<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/img/lufei.ico?v=5.1.2" />






<meta name="description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">
<meta property="og:type" content="website">
<meta property="og:title" content="Youmai ã® Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Youmai ã® Blog">
<meta property="og:description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Youmai ã® Blog">
<meta name="twitter:description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Youmai ã® Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-63551049-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Youmai ã® Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/17/Dockeræ•°æ®ç®¡ç†-Volumeï¼Œ-bind-mountå’Œtmpfs-mount/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/17/Dockeræ•°æ®ç®¡ç†-Volumeï¼Œ-bind-mountå’Œtmpfs-mount/" itemprop="url">Dockeræ•°æ®ç®¡ç†-Volumeï¼Œ bind mountå’Œtmpfs mount</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-17T20:52:02+08:00">
                2017-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æˆ‘ä»¬å¯ä»¥å°†æ•°æ®å†™åˆ°å®¹å™¨çš„å¯å†™å…¥å±‚ï¼Œä½†æ˜¯è¿™ç§å†™å…¥æ˜¯æœ‰ç¼ºç‚¹çš„ï¼š</p>
<ul>
<li>å½“å®¹å™¨åœæ­¢è¿è¡Œæ—¶ï¼Œå†™å…¥çš„æ•°æ®ä¼šä¸¢å¤±ã€‚ä½ ä¹Ÿå¾ˆéš¾å°†è¿™äº›æ•°æ®ä»å®¹å™¨ä¸­å–å‡ºæ¥ç»™å¦å¤–çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚</li>
<li>å®¹å™¨çš„å¯å†™å…¥å±‚ä¸å®¿ä¸»æœºæ˜¯ç´§å¯†è€¦åˆçš„ã€‚è¿™äº›å†™å…¥çš„æ•°æ®åœ¨å¯ä»¥è½»æ˜“åœ°è¢«åˆ æ‰ã€‚</li>
<li>å†™å…¥å®¹å™¨çš„å¯å†™å…¥å±‚éœ€è¦ä¸€ä¸ª<a href="https://docs.docker.com/engine/userguide/storagedriver/" target="_blank" rel="external">å­˜å‚¨é©±åŠ¨</a>ï¼ˆ<code>storage driver</code>ï¼‰æ¥ç®¡ç†æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ä¸ªå­˜å‚¨é©±åŠ¨é€šè¿‡linuxå†…æ ¸æä¾›äº†ä¸€ä¸ª<code>union filesystem</code>ã€‚ç›¸æ¯”äºæ•°æ®å·ï¼ˆ<code>data volume</code>ï¼‰ï¼Œè¿™ç§é¢å¤–çš„æŠ½è±¡ä¼šé™ä½æ€§èƒ½ã€‚</li>
</ul>
<p>Dockeræä¾›äº†3ç§æ–¹æ³•å°†æ•°æ®ä»Dockerå®¿ä¸»æœºæŒ‚è½½ï¼ˆmountï¼‰åˆ°å®¹å™¨ï¼š<code>volumes</code>ï¼Œ<code>bind mounts</code>å’Œ<code>tmpfs mounts</code>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<code>volumes</code>æ€»æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p>
<p>##é€‰æ‹©åˆé€‚çš„æŒ‚è½½æ–¹å¼</p>
<p>ä¸ç®¡ä½ é€‰æ‹©å“ªç§æŒ‚è½½æ–¹å¼ï¼Œä»å®¹å™¨ä¸­çœ‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ•°æ®åœ¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­è¢«å±•ç¤ºä¸ºä¸€ä¸ªç›®å½•æˆ–è€…ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚</p>
<p>ä¸€ä¸ªç®€å•åŒºåˆ†<code>volumes</code>ï¼Œ<code>bind mounts</code>å’Œ<code>tmpfs mounts</code>ä¸åŒç‚¹çš„æ–¹æ³•æ˜¯ï¼šæ€è€ƒæ•°æ®åœ¨å®¿ä¸»æœºä¸Šæ˜¯å¦‚ä½•å­˜åœ¨çš„ã€‚</p>
<p><img src="/img/types-of-mounts.png" alt="different mount"></p>
<ul>
<li><strong>Volumes</strong>ç”±Dockerç®¡ç†ï¼Œå­˜å‚¨åœ¨å®¿ä¸»æœºçš„æŸä¸ªåœ°æ–¹ï¼ˆåœ¨linuxä¸Šæ˜¯<code>/var/lib/docker/volumes/</code>ï¼‰ã€‚éDockeråº”ç”¨ç¨‹åºä¸èƒ½æ”¹åŠ¨è¿™ä¸€ä½ç½®çš„æ•°æ®ã€‚Volumesæ˜¯Dockeræœ€å¥½çš„æ•°æ®æŒä¹…åŒ–æ–¹æ³•ã€‚</li>
<li><strong>Bind mounts</strong>çš„æ•°æ®å¯ä»¥å­˜æ”¾åœ¨å®¿ä¸»æœºçš„ä»»ä½•åœ°æ–¹ã€‚æ•°æ®ç”šè‡³å¯ä»¥æ˜¯é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•ã€‚éDockeråº”ç”¨ç¨‹åºå¯ä»¥æ”¹å˜è¿™äº›æ•°æ®ã€‚</li>
<li><strong>tmpfs mounts</strong>çš„æ•°æ®åªå­˜å‚¨åœ¨å®¿ä¸»æœºçš„å†…å­˜ä¸­ï¼Œä¸ä¼šå†™å…¥åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚</li>
</ul>
<h2 id="æ›´è¯¦ç»†çš„Diff"><a href="#æ›´è¯¦ç»†çš„Diff" class="headerlink" title="æ›´è¯¦ç»†çš„Diff"></a>æ›´è¯¦ç»†çš„Diff</h2><ul>
<li><p><strong>Volumes</strong>ï¼šç”±Dockeråˆ›å»ºå’Œç®¡ç†ã€‚ä½ å¯ä»¥é€šè¿‡<code>docker volume create</code>å‘½ä»¤æ˜¾å¼åœ°åˆ›å»º<code>volume</code>ï¼ŒDockerä¹Ÿå¯ä»¥åœ¨åˆ›å»ºå®¹å™¨æˆ–æœåŠ¡æ˜¯è‡ªå·±åˆ›å»ºvolumeã€‚</p>
<p>å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªvolumeï¼Œå®ƒä¼šè¢«å­˜æ”¾åœ¨å®¿ä¸»æœºçš„ä¸€ä¸ªç›®å½•ä¸‹ã€‚å½“ä½ å°†è¿™ä¸ªvolumeæŒ‚è½½åˆ°æŸä¸ªå®¹å™¨æ—¶ï¼Œè¿™ä¸ªç›®å½•å°±æ˜¯æŒ‚è½½åˆ°å®¹å™¨çš„ä¸œè¥¿ã€‚è¿™ä¸€ç‚¹å’Œ<code>bind mounts</code>ç±»ä¼¼ï¼Œé™¤äº†volumesæ˜¯ç”±Dockeråˆ›å»ºçš„ï¼Œå’Œå®¿ä¸»æœºçš„æ ¸å¿ƒï¼ˆ<code>core functionality</code>ï¼‰éš”ç¦»ã€‚</p>
<p>ä¸€ä¸ªvolumeå¯ä»¥åŒæ—¶è¢«æŒ‚è½½åˆ°å‡ ä¸ªå®¹å™¨ä¸­ã€‚å³ä½¿æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä½¿ç”¨è¿™ä¸ªvolumeï¼Œvolumeä¾ç„¶å­˜åœ¨ï¼Œä¸ä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚å¯ä»¥é€šè¿‡<code>docker volume prune</code>æ¸…é™¤ä¸å†ä½¿ç”¨çš„volumesã€‚</p>
<p>volumesä¹Ÿæ”¯æŒ<code>volume driver</code>ï¼Œå¯ä»¥å°†æ•°æ®å­˜æ”¾åœ¨å¦å¤–çš„æœºå™¨æˆ–è€…äº‘ä¸Šã€‚</p>
</li>
<li><p><strong>Bind mounts</strong>ï¼šDockeræ—©æœŸå°±æ”¯æŒè¿™ä¸ªç‰¹æ€§ã€‚ä¸volumesç›¸æ¯”ï¼Œ<code>Bind mounts</code>æ”¯æŒçš„åŠŸèƒ½æœ‰é™ã€‚ä½¿ç”¨<code>bind mounts</code>æ—¶ï¼Œå®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•è¢«æŒ‚è½½åˆ°å®¹å™¨ä¸Šã€‚</p>
<blockquote>
<p>è­¦å‘Šï¼šä½¿ç”¨<code>Bind mounts</code>çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ï¼Œå®¹å™¨ä¸­è¿è¡Œçš„ç¨‹åºå¯ä»¥ä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬åˆ›å»ºï¼Œä¿®æ”¹ï¼Œåˆ é™¤é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•ã€‚è¿™ä¸ªåŠŸèƒ½å¯èƒ½ä¼šæœ‰å®‰å…¨é—®é¢˜ã€‚</p>
</blockquote>
</li>
<li><p><strong>tmpfs mounts</strong>ï¼š<code>tmpfs mounts</code>çš„æ•°æ®ä¸ä¼šè½ç›˜ã€‚åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥å­˜å‚¨ä¸€äº›ä¸éœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€æˆ–æ•æ„Ÿæ•°æ®ã€‚ä¾‹å¦‚ï¼Œ<code>swarm</code>æœåŠ¡é€šè¿‡<code>tmpfs mounts</code>æ¥å°†<a href="https://docs.docker.com/engine/swarm/secrets/" target="_blank" rel="external">secrets</a>æŒ‚è½½åˆ°ä¸€ä¸ªæœåŠ¡çš„å®¹å™¨ä¸­å»ã€‚</p>
</li>
</ul>
<h2 id="é€‚åˆVolumesçš„åœºæ™¯"><a href="#é€‚åˆVolumesçš„åœºæ™¯" class="headerlink" title="é€‚åˆVolumesçš„åœºæ™¯"></a>é€‚åˆVolumesçš„åœºæ™¯</h2><ul>
<li>åœ¨ä¸åŒçš„å®¹å™¨ä¸­å…±äº«æ•°æ®ã€‚If you donâ€™t explicitly create it, a volume is created the first time it is mounted into a container. When that container stops or is removed, the volume still exists. Multiple containers can mount the same volume simultaneously, either read-write or read-only. <strong>Volumes are only removed when you explicitly remove them</strong>.</li>
<li>When the Docker host is not guaranteed to have a given directory or file structure. Volumes help you decouple the configuration of the Docker host from the container runtime.</li>
<li>When you want to store your containerâ€™s data on a remote host or a cloud provider, rather than locally.</li>
<li>å½“ä½ éœ€è¦å¤‡ä»½æˆ–è¿ç§»æ•°æ®çš„æ—¶å€™ï¼ŒWhen you need to be able to back up, restore, or migrate data from one Docker host to another, volumes are a better choice. You can stop containers using the volume, then back up the volumeâ€™s directory (such as /var/lib/docker/volumes/<volume-name>).</volume-name></li>
</ul>
<h2 id="é€‚åˆbind-mountsçš„åœºæ™¯"><a href="#é€‚åˆbind-mountsçš„åœºæ™¯" class="headerlink" title="é€‚åˆbind mountsçš„åœºæ™¯"></a>é€‚åˆbind mountsçš„åœºæ™¯</h2><ul>
<li>å®¿ä¸»æœºå’Œå®¹å™¨å…±äº«é…ç½®æ–‡ä»¶ã€‚Dockeræä¾›çš„DNSè§£å†³æ–¹æ¡ˆå°±æ˜¯å¦‚æ­¤ï¼Œå°†å®¿ä¸»æœºçš„<code>/etc/resolv.conf</code>æŒ‚è½½åˆ°æ¯ä¸ªå®¹å™¨ä¸­ã€‚</li>
<li>å¼€å‘ç¯å¢ƒéœ€è¦åœ¨å®¿ä¸»æœºå’Œå®¹å™¨ä¸­å…±äº«ä»£ç ã€‚dockerçš„å¼€å‘å°±æ˜¯å¦‚æ­¤ï¼Œæ¯•ç«Ÿå®¹å™¨ä¸­ä¸€èˆ¬æ˜¯æ²¡æœ‰ç¼–è¾‘å™¨çš„</li>
<li>When the file or directory structure of the Docker host is guaranteed to be consistent with the bind mounts the containers require.</li>
</ul>
<h2 id="é€‚åˆtmpfs-mountsçš„åœºæ™¯"><a href="#é€‚åˆtmpfs-mountsçš„åœºæ™¯" class="headerlink" title="é€‚åˆtmpfs mountsçš„åœºæ™¯"></a>é€‚åˆtmpfs mountsçš„åœºæ™¯</h2><p><code>tmpfs mounts</code>ä¸»è¦ç”¨åœ¨ä½ æ—¢ä¸æƒ³åœ¨å®¹å™¨å†…ï¼Œåˆä¸æƒ³åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¿å­˜æ•°æ®çš„æ—¶å€™ã€‚è¿™å¯èƒ½æ˜¯å‡ºäºå®‰å…¨åŸå› ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½ çš„åº”ç”¨éœ€è¦å†™éå¸¸å¤šçš„éæŒä¹…åŒ–æ•°æ®ï¼Œ<code>tmpfs mounts</code>è¿™æ—¶å€™å¯ä»¥ä¿è¯å®¹å™¨æ€§èƒ½ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/16/docker-swarméƒ¨ç½²åº”ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/16/docker-swarméƒ¨ç½²åº”ç”¨/" itemprop="url">docker swarméƒ¨ç½²åº”ç”¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-16T21:42:58+08:00">
                2017-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h2><h3 id="ä»€ä¹ˆæ˜¯swarm"><a href="#ä»€ä¹ˆæ˜¯swarm" class="headerlink" title="ä»€ä¹ˆæ˜¯swarm"></a>ä»€ä¹ˆæ˜¯swarm</h3><p>ä¸€ä¸ª<code>swarm</code>å°±æ˜¯ä¸€ç»„è¿è¡Œ<code>Docker</code>å¹¶ç»„æˆé›†ç¾¤çš„æœºå™¨ã€‚ä¹‹åï¼Œä½ ç»§ç»­è¿è¡Œä»¥å‰ä½¿ç”¨çš„<code>Dockerå‘½ä»¤</code>ï¼Œä½†ç°åœ¨å®ƒä»¬æ˜¯ç”±<code>swarm manager</code>(ä¹Ÿæ˜¯ä¸€å°æœºå™¨ï¼Œæ‰§è¡Œ<code>docker swarm init</code>çš„å°±æ˜¯<code>manager</code>)åœ¨é›†ç¾¤ä¸Šæ‰§è¡Œã€‚é›†ç¾¤ä¸­çš„æœºå™¨å¯ä»¥æ˜¯ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºã€‚åŠ å…¥é›†ç¾¤åï¼Œå®ƒä»¬è¢«ç§°ä¸º<code>èŠ‚ç‚¹</code>ï¼ˆnodeï¼‰ã€‚</p>
<p><code>swarm manager</code>å¯ä»¥ä½¿ç”¨å‡ ç§ç­–ç•¥æ¥è¿è¡Œå®¹å™¨ï¼Œä¾‹å¦‚â€œæœ€ç©ºçš„èŠ‚ç‚¹â€ï¼ˆ<code>empties node</code>ï¼‰ - å°†å®¹å™¨æ”¾åˆ°åˆ©ç”¨ç‡æœ€ä½çš„æœºå™¨ä¸Šã€‚æˆ–è€…â€œå…¨å±€â€ï¼ˆ<code>global</code>ï¼‰æ¨¡å¼ï¼Œå®ƒç¡®ä¿æ¯å°æœºå™¨åªèƒ½è·å¾—æŒ‡å®šå®¹å™¨çš„ä¸€ä¸ªå®ä¾‹ã€‚ä½ é€šè¿‡åœ¨<code>composeæ–‡ä»¶</code>æ¥æŒ‡ç¤º<code>swarm manager</code>ä½¿ç”¨è¿™äº›ç­–ç•¥ã€‚</p>
<p><code>swarm manager</code>æ˜¯é›†ç¾¤ä¸­å”¯ä¸€å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„æœºå™¨ï¼Œä¹Ÿæ˜¯å”¯ä¸€å¯ä»¥æˆæƒå…¶ä»–æœºå™¨ä½œä¸º<code>worker</code>åŠ å…¥é›†ç¾¤çš„æœºå™¨ã€‚<code>worker</code>åªæä¾›<code>capacity</code>ï¼Œå®ƒæ— æ³•å‘Šè¯‰ä»»ä½•å…¶ä»–æœºå™¨å®ƒå¯ä»¥åšä»€ä¹ˆå’Œä¸èƒ½åšä»€ä¹ˆã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯slack"><a href="#ä»€ä¹ˆæ˜¯slack" class="headerlink" title="ä»€ä¹ˆæ˜¯slack"></a>ä»€ä¹ˆæ˜¯slack</h3><p><code>stack</code>æ˜¯ä¸€ç»„ç›¸äº’å…³è”çš„æœåŠ¡ï¼Œå¯ä»¥è¢«ä¸€èµ·ç¼–æ’ã€‚<code>å•ä¸ªstack</code>èƒ½å¤Ÿå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼ˆå°½ç®¡éå¸¸å¤æ‚çš„åº”ç”¨ç¨‹åºå¯èƒ½å¸Œæœ›ä½¿ç”¨å¤šä¸ªstackï¼‰ã€‚</p>
<h2 id="Set-up-your-swarm"><a href="#Set-up-your-swarm" class="headerlink" title="Set up your swarm"></a>Set up your swarm</h2><p>ä¸€ä¸ª<code>swarm</code>ç”±å¾ˆå¤š<code>node</code>ç»„æˆï¼Œ<code>node</code>å¯ä»¥æ˜¯ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºã€‚åŸºæœ¬æ¦‚å¿µå¾ˆç®€å•ï¼šè¿è¡Œ<code>docker swarm init</code>å¯ç”¨é›†ç¾¤æ¨¡å¼ï¼Œä½¿å½“å‰çš„æœºå™¨æˆä¸º<code>manager</code>ï¼Œç„¶ååœ¨å…¶ä»–æœºå™¨ä¸Šè¿è¡Œ<code>docker swarm join</code>ï¼Œä½¿ä»–ä»¬ä»¥<code>worker</code>èº«ä»½åŠ å…¥é›†ç¾¤ã€‚</p>
<h3 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨æœ¬æœºåˆ›å»ºå‡ å°è™šæ‹Ÿæœºæ¥åˆ›å»ºæˆ‘ä»¬çš„é›†ç¾¤ï¼ˆéœ€è¦å®‰è£…<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="external">VirtualBox</a>ï¼‰</p>
<p>é¦–å…ˆï¼Œä½¿ç”¨<code>docker-machine</code>å‘½ä»¤ï¼Œé€šè¿‡<code>VirtualBox</code>é©±åŠ¨åˆ›å»ºä¸¤å°è™šæ‹Ÿæœºï¼Œ<code>myvm1</code>å’Œ<code>myvm2</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> docker-machine create --driver virtualbox myvm1</div><div class="line"><span class="meta">$</span> docker-machine create --driver virtualbox myvm2</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†<code>myvm1</code>ç”¨ä½œmanagerï¼Œå®ƒå¯ä»¥æ‰§è¡Œdockerå‘½ä»¤å’Œæˆæƒåˆ«çš„workeråŠ å…¥swarmï¼Œ<code>myvm2</code>å°†ä½œä¸ºworkerã€‚</p>
<p>ç™»å½•<code>docker-machine</code>åˆ›å»ºçš„è™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨<code>docker-machine sshå‘½ä»¤</code>,ä¸‹é¢æˆ‘ä»¬è®¾ç½®<code>myvm1</code>ä¸ºmanagerï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ls</div><div class="line">NAME    ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS</div><div class="line">myvm1   -        virtualbox   Running   tcp://192.168.99.101:2376           v17.06.2-ce</div><div class="line">myvm2   -        virtualbox   Running   tcp://192.168.99.102:2376           v17.06.2-ce</div><div class="line">âœ  docker-machine ssh myvm1 "docker swarm init --advertise-addr 192.168.99.101:2377"</div><div class="line"></div><div class="line">Swarm initialized: current node (u5e02o4thu4uurxm9w71kxtu5) is now a manager.</div><div class="line"></div><div class="line">To add a worker to this swarm, run the following command:</div><div class="line"></div><div class="line">    docker swarm join --token SWMTKN-1-02sp63h6alkj7sd57dkv6omkyvkb60y05delt5zvkspe0293ao-dtmm6kqjzbbe33jmo03yrml8t 192.168.99.101:2377</div><div class="line"></div><div class="line">To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›å€¼ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªé…ç½®å¥½çš„<code>docker swarm join</code>å‘½ä»¤ï¼Œå¤åˆ¶è¿™ä¸ªå‘½ä»¤ï¼Œåœ¨myvm2ä¸Šæ‰§è¡Œï¼Œä½¿myvm2åŠ å…¥ä½ çš„swarmä½œä¸ºworkerï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ssh myvm2 "docker swarm join --token SWMTKN-1-02sp63h6alkj7sd57dkv6omkyvkb60y05delt5zvkspe0293ao-dtmm6kqjzbbe33jmo03yrml8t 192.168.99.101:2377"</div><div class="line">This node joined a swarm as a worker.</div></pre></td></tr></table></figure>
<p>ğŸ‰ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª<code>swarm</code>åˆ›å»ºæˆåŠŸäº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç™»ä¸Š<code>myvm1</code>å»çœ‹çœ‹ç°åœ¨çš„èŠ‚ç‚¹æƒ…å†µï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ssh myvm1</div><div class="line">                        ##         .</div><div class="line">                  ## ## ##        ==</div><div class="line">               ## ## ## ## ##    ===</div><div class="line">           /"""""""""""""""""\___/ ===</div><div class="line">      ~~~ &#123;~~ ~~~~ ~~~ ~~~~ ~~~ ~ /  ===- ~~~</div><div class="line">           \______ o           __/</div><div class="line">             \    \         __/</div><div class="line">              \____\_______/</div><div class="line"> _                 _   ____     _            _</div><div class="line">| |__   ___   ___ | |_|___ \ __| | ___   ___| | _____ _ __</div><div class="line">| '_ \ / _ \ / _ \| __| __) / _` |/ _ \ / __| |/ / _ \ '__|</div><div class="line">| |_) | (_) | (_) | |_ / __/ (_| | (_) | (__|   &lt;  __/ |</div><div class="line">|_.__/ \___/ \___/ \__|_____\__,_|\___/ \___|_|\_\___|_|</div><div class="line">Boot2Docker version 17.06.2-ce, build HEAD : ff16afa - Wed Sep  6 00:17:25 UTC 2017</div><div class="line">Docker version 17.06.2-ce, build cec0b72</div><div class="line"></div><div class="line">docker@myvm1:~$ docker node ls</div><div class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</div><div class="line">ggr9eji9z868qrorwerufrr45     myvm2               Ready               Active</div><div class="line">u5e02o4thu4uurxm9w71kxtu5 *   myvm1               Ready               Active              Leader</div></pre></td></tr></table></figure>
<p>ä¸€ç›®äº†ç„¶ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªnodeï¼Œmyvm1æ˜¯ä½œä¸ºleaderå­˜åœ¨</p>
<h2 id="éƒ¨ç½²åº”ç”¨"><a href="#éƒ¨ç½²åº”ç”¨" class="headerlink" title="éƒ¨ç½²åº”ç”¨"></a>éƒ¨ç½²åº”ç”¨</h2><p>æˆ‘ä»¬ä½¿ç”¨<a href="https://github.com/michaelyou/docker_swarm_deploy" target="_blank" rel="external">è¿™ä¸ª</a>ç®€å•çš„pythonåº”ç”¨æ¥ä½œä¸ºéƒ¨ç½²å¯¹è±¡ï¼Œä½ å®Œå…¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„åº”ç”¨ç¨‹åº(ä½†è¿˜æ˜¯å»ºè®®ç”¨æˆ‘ä½¿ç”¨çš„è¿™ä¸ªç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨æ‰“å°äº†containerçš„hostnameï¼Œè¿™æ˜¯ä¸‹é¢è´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªæµ‹è¯•)ã€‚</p>
<p>é¦–å…ˆå°†<code>docker-compose.yml</code>æ‹·è´åˆ°<code>myvm1</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine scp docker-compose.yml myvm1:~</div></pre></td></tr></table></figure>
<p>ç„¶åå°±æ˜¯éƒ¨ç½²äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker-machine ssh myvm1 "docker stack deploy -c docker-compose.yml firstswarmapp"</div><div class="line"></div><div class="line">Creating service firstswarmapp_visualizer</div><div class="line">Creating service firstswarmapp_redis</div><div class="line">Creating service firstswarmapp_web</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™éƒ¨ç½²å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æˆæœï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ssh myvm1 "docker stack ls"</div><div class="line">NAME                SERVICES</div><div class="line">firstswarmapp       1</div><div class="line">âœ  docker-machine ssh myvm1 "docker stack ps firstswarmapp"</div><div class="line">ID                  NAME                  IMAGE                         NODE                DESIRED STATE       CURRENT STATE                  ERROR               PORTS</div><div class="line">ID                  NAME                         IMAGE                             NODE                DESIRED STATE       CURRENT STATE                 ERROR                              PORTS</div><div class="line">6lfkdnzq27yf        firstswarmapp_redis.1        redis:latest                      myvm1               Running             Running 43 seconds ago</div><div class="line">ui2tdail0fxv        firstswarmapp_visualizer.1   dockersamples/visualizer:stable   myvm1               Running             Running 2 minutes ago</div><div class="line">901cprboy06k        firstswarmapp_web.1          michaelyou/friendlyhello:v1       myvm2               Running             Running 33 minutes ago</div><div class="line">uvju8t48sc2s        firstswarmapp_web.2          michaelyou/friendlyhello:v1       myvm2               Running             Running 33 minutes ago</div><div class="line">sk2z91e4yn9x        firstswarmapp_web.3          michaelyou/friendlyhello:v1       myvm1               Running             Running 34 minutes ago</div><div class="line">tuzdxnfyofyc        firstswarmapp_web.4          michaelyou/friendlyhello:v1       myvm2               Running             Running 33 minutes ago</div><div class="line">715at7211p8k        firstswarmapp_web.5          michaelyou/friendlyhello:v1       myvm1               Running             Running 34 minutes ago</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸€å…±æœ‰7ä¸ª<code>container</code>ã€‚<code>web</code>5ä¸ªï¼Œåˆ†å¸ƒåœ¨ä¸¤å°æœºå™¨ä¸Šï¼Œ<code>redis</code>å’Œ<code>visualizer</code>å„ä¸€ä¸ªï¼Œåœ¨<code>managerèŠ‚ç‚¹</code>ä¸Šã€‚è¿™å’Œæˆ‘ä»¬åœ¨<code>docker-compose.yml</code>ä¸­å®šä¹‰çš„ä¸€æ ·ã€‚</p>
<p><code>myvm1</code>å’Œ<code>myvm2</code>çš„åœ°å€éƒ½å¯ä»¥è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ã€‚ä½ åˆ›å»ºçš„ç½‘ç»œåœ¨å®ƒä»¬ä¹‹é—´æ˜¯å…±äº«ï¼Œå¹¶ä¸”è´Ÿè½½å¹³è¡¡çš„ã€‚è¿è¡Œ<code>docker-machine ls</code>æ¥è·å–ä½ çš„è™šæ‹Ÿæœºçš„IPåœ°å€ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸Šè®¿é—®å®ƒä»¬ï¼Œå¹¶åˆ·æ–°ã€‚ä½ ä¼šçœ‹åˆ°äº”ä¸ªå¯èƒ½çš„å®¹å™¨IDï¼Œå®ƒä»¬éšæœºå¾ªç¯ï¼Œæ˜¾ç¤ºäº†è´Ÿè½½å¹³è¡¡çš„å­˜åœ¨ã€‚</p>
<p>ä¸¤ä¸ªIPåœ°å€éƒ½èƒ½å·¥ä½œçš„åŸå› æ˜¯ç¾¤é›†ä¸­çš„èŠ‚ç‚¹åŠ å…¥äº†ä¸€ä¸ªå…¥å£è·¯ç”±ç½‘æ ¼ï¼ˆrouting meshï¼‰ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨é›†ç¾¤ä¸­æŸä¸ªç«¯å£éƒ¨ç½²çš„æœåŠ¡å§‹ç»ˆå°†è¯¥ç«¯å£ä¿ç•™ç»™å…¶è‡ªå·±ï¼Œæ— è®ºå®é™…è¿è¡Œå®¹å™¨çš„æ˜¯å“ªä¸ªèŠ‚ç‚¹ã€‚ä»¥ä¸‹æ˜¯åœ¨ä¸€ä¸ªä¸‰èŠ‚ç‚¹é›†ç¾¤çš„8080ç«¯å£ä¸Šéƒ¨ç½²çš„åä¸ºmy-webçš„æœåŠ¡çš„è·¯ç”±ç½‘æ ¼ç¤ºæ„å›¾ï¼š</p>
<p><img src="/img/ingress-routing-mesh.png" alt="ingress-routing-mesh"></p>
<p>å¦‚æœæƒ³è¦å¢åŠ å®¹å™¨ä¸ªæ•°ï¼Œåªè¦ä¿®æ”¹<code>docker-compose.yml</code>æ–‡ä»¶ä¸­çš„replicasçš„æ•°é‡ï¼Œç„¶åé‡æ–°æ‰§è¡Œdeployå°±å¯ä»¥äº†ã€‚</p>
<p>å¦‚æœè¦åŠ å…¥æ–°çš„nodeï¼Œåªè¦åœ¨æ–°çš„æœºå™¨ä¸Šæ‰§è¡Œæˆ‘ä»¬åœ¨<code>myvm2</code>ä¸Šæ‰§è¡Œçš„<code>docker swarm join</code>å‘½ä»¤å°±å¯ä»¥äº†ï¼ŒåŠ å…¥æ–°çš„èŠ‚ç‚¹åï¼Œé‡æ–°æ‰§è¡Œdeployï¼Œæˆ‘ä»¬å°±èƒ½ç”¨ä¸Šæ–°çš„æœºå™¨äº†ï¼ˆæ³¨æ„è¦é‡æ–°æ‰§è¡Œdeployï¼Œä¸ä¼šè‡ªåŠ¨deployï¼Œè¿™ä¸€ç‚¹å’Œelasticsearchç­‰è½¯ä»¶ä¸ä¸€æ ·ï¼‰ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬éƒ¨ç½²äº†visualizerï¼Œå¯ä»¥é€šè¿‡ç½‘é¡µæ¥çœ‹çœ‹æˆ‘ä»¬é›†ç¾¤ç°åœ¨çš„æƒ…å†µï¼š</p>
<p><img src="/img/my_swarm.png" alt="my swarm"></p>
<p>è·Ÿ<code>docker stack ps</code>è¾“å‡ºæ˜¯ä¸€è‡´çš„ã€‚</p>
<h2 id="æ¸…ç†"><a href="#æ¸…ç†" class="headerlink" title="æ¸…ç†"></a>æ¸…ç†</h2><p>æ¸…ç†stack</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine ssh myvm1 "docker stack rm firstswarmapp"</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™swarmè¿˜æ˜¯åœ¨çš„ï¼Œæ¸…ç†swarmï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine ssh myvm1 "docker swarm leave --force"</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/12/dockeræºç åˆ†æ1-cli/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/12/dockeræºç åˆ†æ1-cli/" itemprop="url">dockeræºç åˆ†æï¼ˆä¸€ï¼‰-cli</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-12T20:41:10+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Dockerä»£ç æ›´æ–°å¾ˆå¿«ï¼Œç½‘ä¸Šå„ä½å¤§ç¥çš„æºç è§£æå¾ˆå¤šå·²ç»æ˜¯å‡ å¹´å‰çš„ç‰ˆæœ¬äº†ã€‚å®ç°ä¸Šæœ‰äº†å¾ˆå¤§æ”¹å˜ï¼ŒåŠ ä¹‹Dockeré¡¹ç›®æ›´åä¸º<a href="https://github.com/moby/moby" target="_blank" rel="external">moby</a>ï¼Œå…¶ä¸­å¾ˆå¤šç»„ä»¶åˆä»mobyä¸­æ‹†åˆ†äº†å‡ºæ¥ï¼Œä¸€å¼€å§‹çœ‹ç®€ç›´æ˜¯ä¸€è„¸æ‡µé€¼å•Šã€‚åœ¨è¿™é‡Œè·Ÿå¤§å®¶åˆ†äº«äº†ä¸€ä¸‹æœ€è¿‘çœ‹çš„<a href="https://github.com/docker/cli" target="_blank" rel="external">docker/cli</a>çš„æºç ï¼ŒæŠ›ç –å¼•ç‰ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p>
<p>åˆ†æçš„<code>docker client</code>ç‰ˆæœ¬æ˜¯<code>17.06.2-ce</code>ã€‚</p>
<p><code>docker client</code>æ˜¯Dockerçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ•²çš„<code>docker * *</code> å‘½ä»¤ï¼Œæˆ‘ä»¬é€šè¿‡ä»–ä¸<code>docker deamon</code>ç¨‹åºè¿›è¡Œäº¤äº’ã€‚å¯ä»¥å°†ä»–çœ‹æˆä¸€ä¸ªæ™®é€šçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œdockerçš„æ ¸å¿ƒ<code>namespace</code>å’Œ<code>cgroup</code>ç­‰æŠ€æœ¯éƒ½ä¸åœ¨è¿™é‡Œã€‚</p>
<h2 id="æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ"><a href="#æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ" class="headerlink" title="æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ"></a>æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ</h2><p><code>docker_client</code>çš„å¼€å‘ç¯å¢ƒä¹Ÿæ˜¯åœ¨å®¹å™¨ä¸­ï¼Œé¡¹ç›®å·²ç»ç»™æˆ‘ä»¬åšå¥½äº†å°è£…ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé¡¹ç›®Readmeçš„<a href="https://github.com/docker/cli#development" target="_blank" rel="external">Development</a>ç« èŠ‚ã€‚</p>
<p>é—®å‡ ä¸ªé—®é¢˜ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼š</p>
<h4 id="1-å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ"><a href="#1-å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ" class="headerlink" title="1. å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ"></a>1. å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ</h4><p>ç­”ï¼š å‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯åœ¨å®¹å™¨ä¸­è°ƒè¯•ï¼Œå¼€å‘è¿˜æ˜¯åœ¨æœ¬åœ°å¼€å‘ï¼Œå®¹å™¨ä¸­çœ‹åˆ°çš„ç›®å½•æ˜¯æˆ‘ä»¬æœ¬åœ°ç›®å½•mountè¿›å»çš„</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> docker.Makefileæ–‡ä»¶</div><div class="line"></div><div class="line">......</div><div class="line">MOUNTS = -v "$(CURDIR)":/go/src/github.com/docker/cli</div><div class="line">......</div><div class="line"><span class="meta">#</span> start container in interactive mode for in-container development</div><div class="line">.PHONY: dev</div><div class="line">dev: build_docker_image</div><div class="line">    docker run -ti --security-opt=seccomp:unconfined $(ENVVARS) $(MOUNTS) \</div><div class="line">        -v /var/run/docker.sock:/var/run/docker.sock \</div><div class="line">        $(DEV_DOCKER_IMAGE_NAME) ash</div><div class="line"></div><div class="line">shell: dev</div><div class="line">......</div></pre></td></tr></table></figure>
<p>ä»shellé‡Œé¢è¿˜æ˜¯å¾ˆå®¹å™¨çœ‹å‡ºæ¥çš„ï¼Œrunçš„æ—¶å€™mountäº†<code>$(CURDIR)</code></p>
<h4 id="2-å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ"><a href="#2-å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ" class="headerlink" title="2. å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ"></a>2. å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ</h4><p>ç­”ï¼šä¸æ˜¯çš„ï¼Œé‡Œé¢åªæœ‰ä½ ç¼–è¯‘ç”Ÿæˆçš„docker clientç¨‹åºï¼Œæ˜¯æ²¡æœ‰docker deamonç¨‹åºï¼Œè‡³äºä¸ºä»€ä¹ˆèƒ½å“åº”ï¼Œè¿˜æ˜¯çœ‹ä¸Šé¢çš„shellè„šæœ¬ï¼Œ<code>-v /var/run/docker.sock:/var/run/docker.sock</code>è¿™ä¸€è¡Œå°†<code>docker.sock</code>æ–‡ä»¶ä¹Ÿmountäº†è¿›å»ï¼Œ<code>docker.sock</code>æ˜¯<code>docker deamon</code>é»˜è®¤ç›‘å¬çš„Unixå¥—æ¥å­—ï¼ˆUnix domain socketï¼‰ï¼Œå®¹å™¨ä¸­çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ä»–ä¸docker deamonè¿›è¡Œé€šä¿¡ã€‚æ‰€ä»¥è¿™é‡Œdocker clienté€šä¿¡çš„æ˜¯ä½ æœ¬æœºçš„docker daemonã€‚</p>
<p><img src="/img/docker_deamon_socket.png" alt="docker_deamon_socket"></p>
<blockquote>
<p>Note: å…³äº<code>/var/run/docker.sock</code>æ›´å¤šå†…å®¹å¯ä»¥çœ‹<a href="https://medium.com/lucjuggery/about-var-run-docker-sock-3bfd276e12fd" target="_blank" rel="external">è¿™é‡Œ</a></p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬çš„å¼€å‘æµç¨‹æ˜¯ï¼šæœ¬åœ°æ”¹ä»£ç â€“&gt;åˆ°containerä¸­ç¼–è¯‘â€“&gt;è¿è¡Œdocker clientçœ‹æ•ˆæœ</p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>æ˜¯æ—¶å€™è¡¨æ¼”çœŸæ­£çš„æŠ€æœ¯äº†ï¼</p>
<p>ğŸ˜†ï¼Œå¼€ä¸ªç©ç¬‘ï¼Œä¸‹é¢çš„åˆ†æå¦‚æœæœ‰é—®é¢˜ï¼Œè¿˜è¯·å¤§å®¶ä¸åèµæ•™ï¼</p>
<p>æˆ‘å°½é‡æŠŠæ–‡ä»¶è·¯å¾„åˆ—å‡ºæ¥ï¼Œä¼šè´´ä¸€äº›ä»£ç ï¼Œä½†ä¸»è¦è¿˜æ˜¯è·¯å¾„ï¼Œå»ºè®®å¤§å®¶æŠŠä»£ç cloneä¸‹æ¥ç…§ç€çœ‹ã€‚</p>
<p>dockerâ€”clientæ˜¯åŸºäº<a href="https://github.com/spf13/cobra" target="_blank" rel="external">cobra</a>å†™çš„ï¼Œå»ºè®®å¤§å®¶å…ˆçœ‹ä¸€ä¸‹cobraï¼Œè‡³å°‘å†™ä¸ª<code>hello world</code>ç†Ÿæ‚‰ä¸€ä¸‹åŸºæœ¬ç”¨æ³•ã€‚</p>
<p>æˆ‘ä»¬å¼€å§‹äº†ï¼</p>
<p>å…¥å£æ–‡ä»¶åœ¨<code>cmd/docker/docker.go</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// æ—¥å¿—è¾“å‡ºé‡‡ç”¨äº†ç¬¬ä¸‰æ–¹åº“logrus</span></div><div class="line">    <span class="comment">// Set terminal emulation based on platform as required.</span></div><div class="line">    stdin, stdout, stderr := term.StdStreams()</div><div class="line">    logrus.SetOutput(stderr)</div><div class="line"></div><div class="line">    dockerCli := command.NewDockerCli(stdin, stdout, stderr)</div><div class="line">    </div><div class="line">    <span class="comment">// rootå‘½ä»¤ï¼Œå­å‘½ä»¤éƒ½åœ¨è¿™é‡Œé¢ï¼Œé‡ç‚¹çœ‹</span></div><div class="line">    cmd := newDockerCommand(dockerCli)</div><div class="line"></div><div class="line">    <span class="comment">// å‘½ä»¤æ‰§è¡Œ	</span></div><div class="line">    <span class="keyword">if</span> err := cmd.Execute(); err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">if</span> sterr, ok := err.(cli.StatusError); ok &#123;</div><div class="line">            <span class="keyword">if</span> sterr.Status != <span class="string">""</span> &#123;</div><div class="line">                fmt.Fprintln(stderr, sterr.Status)</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// StatusError should only be used for errors, and all errors should</span></div><div class="line">            <span class="comment">// have a non-zero exit status, so never exit with 0</span></div><div class="line">            <span class="keyword">if</span> sterr.StatusCode == <span class="number">0</span> &#123;</div><div class="line">                os.Exit(<span class="number">1</span>)</div><div class="line">            &#125;</div><div class="line">            os.Exit(sterr.StatusCode)</div><div class="line">        &#125;</div><div class="line">        fmt.Fprintln(stderr, err)</div><div class="line">        os.Exit(<span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿˜æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼Œ<code>newDockerCommand</code>å‡½æ•°è°ƒç”¨äº†<code>commands.AddCommands(cmd, dockerCli)</code>æ¥æ·»åŠ å‘½ä»¤ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">newDockerCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        opts := cliflags.NewClientOptions()</div><div class="line">        <span class="keyword">var</span> flags *pflag.FlagSet</div><div class="line"></div><div class="line">        cmd := &amp;cobra.Command&#123;</div><div class="line">                Use:              <span class="string">"docker [OPTIONS] COMMAND [ARG...]"</span>,</div><div class="line">                Short:            <span class="string">"A self-sufficient runtime for containers"</span>,</div><div class="line">                SilenceUsage:     <span class="literal">true</span>,</div><div class="line">                SilenceErrors:    <span class="literal">true</span>,</div><div class="line">                TraverseChildren: <span class="literal">true</span>,</div><div class="line">                Args:             noArgs,</div><div class="line">                RunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="keyword">if</span> opts.Version &#123;</div><div class="line">                                showVersion()</div><div class="line">                                <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> command.ShowHelp(dockerCli.Err())(cmd, args)</div><div class="line">                &#125;,</div><div class="line">                PersistentPreRunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="comment">// daemon command is special, we redirect directly to another binary</span></div><div class="line">                        <span class="keyword">if</span> cmd.Name() == <span class="string">"daemon"</span> &#123;</div><div class="line">                                <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">                        &#125;</div><div class="line">                        <span class="comment">// flags must be the top-level command flags, not cmd.Flags()</span></div><div class="line">                        opts.Common.SetDefaultOptions(flags)</div><div class="line">                        dockerPreRun(opts)</div><div class="line">                        <span class="keyword">if</span> err := dockerCli.Initialize(opts); err != <span class="literal">nil</span> &#123;</div><div class="line">                                <span class="keyword">return</span> err</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> isSupported(cmd, dockerCli)</div><div class="line">                &#125;,</div><div class="line">        &#125;</div><div class="line">        cli.SetupRootCommand(cmd)</div><div class="line"></div><div class="line">        flags = cmd.Flags()</div><div class="line">        flags.BoolVarP(&amp;opts.Version, <span class="string">"version"</span>, <span class="string">"v"</span>, <span class="literal">false</span>, <span class="string">"Print version information and quit"</span>)</div><div class="line">        flags.StringVar(&amp;opts.ConfigDir, <span class="string">"config"</span>, cliconfig.Dir(), <span class="string">"Location of client config files"</span>)</div><div class="line">        opts.Common.InstallFlags(flags)</div><div class="line"></div><div class="line">        setFlagErrorFunc(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        setHelpFunc(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        cmd.SetOutput(dockerCli.Out())</div><div class="line">        cmd.AddCommand(newDaemonCommand())</div><div class="line">        # æ·»åŠ å­å‘½ä»¤ï¼Œcmdé‡Œç°åœ¨æ˜¯rootå‘½ä»¤</div><div class="line">        commands.AddCommands(cmd, dockerCli)</div><div class="line"></div><div class="line">        setValidateArgs(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> cmd</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™è¡Œä¸Šé¢çš„<code>cmd.AddCommand(newDaemonCommand())</code>æ˜¯ä¸º<code>docker daemon</code>å‘½ä»¤è¿›è¡Œçš„è¾“å‡ºï¼Œ<code>newDaemonCommand</code>å®šä¹‰åœ¨<code>cmd/docker/daemon_none.go</code>ä¸­ï¼Œä»ä»–çš„<code>RunE</code>æ–¹æ³•å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯è¾“å‡ºäº†ä¸èƒ½è¿è¡Œçš„æç¤ºï¼Œ<code>runtime.GOOS</code>æ˜¯è¾“å‡ºå½“å‰ç³»ç»Ÿçš„åç§°ï¼Œæ¯”å¦‚macæ˜¯<code>Darwin</code>ï¼Œ ubuntuæ˜¯<code>linux</code>ï¼Œå®Œæ•´çœ‹æ¥å°±æ˜¯:</p>
<pre><code>`docker daemon` is not supported on Darwin. Please run `dockerd` directly
</code></pre><p>è®©æˆ‘ä»¬æ¥åˆ°<code>commands.AddCommands</code>å®šä¹‰çš„åœ°æ–¹ï¼Œ<code>cli/command/commands/commands.go</code>æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°<code>cmd.AddCommand</code>çš„è°ƒç”¨ï¼Œè¿™é‡Œå°±æ˜¯åœ¨æ·»åŠ æˆ‘ä»¬çœ‹åˆ°çš„äºŒçº§å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ç´§è·Ÿç€<code>docker</code>åé¢çš„å‘½ä»¤ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddCommands</span><span class="params">(cmd *cobra.Command, dockerCli *command.DockerCli)</span></span> &#123;</div><div class="line">        cmd.AddCommand(</div><div class="line">                ......</div><div class="line"></div><div class="line">                <span class="comment">// container</span></div><div class="line">                container.NewContainerCommand(dockerCli),</div><div class="line">                container.NewRunCommand(dockerCli),</div><div class="line">                </div><div class="line">                ......</div><div class="line">                hide(container.NewPsCommand(dockerCli)),</div><div class="line">                hide(container.NewRenameCommand(dockerCli)),</div><div class="line">                ......</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä»ä¸Šçœ‹åˆ°ä¸‹ï¼Œæ•´é½åˆ’ä¸€ä¸­å‘ç°æœ€åå¥½å¤šå‘½ä»¤è¢«ç”¨hideåŒ…è£¹äº†ã€‚è¿™äº›å‘½ä»¤æ˜¯ä¸€äº›æ—§å‘½ä»¤ï¼Œåœ¨æ–°çš„ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨æ–°çš„å‘½ä»¤æ¥ä»£æ›¿ï¼Œå¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡<code>DOCKER_HIDE_LEGACY_COMMANDS</code>ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆdockerçš„æç¤ºå°†ä¸ä¼šè¾“å‡ºè¿™äº›ã€‚</p>
<p>è¿™é‡Œçš„å‘½ä»¤å¤ªå¤šäº†ï¼Œæˆ‘ä»¬é€šè¿‡<code>docker ps</code>å‘½ä»¤æ¥äº†è§£ä¸€ä¸‹å¤§è‡´çš„æ‰§è¡Œæµç¨‹ã€‚</p>
<p><code>docker ps</code>å‘½ä»¤ä¹Ÿæ˜¯æ—§ç‰ˆçš„å‘½ä»¤ï¼Œ<code>hide(container.NewPsCommand(dockerCli))</code>å°±æ˜¯åœ¨å¤„ç†ä»–ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­å¯¹åº”çš„æ˜¯<code>docker container ls</code>å‘½ä»¤ã€‚å®ç°ä»£ç åœ¨<code>cli/command/container/list.go</code>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// NewPsCommand creates a new cobra.Command for `docker ps`</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPsCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        options := psOptions&#123;filter: opts.NewFilterOpt()&#125;</div><div class="line"></div><div class="line">        cmd := &amp;cobra.Command&#123;</div><div class="line">                Use:   <span class="string">"ps [OPTIONS]"</span>,</div><div class="line">                Short: <span class="string">"List containers"</span>,</div><div class="line">                Args:  cli.NoArgs,</div><div class="line">                RunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="keyword">return</span> runPs(dockerCli, &amp;options)</div><div class="line">                &#125;,</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        flags := cmd.Flags()</div><div class="line"></div><div class="line">        flags.BoolVarP(&amp;options.quiet, <span class="string">"quiet"</span>, <span class="string">"q"</span>, <span class="literal">false</span>, <span class="string">"Only display numeric IDs"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.size, <span class="string">"size"</span>, <span class="string">"s"</span>, <span class="literal">false</span>, <span class="string">"Display total file sizes"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.all, <span class="string">"all"</span>, <span class="string">"a"</span>, <span class="literal">false</span>, <span class="string">"Show all containers (default shows just running)"</span>)</div><div class="line">        flags.BoolVar(&amp;options.noTrunc, <span class="string">"no-trunc"</span>, <span class="literal">false</span>, <span class="string">"Don't truncate output"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.nLatest, <span class="string">"latest"</span>, <span class="string">"l"</span>, <span class="literal">false</span>, <span class="string">"Show the latest created container (includes all states)"</span>)</div><div class="line">        flags.IntVarP(&amp;options.last, <span class="string">"last"</span>, <span class="string">"n"</span>, <span class="number">-1</span>, <span class="string">"Show n last created containers (includes all states)"</span>)</div><div class="line">        flags.StringVarP(&amp;options.format, <span class="string">"format"</span>, <span class="string">""</span>, <span class="string">""</span>, <span class="string">"Pretty-print containers using a Go template"</span>)</div><div class="line">        flags.VarP(&amp;options.filter, <span class="string">"filter"</span>, <span class="string">"f"</span>, <span class="string">"Filter output based on conditions provided"</span>)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> cmd</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">newListCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        cmd := *NewPsCommand(dockerCli)</div><div class="line">        cmd.Aliases = []<span class="keyword">string</span>&#123;<span class="string">"ps"</span>, <span class="string">"list"</span>&#125;</div><div class="line">        cmd.Use = <span class="string">"ls [OPTIONS]"</span></div><div class="line">        <span class="keyword">return</span> &amp;cmd</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>NewPsCommand</code>å¯¹åº”çš„æ˜¯<code>docker ps</code>, <code>newListCommand</code>å¯¹åº”çš„æ˜¯<code>docker container ls</code>ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œ <code>newListCommand</code>é‡Œçš„commandå°±æ˜¯<code>NewPsCommand</code>è¿”å›çš„ï¼Œåªæ˜¯åŠ äº†ä¸€ä¸‹è¯´æ˜è€Œå·²ã€‚</p>
<blockquote>
<p>è¿™é‡Œè¿˜æ¼äº†ä¸€ç‚¹ï¼Œdocker container lsæ˜¯3ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬çŸ¥é“dockeræ˜¯rootå‘½ä»¤ï¼ŒæŒ‰ç…§cobraçš„å†™æ³•ï¼Œcontainerå’Œlsåº”è¯¥æ˜¯åˆ†å¼€çš„ã€‚ä»–ä»¬çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼Œåœ¨<code>cli/command/commands/commands.go</code>æ–‡ä»¶ä¸­<code>container.NewContainerCommand(dockerCli)</code>åŠ å…¥äº†<code>container</code>å‘½ä»¤ï¼Œ<code>NewContainerCommand</code>çš„å®ç°åœ¨<code>cli/command/container/cmd.go</code>ä¸­ï¼Œåœ¨<code>NewContainerCommand</code>å‡½æ•°ä¸­é€šè¿‡<code>newListCommand(dockerCli)</code>åŠ å…¥äº†lså‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¿˜æ·»åŠ äº†å¾ˆå¤šåˆ«çš„æ–¹æ³•ï¼Œé‚£äº›éƒ½æ˜¯<code>container</code>æ”¯æŒçš„å­å‘½ä»¤ã€‚è¿™æ ·å°±å›åˆ°äº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å†…å®¹äº†ï¼Œæ²¡æœ‰é­”æ³•</p>
</blockquote>
<p>æˆ‘ä»¬ç»§ç»­çœ‹<code>NewPsCommand</code>:</p>
<p>é‡Œé¢å®šä¹‰äº†<code>docker ps</code>ï¼ˆä¸‹é¢æ‰€æœ‰çš„å†…å®¹å¯¹<code>docker container ls</code>éƒ½é€‚ç”¨ï¼‰æ”¯æŒçš„ä¸€äº›é€‰é¡¹ï¼ˆflagï¼‰,é€‰é¡¹è¢«æ”¾åœ¨äº†psOptionsè¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œæœ€ç»ˆä¼ ç»™runPså‡½æ•°.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">runPs</span><span class="params">(dockerCli *command.DockerCli, options *psOptions)</span> <span class="title">error</span></span> &#123;</div><div class="line">        ctx := context.Background()</div><div class="line"></div><div class="line">        listOptions, err := buildContainerListOptions(options)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        containers, err := dockerCli.Client().ContainerList(ctx, *listOptions)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        format := options.format</div><div class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(format) == <span class="number">0</span> &#123;</div><div class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(dockerCli.ConfigFile().PsFormat) &gt; <span class="number">0</span> &amp;&amp; !options.quiet &#123;</div><div class="line">                        format = dockerCli.ConfigFile().PsFormat</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        format = formatter.TableFormatKey</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        containerCtx := formatter.Context&#123;</div><div class="line">                Output: dockerCli.Out(),</div><div class="line">                Format: formatter.NewContainerFormat(format, options.quiet, listOptions.Size),</div><div class="line">                Trunc:  !options.noTrunc,</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> formatter.ContainerWrite(containerCtx, containers)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>listOptions, err := buildContainerListOptions(options)</code>å¯¹é€‰é¡¹è¿›è¡Œäº†å¤„ç†ï¼Œé‡ç‚¹åœ¨<code>dockerCli.Client().ContainerList(ctx, *listOptions)</code>ï¼Œ<code>ContainerList</code>æ˜¯ä¸€ä¸ªinterfaceã€‚</p>
<p>å®ç°åœ¨<code>vendor/github.com/docker/docker/client/container_list.go</code>ï¼ˆvendoråœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæˆ‘æ˜¯goæ–°æ‰‹ï¼Œæ‰€ä»¥æ‹…å¿ƒå¤§å®¶ä¸çŸ¥é“ï¼Œé«˜æ‰‹å¿½ç•¥ï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cli *Client)</span> <span class="title">ContainerList</span><span class="params">(ctx context.Context, options types.ContainerListOptions)</span> <span class="params">([]types.Container, error)</span></span> &#123;</div><div class="line">        query := url.Values&#123;&#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.All &#123;</div><div class="line">                query.Set(<span class="string">"all"</span>, <span class="string">"1"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Limit != <span class="number">-1</span> &#123;</div><div class="line">                query.Set(<span class="string">"limit"</span>, strconv.Itoa(options.Limit))</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Since != <span class="string">""</span> &#123;</div><div class="line">                query.Set(<span class="string">"since"</span>, options.Since)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Before != <span class="string">""</span> &#123;</div><div class="line">                query.Set(<span class="string">"before"</span>, options.Before)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Size &#123;</div><div class="line">                query.Set(<span class="string">"size"</span>, <span class="string">"1"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Filters.Len() &gt; <span class="number">0</span> &#123;</div><div class="line">                filterJSON, err := filters.ToParamWithVersion(cli.version, options.Filters)</div><div class="line"></div><div class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                        <span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                query.Set(<span class="string">"filters"</span>, filterJSON)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        resp, err := cli.get(ctx, <span class="string">"/containers/json"</span>, query, <span class="literal">nil</span>)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> containers []types.Container</div><div class="line">        err = json.NewDecoder(resp.body).Decode(&amp;containers)</div><div class="line">        ensureReaderClosed(resp)</div><div class="line">        <span class="keyword">return</span> containers, err</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å‰é¢æ˜¯åœ¨æ‹¼è¯·æ±‚çš„å‚æ•°ï¼Œ<code>resp, err := cli.get(ctx, &quot;/containers/json&quot;, query, nil)</code>è¿™é‡Œå‘èµ·äº†è¯·æ±‚ï¼Œè¿”å›äº†containerçš„åˆ—è¡¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡curlæˆ–ncæ¥è·å¾—åŸå§‹çš„æ•°æ®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">âœ  curl -XGET --unix-socket /var/run/docker.sock http://localhost/containers/json</div><div class="line">æˆ–è€…</div><div class="line">âœ  echo 'GET /containers/json HTTP/1.0\r\n\r\n' | nc -U /var/run/docker.sock</div><div class="line"></div><div class="line">[&#123;"Id":"c64ea306f74980555521ad2fcbb4c54e1b05e7ca0d597838557d4d613ed12039","Names":["/brave_swirles"],"Image":"docker-cli-dev","ImageID":"sha256:b123a157eaf7e4d468647b42be4c8e339e9e4b9e84058a56575dbfa7249161c9","Command":"ash","Created":1505218585,"Ports":[],"Labels":&#123;&#125;,"State":"running","Status":"Up 25 hours","HostConfig":&#123;"NetworkMode":"default"&#125;,"NetworkSettings":&#123;"Networks":&#123;"bridge":&#123;"IPAMConfig":null,"Links":null,"Aliases":null,"NetworkID":"4b149c263b9a12caef2b16482db33fded74eac5396a57da1724428948464e00f","EndpointID":"6a3fb06309f2142b23db84303cbdb5d55b3a41e91cf2468649bd5f2adee11c66","Gateway":"172.17.0.1","IPAddress":"172.17.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"MacAddress":"02:42:ac:11:00:02","DriverOpts":null&#125;&#125;&#125;,"Mounts":[&#123;"Type":"bind","Source":"/Users/youwangqiu/go_code/src/github.com/docker/cli","Destination":"/go/src/github.com/docker/cli","Mode":"","RW":true,"Propagation":"rprivate"&#125;,&#123;"Type":"bind","Source":"/var/run/docker.sock","Destination":"/var/run/docker.sock","Mode":"","RW":true,"Propagation":"rprivate"&#125;]&#125;]</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯ä»¥jsonæ ¼å¼è¿”å›çš„ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<p>å›åˆ°<code>cli/command/container/list.go</code>ï¼Œæ¥æ”¶åˆ°è¿”å›å€¼ä¹‹åï¼Œè¿™æ—¶å€™è¿˜æ˜¯ä¸Šé¢çœ‹åˆ°çš„jsonï¼Œä¸‹é¢è¿›è¡Œäº†æ ¼å¼åŒ–è¾“å‡ºï¼Œå¤§å®¶åº”è¯¥éƒ½æœ‰åšæ‰“å°<code>9*9ä¹˜æ³•è¡¨</code>çš„ç»å†ï¼Œè¿™é‡Œçš„æ ¼å¼åŒ–æ˜¯åŒæ ·çš„é“ç†ï¼Œä¸æ˜ç™½çš„åŒå­¦å¯ä»¥ç»§ç»­å¾€æŒ–ï¼Œæˆ‘å·ä¸ªæ‡’ï¼Œå°±ä¸ç»§ç»­äº†ã€‚</p>
<p>è‡³æ­¤<code>docker ps</code>çš„æµç¨‹å°±èµ°å®Œäº†ï¼Œå¤§å®¶å¯ä»¥å¯¹æºç åšä¸€äº›ä¿®æ”¹ï¼Œç„¶åè¿›åˆ°å®¹å™¨ä¸­æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make binary</div></pre></td></tr></table></figure>
<p>å°±å¯ä»¥ç”Ÿäº§æ–°çš„docker clientï¼Œæ‰§è¡Œä¸€ä¸‹å°±èƒ½å¾—åˆ°æƒ³è¦çš„è¾“å‡ºå•¦ã€‚</p>
<p>è°¢è°¢å¤§å®¶ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£ğŸ™‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/07/Moby-LinuxKit-åˆä½“éªŒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/07/Moby-LinuxKit-åˆä½“éªŒ/" itemprop="url">Moby & LinuxKit åˆä½“éªŒ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-07T21:14:16+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Dockerçš„å¼€æºéƒ¨åˆ†è¢«æ”¹åæˆäº†<a href="https://github.com/moby/moby" target="_blank" rel="external">Moby</a>ï¼ŒåŒæ—¶Dockerå…¬å¸è¿˜å¼€æºäº†ä¸€ä¸ª<a href="https://github.com/linuxkit/linuxkit" target="_blank" rel="external">LinuxKit</a>çš„é¡¹ç›®ï¼Œå¤§å®¶å¯ä»¥å…ˆå»çœ‹ä¸€ä¸‹readmeã€‚</p>
<p>Mobyæ˜¯ä¸€ä¸ªç»„è£…å®¹å™¨ç³»ç»Ÿçš„æ¡†æ¶ã€‚å®ƒåŒ…å«ä¸€ä¸ªå®¹å™¨åŒ–ç»„ä»¶åº“å’Œä¸€ä¸ªå°†è¿™äº›ç»„ä»¶ç»„è£…æˆç‹¬ç«‹çš„å®¹å™¨ç³»ç»Ÿçš„æ¡†æ¶ã€‚ç›®å‰ï¼ŒDockeræ­£åœ¨è¢«æ‹†åˆ†æˆæ¨¡å—åŒ–çš„ç»„ä»¶ï¼Œå°†æ¥ï¼ŒDockerä¼šä»è¿™äº›è¢«Mobyæ‰“åŒ…çš„ç»„ä»¶ä¸­è¢«ç»„è£…å‡ºæ¥ã€‚</p>
<p>LinuxKitæ˜¯ä¸€ä¸ªç”¨æ¥æ„é€ æœ€å°Linuxå‘è¡Œç‰ˆçš„å·¥å…·é›†ã€‚å®ƒé€šè¿‡Mobyæ¥åˆ›å»ºé•œåƒï¼ˆimageï¼‰ï¼Œä½¿ç”¨LinuxKitå·¥å…·æ¥è¿è¡Œè¿™äº›é•œåƒã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥ä½“éªŒä¸€ä¸‹ï¼Œé¦–å…ˆç¡®ä¿ä½ å·²ç»å®‰è£…äº†<a href="https://docs.Docker.com/engine/installation/linux/docker-ce/ubuntu/#recommended-extra-packages-for-trusty-1404" target="_blank" rel="external">Docker</a>å’Œ<a href="https://golang.org/doc/install" target="_blank" rel="external">Golang</a>ã€‚</p>
<h3 id="æ„å»ºMoby"><a href="#æ„å»ºMoby" class="headerlink" title="æ„å»ºMoby"></a>æ„å»ºMoby</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">âœ  git clone https://github.com/linuxkit/linuxkit.git</div><div class="line">âœ  cd linuxkit</div><div class="line">âœ  make &amp;&amp; sudo make install</div><div class="line">âœ  moby version</div><div class="line">moby version 0.0</div><div class="line">commit: 1ff0e3beeeb1e741b9c5a54574f01ac5eee525a5</div></pre></td></tr></table></figure>
<h3 id="æ„å»ºlinuxé•œåƒ"><a href="#æ„å»ºlinuxé•œåƒ" class="headerlink" title="æ„å»ºlinuxé•œåƒ"></a>æ„å»ºlinuxé•œåƒ</h3><p>æ„å»ºé•œåƒæ˜¯é€šè¿‡yamlæ–‡ä»¶ï¼ˆæ ¼å¼å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://github.com/moby/tool/blob/master/docs/yaml.md" target="_blank" rel="external">LinuxKit YAML</a>ï¼‰ï¼Œlinuxkitç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>linuxkit.yml</code>å¯ä»¥ç”¨ï¼Œexamplesç›®å½•ä¸‹ä¹Ÿæœ‰å¾ˆå¤šå¯ç”¨çš„yamlæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»»é€‰ä¸€ä¸ªæ¥æ„å»ºï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨<code>linuxkit.yml</code>æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) moby build linuxkit.yml</div><div class="line">æœ€ååœ¨å½“å‰ç›®å½•ä¸‹è¾“å‡ºäº†3ä¸ªæ–‡ä»¶</div><div class="line">Create outputs:</div><div class="line">  linuxkit-kernel linuxkit-initrd.img linuxkit-cmdline</div></pre></td></tr></table></figure>
<h3 id="è¿è¡ŒLinuxKité•œåƒ"><a href="#è¿è¡ŒLinuxKité•œåƒ" class="headerlink" title="è¿è¡ŒLinuxKité•œåƒ"></a>è¿è¡ŒLinuxKité•œåƒ</h3><p>è¿è¡Œé€šè¿‡linuxkitè‡ªå¸¦çš„linuxkitå‘½ä»¤ï¼Œå‘½ä»¤åœ¨linuxkit/binç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯ä½“éªŒï¼Œä¹Ÿæ²¡å¿…è¦å†™PATHï¼Œå°±ç›´æ¥å†™å…¨è·¯å¾„å§ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) bin/linuxkit run linuxkit</div><div class="line">...æ»¡å±æ»¡å±çš„è¾“å‡ºï¼Œæœ€åæ˜¯ç†Ÿæ‚‰çš„ğŸ³</div><div class="line">Welcome to LinuxKit</div><div class="line"></div><div class="line">                        ##         .</div><div class="line">                  ## ## ##        ==</div><div class="line">               ## ## ## ## ##    ===</div><div class="line">           /"""""""""""""""""\___/ ===</div><div class="line">          &#123;                       /  ===-</div><div class="line">           \______ O           __/</div><div class="line">             \    \         __/</div><div class="line">              \____\_______/</div><div class="line">...</div></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å°±æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±æ„å»ºçš„linuxæœ€å°å‘è¡Œç‰ˆé‡Œé¢äº†ï¼Œæ•²å‡ ä¸ªå‘½ä»¤è¯•è¯•å§ï¼Œé€€å‡ºæ˜¯<code>halt</code>ã€‚</p>
<p>è¿™ä¸ªé•œåƒåªæœ‰54Mï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å°äº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) ls -alh | grep linuxkit</div><div class="line">-rw-r--r--  1 vagrant vagrant   42 Sep  7 11:52 linuxkit-cmdline</div><div class="line">-rw-r--r--  1 vagrant vagrant  54M Sep  7 11:52 linuxkit-initrd.img</div><div class="line">-rw-r--r--  1 vagrant vagrant 6.3M Sep  7 11:52 linuxkit-kernel</div><div class="line">drwxr-xr-x  2 vagrant vagrant 4.0K Sep  7 12:11 linuxkit-state</div><div class="line">-rw-rw-r--  1 vagrant vagrant 1.7K Sep  7 10:33 linuxkit.yml</div></pre></td></tr></table></figure>
<p>Mobyå’ŒLinuxKitæ˜¯éå¸¸ä¸é”™çš„å·¥å…·ï¼Œä½†ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬æ˜¯ç”¨ä¸ä¸Šçš„ã€‚å¦‚æœä½ éœ€è¦æ„å»ºå®šåˆ¶çš„linuxå‘è¡Œç‰ˆï¼Œé‚£ä»–ä»¬å¯ä»¥èŠ‚çº¦å¾ˆå¤šæ—¶é—´ã€‚ä½†å¦‚æœä½ åªæ˜¯æƒ³å°†åº”ç”¨æ”¾åœ¨å®¹å™¨é‡Œè·‘èµ·æ¥ï¼Œé‚£è¿˜æ˜¯ç›´æ¥ç”¨Dockerå§ï¼</p>
<p>å¦å¤–ï¼ŒMobyå’ŒLinuxKitåº”è¯¥è¿˜æ²¡æœ‰æˆç†Ÿï¼Œå‘½ä»¤ä¸€å¤©ä¸€ä¸ªå˜åŒ–ï¼ˆå¤¸å¼ äº†ï¼‰ï¼Œå¦‚æœä½ å‘ç°ä¸Šé¢çš„å‘½ä»¤å¤±æ•ˆäº†ï¼Œå»ºè®®googleä¸€ä¸‹ï¼Œæˆ–è€…è”ç³»æˆ‘ï¼ˆçŸ¥ä¹ or whaterverï¼‰</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/07/æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤dockerç³»åˆ—æ–‡ç« ç›®å½•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/07/æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤dockerç³»åˆ—æ–‡ç« ç›®å½•/" itemprop="url">æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤Dockerç³»åˆ—æ–‡ç« ç›®å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-07T17:24:33+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.sel.zju.edu.cn/?p=112" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸€ï¼‰ï¼šDOCKERæ¶æ„</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=147" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆäºŒï¼‰ï¼šDOCKER CLIENTåˆ›å»ºä¸å‘½ä»¤æ‰§è¡Œ</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=158" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸‰ï¼‰ï¼šDOCKER DAEMONå¯åŠ¨</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=165" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå››ï¼‰ï¼šDOCKER DAEMONä¹‹NEWDAEMONå®ç°</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=259" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆäº”ï¼‰ï¼šDOCKER SERVERçš„åˆ›å»º</a>-2014.12.09</p>
<p><a href="http://www.sel.zju.edu.cn/?p=399" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå…­ï¼‰ï¼šDOCKER DAEMONç½‘ç»œ</a>-2015.01.05</p>
<p><a href="http://www.sel.zju.edu.cn/?p=508" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸ƒï¼‰ï¼šDOCKER CONTAINERç½‘ç»œ ï¼ˆä¸Šï¼‰</a>-2015.01.26</p>
<p><a href="http://www.sel.zju.edu.cn/?p=537" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå…«ï¼‰ï¼šDOCKER CONTAINERç½‘ç»œï¼ˆä¸‹ï¼‰</a>-2015.03.12</p>
<p><a href="http://www.sel.zju.edu.cn/?p=549" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¹ï¼‰ï¼šDOCKERé•œåƒ</a>-2015.03.12</p>
<p><a href="http://www.sel.zju.edu.cn/?p=444" target="_blank" rel="external">DOCKERç½‘ç»œè¯¦è§£åŠPIPEWORKæºç è§£è¯»ä¸å®è·µ</a>-2015.01.16</p>
<p><a href="http://www.sel.zju.edu.cn/?p=556" target="_blank" rel="external">DOCKERèƒŒåçš„å†…æ ¸çŸ¥è¯†â€”â€”NAMESPACEèµ„æºéš”ç¦»</a>-2015.03.13</p>
<p><a href="http://www.sel.zju.edu.cn/?p=573" target="_blank" rel="external">DOCKERèƒŒåçš„å†…æ ¸çŸ¥è¯†â€”â€”CGROUPSèµ„æºé™åˆ¶</a>-2015.04.22</p>
<p><a href="http://www.sel.zju.edu.cn/?p=577" target="_blank" rel="external">DOCKERèƒŒåçš„å®¹å™¨ç®¡ç†â€”â€”LIBCONTAINERæ·±åº¦è§£æ</a>-2015.06.03</p>
<p><a href="http://www.sel.zju.edu.cn/?p=296" target="_blank" rel="external">ç©è½¬DOCKERé•œåƒ</a>-2014.12.16</p>
<p><a href="http://www.sel.zju.edu.cn/?p=467" target="_blank" rel="external">æ·±å…¥ç†è§£ETCDæŠ€æœ¯åˆ†äº«PPT</a>-2015.01.20</p>
<p><a href="http://www.sel.zju.edu.cn/?p=523" target="_blank" rel="external">ETCDï¼šä»åº”ç”¨åœºæ™¯åˆ°å®ç°åŸç†çš„å…¨æ–¹ä½è§£è¯»</a>-2015.02.01</p>
<p><a href="http://www.sel.zju.edu.cn/?p=283" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹å®‰å…¨ç¯‡</a>-2014.12.11</p>
<p><a href="http://www.sel.zju.edu.cn/?p=331" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹PODç¯‡</a>-2014.12.19</p>
<p><a href="http://www.sel.zju.edu.cn/?p=360" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹æœåŠ¡ç¯‡</a>-2014.12.23</p>
<p><a href="http://www.sel.zju.edu.cn/?p=353" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹ç½‘ç»œç¯‡</a>-2014.12.29</p>
<p><a href="http://www.sel.zju.edu.cn/?p=394" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹VOLUMES</a>-2015.01.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=417" target="_blank" rel="external">KUBERNETES MINION NODE ç»„ä»¶ ä¹‹ KUBELET</a>-2015.01.13</p>
<p><a href="http://www.sel.zju.edu.cn/?p=484" target="_blank" rel="external">KUBERNETESä»£ç èµ°è¯»ä¹‹MINION NODE ç»„ä»¶ KUBE-PROXY</a>-2015.01.22</p>
<p><a href="http://www.sel.zju.edu.cn/?p=588" target="_blank" rel="external">4S: SERVICES ACCOUNT, SECRET, SECURITY CONTEXT AND SECURITY IN KUBERNETES</a>-2015.07.30</p>
<p><a href="http://www.sel.zju.edu.cn/?p=595" target="_blank" rel="external">KUBERNETES NODE COMPONENTS â€“ KUBELET</a>-2015.08.07</p>
<p><a href="http://www.sel.zju.edu.cn/?p=609" target="_blank" rel="external">KUBERNETES APISERVERæºç åˆ†æâ€”â€”APIè¯·æ±‚çš„è®¤è¯è¿‡ç¨‹</a>-2015.08.09</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/02/pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/02/pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²/" itemprop="url">pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-02T22:35:33+08:00">
                2017-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>èƒŒæ™¯ï¼šæˆ‘å¸ä»£ç éƒ½æ˜¯åŸºäºpython2</p>
<p>ä»Šå¤©æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œç”¨æˆ·æäº¤çš„è¯„è®ºå­—æ•°å¦‚æœå¤§äº20ä¸ªå­—è¦ç»™ç”¨æˆ·å‘çº¢åŒ…ã€‚æ¯«ä¸è¿Ÿç–‘ï¼Œæˆ‘å†™ä¸‹äº†ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> len(content) &gt; <span class="number">20</span>:</div><div class="line">	<span class="comment"># å‘çº¢åŒ…</span></div></pre></td></tr></table></figure>
<p>æˆ‘è½¬å¿µä¸€æƒ³ï¼Œäº‹æƒ…ä¸å¤§å¯¹ï¼Œæˆ‘è¿™ç®—çš„æ˜¯å­—ç¬¦æ•°ï¼ˆè¿™ä¸ªè¡¨è¿°æ˜¯æ­£ç¡®çš„ï¼Œæ˜¯å­—ç¬¦ï¼‰å•Š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"abcd"</span>)  <span class="comment"># ç­‰äº4</span></div><div class="line">len(<span class="string">"I love python"</span>)  <span class="comment"># ç­‰äº13</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­æ˜¾è€Œæ˜“è§ï¼Œå°å­¦ç”Ÿæ°´å¹³ï¼Œå†çœ‹ä¸‹é¢çš„</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># è¿™ä¸ªè¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</span></div><div class="line">len(<span class="string">u"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># è¿™ä¸ªåˆè¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</span></div></pre></td></tr></table></figure>
<p>å¤§å®¶å¯ä»¥æœ¬åœ°æ‰“å¼€pythonè¯•ä¸€ä¸‹ï¼Œç»“æœæ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># ç­‰äº21</span></div><div class="line">len(<span class="string">u"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># ç­‰äº7</span></div></pre></td></tr></table></figure>
<p>å…¶å®æˆ‘æƒ³è¦çš„æ˜¯ä¸‹é¢è¿™ä¸ªï¼Œä½†æ˜¯æˆ‘åœ¨ä»£ç é‡Œç›´æ¥é‚£ä¹ˆå†™ï¼Œæˆ‘æ“ä½œçš„å­—ç¬¦ä¸²å‰é¢åˆ°åº•æœ‰æ²¡æœ‰<code>u</code>å‘¢ï¼Œè¿™ä¸ª<code>u</code>æˆ‘çŸ¥é“æ˜¯<code>unicode</code>å­—ç¬¦ä¸²ï¼Œå®ƒå’Œæ²¡æœ‰<code>u</code>çš„å­—ç¬¦ä¸²åˆ°åº•åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ</p>
<p>å‡ å¹´å‰æˆ‘æ›¾ç»ä¸‹å†³å¿ƒå¼„æ‡‚è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½å½“æ—¶ä¹Ÿç¡®å®æ˜ç™½äº†ï¼Œä½†æ˜¯ç°åœ¨å·®ä¸å¤šå·²ç»å…¨å¿˜äº†ã€‚æˆ‘è‡ªå·±æ€»ç»“äº†ä¸€ä¸‹ï¼Œä¸€æ˜¯ä¹‹å‰ä¸€ç›´æ˜¯ç”¨python3ï¼Œpython3åšäº†ä¸€äº›ä¿®æ”¹ã€‚äºŒæ˜¯è¿™ä¸ªé—®é¢˜ç¡®å®ä¸åº”è¯¥äº¤ç»™ç¨‹åºå‘˜æ¥è§£å†³ï¼ˆæˆ‘æ‰¿è®¤æˆ‘çš„è®°æ€§ç¡®å®ä¸å¥½ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œæ—§çš„ç³»ç»Ÿé‚£ä¹ˆå¤šï¼Œéš¾ä¿ä½ ä¸‹æ¬¡è·³æ§½çš„å…¬å¸æ²¡æœ‰ä¸€äº›ä¸Šäº†å¹´çºªçš„ä»£ç ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥æ¢³ç†ä¸€ä¸‹å§ã€‚</p>
<h2 id="å­—ç¬¦ä¸å­—èŠ‚"><a href="#å­—ç¬¦ä¸å­—èŠ‚" class="headerlink" title="å­—ç¬¦ä¸å­—èŠ‚"></a>å­—ç¬¦ä¸å­—èŠ‚</h2><p>ä¸€ä¸ªå­—ç¬¦ä¸ç­‰ä»·äºä¸€ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦æ˜¯äººç±»èƒ½å¤Ÿè¯†åˆ«çš„ç¬¦å·ï¼Œè€Œè¿™äº›ç¬¦å·è¦ä¿å­˜åˆ°è®¡ç®—æœºçš„å­˜å‚¨ä¸­å°±éœ€è¦ç”¨è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å­—èŠ‚æ¥è¡¨ç¤ºã€‚ä¸€ä¸ªå­—ç¬¦å¾€å¾€æœ‰å¤šç§è¡¨ç¤ºæ–¹æ³•ï¼Œä¸åŒçš„è¡¨ç¤ºæ–¹æ³•ä¼šä½¿ç”¨ä¸åŒçš„å­—èŠ‚æ•°ã€‚è¿™é‡Œæ‰€è¯´çš„ä¸åŒçš„è¡¨ç¤ºæ–¹æ³•å°±æ˜¯æŒ‡<code>å­—ç¬¦ç¼–ç </code>ï¼Œæ¯”å¦‚å­—æ¯A-Zéƒ½å¯ä»¥ç”¨<code>ASCII</code>ç è¡¨ç¤ºï¼ˆå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨<code>UNICODE</code>è¡¨ç¤ºï¼ˆå ä¸¤ä¸ªå­—èŠ‚ï¼‰ï¼Œè¿˜å¯ä»¥ç”¨<code>UTF-8</code>è¡¨ç¤ºï¼ˆå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼‰ã€‚å­—ç¬¦ç¼–ç çš„ä½œç”¨å°±æ˜¯å°†äººç±»å¯è¯†åˆ«çš„å­—ç¬¦è½¬æ¢ä¸ºæœºå™¨å¯è¯†åˆ«çš„å­—èŠ‚ç ï¼Œä»¥åŠåå‘è¿‡ç¨‹ã€‚</p>
<p><strong>UNICDOEæ‰æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²ï¼Œè€Œç”¨ASCIIã€UTF-8ã€GBKç­‰å­—ç¬¦ç¼–ç è¡¨ç¤ºçš„æ˜¯å­—èŠ‚ä¸²</strong>ã€‚å…³äºè¿™ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Pythonçš„å®˜æ–¹æ–‡æ¡£ä¸­ç»å¸¸å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æè¿°<strong>â€œUnicode stringâ€</strong> , <strong>â€œtranslating a Unicode string into a sequence of bytesâ€</strong>ã€‚ï¼ˆæ³¨æ„ï¼šè‹±æ–‡ä¸­stringæ˜¯æˆ‘ä»¬è¯´çš„å­—ç¬¦ä¸²ï¼Œbytesæ˜¯å­—èŠ‚ä¸²ï¼‰</p>
<p>æˆ‘ä»¬å†™<code>ä»£ç </code>æ˜¯å†™åœ¨<code>æ–‡ä»¶</code>ä¸­çš„ï¼Œè€Œ<code>å­—ç¬¦</code>æ˜¯ä»¥<code>å­—èŠ‚</code>å½¢å¼ä¿å­˜åœ¨<code>æ–‡ä»¶</code>ä¸­çš„ï¼Œå› æ­¤å½“æˆ‘ä»¬åœ¨æ–‡ä»¶ä¸­å®šä¹‰ä¸ª<code>å­—ç¬¦ä¸²</code>æ—¶è¢«å½“åš<code>å­—èŠ‚ä¸²</code>ä¹Ÿæ˜¯å¯ä»¥ç†è§£çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œè€Œä¸æ˜¯<code>å­—èŠ‚ä¸²</code>ï¼ˆæˆ‘ä»¬å†™ä»£ç å¤„ç†çš„æ˜¯æˆ‘ä»¬èƒ½æƒ³è±¡çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ï¼Œåº”è¯¥ä¸ä¼šæœ‰äººæƒ³è±¡å­—èŠ‚ä¸²å§ï¼‰ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€ï¼Œåº”è¯¥ä¸¥æ ¼åŒºåˆ†ä¸¤è€…çš„å…³ç³»å¹¶æä¾›å·§å¦™çš„å®Œç¾çš„æ”¯æŒã€‚JAVAè¯­è¨€å°±å¾ˆå¥½ï¼Œæˆ‘è®¤è¯†çš„JAVAç¨‹åºå‘˜ä»æ¥æ²¡æœ‰è€ƒè™‘è¿‡è¿™äº›ä¸åº”è¯¥ç”±ç¨‹åºå‘˜æ¥å¤„ç†çš„é—®é¢˜ï¼ˆæˆ‘ä¸€ç›´è¿™ä¹ˆè®¤ä¸ºï¼‰ã€‚é—æ†¾çš„æ˜¯ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€è¯•å›¾æ··æ·†<code>â€œå­—ç¬¦ä¸²â€</code>å’Œ<code>â€œå­—èŠ‚ä¸²â€</code>ï¼Œä»–ä»¬<em>æŠŠå­—èŠ‚ä¸²å½“åšå­—ç¬¦ä¸²æ¥ä½¿ç”¨</em>ï¼ŒPHPå’ŒPython2éƒ½å±äºè¿™ç§ç¼–ç¨‹è¯­è¨€ã€‚æœ€èƒ½è¯´æ˜è¿™ä¸ªé—®é¢˜çš„æ“ä½œå°±æ˜¯å–ä¸€ä¸ªåŒ…å«ä¸­æ–‡å­—ç¬¦çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼š</p>
<ul>
<li>å¯¹<code>å­—ç¬¦ä¸²</code>å–é•¿åº¦ï¼Œç»“æœåº”è¯¥æ˜¯æ‰€æœ‰<code>å­—ç¬¦</code>çš„ä¸ªæ•°ï¼Œæ— è®ºä¸­æ–‡è¿˜æ˜¯è‹±æ–‡</li>
<li>å¯¹<code>å­—ç¬¦ä¸²</code>å¯¹åº”çš„<code>å­—èŠ‚ä¸²</code>å–é•¿åº¦ï¼Œå°±è·Ÿç¼–ç (encode)è¿‡ç¨‹ä½¿ç”¨çš„<code>å­—ç¬¦ç¼–ç </code>æœ‰å…³äº†(æ¯”å¦‚ï¼š<code>UTF-8ç¼–ç </code>ï¼Œä¸€ä¸ª<code>ä¸­æ–‡å­—ç¬¦</code>éœ€è¦ç”¨<code>3ä¸ªå­—èŠ‚</code>æ¥è¡¨ç¤ºï¼›<code>GBKç¼–ç </code>ï¼Œä¸€ä¸ª<code>ä¸­æ–‡å­—ç¬¦</code>éœ€è¦<code>2ä¸ªå­—èŠ‚</code>æ¥è¡¨ç¤º)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">7</span>]: a = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">9</span>]: <span class="keyword">print</span> len(a), type(a)</div><div class="line"><span class="number">2</span> &lt;type <span class="string">'unicode'</span>&gt;</div><div class="line"></div><div class="line">In [<span class="number">10</span>]: b = a.encode(<span class="string">'utf-8'</span>)</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: <span class="keyword">print</span> len(b), type(b)</div><div class="line"><span class="number">6</span> &lt;type <span class="string">'str'</span>&gt;</div><div class="line"></div><div class="line">In [<span class="number">12</span>]: c = a.encode(<span class="string">'gbk'</span>)</div><div class="line"></div><div class="line">In [<span class="number">13</span>]: <span class="keyword">print</span> len(c), type(c)</div><div class="line"><span class="number">4</span> &lt;type <span class="string">'str'</span>&gt;</div></pre></td></tr></table></figure>
<h2 id="ç¼–ç ä¸è§£ç "><a href="#ç¼–ç ä¸è§£ç " class="headerlink" title="ç¼–ç ä¸è§£ç "></a>ç¼–ç ä¸è§£ç </h2><p>UNICODEå­—ç¬¦ç¼–ç ï¼Œä¹Ÿæ˜¯ä¸€å¼ å­—ç¬¦ä¸æ•°å­—çš„æ˜ å°„ï¼Œä½†æ˜¯è¿™é‡Œçš„æ•°å­—è¢«ç§°ä¸ºä»£ç ç‚¹(code point), å®é™…ä¸Šå°±æ˜¯åå…­è¿›åˆ¶çš„æ•°å­—ã€‚</p>
<p><a href="https://docs.python.org/2/howto/unicode.html#encodings" target="_blank" rel="external">Pythonå®˜æ–¹æ–‡æ¡£</a>ä¸­å¯¹Unicodeå­—ç¬¦ä¸²ã€å­—èŠ‚ä¸²ä¸ç¼–ç ä¹‹é—´çš„å…³ç³»æœ‰è¿™æ ·ä¸€æ®µæè¿°ï¼š</p>
<pre><code>a Unicode string is a sequence of code points, which are numbers from 0 to 0x10ffff.
This sequence needs to be represented as a set of bytes (meaning, values from 0â€“255) in memory.
The rules for translating a Unicode string into a sequence of bytes are called an encoding.

Unicodeå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªä»£ç ç‚¹ï¼ˆcode pointï¼‰åºåˆ—ï¼Œä»£ç ç‚¹å–å€¼èŒƒå›´ä¸º0åˆ°0x10FFFFï¼ˆå¯¹åº”çš„åè¿›åˆ¶ä¸º1114111ï¼‰ã€‚
è¿™ä¸ªä»£ç ç‚¹åºåˆ—åœ¨å­˜å‚¨ï¼ˆåŒ…æ‹¬å†…å­˜å’Œç‰©ç†ç£ç›˜ï¼‰ä¸­éœ€è¦è¢«è¡¨ç¤ºä¸ºä¸€ç»„å­—èŠ‚(0åˆ°255ä¹‹é—´çš„å€¼)ï¼Œ
è€Œå°†Unicodeå­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è§„åˆ™ç§°ä¸ºç¼–ç ã€‚
</code></pre><p>è¿™é‡Œè¯´çš„ç¼–ç ä¸æ˜¯æŒ‡å­—ç¬¦ç¼–ç ï¼Œè€Œæ˜¯æŒ‡<strong>ç¼–ç çš„è¿‡ç¨‹ä»¥åŠè¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨åˆ°çš„Unicodeå­—ç¬¦çš„ä»£ç ç‚¹ä¸å­—èŠ‚çš„æ˜ å°„è§„åˆ™</strong>ã€‚è¿™ä¸ªæ˜ å°„ä¸å¿…æ˜¯ç®€å•çš„ä¸€å¯¹ä¸€æ˜ å°„ï¼Œå› æ­¤ç¼–ç è¿‡ç¨‹ä¹Ÿä¸å¿…å¤„ç†æ¯ä¸ªå¯èƒ½çš„Unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ï¼š</p>
<p>å°†<code>Unicodeå­—ç¬¦ä¸²</code>è½¬æ¢ä¸º<code>ASCIIç¼–ç </code>çš„è§„åˆ™å¾ˆç®€å•â€“å¯¹äºæ¯ä¸ª<code>ä»£ç ç‚¹</code>ï¼š</p>
<ul>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&lt;128ï¼Œåˆ™æ¯ä¸ª<code>å­—èŠ‚</code>ä¸ä»£ç ç‚¹çš„å€¼ç›¸åŒ</li>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&gt;=128ï¼Œåˆ™<code>Unicodeå­—ç¬¦</code>æ— æ³•åœ¨æ­¤ç¼–ç ä¸­è¿›è¡Œè¡¨ç¤ºï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼ŒPythonä¼šå¼•å‘ä¸€ä¸ª<code>UnicodeEncodeError</code>å¼‚å¸¸ï¼‰</li>
</ul>
<p>å°†<code>Unicodeå­—ç¬¦ä¸²</code>è½¬æ¢ä¸º<code>UTF-8ç¼–ç </code>ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&lt;128ï¼Œåˆ™ç”±ç›¸åº”çš„<code>å­—èŠ‚å€¼</code>è¡¨ç¤ºï¼ˆä¸Unicodeè½¬ASCIIå­—èŠ‚ä¸€æ ·ï¼‰</li>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&gt;=128ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª2ä¸ªå­—èŠ‚ï¼Œ3ä¸ªå­—èŠ‚æˆ–4ä¸ªå­—èŠ‚çš„åºåˆ—ï¼Œè¯¥åºåˆ—ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½åœ¨128åˆ°255ä¹‹é—´ã€‚</li>
</ul>
<p>ç®€å•æ€»ç»“ï¼š</p>
<ul>
<li>ç¼–ç (<code>encode</code>)ï¼šå°†<code>Unicodeå­—ç¬¦ä¸²</code>ï¼ˆä¸­çš„ä»£ç ç‚¹)è½¬æ¢ç‰¹å®š<code>å­—ç¬¦ç¼–ç </code>å¯¹åº”çš„<code>å­—èŠ‚ä¸²</code>çš„è¿‡ç¨‹å’Œè§„åˆ™</li>
<li>è§£ç (decode)ï¼šå°†<strong>ç‰¹å®šå­—ç¬¦ç¼–ç çš„å­—èŠ‚ä¸²</strong>è½¬æ¢ä¸ºå¯¹åº”çš„<strong>Unicodeå­—ç¬¦ä¸²</strong>(ä¸­çš„ä»£ç ç‚¹)çš„è¿‡ç¨‹å’Œè§„åˆ™</li>
</ul>
<p>å¯è§ï¼Œæ— è®ºæ˜¯ç¼–ç è¿˜æ˜¯è§£ç ï¼Œéƒ½éœ€è¦ä¸€ä¸ªé‡è¦å› ç´ ï¼Œå°±æ˜¯ç‰¹å®šçš„å­—ç¬¦ç¼–ç ã€‚å› ä¸ºä¸€ä¸ªå­—ç¬¦ç”¨ä¸åŒçš„å­—ç¬¦ç¼–ç è¿›è¡Œç¼–ç åçš„å­—èŠ‚å€¼ä»¥åŠå­—èŠ‚ä¸ªæ•°å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸åŒçš„ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p>è€Œä¸”å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œç¼–ç å’Œè§£ç éƒ½æ˜¯åŸºäº<strong>Unicodeå­—ç¬¦ä¸²</strong>ï¼Œ<em>æ²¡æœ‰ç¬¬äºŒç§å­—ç¬¦ä¸²æºå’Œ</em>ï¼Œå…¶ä»–éƒ½æ˜¯ç¼–ç æ–¹å¼ï¼Œä¸€å®šè¦æ·±åˆ»åœ°è®¤è¯†åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<h2 id="Pythonç¼–ç "><a href="#Pythonç¼–ç " class="headerlink" title="Pythonç¼–ç "></a>Pythonç¼–ç </h2><h3 id="Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"></a>Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç£ç›˜ä¸Šçš„æ–‡ä»¶éƒ½æ˜¯ä»¥<code>äºŒè¿›åˆ¶æ ¼å¼</code>å­˜æ”¾çš„ï¼Œå…¶ä¸­<code>æ–‡æœ¬æ–‡ä»¶</code>éƒ½æ˜¯ä»¥<code>æŸç§ç‰¹å®šç¼–ç </code>çš„<code>å­—èŠ‚</code>å½¢å¼å­˜æ”¾çš„ã€‚å¯¹äºç¨‹åºæºä»£ç æ–‡ä»¶çš„å­—ç¬¦ç¼–ç æ˜¯ç”±ç¼–è¾‘å™¨æŒ‡å®šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨vimæ¥ç¼–å†™Pythonç¨‹åºæ—¶ä¼šæŒ‡å®šæ–‡ä»¶ç¼–ç ä¸ºUTF-8ï¼Œé‚£ä¹ˆPythonä»£ç è¢«ä¿å­˜åˆ°ç£ç›˜æ—¶å°±ä¼šè¢«è½¬æ¢ä¸ºUTF-8ç¼–ç å¯¹åº”çš„å­—èŠ‚ï¼ˆencodeè¿‡ç¨‹ï¼‰åå†™å…¥ç£ç›˜ã€‚å½“æ‰§è¡ŒPythonä»£ç æ–‡ä»¶ä¸­çš„ä»£ç æ—¶ï¼ŒPythonè§£é‡Šå™¨åœ¨è¯»å–Pythonä»£ç æ–‡ä»¶ä¸­çš„å­—èŠ‚ä¸²ä¹‹åï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸ºUNICODEå­—ç¬¦ä¸²ï¼ˆdecodeè¿‡ç¨‹ï¼‰ä¹‹åæ‰æ‰§è¡Œåç»­æ“ä½œã€‚</p>
<p>ä¸Šé¢å·²ç»è§£é‡Šè¿‡ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼ˆdecodeï¼Œè§£ç ï¼‰éœ€è¦æˆ‘ä»¬æŒ‡å®šæ–‡ä»¶ä¸­ä¿å­˜çš„å­—èŠ‚ä½¿ç”¨çš„å­—ç¬¦ç¼–ç æ˜¯ä»€ä¹ˆï¼Œæ‰èƒ½çŸ¥é“è¿™äº›å­—èŠ‚åœ¨UNICODEè¿™å¼ ä¸‡å›½ç å’Œç»Ÿä¸€ç ä¸­æ‰¾åˆ°å…¶å¯¹åº”çš„ä»£ç ç‚¹æ˜¯ä»€ä¹ˆã€‚è¿™é‡ŒæŒ‡å®šå­—ç¬¦ç¼–ç çš„æ–¹å¼å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œä¸€å›¾èƒœåƒè¨€ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div></pre></td></tr></table></figure>
<p><img src="/img/python_source_file_execute.png" alt="pythonæºæ–‡ä»¶æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"></p>
<h3 id="é»˜è®¤ç¼–ç "><a href="#é»˜è®¤ç¼–ç " class="headerlink" title="é»˜è®¤ç¼–ç "></a>é»˜è®¤ç¼–ç </h3><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ä»£ç æ–‡ä»¶å¼€å§‹çš„éƒ¨åˆ†æŒ‡å®šå­—ç¬¦ç¼–ç ï¼ŒPythonè§£é‡Šå™¨ä¼šä½¿ç”¨å“ªç§å­—ç¬¦ç¼–ç æŠŠä»ä»£ç æ–‡ä»¶ä¸­è¯»å–åˆ°çš„å­—èŠ‚è½¬æ¢ä¸º<strong>UNICODEä»£ç ç‚¹</strong>å‘¢ï¼Ÿå°±åƒæˆ‘ä»¬é…ç½®æŸäº›è½¯ä»¶æ—¶ï¼Œæœ‰å¾ˆå¤šé»˜è®¤é€‰é¡¹ä¸€æ ·ï¼ŒPythonè§£é‡Šå™¨å†…éƒ¨è®¾ç½®äº†é»˜è®¤çš„<code>å­—ç¬¦ç¼–ç </code>ã€‚å› æ­¤å¤§å®¶æ‰€è¯´çš„Pythonä¸­æ–‡å­—ç¬¦é—®é¢˜å°±å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå½“æ— æ³•é€šè¿‡<strong>é»˜è®¤çš„å­—ç¬¦ç¼–ç </strong>å¯¹å­—èŠ‚è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±ä¼šå‡ºç°è§£ç é”™è¯¯(UnicodeEncodeError)ã€‚</p>
<p>Python2å’ŒPython3çš„è§£é‡Šå™¨ä½¿ç”¨çš„é»˜è®¤ç¼–ç æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>sys.getdefaultencoding()</code>æ¥è·å–é»˜è®¤ç¼–ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># python2</span></div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> sys</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: sys.getdefaultencoding()</div><div class="line">Out[<span class="number">3</span>]: <span class="string">'ascii'</span></div><div class="line"></div><div class="line"><span class="comment"># python3</span></div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> sys</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: sys.getdefaultencoding()</div><div class="line">Out[<span class="number">3</span>]: <span class="string">'utf-8'</span></div></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œå¯¹äºPython2æ¥è®²ï¼ŒPythonè§£é‡Šå™¨åœ¨è¯»å–åˆ°ä¸­æ–‡å­—ç¬¦çš„å­—èŠ‚ç å°è¯•è§£ç æ“ä½œæ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹å½“å‰ä»£ç æ–‡ä»¶å¤´éƒ¨æ˜¯å¦æœ‰æŒ‡æ˜å½“å‰ä»£ç æ–‡ä»¶ä¸­ä¿å­˜çš„å­—èŠ‚ç å¯¹åº”çš„å­—ç¬¦ç¼–ç æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤å­—ç¬¦ç¼–ç â€ASCIIâ€è¿›è¡Œè§£ç å¯¼è‡´è§£ç å¤±è´¥ï¼Œå¯¼è‡´å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Non-ASCII character <span class="string">'\xc4'</span> <span class="keyword">in</span> file xxx.py on line <span class="number">11</span>, but no encoding declared; see http://python.org/dev/peps/pep<span class="number">-0263</span>/ <span class="keyword">for</span> details</div></pre></td></tr></table></figure>
<p>å¯¹äºPython3æ¥è®²ï¼Œæ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯Python3çš„è§£é‡Šå™¨ä»¥â€UTF-8â€ä½œä¸ºé»˜è®¤ç¼–ç ï¼Œä½†æ˜¯è¿™å¹¶ä¸è¡¨ç¤ºå¯ä»¥å®Œå…¨å…¼å®¹ä¸­æ–‡é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨Windowsä¸Šè¿›è¡Œå¼€å‘æ—¶ï¼ŒPythonå·¥ç¨‹åŠä»£ç æ–‡ä»¶éƒ½ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„GBKç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´Pythonä»£ç æ–‡ä»¶æ˜¯è¢«è½¬æ¢æˆGBKæ ¼å¼çš„å­—èŠ‚ç ä¿å­˜åˆ°ç£ç›˜ä¸­çš„ã€‚Python3çš„è§£é‡Šå™¨æ‰§è¡Œè¯¥ä»£ç æ–‡ä»¶æ—¶ï¼Œè¯•å›¾ç”¨UTF-8è¿›è¡Œè§£ç æ“ä½œæ—¶ï¼ŒåŒæ ·ä¼šè§£ç å¤±è´¥ï¼Œå¯¼è‡´å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Non-UTF<span class="number">-8</span> code starting <span class="keyword">with</span> <span class="string">'\xc4'</span> <span class="keyword">in</span> file xxx.py on line <span class="number">11</span>, but no encoding declared; see http://python.org/dev/peps/pep<span class="number">-0263</span>/ <span class="keyword">for</span> details</div></pre></td></tr></table></figure>
<h2 id="å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²"><a href="#å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²" class="headerlink" title="å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²"></a>å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²</h2><p>å…¶å®Python3ä¸­å¯¹å­—ç¬¦ä¸²æ”¯æŒçš„æ”¹è¿›ï¼Œä¸ä»…ä»…æ˜¯æ›´æ”¹äº†é»˜è®¤ç¼–ç ï¼Œè€Œæ˜¯é‡æ–°è¿›è¡Œäº†å­—ç¬¦ä¸²çš„å®ç°ï¼Œè€Œä¸”å®ƒå·²ç»å®ç°äº†<strong>å¯¹UNICODEçš„å†…ç½®æ”¯æŒ</strong>ï¼Œä»è¿™æ–¹é¢æ¥è®²Pythonå·²ç»å’ŒJAVAç­‰è¯­è¨€ä¸€æ ·ä¼˜ç§€ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹Python2ä¸Python3ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p>
<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>Python2ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒç”±ä»¥ä¸‹ä¸‰ä¸ªç±»æä¾›</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">basestring</span><span class="params">(object)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">str</span><span class="params">(basestring)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">unicode</span><span class="params">(basestring)</span></span></div></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>help(str)</code>å’Œ<code>help(bytes)</code>ä¼šå‘ç°ç»“æœéƒ½æ˜¯<code>strç±»</code>çš„å®šä¹‰ï¼Œè¿™ä¹Ÿè¯´æ˜Python2ä¸­strå°±æ˜¯<strong>å­—èŠ‚ä¸²</strong>ï¼Œè€Œåæ¥çš„<strong>unicodeå¯¹è±¡å¯¹åº”æ‰æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²</strong>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: <span class="keyword">print</span> type(a), len(a)</div><div class="line">&lt;type <span class="string">'str'</span>&gt; <span class="number">6</span></div><div class="line"></div><div class="line">In [<span class="number">4</span>]: <span class="keyword">print</span> type(b), len(b)</div><div class="line">&lt;type <span class="string">'unicode'</span>&gt; <span class="number">2</span></div></pre></td></tr></table></figure>
<h3 id="python3"><a href="#python3" class="headerlink" title="python3"></a>python3</h3><p>Python3ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒè¿›è¡Œäº†å®ç°ç±»å±‚æ¬¡çš„ä¸Šç®€åŒ–ï¼Œå»æ‰äº†unicodeç±»ï¼Œæ·»åŠ äº†ä¸€ä¸ªbytesç±»ã€‚ä»è¡¨é¢ä¸Šæ¥çœ‹ï¼Œå¯ä»¥è®¤ä¸ºPython3ä¸­çš„strå’ŒunicodeåˆäºŒä¸ºä¸€äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">bytes</span><span class="params">(object)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">str</span><span class="params">(object)</span></span></div></pre></td></tr></table></figure>
<p>å®é™…ä¸Šï¼ŒPython3ä¸­å·²ç»æ„è¯†åˆ°ä¹‹å‰çš„é”™è¯¯ï¼Œå¼€å§‹æ˜ç¡®çš„åŒºåˆ†å­—ç¬¦ä¸²ä¸å­—èŠ‚ã€‚å› æ­¤Python3ä¸­çš„strå·²ç»æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²ï¼Œè€Œå­—èŠ‚æ˜¯ç”¨å•ç‹¬çš„bytesç±»æ¥è¡¨ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython3é»˜è®¤å®šä¹‰çš„å°±æ˜¯å­—ç¬¦ä¸²ï¼Œå®ç°äº†å¯¹UNICODEçš„å†…ç½®æ”¯æŒï¼Œå‡è½»äº†ç¨‹åºå‘˜å¯¹å­—ç¬¦ä¸²å¤„ç†çš„è´Ÿæ‹…ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: c = a.encode(<span class="string">"gbk"</span>)</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: print(type(a), len(a))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2</span></div><div class="line"><span class="class"></span></div><div class="line"><span class="class"><span class="title">In</span> [5]:</span> print(type(b), len(b))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2</span></div><div class="line"><span class="class"></span></div><div class="line"><span class="class"><span class="title">In</span> [6]:</span> print(type(c), len(c))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">bytes</span>'&gt; 4</span></div></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ç¼–ç è½¬æ¢"><a href="#å­—ç¬¦ç¼–ç è½¬æ¢" class="headerlink" title="å­—ç¬¦ç¼–ç è½¬æ¢"></a>å­—ç¬¦ç¼–ç è½¬æ¢</h2><p>ä¸Šé¢æåˆ°ï¼ŒUNICODEå­—ç¬¦ä¸²å¯ä»¥ä¸ä»»æ„å­—ç¬¦ç¼–ç çš„å­—èŠ‚è¿›è¡Œç›¸äº’è½¬æ¢ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/img/unicode_string.png" alt="unicode å­—ç¬¦ä¸²"></p>
<p>é‚£ä¹ˆå¤§å®¶å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸åŒçš„å­—ç¬¦ç¼–ç çš„å­—èŠ‚å¯ä»¥é€šè¿‡Unicodeç›¸äº’è½¬æ¢å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p>
<p><strong>Python2ä¸­çš„å­—ç¬¦ä¸²è¿›è¡Œå­—ç¬¦ç¼–ç è½¬æ¢è¿‡ç¨‹æ˜¯</strong>ï¼š</p>
<p>å­—èŠ‚ä¸²â€“&gt;decode(â€˜åŸæ¥çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;Unicodeå­—ç¬¦ä¸²â€“&gt;encode(â€˜æ–°çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;å­—èŠ‚ä¸²</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span>  <span class="comment"># utf-8ç¼–ç çš„å­—èŠ‚ä¸²</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = a.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>)  <span class="comment"># å…ˆè½¬æ¢æˆunicodeå­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œgbkç¼–ç </span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: <span class="keyword">print</span> b.decode(<span class="string">'gbk'</span>)  <span class="comment"># è§£ç æˆunicodeå­—ç¬¦ä¸²</span></div><div class="line">ä¸­å›½</div></pre></td></tr></table></figure>
<p><strong>Python3ä¸­å®šä¹‰çš„å­—ç¬¦ä¸²é»˜è®¤å°±æ˜¯unicodeï¼Œå› æ­¤ä¸éœ€è¦å…ˆè§£ç ï¼Œå¯ä»¥ç›´æ¥ç¼–ç æˆæ–°çš„å­—ç¬¦ç¼–ç ï¼š</strong></p>
<p>å­—ç¬¦ä¸²â€“&gt;encode(â€˜æ–°çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;å­—èŠ‚ä¸²</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = a.encode(<span class="string">"gbk"</span>)</div><div class="line"></div><div class="line">In [<span class="number">3</span>]: print(b.decode(<span class="string">"gbk"</span>))</div><div class="line">ä¸­å›½</div></pre></td></tr></table></figure>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>pythonå­—ç¬¦ä¸²ç¼–ç å·®ä¸å¤šå°±æ˜¯è¿™äº›å†…å®¹äº†ï¼Œææ¸…æ¥šåŸç†å…¶å®è®°å¿†ä¹Ÿä¸éš¾ã€‚ç¥å¤§å®¶ä¸ä¼šå†æ‰åˆ°pythonå­—ç¬¦ç¼–ç çš„å‘ä¸­ï¼Œç¥æˆ‘å¸èƒ½å°½å¿«è¿ç§»åˆ°python3ï¼</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/30/goå’Œpythonå˜é‡èµ‹å€¼çš„ä¸€ä¸ªå°é—®é¢˜/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/30/goå’Œpythonå˜é‡èµ‹å€¼çš„ä¸€ä¸ªå°é—®é¢˜/" itemprop="url">goå’Œpythonå˜é‡èµ‹å€¼çš„ä¸€ä¸ªå°é—®é¢˜</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-30T19:37:23+08:00">
                2017-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¹³æ—¶å†™å¾—å¤šçš„æ˜¯pythonï¼Œæœ€è¿‘çœ‹äº†ä¸€ç‚¹goï¼Œä»Šå¤©ç¢°åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</div><div class="line">    Name <span class="keyword">string</span></div><div class="line">    Age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">pase_student</span><span class="params">()</span></span> &#123;</div><div class="line">    m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*student)</div><div class="line">    stus := []student&#123;</div><div class="line">        &#123;Name: <span class="string">"zhou"</span>, Age: <span class="number">24</span>&#125;,</div><div class="line">        &#123;Name: <span class="string">"li"</span>, Age: <span class="number">23</span>&#125;,</div><div class="line">        &#123;Name: <span class="string">"wang"</span>, Age: <span class="number">22</span>&#125;,</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> _, stu := <span class="keyword">range</span> stus &#123;</div><div class="line">        m[stu.Name] = &amp;stu</div><div class="line">    &#125;</div><div class="line">    fmt.Println(m[<span class="string">"zhou"</span>].Name)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    pase_student()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»£ç å¾ˆç®€å•ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ä¼šæ‰“å°å‡ºä»€ä¹ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">time.sleep(<span class="number">60</span>)  <span class="comment"># æ€è€ƒ</span></div></pre></td></tr></table></figure>
<p>ç»“æœæ˜¯<code>wang</code>!ï¼ŒæƒŠå–œä¸æƒŠå–œï¼éå†èµ‹å€¼å•ŠåŒå­¦ä»¬ï¼Œè¿™ä¹ˆç®€å•çš„æ“ä½œéƒ½èƒ½å‡ºå¹ºè›¾å­ï¼ŒWTFï¼</p>
<p>ä¸ºä»€ä¹ˆæ˜¯<code>wang</code>å‘¢ï¼Ÿ<del>ä½ tmç»™æˆ‘</del>è§£é‡Šè§£é‡Š<del>ä»€ä¹ˆæ˜¯æƒŠå–œ</del>ï¼š</p>
<p>forå¾ªç¯çš„æ—¶å€™ï¼Œå˜é‡stuçš„æŒ‡é’ˆæ˜¯ä¸å˜çš„ï¼Œæ¯æ¬¡å¾ªç¯ä»…ä»…æ˜¯å¯¹studentç»“æ„ä½“çš„<strong>å€¼</strong>æ‹·è´ï¼Œä¸Šé¢çš„forå¾ªç¯å’Œä¸‹é¢æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> stu student </div><div class="line"><span class="keyword">for</span> _, stu = <span class="keyword">range</span> stus &#123;</div><div class="line">	m[stu.Name] = &amp;stu</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥<code>&amp;stu</code>è‡ªå§‹è‡³ç»ˆéƒ½æ˜¯ä¸€ä¸ªåœ°å€ï¼Œå˜åŒ–çš„æ˜¯è¿™ä¸ªåœ°å€ä¸Šå­˜å‚¨çš„å€¼ã€‚<code>&amp;stu</code>æœ€ç»ˆå­˜å‚¨çš„å€¼æ˜¯<code>student{Name: &quot;wang&quot;, Age: 22}</code>ç»“æ„ä½“ï¼Œæ‰€ä»¥æ‹¿å‡ºæ¥çš„æ˜¯<code>wang</code>ã€‚</p>
<p>å¯ä»¥å°†<code>m</code>æ‰“å‡ºæ¥çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">map</span>[zhou:<span class="number">0xc42000a260</span> li:<span class="number">0xc42000a260</span> wang:<span class="number">0xc42000a260</span>]</div></pre></td></tr></table></figure>
<p>éªŒè¯äº†æˆ‘ä»¬ä¸Šé¢çš„æƒ³æ³•ï¼Œå¤§å®¶çš„valueéƒ½æ˜¯åŒä¸€ä¸ªåœ°å€ã€‚</p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ—¥å¸¸å†™cï¼Œc++ç­‰å¼ºç±»å‹è¯­è¨€çš„åŒå­¦å¯èƒ½ä¼šè¯´ï¼Œç¥ç»ç—…å•Šï¼è¿™æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼ä¸å°±æ˜¯è¿™æ ·çš„å—ï¼è¯·åŸè°…æˆ‘ï¼Œæˆ‘æ—¥å¸¸å†™pythonçš„ [æ‚è„¸]ã€‚</p>
<p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨goä¸­ï¼Œå˜é‡åæ˜¯<code>å­˜å‚¨åœ°å€çš„åå­—</code>ã€‚å®ƒåœ¨ç¼–è¯‘æ—¶ç»‘å®šå·²ç»å®Œæˆï¼Œè¿è¡Œæ—¶æ˜¯ä¸å¯ä»¥æ”¹å˜çš„ï¼Œä½ åªèƒ½æ”¹å˜åœ°å€ä¸­å­˜å‚¨çš„å€¼ã€‚</p>
<p>è€Œåœ¨pythonä¸­ï¼Œå˜é‡æ˜¯å¯¹è±¡çš„åå­—ï¼Œè¿è¡Œæ—¶å˜é‡å¯ä»¥ç»‘å®šåˆ°ä»»æ„çš„å¯¹è±¡ä¸Šã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">4</span>]: a = <span class="number">123456</span></div><div class="line"></div><div class="line">In [<span class="number">5</span>]: id(a)</div><div class="line">Out[<span class="number">5</span>]: <span class="number">4426596208</span></div><div class="line"></div><div class="line">In [<span class="number">6</span>]: a = <span class="number">1234567</span></div><div class="line"></div><div class="line">In [<span class="number">7</span>]: id(a)</div><div class="line">Out[<span class="number">7</span>]: <span class="number">4426592592</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šç”±äºpythonå¯¹intç±»å‹å®ç°äº†<strong>å°æ•´æ•°å¯¹è±¡æ± </strong>ï¼Œä¸è¦ç”¨<strong>0-255</strong>çš„æ•´æ•°åšå®éªŒï¼Œä¸ç„¶ä½ å¾—åˆ°idä¼šæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ å¾ªç¯ä¸€ä¸ªlistçš„æ—¶å€™ï¼Œæ¯æ¬¡å¾—åˆ°çš„æ˜¯ä¸åŒå¯¹è±¡ï¼Œå˜é‡æŒ‡å‘äº†ä¸åŒçš„åœ°å€ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">9</span>]: <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">2222</span>, <span class="number">2223</span>, <span class="number">2224</span>]:</div><div class="line">   ...:     print(id(i))</div><div class="line">   ...:</div><div class="line"><span class="number">4426596208</span></div><div class="line"><span class="number">4426592336</span></div><div class="line"><span class="number">4426596080</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œpythonä¸ºæˆ‘ä»¬åˆ›å»ºäº†3ä¸ª<code>PyIntObject</code>ï¼Œ<strong>i</strong>åªæ˜¯ä»–ä»¬çš„åå­—ã€‚è€Œåœ¨goä¸­ï¼Œå¯ä»¥è®¤ä¸ºåªæœ‰ä¸€ä¸ªobjectï¼Œå€¼å˜åŒ–äº†3æ¬¡ã€‚</p>
<p>pythonä¸­è¯´çš„<code>èµ‹å€¼å°±æ˜¯å»ºç«‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨</code>ï¼Œæ˜¯å®è¯ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/13/ssl-traffic-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/13/ssl-traffic-analysis/" itemprop="url">SSL/TLS ä¼šè¯æµé‡åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-13T12:50:39+08:00">
                2017-08-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç½‘ç»œ/" itemprop="url" rel="index">
                    <span itemprop="name">ç½‘ç»œ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åŸæ–‡ï¼š<a href="http://blog.fourthbit.com/2014/12/23/traffic-analysis-of-an-ssl-slash-tls-session" target="_blank" rel="external">http://blog.fourthbit.com/2014/12/23/traffic-analysis-of-an-ssl-slash-tls-session</a></p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¼šç»™å¤§å®¶å±•ç¤ºå½“æˆ‘ä»¬ä½¿ç”¨SSL/TLSçš„æ—¶å€™ï¼Œåœ¨åè®®å±‚é¢ä¸Šå‘ç”Ÿäº†ä»€ä¹ˆã€‚ä¸ºäº†ä¾¿äºåˆ†æï¼Œæˆ‘å°†ä¼šä½¿ç”¨ä¸€ä¸ªåŸºäºOpenSSLå®ç°çš„éé˜»å¡TCPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚</p>
<p>æˆ‘ä»¬è¦è®°ä½ï¼ŒSSL/TLSèƒ½è®©åº”ç”¨åƒåº•å±‚åŸºç¡€è®¾æ–½ï¼ˆç½‘ç»œå’Œä¸»æœºï¼‰ä¸€æ ·å®‰å…¨ï¼Œç¡®ä¿é€šä¿¡å®‰å…¨æ˜¯å®ƒå”¯ä¸€åšçš„äº‹ã€‚SSL/TLSæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åè®®ï¼Œå®ƒå¤„äºåº”ç”¨å±‚ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯HTTPï¼Œå…¶ä»–åŒæ ·ä¹Ÿå¯ä»¥ï¼‰å’Œä¼ è¾“å±‚ï¼ˆTCPï¼‰ä¹‹é—´ã€‚å¦‚æ­¤ï¼ŒTLSä¸éœ€è¦ä¸Šä¸‹å±‚åè®®æœ‰å¤§çš„æ”¹åŠ¨ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ï¼Œå®ƒå‡ ä¹æ˜¯é€æ˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·æ ¹æœ¬ä¸éœ€è¦çŸ¥é“è¿™ä¸ªåè®®çš„å­˜åœ¨ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›å¼Šç«¯ï¼Œå®ƒåœ¨ä¸€äº›åŸºç¡€æ–¹é¢å¯¹åè®®åšäº†é™åˆ¶ï¼ˆæ¯”å¦‚ä¸æ”¯æŒUDPï¼‰ã€‚</p>
<p>è‡ªSSL/TLSè¯ç”Ÿä»¥æ¥ï¼Œå®ƒå·²ç»æœ‰äº†ç›¸å½“å¤§çš„æ”¹è¿›ã€‚ç°åœ¨ï¼ŒSSL 2.0å’Œ3.0è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œä»–ä»¬å·²ç»è¢«TLS 1.0/1.1/1.2 æ›¿æ¢ã€‚è¿™äº›åè®®çš„å†å²æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„è¯é¢˜ã€‚</p>
<h2 id="åè®®æè¿°"><a href="#åè®®æè¿°" class="headerlink" title="åè®®æè¿°"></a>åè®®æè¿°</h2><p>å°±åƒä¸Šé¢æåˆ°çš„ï¼ŒTLSåè®®åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¸­é—´ã€‚å®ƒè¢«åˆ†å‰²æˆä¸¤ä¸ªä¸»è¦çš„å­å±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªåè®®çš„ä¸»è¦ç»“æ„å’Œå®ƒåœ¨ç½‘ç»œåè®®æ ˆä¸­çš„ä½ç½®ã€‚</p>
<p><img src="/img/protocol_description.png" alt="tls structure"></p>
<p>ä¸‹é¢çš„å­å±‚åœ¨TCPä¹‹ä¸Šï¼Œå› ä¸ºTCPæ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„å¯é çš„åè®®ã€‚è¿™ä¸€å±‚ä¸»è¦åŒ…æ‹¬TLSè®°å½•åè®®ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè®°å½•åè®®é¦–å…ˆå°†ä¸Šå±‚åè®®çš„æ•°æ®å˜æˆ2^14bytesæˆ–æ›´å°‘çš„å—ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼ˆå¯é€‰ï¼‰ï¼ŒåŠ ä¸Šä¸€ä¸ªæ¶ˆæ¯è®¤è¯ç ï¼ˆMessage Authentication Codeï¼‰ï¼Œæœ€åï¼Œæ ¹æ®åå•†çš„åŠ å¯†ç»†åˆ™å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å¹¶æ·»åŠ ä¸€ä¸ªSSLè®°å½•å¤´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªå—éƒ½ä¼šè¢«æ‰“åŒ…è¿›ä¸€ä¸ªç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“å¹¶ä¸ä¿å­˜åº”ç”¨å±‚æ¶ˆæ¯çš„è¾¹ç•Œï¼Œè¿™å°±æ„å‘³ç€å¤šæ¡ç›¸åŒç±»å‹çš„æ¶ˆæ¯å¯èƒ½ä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ã€‚</p>
<p>ä¸‹é¢çš„å›¾æè¿°äº†å»ºç«‹ä¸€ä¸ªSSL Recordçš„è¿‡ç¨‹</p>
<p><img src="/img/ssl_record.png" alt="ssl record"></p>
<p>ä¸Šé¢çš„å­å±‚åœ¨SSLè®°å½•åè®®(SSL Record Protocol)ä¹‹ä¸Šï¼Œå®ƒç”±å››ä¸ªå­åè®®ç»„æˆã€‚æ¯ä¸ªå­åè®®éƒ½æœ‰éå¸¸æ˜ç¡®çš„ç›®çš„ï¼Œå¹¶åœ¨é€šä¿¡çš„ä¸åŒé˜¶æ®µè¢«åº”ç”¨ï¼š</p>
<ol>
<li><p>æ¡æ‰‹åè®®ï¼ˆHandShake Protocolï¼‰ï¼šå®ƒä½¿åŒæ–¹å¯ä»¥ç›¸äº’è®¤è¯ï¼Œä»¥åŠä¸ºæœ¬æ¬¡è¿æ¥åå•†å‡ºä¸€ä¸ªåŠ å¯†å¥—ä»¶ï¼ˆcipher suiteï¼‰å’Œå…¶ä»–å‚æ•°ã€‚SSLæ¡æ‰‹åè®®æ¶‰åŠåˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´4ç»„æ¶ˆæ¯äº¤æ¢ã€‚æ¯ä¸€ç»„éƒ½æ˜¯åœ¨ç‹¬ç«‹çš„TCPæ®µï¼ˆsegmentï¼‰ä¸­ä¼ è¾“ã€‚ä¸‹é¢çš„å›¾ä¸ºè¿™ä¸ªè¿‡ç¨‹åšäº†æ€»ç»“ï¼Œå®ƒåŒ…å«å¥½å‡ ä¸ªæ­¥éª¤ï¼Œä¸€äº›æ­¥éª¤æ˜¯å¯é€‰çš„ã€‚æ³¨æ„ï¼Œ<em>ChangeCipherSpec</em>ä¸å±äºè¿™ä¸ªåè®®ï¼Œä»–ä»¬æ˜¯ç‹¬ç«‹çš„åè®®ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚<br><img src="/img/handshake.png" alt="handshake"></p>
</li>
<li><p>ChangeCipherSpecåè®®ï¼šå®ƒä½¿ä¹‹å‰åŒæ–¹åå•†å¾—åˆ°çš„å‚æ•°èµ·ä½œç”¨ï¼Œé€šä¿¡å˜æˆåŠ å¯†çš„ã€‚</p>
</li>
<li>Alertåè®®ï¼šç”¨äºé€šä¿¡å¼‚å¸¸ï¼Œå¹¶é¢„è­¦å¯èƒ½é™ä½é€šä¿¡å®‰å…¨æ€§çš„é—®é¢˜</li>
<li>åº”ç”¨æ•°æ®åè®®ï¼ˆApplication Data Protocolï¼‰ï¼šå®ƒæ¥å—ä»»æ„å¤§å°çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯åº”ç”¨å±‚æ•°æ®ï¼‰ï¼Œå°†æ•°æ®å–‚ç»™å®‰å…¨é€šé“ï¼ˆfeeds it through the secure channelï¼‰ã€‚</li>
</ol>
<p>å¤šæ¡æ¶ˆæ¯å¯ä»¥è¢«ä¸²è”æˆä¸€æ¡è®°å½•å±‚ï¼ˆRecord Layerï¼‰æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™äº›æ¶ˆæ¯å¿…é¡»å½’å±äºç›¸åŒçš„å­åè®®ã€‚ç»“æœæ˜¯ï¼Œè¿™4ä¸ªåè®®çš„æ¯ä¸ªéƒ½å¿…é¡»æ˜¯è‡ªå®šç•Œçš„ï¼ˆæ¯”å¦‚ï¼Œéƒ½éœ€è¦åŒ…å«è‡ªå·±çš„é•¿åº¦å­—æ®µï¼‰ã€‚</p>
<h2 id="è®°å½•åè®®æ ¼å¼ï¼ˆRecord-Protocol-formatï¼‰"><a href="#è®°å½•åè®®æ ¼å¼ï¼ˆRecord-Protocol-formatï¼‰" class="headerlink" title="è®°å½•åè®®æ ¼å¼ï¼ˆRecord Protocol formatï¼‰"></a>è®°å½•åè®®æ ¼å¼ï¼ˆRecord Protocol formatï¼‰</h2><p>TLS è®°å½•å¤´ï¼ˆRecord headerï¼‰åŒ…å«3ä¸ªå­—æ®µï¼Œé«˜å±‚åè®®å»ºç«‹åœ¨å®ƒä¹‹ä¸Šï¼š</p>
<ol>
<li>Byte 0ï¼šTLSè®°å½•ç±»å‹ï¼ˆTLS recode typeï¼‰</li>
<li>Bytes 1-2: TLS version (major/minor)</li>
<li>Bytes 3-4: Length of data in the record (excluding the header itself). The maximum supported is 16384 (16K)</li>
</ol>
<p><img src="/img/record_protocol_format.png" alt="record protocol format"></p>
<h2 id="æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake-Protocol-formatï¼‰"><a href="#æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake-Protocol-formatï¼‰" class="headerlink" title="æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake Protocol formatï¼‰"></a>æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake Protocol formatï¼‰</h2><p>è¿™æ˜¯TLSç§æœ€å¤æ‚çš„å­åè®®ã€‚TLSæ ‡å‡†ä¸»è¦ä¹Ÿåœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒä¸ºå»ºç«‹ä¸€ä¸ªå®‰å…¨çš„è¿æ¥å¤„ç†äº†æ‰€æœ‰ç»†èŠ‚ã€‚ä¸‹é¢çš„å›¾å±•ç¤ºäº†æ¡æ‰‹åè®®æ¶ˆæ¯çš„ä¸»ä½“ç»“æ„ã€‚TLSæ ‡å‡†å­˜åœ¨10ç§ï¼ˆä¸åŒ…æ‹¬æ‰©å±•ï¼‰æ¡æ‰‹æ¶ˆæ¯ç±»å‹ï¼Œä¸‹é¢ä¸€ä¸€åšäº†å±•ç¤ºã€‚</p>
<p><img src="/img/handshake_message_structure.png" alt="handshake message general structure"></p>
<ul>
<li>HelloRequestï¼šå…è®¸æœåŠ¡å™¨é‡å¯æ¡æ‰‹åå•†ã€‚ä¸å¸¸ç”¨ã€‚å¦‚æœä¸€ä¸ªè¿æ¥è¢«æŒ‚èµ·äº†è¶³å¤Ÿé•¿æ—¶é—´åªæ˜¯å®‰å…¨æ€§ä¸‹é™ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨æ­¤æ¶ˆæ¯è¿«ä½¿å®¢æˆ·ç«¯é‡æ–°åå•†æ–°çš„ä¼šè¯ç§˜é’¥ï¼ˆkeysï¼‰ã€‚</li>
</ul>
<p><img src="/img/hello_request.png" alt="hello request"></p>
<ul>
<li>ClientHelloï¼šè¿™æ¡æ¶ˆæ¯ä»£è¡¨äº†ä¸€ä¸ªTLSæ¡æ‰‹åå•†çš„å¼€å§‹ã€‚å‘é€å®ƒçš„åŒæ—¶ä¼šå¸¦ä¸Šå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼ŒæœåŠ¡ç«¯ä¼šæŒ‘é€‰æœ€åˆé€‚çš„é‚£ä¸ªï¼ˆå®‰å…¨æ€§æœ€å¼ºçš„é‚£ä¸ªï¼‰ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€ä¸ªå‹ç¼©æ–¹æ³•åˆ—è¡¨ï¼Œä¸€ä¸ªæ‰©å±•åˆ—è¡¨ã€‚é€šè¿‡åŒ…å«<code>SessionId</code>å­—æ®µï¼Œå®ƒä¹Ÿèµ‹äºˆäº†å®¢æˆ·ç«¯é‡æ–°å¼€å§‹ä¹‹å‰çš„ä¼šè¯çš„èƒ½åŠ›ã€‚</li>
</ul>
<p><img src="/img/client_hello.png" alt="client hello"></p>
<ul>
<li>ServerHelloï¼šServerHelloæ¶ˆæ¯å’ŒClientHelloæ¶ˆæ¯å¾ˆç±»ä¼¼ï¼Œé™¤äº†å®ƒåªåŒ…å«ä¸€ä¸ªå¯†ç å¥—ä»¶å’Œä¸€ä¸ªåŠ å¯†æ–¹æ³•ã€‚å¦‚æœä»–åŒ…å«äº†ä¸€ä¸ªSessionIdï¼ˆä¾‹å¦‚ï¼šSessionIdé•¿åº¦å¤§äº0ï¼‰ï¼Œå°±æ˜¯é€šçŸ¥å®¢æˆ·ç«¯åœ¨ä»¥åé‡ç”¨è¿™ä¸ªä¼šè¯ã€‚</li>
</ul>
<p><img src="/img/server_hello.png" alt="server hello"></p>
<ul>
<li>Certificateï¼šè¿™ä¸ªæ¶ˆæ¯çš„æ¶ˆæ¯ä½“åŒ…å«äº†ä¸€ä¸ªå…¬é’¥è¯ä¹¦é“¾ã€‚è¯ä¹¦é“¾ä½¿TLSæ”¯æŒè¯ä¹¦åˆ†å±‚å’Œå…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼šPublic Key Infrastructuresï¼‰</li>
</ul>
<p><img src="/img/certificate.png" alt="certificate"></p>
<ul>
<li>ServerKeyExchangeï¼šè¯¥æ¶ˆæ¯æºå¸¦å®¢æˆ·ç«¯éœ€è¦ä»æœåŠ¡å™¨è·å¾—çš„å¯†é’¥äº¤æ¢ç®—æ³•å‚æ•°ï¼Œä»¥ä¾¿ä¹‹åèƒ½ä½¿ç”¨å¯¹ç§°åŠ å¯†ã€‚è¿™æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰å¯†é’¥äº¤æ¢éƒ½è¦æ±‚æœåŠ¡å™¨æ˜ç¡®åœ°å‘é€æ­¤æ¶ˆæ¯ã€‚å®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒCertificateæ¶ˆæ¯è¶³ä»¥ä½¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å®‰å…¨åœ°é€šä¿¡ä¸€ä¸ªé¢„å…ˆå¯†é’¥ã€‚è¿™äº›å‚æ•°çš„æ ¼å¼å®Œå…¨å–å†³äºæ‰€é€‰æ‹©çš„å¯†é’¥å¥—ä»¶ï¼ˆCipherSuiteï¼‰ï¼Œå®ƒå…ˆå‰ç”±æœåŠ¡å™¨é€šè¿‡ServerHelloæ¶ˆæ¯è®¾ç½®ã€‚</li>
</ul>
<p><img src="/img/server_key_exchange.png" alt="server key exchange"></p>
<ul>
<li>CertificateRequestï¼šå½“æœåŠ¡å™¨éœ€è¦å®¢æˆ·ç«¯èº«ä»½éªŒè¯æ—¶ä½¿ç”¨å®ƒã€‚åœ¨WebæœåŠ¡å™¨ä¸­ä¸å¸¸ç”¨ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸é‡è¦ã€‚è¯¥æ¶ˆæ¯ä¸ä»…å‘å®¢æˆ·ç«¯è¯¢é—®è¯ä¹¦ï¼Œè¿˜ä¼šå‘ŠçŸ¥å“ªäº›è¯ä¹¦ç±»å‹æ˜¯å¯æ¥å—çš„ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æŒ‡å‡ºé‚£äº›è¯ä¹¦æœºæ„æ˜¯å¯ä¿¡èµ–çš„ã€‚</li>
</ul>
<p><img src="/img/certificate_request.png" alt="certificate request"></p>
<ul>
<li>ServerHelloDoneï¼šè¯¥æ¶ˆæ¯å®Œæˆäº†æ¡æ‰‹åå•†çš„æœåŠ¡å™¨éƒ¨åˆ†ã€‚å®ƒæ²¡æœ‰é™„åŠ ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="/img/server_hello_done.png" alt="server hello done"></p>
<ul>
<li>ClientKeyExchangeï¼šå®ƒä¸ºæœåŠ¡å™¨æä¾›å¿…è¦çš„æ•°æ®ï¼Œä»¥ç”Ÿæˆå¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚æ¶ˆæ¯æ ¼å¼ä¸ServerKeyExchangeéå¸¸ç›¸ä¼¼ï¼Œå› ä¸ºå®ƒä¸»è¦å–å†³äºæœåŠ¡å™¨é€‰æ‹©çš„å¯†é’¥äº¤æ¢ç®—æ³•ã€‚</li>
</ul>
<p><img src="/img/client_key_exchange.png" alt="client key exchange"></p>
<ul>
<li>CertificateVerifyï¼šå®¢æˆ·ç«¯ä½¿ç”¨è¯¥æ¶ˆæ¯æ¥è¯æ˜æœåŠ¡å™¨æ‹¥æœ‰ä¸å…¶å…¬é’¥è¯ä¹¦ç›¸å¯¹åº”çš„ç§é’¥ã€‚è¯¥æ¶ˆæ¯ä¿å­˜æœ‰å®¢æˆ·ç«¯æ•°å­—ç­¾åçš„æ•£â€‹â€‹åˆ—ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘å‡ºCertificateRequestï¼Œåˆ™éœ€è¦å‘é€éœ€è¦éªŒè¯çš„è¯ä¹¦ã€‚åŒæ ·çš„ï¼Œä¿¡æ¯çš„ç¡®åˆ‡å°ºå¯¸å’Œç»“æ„å–å†³äºå•†å®šçš„ç®—æ³•ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œè¾“å…¥åˆ°å“ˆå¸Œå‡½æ•°çš„ä¿¡æ¯æ˜¯ç›¸åŒçš„ã€‚</li>
</ul>
<p><img src="/img/certificate_verify.png" alt="certificate verify"></p>
<ul>
<li>Finishedï¼šæ­¤æ¶ˆæ¯è¡¨ç¤ºTLSåå•†å·²å®Œæˆï¼Œå¯†ç å¥—ä»¶ï¼ˆCipherSuiteï¼‰å·²æ¿€æ´»ã€‚åº”è¯¥å‘é€å·²ç»åŠ å¯†ï¼Œå› ä¸ºåå•†æˆåŠŸå®Œæˆï¼Œæ‰€ä»¥å¿…é¡»åœ¨æ­¤ä¹‹å‰å‘é€ä¸€ä¸ª<code>ChangeCipherSpec</code>åè®®æ¶ˆæ¯æ¥æ¿€æ´»åŠ å¯†ã€‚Finishæ¶ˆæ¯åŒ…å«ä¸€ä¸ªç”¨æ‰€æœ‰å…ˆå‰çš„æ¡æ‰‹æ¶ˆæ¯ç»„åˆçš„å“ˆå¸Œï¼Œå…¶åæ˜¯è¯†åˆ«æœåŠ¡å™¨/å®¢æˆ·ç«¯è§’è‰²çš„ç‰¹æ®Šå·ç ï¼Œä¸»å¯†é’¥å’Œå¡«å……ã€‚æ‰€äº§ç”Ÿçš„å“ˆå¸Œä¸<code>CertificateVerify</code>å“ˆå¸Œä¸åŒï¼Œå› ä¸ºå­˜åœ¨æ›´å¤šçš„æ¡æ‰‹æ¶ˆæ¯ã€‚</li>
</ul>
<p><img src="/img/finish.png" alt="finish"></p>
<h2 id="ChangeCipherSpecåè®®æ ¼å¼"><a href="#ChangeCipherSpecåè®®æ ¼å¼" class="headerlink" title="ChangeCipherSpecåè®®æ ¼å¼"></a>ChangeCipherSpecåè®®æ ¼å¼</h2><p>è¿™æ˜¯æœ€ç®€å•çš„åè®®ï¼šå®ƒåªæœ‰ä¸€æ¡æ¶ˆæ¯ã€‚è¯¥æ¶ˆæ¯å¿…é¡»æ˜¯å•ç‹¬çš„åè®®è€Œä¸æ˜¯æ¡æ‰‹åè®®çš„ä¸€éƒ¨åˆ†çš„åŸå› æ˜¯ç”±äºè®°å½•å±‚å°è£…ï¼ˆRecord Layer encapsulationï¼‰ã€‚ TLSåè®®åŒæ—¶å¯¹æ•´ä¸ªè®°å½•å±‚æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚ ChangeCipherSpecæ¶ˆæ¯è¡¨ç¤ºåŠ å¯†çš„æ¿€æ´»ï¼Œå¹¶ä¸”ç”±äºåŠ å¯†ä¸èƒ½åº”ç”¨äºæ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä»»ä½•å…¶ä»–æ¶ˆæ¯éƒ½ä¸å¯èƒ½éµå¾ªChangeCipherSpecã€‚é¿å…è¿™äº›ç»„åˆçš„æœ€ä½³æ–¹æ³•æ˜¯å°†æ­¤æ¶ˆæ¯å‡çº§ä¸ºåè®®çŠ¶æ€ã€‚</p>
<p>ä¸‹é¢å±•ç¤ºChangeCipherSpecæ¶ˆæ¯æ˜¯å¦‚ä½•æ„é€ çš„ï¼š</p>
<p><img src="/img/change_cipher_spec.png" alt="change cipher spec"></p>
<h2 id="Alertåè®®æ ¼å¼"><a href="#Alertåè®®æ ¼å¼" class="headerlink" title="Alertåè®®æ ¼å¼"></a>Alertåè®®æ ¼å¼</h2><p>è­¦æŠ¥åè®®ä¹Ÿå¾ˆç®€å•ã€‚å®ƒå®šä¹‰äº†ä¸¤ä¸ªå­—æ®µï¼šä¸¥é‡æ€§çº§åˆ«å’Œè­¦æŠ¥æè¿°ã€‚ç¬¬ä¸€ä¸ªå­—æ®µè¡¨ç¤ºè­¦æŠ¥çš„ä¸¥é‡æ€§ï¼ˆè­¦å‘Šä¸º1ï¼Œè‡´å‘½çš„2ï¼‰ï¼Œè€Œç¬¬äºŒä¸ªå­—æ®µåˆ™è¡¨ç¤ºå‡†ç¡®çš„æ¡ä»¶ã€‚æ”¯æŒçš„è­¦æŠ¥æè¿°å–å†³äºSSL/TLSç‰ˆæœ¬ã€‚</p>
<p><img src="/img/alert_protocol_format.png" alt="alert protocol format"></p>
<h2 id="ApplicationDataåè®®æ ¼å¼"><a href="#ApplicationDataåè®®æ ¼å¼" class="headerlink" title="ApplicationDataåè®®æ ¼å¼"></a>ApplicationDataåè®®æ ¼å¼</h2><p>è¯¥åè®®çš„ä»»åŠ¡æ˜¯æ­£ç¡®åœ°å°è£…æ¥è‡ªç½‘ç»œå †æ ˆçš„åº”ç”¨å±‚çš„æ•°æ®ï¼Œä»è€Œå¯ä»¥é€šè¿‡åº•å±‚åè®®ï¼ˆTCPï¼‰æ— ç¼åœ°å¤„ç†æ•°æ®ï¼Œè€Œä¸ä¼šå¼ºåˆ¶æ›´æ”¹ä»»ä½•è¿™äº›å±‚ã€‚æ­¤åè®®ä¸­æ¶ˆæ¯çš„æ ¼å¼éµå¾ªä¸ä»¥å‰åè®®ç›¸åŒçš„ç»“æ„ã€‚</p>
<p><img src="/img/application_protocol_format.png" alt="applicationdata protocol format"></p>
<h2 id="åˆ†æSSL-TLSæµé‡"><a href="#åˆ†æSSL-TLSæµé‡" class="headerlink" title="åˆ†æSSL/TLSæµé‡"></a>åˆ†æSSL/TLSæµé‡</h2><p>æˆ‘å°†ä½¿ç”¨Wiresharkè¿›è¡ŒæŠ“åŒ…ã€‚å®¢æˆ·ç«¯åŸºäºSchemeçš„æ–¹å¼æ”¯æŒSSL/TLSï¼ŒæœåŠ¡ç«¯æ˜¯OpenSSLåˆ†å‘çš„ä¸€éƒ¨åˆ†ï¼ˆå…·æœ‰è¯ä¹¦ï¼‰ã€‚æœåŠ¡å™¨ç›‘å¬åœ¨443ç«¯å£ï¼Œæ‰€æœ‰é€šä¿¡å°†é€šè¿‡ç¯å›è®¾å¤‡è¿›è¡Œã€‚åœ¨Wiresharkä¸­å°†è§†å›¾é™åˆ¶ä¸ºTLSæ•°æ®åŒ…çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨åè®®è¿‡æ»¤å™¨â€œsslâ€ã€‚</p>
<h3 id="ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰"><a href="#ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰" class="headerlink" title="ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰"></a>ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰</h3><p>ä¸€æ—¦æœåŠ¡å™¨è¿è¡Œå¹¶ç­‰å¾…è¿æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥å¯åŠ¨å®ƒã€‚è¿™æ˜¯å®¢æˆ·ç«¯å‘é€çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…</p>
<p><img src="/img/first_flight.png" alt="first flight"></p>
<h3 id="ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰"><a href="#ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰" class="headerlink" title="ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰"></a>ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰</h3><p>ç¬¬ä¸€ä¸ªåŒ…åªåŒ…å«ä¸€ä¸ªä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„TLSæ¡æ‰‹æ¶ˆæ¯ï¼ˆClientHelloï¼‰ã€‚ç„¶è€Œï¼ŒæœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ä½œä¸ºClientHelloå“åº”çš„ä¸‹ä¸€ä¸ªTCPæ•°æ®åŒ…æºå¸¦3ä¸ªæ¡æ‰‹æ¶ˆæ¯ã€‚è¿™äº›æ¶ˆæ¯æ˜¯ServerHelloï¼ŒCertificateå’ŒServerHelloDoneï¼ˆæ²¡æœ‰å‘é€ServerKeyExchangeæˆ–CertificateRequestï¼‰ã€‚åœ¨ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ä¹‹åï¼Œæˆ‘å°†çœç•¥è¾ƒä½çš„å †æ ˆåè®®ï¼ˆTCP/IPï¼‰ã€‚</p>
<p><img src="/img/second_flight.png" alt="second flight"></p>
<h3 id="ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰"><a href="#ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰" class="headerlink" title="ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰"></a>ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰</h3><p>ç›®å‰çœ‹ä¸Šå»éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä¸ä¸Šè¿°çš„åè®®ä¸€è‡´ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç°åœ¨å·²ç»åŒæ„ä½¿ç”¨çš„ç®—æ³•ï¼ˆå¯†é’¥äº¤æ¢çš„RSAï¼Œå¯¹ç§°åŠ å¯†çš„AES-256-CBCå’Œæ¶ˆæ¯æ•£åˆ—çš„SHAï¼‰ï¼Œå‹ç¼©ï¼ˆæ— å‹ç¼©ï¼‰å’Œä½¿ç”¨çš„TLSæ‰©å±•ï¼ˆSessionTicket TLSï¼Œé‡æ–°è°ˆåˆ¤ä¿¡æ¯ï¼‰ã€‚æ­¤å¤–ï¼Œå®¢æˆ·ç«¯ç°åœ¨æ‹¥æœ‰æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œå› æ­¤å¯ä»¥å†³å®šæ˜¯å¦ä¿¡ä»»æœåŠ¡å™¨ã€‚ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ç”±å®¢æˆ·ç«¯å‘é€ï¼Œå¹¶æºå¸¦ä»¥ä¸‹æ¶ˆæ¯ï¼šClientKeyExchangeï¼ŒChangeCipherSpecï¼ŒFinishedï¼ˆå·²ç»åŠ å¯†ï¼‰ã€‚</p>
<p><img src="/img/third_flight.png" alt="third flight"></p>
<h3 id="ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰"><a href="#ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰" class="headerlink" title="ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰"></a>ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰</h3><p>åœ¨å®¢æˆ·ç«¯å‘é€ChangeCipherSpecå’ŒFinishedä¹‹åï¼ŒæœåŠ¡å™¨é¢„æœŸæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œä»¥ä¾¿åŒå‘å¯åŠ¨é‡‡ç”¨å¯¹ç§°å¯†é’¥å’Œæ‰€æœ‰åå•†çš„å¯†ç å¥—ä»¶å‚æ•°çš„åŠ å¯†é€šä¿¡ã€‚æœåŠ¡å™¨å¿…é¡»å‘é€è‡ªå·±çš„ChangeCipherSpecå’ŒFinishedçš„æ¶ˆæ¯ï¼Œä»¥ä½¿æ¡æ‰‹è¿‡ç¨‹å¯ä»¥è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚åœ¨è¿™ä¸ªæ¶ˆæ¯ä¸­å‘ç”Ÿçš„ä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹æƒ…æ˜¯ï¼Œæˆ‘ä»¬çœ‹åˆ°å…¶ä¸­ä¸€ä¸ªæ‰©å±•ï¼Œæ‰©å±•åç§°ä¸ºTransport Layer Securityï¼ˆä¼ è¾“å±‚å®‰å…¨TLSï¼‰ä¼šè¯æ¢å¤ï¼Œè€Œæ— éœ€æœåŠ¡å™¨ç«¯çŠ¶æ€ï¼Œå®ƒæ˜ç¡®è¯´æ˜äº†å®ƒçš„ä½œç”¨ã€‚ä½ åº”è¯¥è®°å¾—ï¼Œå®ƒè¢«è¦æ±‚ä½œä¸ºæˆ‘ä»¬çš„ClientHelloçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ç”±æœåŠ¡å™¨åœ¨å…¶ServerHelloä¸­å®ç°ã€‚æœ‰å…³ä¸æ­¤æ‰©å±•ç›¸å…³çš„æ¶ˆæ¯çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥æ‰¾<a href="http://www.ietf.org/rfc/rfc5077.txt" target="_blank" rel="external">RFC5077</a>è§„èŒƒã€‚å¦‚æ–‡æ¡£ä¸­æ‰€è¿°ï¼Œæ­¤æ‰©å±•æ¡æ‰‹æ¶ˆæ¯å·²è¢«åˆ†é…å·ç 4ã€‚</p>
<p><img src="/img/fourth_flight.png" alt="fourth flight"></p>
<h3 id="åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯-lt-gt-æœåŠ¡ç«¯ï¼‰"><a href="#åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯-lt-gt-æœåŠ¡ç«¯ï¼‰" class="headerlink" title="åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯&lt;-&gt;æœåŠ¡ç«¯ï¼‰"></a>åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯&lt;-&gt;æœåŠ¡ç«¯ï¼‰</h3><p>æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®Œæˆæ¡æ‰‹ã€‚åŠ å¯†é€šä¿¡å°±ä½ï¼Œåº”ç”¨æ•°æ®å¯ä»¥å®‰å…¨ä¼ è¾“ã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è®°å½•ï¼Œå•ä¸ªTCPæ•°æ®åŒ…å¯ä»¥æºå¸¦å‡ ä¸ªæ¶ˆæ¯ï¼š</p>
<p><img src="/img/application_data.png" alt="application data"></p>
<h3 id="å…³é—­è¿æ¥"><a href="#å…³é—­è¿æ¥" class="headerlink" title="å…³é—­è¿æ¥"></a>å…³é—­è¿æ¥</h3><p>ç”±äºæˆ‘ä»¬çš„è¿æ¥æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥æƒ³çŸ¥é“åœ¨æ•°æ®åŒ…ä¸­å‘é€ä»€ä¹ˆçš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿Wiresharkæˆ–ç±»ä¼¼çš„å·¥å…·çŸ¥é“ä¼ è¾“ä¸­ä½¿ç”¨çš„å¯†é’¥ã€‚å°½ç®¡è¿™æ˜¯å¯èƒ½çš„ï¼Œæˆ‘è®¤ä¸ºä¸ºäº†åˆ†æçš„ç›®çš„ï¼Œå½“å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿æ¥æ—¶ï¼ŒçŸ¥é“å®¢æˆ·ç«¯ä¼šå‘å‡ºä¸€ä¸ªè­¦å‘Šæ¶ˆæ¯å°±è¶³å¤Ÿäº†ã€‚æ­¤è­¦æŠ¥æ¶ˆæ¯çš„ç±»å‹åº”ä¸ºCloseNotifyï¼ˆç±»å‹0ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å°†æ— æ³•ä»åŸå§‹æ•°æ®ä¸­çœ‹åˆ°å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ˜¯ä»¥ä¸‹è­¦æŠ¥æ¶ˆæ¯çš„å‘ä»¶äººï¼š</p>
<p><img src="/img/closing_connection.png" alt="closing message"></p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä»æµé‡åˆ†æå¯ä»¥çœ‹å‡ºï¼Œæ ‡å‡†åº“å’Œå®¢æˆ·ç«¯çš„å®ç°éµå¾ªäº†TLS 1.0è§„èŒƒã€‚å¸Œæœ›è¿™å¯¹æ‚¨äº†è§£SSL/TLSåè®®çš„å†…éƒ¨æœºåˆ¶æ˜¯æœ‰ç”¨çš„ã€‚æˆ‘å‘ç°æ£€æŸ¥åå…­è¿›åˆ¶åŸå§‹æ•°æ®ï¼ˆç‰¹åˆ«æ˜¯åƒWiresharkè¿™æ ·å¼ºå¤§çš„å·¥å…·ï¼‰æ˜¯ä¸€ç§éå¸¸æœ‰æ„ä¹‰å’Œæœ‰è¶£çš„å·¥ä½œæ–¹å¼ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/19/Djangoå¤–é”®èµ‹å€¼/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/19/Djangoå¤–é”®èµ‹å€¼/" itemprop="url">Djangoå¤–é”®èµ‹å€¼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-12-19T10:46:48+08:00">
                2016-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Django/" itemprop="url" rel="index">
                    <span itemprop="name">Django</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>class Article(models.Model):
    title = models.CharField(max_length=1024, default=&apos;&apos;)
    ...
    def __str__(self):
        return &apos;Article pk:%d %s&apos; % (self.pk, self.title[:30])

class ArticleContent(models.Model):
    article = cached_fields.OneToOneField(Article)
    ...
</code></pre><p>å†™ä»£ç çš„çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡ï¼Œå½“æˆ‘ç»™ä¸€ä¸ªinstanceçš„å¤–é”®ï¼ˆä»¥_idç»“å°¾ï¼‰èµ‹å€¼ï¼ˆæ•°å­—ï¼‰çš„æ—¶å€™    ï¼Œè¿™ä¸ªå¤–é”®å¯¹åº”çš„instanceçš„å€¼å¹¶ä¸ä¼šæ”¹å˜ã€‚</p>
<pre><code>In [44]: ac = ArticleContent.objects.get(article_id=14269)
In [45]: ac.article_id
Out[45]: 14269
In [46]: ac.article_id = 14266
In [47]: ac.save()
In [48]: ac.article
Out[48]: &lt;Article: Article pk:14266 EC: Russia, Ukraine to Meet in&gt;
In [49]: ac.article.pk
Out[49]: 14266
</code></pre><p>å¦‚ä¸Šé¢çš„ä»£ç æ‰€ç¤ºï¼Œä¸ºäº†æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆ‘ç¿»äº†ä¸€ä¸‹Djangoçš„æºç ï¼š</p>
<pre><code>django/db/models/fields/related_descriptors.py 
145     def __get__(self, instance, cls=None):
146         &quot;&quot;&quot;
147         Get the related instance through the forward relation.
148
149         With the example above, when getting ``child.parent``:
150
151         - ``self`` is the descriptor managing the ``parent`` attribute
152         - ``instance`` is the ``child`` instance
153         - ``cls`` is the ``Child`` class (we don&apos;t need it)
154         &quot;&quot;&quot;
155         if instance is None:
156             return self
157
158         # The related instance is loaded from the database and then cached in
159         # the attribute defined in self.cache_name. It can also be pre-cached
160         # by the reverse accessor (ReverseOneToOneDescriptor).
161         try:
162             rel_obj = getattr(instance, self.cache_name)
163         except AttributeError:
164             val = self.field.get_local_related_value(instance)
165             if None in val:
166                 rel_obj = None
167             else:
168                 qs = self.get_queryset(instance=instance)
169                 qs = qs.filter(self.field.get_reverse_related_filter(instance))
170                 # Assuming the database enforces foreign keys, this won&apos;t fail.
171                 rel_obj = qs.get()
172                 # If this is a one-to-one relation, set the reverse accessor
173                 # cache on the related object to the current instance to avoid
174                 # an extra SQL query if it&apos;s accessed later on.
175                 if not self.field.remote_field.multiple:
176                     setattr(rel_obj, self.field.remote_field.get_cache_name(), instance)
177             setattr(instance, self.cache_name, rel_obj)
178
179         if rel_obj is None and not self.field.null:
180             raise self.RelatedObjectDoesNotExist(
181                 &quot;%s has no %s.&quot; % (self.field.model.__name__, self.field.name)
182             )
183         else:
184             return rel_obj
</code></pre><p>æ³¨é‡Šå¾—éå¸¸åˆ°ä½ï¼Œå½“æˆ‘ä»¬è¯·æ±‚<code>ac.article</code>çš„æ—¶å€™ï¼Œä¼šå…ˆå»æ£€æŸ¥å¯¹åº”çš„cacheï¼ˆåœ¨è¿™é‡Œæ˜¯<code>_article_cache</code>ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»çœ‹<code>cache_name</code>çš„ç”Ÿæˆè§„åˆ™ï¼Œå°±æ˜¯å¤–é”®åå‰é¢åŠ ä¸‹åˆ’çº¿ï¼Œåé¢åŠ cacheï¼‰å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨é‚£ä¹ˆå°±è¿›è¡Œæ•°æ®åº“è¯·æ±‚ï¼Œè¯·æ±‚å®Œä¹‹åä¼šä¿å­˜åˆ°cacheä¸­ã€‚</p>
<p>æˆ‘ä»¬å†çœ‹çœ‹<code>__set__</code>ï¼Œä»£ç å¤ªé•¿å°±ä¸è´´äº†ï¼ˆå°±åœ¨<code>__get__</code>æ–¹æ³•ä¸‹é¢ï¼‰ã€‚é™¤äº†ç»™å¤–é”®å­—æ®µï¼ˆ<code>article</code>ï¼‰èµ‹å€¼å¤–ï¼Œè¿˜ä¼šå°†pkå­—æ®µï¼ˆ<code>article_id</code>ï¼Œæ˜¯<code>lh_field.attname</code>çš„å€¼ï¼‰è®¾ç½®ä¸ºNoneï¼Œè¿™æ ·ä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™å°±èƒ½æ‹¿åˆ°æ­£ç¡®çš„å€¼ã€‚</p>
<p>ä»¥ä¸Šéƒ½æ˜¯ForeignKeyçš„Magicï¼Œè€Œå½“æˆ‘ä»¬ç»™<code>article_id</code>èµ‹å€¼çš„æ—¶å€™ï¼Œåªæ˜¯åœ¨ç»™ä¸€ä¸ªæ™®é€šçš„attributeèµ‹å€¼è€Œå·²ï¼Œæ²¡æœ‰ä»»ä½•magicï¼Œä¸ä¼šæ¸…ç†å¯¹åº”å¤–é”®çš„cacheï¼Œè¿™æ—¶å€™æ‹¿åˆ°çš„instanceä»ç„¶æ˜¯cacheä¸­åŸæ¥çš„é‚£ä¸ªinstanceã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/03/Django-rediså¦‚ä½•æ”¯æŒå­˜å–æ•´å‹å’Œå¸ƒå°”å€¼/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/03/Django-rediså¦‚ä½•æ”¯æŒå­˜å–æ•´å‹å’Œå¸ƒå°”å€¼/" itemprop="url">Django-rediså¦‚ä½•æ”¯æŒå­˜å–æ•´å‹å’Œå¸ƒå°”å€¼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-11-03T05:16:48+08:00">
                2016-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Django/" itemprop="url" rel="index">
                    <span itemprop="name">Django</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>redisæ”¯æŒ5ç§æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œhashï¼ˆå“ˆå¸Œï¼‰ï¼Œlistï¼ˆåˆ—è¡¨ï¼‰ï¼Œsetï¼ˆé›†åˆï¼‰åŠzset(sorted setï¼šæœ‰åºé›†åˆ)ã€‚æ•´å‹å€¼å’Œå¸ƒå°”å€¼å¹¶ä¸åœ¨å…¶ä¸­ã€‚å­˜å‚¨æ•´å‹å’Œå¸ƒå°”å€¼æ—¶ï¼Œredisä¼šå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p>
<pre><code>127.0.0.1:6379&gt; SET test_key 1
OK
127.0.0.1:6379&gt; GET test_key
&quot;1&quot;
127.0.0.1:6379&gt; SET test_key True
OK
127.0.0.1:6379&gt; GET test_key
&quot;True&quot;
127.0.0.1:6379&gt; SET test_key TRUE
OK
127.0.0.1:6379&gt; GET test_key
&quot;TRUE&quot;
127.0.0.1:6379&gt; SET test_key true
OK
127.0.0.1:6379&gt; GET test_key
&quot;true&quot;
</code></pre><p>ä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨äº†<code>django-redis</code>ä¹‹åå‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸å­˜å–æ•´å‹å’Œå¸ƒå°”å€¼ï¼Œè¿™æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿç­”æ¡ˆè‡ªç„¶æ˜¯åœ¨æºç ä¸­ï¼Œç›´è§‰å‘Šè¯‰æˆ‘ä»¬ï¼Œ<code>setå‡½æ•°</code>é‡Œä¸€å®šåšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<pre><code># django_redis.client.default.py
def set(self, key, value, timeout=DEFAULT_TIMEOUT, version=None, client=None, nx=False, xx=False):
    &quot;&quot;&quot;
    Persist a value to the cache, and set an optional expiration time.
    Also supports optional nx parameter. If set to True - will use redis setnx instead of set.
    &quot;&quot;&quot;

    if not client:
        client = self.get_client(write=True)

    nkey = self.make_key(key, version=version)
    nvalue = self.encode(value)

    ......
</code></pre><p><code>set</code>æ–¹æ³•ä¸­è°ƒç”¨äº†ç±»çš„<code>encode</code>çš„æ–¹æ³•å¯¹<code>value</code>è¿›è¡Œäº†å¤„ç†ï¼Œæˆ‘ä»¬å†çœ‹<code>encode</code>ï¼š</p>
<pre><code>django_redis.client.default.py
def encode(self, value): &quot;&quot;&quot; Encode the given value. &quot;&quot;&quot;

if isinstance(value, bool) or not isinstance(value, integer_types):
    value = self._serializer.dumps(value)
    value = self._compressor.compress(value)
    return value

return value
</code></pre><p>çœ‹åˆ°äº†å§ï¼Œå¦‚æœæ˜¯<code>å¸ƒå°”å€¼</code>ï¼Œé‚£ä¹ˆè¦è°ƒç”¨ä¸€ä¸ª<code>dumps</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ‰¾åˆ°è¿™ä¸ª<code>dumps</code>æ–¹æ³•ï¼š</p>
<pre><code>django_redis.serializers.pickle.py
class PickleSerializer(BaseSerializer): ......

def dumps(self, value):
    return pickle.dumps(value, self._pickle_version)

def loads(self, value):
    return pickle.loads(force_bytes(value))
</code></pre><p>åŸæ¥æ˜¯ç”¨äº†<a href="https://docs.python.org/3/library/pickle.html" target="_blank" rel="external">pickle</a>æ¥åšäº†åºåˆ—åŒ–ï¼Œè¿™æ ·æ‹¿å‡ºæ¥çš„æ—¶å€™è°ƒç”¨<code>pickle.loads</code>æ–¹æ³•ï¼Œå°±å¯ä»¥è¿˜åŸä¸ºåŸæ¥çš„å¯¹è±¡äº†ã€‚è¿™ä¹Ÿæ˜¯<code>django-redis</code>æ”¯æŒå­˜å‚¨ä»»æ„<code>python</code>å¯¹è±¡çš„åŸå› ï¼Œ<a href="https://docs.python.org/3/library/pickle.html" target="_blank" rel="external">pickle</a>å¸®äº†å¤§å¿™ã€‚</p>
<p>è‡³äº<code>int</code>çš„å­˜å–å°±ç®€å•äº†ï¼Œæˆ‘ä»¬ä»<code>get</code>æ–¹æ³•çœ‹è¿‡å»ï¼š</p>
<pre><code>django_redis.client.default.py
def get(self, key, default=None, version=None, client=None): &quot;&quot;&quot; Retrieve a value from the cache. Returns decoded value if key is found, the default if not. &quot;&quot;&quot; if client is None: client = self.get_client(write=False)

key = self.make_key(key, version=version)

try:
    value = client.get(key)
except _main_exceptions as e:
    raise ConnectionInterrupted(connection=client, parent=e)

if value is None:
    return default

return self.decode(value)
</code></pre><p>å¯ä»¥çœ‹åˆ°å¯¹ä»<code>redis</code>ä¸­å–å‡ºæ¥çš„å€¼è°ƒç”¨äº†<code>decode</code>æ–¹æ³•ï¼š</p>
<pre><code>django_redis.client.default.py
def decode(self, value): 
&quot;&quot;&quot; 
Decode the given value. 
&quot;&quot;&quot; 
try: 
    value = int(value)
except (ValueError, TypeError):
    try:
        value = self._compressor.decompress(value)
    except CompressorError:
        # Handle little values, chosen to be not compressed pass
        value = self._serializer.loads(value) return value
</code></pre><p>ä¸€ç›®äº†ç„¶äº†å§ï¼Œæ€»ç»“çš„è¯å°±æ˜¯ï¼š<code>redis</code>å­˜çš„æ—¶å€™è¿˜æ˜¯å­˜çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å–å‡ºæ¥çš„æ—¶å€™ä¼šå°è¯•å»<code>int</code>ä¸€ä¸‹ã€‚</p>
<p>å¤§å®¶å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼Œå¦‚æœå€¼æ˜¯<code>&#39;123&#39;</code>è¿™æ ·çš„å­—ç¬¦ä¸²æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ ·å¹¶ä¸ä¼šæœ‰é—®é¢˜å•¦ï¼Œå› ä¸ºå­—ç¬¦ä¸²å­˜åˆ°æ•°æ®åº“ä¹‹å‰ä¼šå…ˆåš<code>pickle.dumps</code>ï¼Œè¿™æ ·å°±å¯ä»¥åŒºåˆ†å¼€<strong>æ•°å­—è½¬æ¢æˆçš„å­—ç¬¦ä¸²</strong>å’Œ<strong>çœŸå®çš„å­—ç¬¦ä¸²</strong>äº†ã€‚</p>
<p>å¦å¤–ï¼Œå°†<code>æ•´å‹</code>è¿›è¡Œ<code>pickle</code>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å› ä¸ºæ•°å­—çš„å­˜å‚¨æ˜¯å¾ˆå¹³å¸¸çš„éœ€æ±‚ï¼Œè€Œ<code>pickle</code>ä¹‹åä¼šå¸¦ä¸Šå¯¹è±¡çš„å„ç§é™„åŠ ä¿¡æ¯ï¼Œä¼šå¢åŠ ç©ºé—´æ¶ˆè€—ï¼Œæ‰€ä»¥ä½œè€…æ‰æœ‰äº†è¿™æ ·çš„è®¾è®¡ã€‚</p>
<p>å¦‚æœå¤§å®¶éœ€è¦å†™è‡ªå·±çš„<code>redis client</code>çš„è¯ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™äº›è®¾è®¡ï¼Œä¼šç»™ä½¿ç”¨å¸¦æ¥å¾ˆå¤§çš„æ–¹ä¾¿ã€‚</p>
<p><strong>Note</strong>: <code>Python3</code> ä¸­<code>pickle</code>å’Œ<code>cPickle</code>å·²ç»åˆå¹¶ä¸º<code>pickle</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/img/lufei.jpeg"
               alt="You Wangqiu" />
          <p class="site-author-name" itemprop="name">You Wangqiu</p>
           
              <p class="site-description motion-element" itemprop="description">ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">169</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/michaelyou" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhi-yu-65-2" target="_blank" title="çŸ¥ä¹">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      çŸ¥ä¹
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="michaelseu2011@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">You Wangqiu</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
