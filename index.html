<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/img/lufei.ico?v=5.1.2" />






<meta name="description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">
<meta property="og:type" content="website">
<meta property="og:title" content="Youmai ã® Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Youmai ã® Blog">
<meta property="og:description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Youmai ã® Blog">
<meta name="twitter:description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Youmai ã® Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-63551049-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Youmai ã® Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/12/dockeræºç åˆ†æ1-cli/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/12/dockeræºç åˆ†æ1-cli/" itemprop="url">dockeræºç åˆ†æ1-cli</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-12T20:41:10+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Dockerä»£ç æ›´æ–°å¾ˆå¿«ï¼Œç½‘ä¸Šå„ä½å¤§ç¥çš„æºç è§£æå¾ˆå¤šå·²ç»æ˜¯å‡ å¹´å‰çš„ç‰ˆæœ¬äº†ã€‚å®ç°ä¸Šæœ‰äº†å¾ˆå¤§æ”¹å˜ï¼ŒåŠ ä¹‹Dockeré¡¹ç›®æ›´åä¸º<a href="https://github.com/moby/moby" target="_blank" rel="external">moby</a>ï¼Œå…¶ä¸­å¾ˆå¤šç»„ä»¶åˆä»mobyä¸­æ‹†åˆ†äº†å‡ºæ¥ï¼Œä¸€å¼€å§‹çœ‹ç®€ç›´æ˜¯ä¸€è„¸æ‡µé€¼å•Šã€‚åœ¨è¿™é‡Œè·Ÿå¤§å®¶åˆ†äº«äº†ä¸€ä¸‹æœ€è¿‘çœ‹çš„<a href="https://github.com/docker/cli" target="_blank" rel="external">docker/cli</a>çš„æºç ï¼ŒæŠ›ç –å¼•ç‰ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚<br><a href="https://github.com/docker/cli" target="_blank" rel="external">docker/cli</a></p>
<p>åˆ†æçš„<code>docker client</code>ç‰ˆæœ¬æ˜¯<code>17.06.2-ce</code>ã€‚</p>
<p><code>docker client</code>æ˜¯Dockerçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ•²çš„<code>docker * *</code> å‘½ä»¤ï¼Œæˆ‘ä»¬é€šè¿‡ä»–ä¸<code>docker deamon</code>ç¨‹åºè¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬å¯ä»¥å°†ä»–çœ‹æˆä¸€ä¸ªæ™®é€šçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œdockerçš„æ ¸å¿ƒ<code>namespace</code>å’Œ<code>cgroup</code>ç­‰æŠ€æœ¯éƒ½ä¸åœ¨è¿™é‡Œã€‚</p>
<h2 id="æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ"><a href="#æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ" class="headerlink" title="æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ"></a>æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ</h2><p><code>docker_client</code>çš„å¼€å‘ç¯å¢ƒä¹Ÿæ˜¯åœ¨å®¹å™¨ä¸­ï¼Œé¡¹ç›®å·²ç»ç»™æˆ‘ä»¬åšå¥½äº†å°è£…ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé¡¹ç›®Readmeçš„<a href="https://github.com/docker/cli#development" target="_blank" rel="external">Development</a>ç« èŠ‚ã€‚</p>
<p>é—®å‡ ä¸ªé—®é¢˜ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼š</p>
<p>####1. å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ</p>
<p>ç­”ï¼š å‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯åœ¨å®¹å™¨ä¸­è°ƒè¯•ï¼Œå¼€å‘è¿˜æ˜¯åœ¨æœ¬åœ°å¼€å‘ï¼Œå®¹å™¨ä¸­çœ‹åˆ°çš„ç›®å½•æ˜¯æˆ‘ä»¬æœ¬åœ°ç›®å½•mountè¿›å»çš„</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> docker.Makefileæ–‡ä»¶</div><div class="line"></div><div class="line">......</div><div class="line">MOUNTS = -v "$(CURDIR)":/go/src/github.com/docker/cli</div><div class="line">......</div><div class="line"><span class="meta">#</span> start container in interactive mode for in-container development</div><div class="line">.PHONY: dev</div><div class="line">dev: build_docker_image</div><div class="line">    docker run -ti --security-opt=seccomp:unconfined $(ENVVARS) $(MOUNTS) \</div><div class="line">        -v /var/run/docker.sock:/var/run/docker.sock \</div><div class="line">        $(DEV_DOCKER_IMAGE_NAME) ash</div><div class="line"></div><div class="line">shell: dev</div><div class="line">......</div></pre></td></tr></table></figure>
<p>ä»shellé‡Œé¢è¿˜æ˜¯å¾ˆå®¹å™¨çœ‹å‡ºæ¥çš„ï¼Œrunçš„æ—¶å€™mountäº†<code>$(CURDIR)</code></p>
<p>####2. å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ<br>ç­”ï¼šä¸æ˜¯çš„ï¼Œé‡Œé¢åªæœ‰ä½ ç¼–è¯‘ç”Ÿæˆçš„docker clientç¨‹åºï¼Œæ˜¯æ²¡æœ‰docker deamonç¨‹åºï¼Œè‡³äºä¸ºä»€ä¹ˆèƒ½å“åº”ï¼Œè¿˜æ˜¯çœ‹ä¸Šé¢çš„shellè„šæœ¬ï¼Œ<code>-v /var/run/docker.sock:/var/run/docker.sock</code>è¿™ä¸€è¡Œå°†<code>docker.sock</code>æ–‡ä»¶ä¹Ÿmountäº†è¿›å»ï¼Œ<code>docker.sock</code>æ˜¯<code>docker deamon</code>é»˜è®¤ç›‘å¬çš„Unixå¥—æ¥å­—ï¼ˆUnix domain socketï¼‰ï¼Œå®¹å™¨ä¸­çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ä»–ä¸docker deamonè¿›è¡Œé€šä¿¡ã€‚æ‰€ä»¥è¿™é‡Œdocker clienté€šä¿¡çš„æ˜¯ä½ æœ¬æœºçš„docker daemonã€‚</p>
<p><img src="/img/docker_deamon_socket.png" alt="docker_deamon_socket"></p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„å¼€å‘æµç¨‹æ˜¯ï¼šæœ¬åœ°æ”¹ä»£ç â€“&gt;åˆ°containerä¸­ç¼–è¯‘â€“&gt;è¿è¡Œdocker clientçœ‹æ•ˆæœ</p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>æ˜¯æ—¶å€™è¡¨æ¼”çœŸæ­£çš„æŠ€æœ¯äº†ï¼</p>
<p>ğŸ˜†ï¼Œå¼€ä¸ªç©ç¬‘ï¼Œä¸‹é¢çš„åˆ†æå¦‚æœæœ‰é—®é¢˜ï¼Œè¿˜è¯·å¤§å®¶ä¸åèµæ•™ï¼</p>
<p>æˆ‘å°½é‡æŠŠæ–‡ä»¶è·¯å¾„åˆ—å‡ºæ¥ï¼Œä¼šè´´ä¸€äº›ä»£ç ï¼Œä½†ä¸»è¦è¿˜æ˜¯è·¯å¾„ï¼Œå»ºè®®å¤§å®¶æŠŠä»£ç cloneä¸‹æ¥ç…§ç€çœ‹ã€‚</p>
<p>dockerâ€”clientæ˜¯åŸºäº<a href="https://github.com/spf13/cobra" target="_blank" rel="external">cobra</a>å†™çš„ï¼Œå»ºè®®å¤§å®¶å…ˆçœ‹ä¸€ä¸‹cobraï¼Œè‡³å°‘å†™ä¸ª<code>hello world</code>ç†Ÿæ‚‰ä¸€ä¸‹åŸºæœ¬ç”¨æ³•ã€‚</p>
<p>æˆ‘ä»¬å¼€å§‹äº†ï¼</p>
<p>å…¥å£æ–‡ä»¶åœ¨<code>cmd/docker/docker.go</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// æ—¥å¿—è¾“å‡ºé‡‡ç”¨äº†ç¬¬ä¸‰æ–¹åº“logrus</span></div><div class="line">    <span class="comment">// Set terminal emulation based on platform as required.</span></div><div class="line">    stdin, stdout, stderr := term.StdStreams()</div><div class="line">    logrus.SetOutput(stderr)</div><div class="line"></div><div class="line">    dockerCli := command.NewDockerCli(stdin, stdout, stderr)</div><div class="line">    </div><div class="line">    <span class="comment">// rootå‘½ä»¤ï¼Œå­å‘½ä»¤éƒ½åœ¨è¿™é‡Œé¢ï¼Œé‡ç‚¹çœ‹</span></div><div class="line">    cmd := newDockerCommand(dockerCli)</div><div class="line"></div><div class="line">    <span class="comment">// å‘½ä»¤æ‰§è¡Œ	</span></div><div class="line">    <span class="keyword">if</span> err := cmd.Execute(); err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">if</span> sterr, ok := err.(cli.StatusError); ok &#123;</div><div class="line">            <span class="keyword">if</span> sterr.Status != <span class="string">""</span> &#123;</div><div class="line">                fmt.Fprintln(stderr, sterr.Status)</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// StatusError should only be used for errors, and all errors should</span></div><div class="line">            <span class="comment">// have a non-zero exit status, so never exit with 0</span></div><div class="line">            <span class="keyword">if</span> sterr.StatusCode == <span class="number">0</span> &#123;</div><div class="line">                os.Exit(<span class="number">1</span>)</div><div class="line">            &#125;</div><div class="line">            os.Exit(sterr.StatusCode)</div><div class="line">        &#125;</div><div class="line">        fmt.Fprintln(stderr, err)</div><div class="line">        os.Exit(<span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿˜æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼Œ<code>newDockerCommand</code>å‡½æ•°è°ƒç”¨äº†<code>commands.AddCommands(cmd, dockerCli)</code>æ¥æ·»åŠ å‘½ä»¤ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">newDockerCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        opts := cliflags.NewClientOptions()</div><div class="line">        <span class="keyword">var</span> flags *pflag.FlagSet</div><div class="line"></div><div class="line">        cmd := &amp;cobra.Command&#123;</div><div class="line">                Use:              <span class="string">"docker [OPTIONS] COMMAND [ARG...]"</span>,</div><div class="line">                Short:            <span class="string">"A self-sufficient runtime for containers"</span>,</div><div class="line">                SilenceUsage:     <span class="literal">true</span>,</div><div class="line">                SilenceErrors:    <span class="literal">true</span>,</div><div class="line">                TraverseChildren: <span class="literal">true</span>,</div><div class="line">                Args:             noArgs,</div><div class="line">                RunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="keyword">if</span> opts.Version &#123;</div><div class="line">                                showVersion()</div><div class="line">                                <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> command.ShowHelp(dockerCli.Err())(cmd, args)</div><div class="line">                &#125;,</div><div class="line">                PersistentPreRunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="comment">// daemon command is special, we redirect directly to another binary</span></div><div class="line">                        <span class="keyword">if</span> cmd.Name() == <span class="string">"daemon"</span> &#123;</div><div class="line">                                <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">                        &#125;</div><div class="line">                        <span class="comment">// flags must be the top-level command flags, not cmd.Flags()</span></div><div class="line">                        opts.Common.SetDefaultOptions(flags)</div><div class="line">                        dockerPreRun(opts)</div><div class="line">                        <span class="keyword">if</span> err := dockerCli.Initialize(opts); err != <span class="literal">nil</span> &#123;</div><div class="line">                                <span class="keyword">return</span> err</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> isSupported(cmd, dockerCli)</div><div class="line">                &#125;,</div><div class="line">        &#125;</div><div class="line">        cli.SetupRootCommand(cmd)</div><div class="line"></div><div class="line">        flags = cmd.Flags()</div><div class="line">        flags.BoolVarP(&amp;opts.Version, <span class="string">"version"</span>, <span class="string">"v"</span>, <span class="literal">false</span>, <span class="string">"Print version information and quit"</span>)</div><div class="line">        flags.StringVar(&amp;opts.ConfigDir, <span class="string">"config"</span>, cliconfig.Dir(), <span class="string">"Location of client config files"</span>)</div><div class="line">        opts.Common.InstallFlags(flags)</div><div class="line"></div><div class="line">        setFlagErrorFunc(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        setHelpFunc(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        cmd.SetOutput(dockerCli.Out())</div><div class="line">        cmd.AddCommand(newDaemonCommand())</div><div class="line">        # æ·»åŠ å­å‘½ä»¤ï¼Œcmdé‡Œç°åœ¨æ˜¯rootå‘½ä»¤</div><div class="line">        commands.AddCommands(cmd, dockerCli)</div><div class="line"></div><div class="line">        setValidateArgs(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> cmd</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™è¡Œä¸Šé¢çš„<code>cmd.AddCommand(newDaemonCommand())</code>æ˜¯ä¸º<code>docker daemon</code>å‘½ä»¤è¿›è¡Œçš„è¾“å‡ºï¼Œ<code>newDaemonCommand</code>å®šä¹‰åœ¨<code>cmd/docker/daemon_none.go</code>ä¸­ï¼Œä»ä»–çš„<code>RunE</code>æ–¹æ³•å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯è¾“å‡ºäº†ä¸èƒ½è¿è¡Œçš„æç¤ºï¼Œ<code>runtime.GOOS</code>æ˜¯è¾“å‡ºå½“å‰ç³»ç»Ÿçš„åç§°ï¼Œæ¯”å¦‚macæ˜¯<code>Darwin</code>ï¼Œ ubuntuæ˜¯<code>linux</code>ï¼Œå®Œæ•´çœ‹æ¥å°±æ˜¯:</p>
<pre><code>`docker daemon` is not supported on Darwin. Please run `dockerd` directly
</code></pre><p>è®©æˆ‘ä»¬æ¥åˆ°<code>commands.AddCommands</code>å®šä¹‰çš„åœ°æ–¹ï¼Œ<code>cli/command/commands/commands.go</code>æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°<code>cmd.AddCommand</code>çš„è°ƒç”¨ï¼Œè¿™é‡Œå°±æ˜¯åœ¨æ·»åŠ æˆ‘ä»¬çœ‹åˆ°çš„äºŒçº§å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ç´§è·Ÿç€<code>docker</code>åé¢çš„å‘½ä»¤ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddCommands</span><span class="params">(cmd *cobra.Command, dockerCli *command.DockerCli)</span></span> &#123;</div><div class="line">        cmd.AddCommand(</div><div class="line">                ......</div><div class="line"></div><div class="line">                <span class="comment">// container</span></div><div class="line">                container.NewContainerCommand(dockerCli),</div><div class="line">                container.NewRunCommand(dockerCli),</div><div class="line">                </div><div class="line">                ......</div><div class="line">                hide(container.NewPsCommand(dockerCli)),</div><div class="line">                hide(container.NewRenameCommand(dockerCli)),</div><div class="line">                ......</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä»ä¸Šçœ‹åˆ°ä¸‹ï¼Œæ•´é½åˆ’ä¸€ä¸­å‘ç°æœ€åå¥½å¤šå‘½ä»¤è¢«ç”¨hideåŒ…è£¹äº†ã€‚è¿™äº›å‘½ä»¤æ˜¯ä¸€äº›æ—§å‘½ä»¤ï¼Œåœ¨æ–°çš„ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨æ–°çš„å‘½ä»¤æ¥ä»£æ›¿ï¼Œå¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡<code>DOCKER_HIDE_LEGACY_COMMANDS</code>ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆdockerçš„æç¤ºå°†ä¸ä¼šè¾“å‡ºè¿™äº›ã€‚</p>
<p>è¿™é‡Œçš„å‘½ä»¤å¤ªå¤šäº†ï¼Œæˆ‘ä»¬é€šè¿‡<code>docker ps</code>å‘½ä»¤æ¥äº†è§£ä¸€ä¸‹å¤§è‡´çš„æ‰§è¡Œæµç¨‹ã€‚</p>
<p><code>docker ps</code>å‘½ä»¤ä¹Ÿæ˜¯æ—§ç‰ˆçš„å‘½ä»¤ï¼Œ<code>hide(container.NewPsCommand(dockerCli))</code>å°±æ˜¯åœ¨å¤„ç†ä»–ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­å¯¹åº”çš„æ˜¯<code>docker container ls</code>å‘½ä»¤ã€‚å®ç°ä»£ç åœ¨<code>cli/command/container/list.go</code>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// NewPsCommand creates a new cobra.Command for `docker ps`</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPsCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        options := psOptions&#123;filter: opts.NewFilterOpt()&#125;</div><div class="line"></div><div class="line">        cmd := &amp;cobra.Command&#123;</div><div class="line">                Use:   <span class="string">"ps [OPTIONS]"</span>,</div><div class="line">                Short: <span class="string">"List containers"</span>,</div><div class="line">                Args:  cli.NoArgs,</div><div class="line">                RunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="keyword">return</span> runPs(dockerCli, &amp;options)</div><div class="line">                &#125;,</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        flags := cmd.Flags()</div><div class="line"></div><div class="line">        flags.BoolVarP(&amp;options.quiet, <span class="string">"quiet"</span>, <span class="string">"q"</span>, <span class="literal">false</span>, <span class="string">"Only display numeric IDs"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.size, <span class="string">"size"</span>, <span class="string">"s"</span>, <span class="literal">false</span>, <span class="string">"Display total file sizes"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.all, <span class="string">"all"</span>, <span class="string">"a"</span>, <span class="literal">false</span>, <span class="string">"Show all containers (default shows just running)"</span>)</div><div class="line">        flags.BoolVar(&amp;options.noTrunc, <span class="string">"no-trunc"</span>, <span class="literal">false</span>, <span class="string">"Don't truncate output"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.nLatest, <span class="string">"latest"</span>, <span class="string">"l"</span>, <span class="literal">false</span>, <span class="string">"Show the latest created container (includes all states)"</span>)</div><div class="line">        flags.IntVarP(&amp;options.last, <span class="string">"last"</span>, <span class="string">"n"</span>, <span class="number">-1</span>, <span class="string">"Show n last created containers (includes all states)"</span>)</div><div class="line">        flags.StringVarP(&amp;options.format, <span class="string">"format"</span>, <span class="string">""</span>, <span class="string">""</span>, <span class="string">"Pretty-print containers using a Go template"</span>)</div><div class="line">        flags.VarP(&amp;options.filter, <span class="string">"filter"</span>, <span class="string">"f"</span>, <span class="string">"Filter output based on conditions provided"</span>)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> cmd</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">newListCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        cmd := *NewPsCommand(dockerCli)</div><div class="line">        cmd.Aliases = []<span class="keyword">string</span>&#123;<span class="string">"ps"</span>, <span class="string">"list"</span>&#125;</div><div class="line">        cmd.Use = <span class="string">"ls [OPTIONS]"</span></div><div class="line">        <span class="keyword">return</span> &amp;cmd</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>NewPsCommand</code>å¯¹åº”çš„æ˜¯<code>docker ps</code>, <code>newListCommand</code>å¯¹åº”çš„æ˜¯<code>docker container ls</code>ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œ <code>newListCommand</code>é‡Œçš„commandå°±æ˜¯<code>NewPsCommand</code>è¿”å›çš„ï¼Œåªæ˜¯åŠ äº†ä¸€ä¸‹è¯´æ˜è€Œå·²ã€‚</p>
<blockquote>
<p>è¿™é‡Œè¿˜æ¼äº†ä¸€ç‚¹ï¼Œdocker container lsæ˜¯3ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬çŸ¥é“dockeræ˜¯rootå‘½ä»¤ï¼ŒæŒ‰ç…§cobraçš„å†™æ³•ï¼Œcontainerå’Œlsåº”è¯¥æ˜¯åˆ†å¼€çš„ã€‚ä»–ä»¬çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼Œåœ¨<code>cli/command/commands/commands.go</code>æ–‡ä»¶ä¸­<code>container.NewContainerCommand(dockerCli)</code>åŠ å…¥äº†<code>container</code>å‘½ä»¤ï¼Œ<code>NewContainerCommand</code>çš„å®ç°åœ¨<code>cli/command/container/cmd.go</code>ä¸­ï¼Œåœ¨<code>NewContainerCommand</code>å‡½æ•°ä¸­é€šè¿‡<code>newListCommand(dockerCli)</code>åŠ å…¥äº†lså‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¿˜æ·»åŠ äº†å¾ˆå¤šåˆ«çš„æ–¹æ³•ï¼Œé‚£äº›éƒ½æ˜¯<code>container</code>æ”¯æŒçš„å­å‘½ä»¤ã€‚è¿™æ ·å°±å›åˆ°äº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å†…å®¹äº†ï¼Œæ²¡æœ‰é­”æ³•</p>
</blockquote>
<p>æˆ‘ä»¬ç»§ç»­çœ‹<code>NewPsCommand</code>:</p>
<p>é‡Œé¢å®šä¹‰äº†<code>docker ps</code>ï¼ˆä¸‹é¢æ‰€æœ‰çš„å†…å®¹å¯¹<code>docker container ls</code>éƒ½é€‚ç”¨ï¼‰æ”¯æŒçš„ä¸€äº›é€‰é¡¹ï¼ˆflagï¼‰,é€‰é¡¹è¢«æ”¾åœ¨äº†psOptionsè¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œæœ€ç»ˆä¼ ç»™runPså‡½æ•°.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">runPs</span><span class="params">(dockerCli *command.DockerCli, options *psOptions)</span> <span class="title">error</span></span> &#123;</div><div class="line">        ctx := context.Background()</div><div class="line"></div><div class="line">        listOptions, err := buildContainerListOptions(options)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        containers, err := dockerCli.Client().ContainerList(ctx, *listOptions)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        format := options.format</div><div class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(format) == <span class="number">0</span> &#123;</div><div class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(dockerCli.ConfigFile().PsFormat) &gt; <span class="number">0</span> &amp;&amp; !options.quiet &#123;</div><div class="line">                        format = dockerCli.ConfigFile().PsFormat</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        format = formatter.TableFormatKey</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        containerCtx := formatter.Context&#123;</div><div class="line">                Output: dockerCli.Out(),</div><div class="line">                Format: formatter.NewContainerFormat(format, options.quiet, listOptions.Size),</div><div class="line">                Trunc:  !options.noTrunc,</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> formatter.ContainerWrite(containerCtx, containers)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>listOptions, err := buildContainerListOptions(options)</code>å¯¹é€‰é¡¹è¿›è¡Œäº†å¤„ç†ï¼Œé‡ç‚¹åœ¨<code>dockerCli.Client().ContainerList(ctx, *listOptions)</code>ï¼Œ<code>ContainerList</code>æ˜¯ä¸€ä¸ªinterfaceã€‚</p>
<p>å®ç°åœ¨<code>vendor/github.com/docker/docker/client/container_list.go</code>ï¼ˆvendoråœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæˆ‘æ˜¯goæ–°æ‰‹ï¼Œæ‰€ä»¥æ‹…å¿ƒå¤§å®¶ä¸çŸ¥é“ï¼Œé«˜æ‰‹å¿½ç•¥ï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cli *Client)</span> <span class="title">ContainerList</span><span class="params">(ctx context.Context, options types.ContainerListOptions)</span> <span class="params">([]types.Container, error)</span></span> &#123;</div><div class="line">        query := url.Values&#123;&#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.All &#123;</div><div class="line">                query.Set(<span class="string">"all"</span>, <span class="string">"1"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Limit != <span class="number">-1</span> &#123;</div><div class="line">                query.Set(<span class="string">"limit"</span>, strconv.Itoa(options.Limit))</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Since != <span class="string">""</span> &#123;</div><div class="line">                query.Set(<span class="string">"since"</span>, options.Since)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Before != <span class="string">""</span> &#123;</div><div class="line">                query.Set(<span class="string">"before"</span>, options.Before)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Size &#123;</div><div class="line">                query.Set(<span class="string">"size"</span>, <span class="string">"1"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Filters.Len() &gt; <span class="number">0</span> &#123;</div><div class="line">                filterJSON, err := filters.ToParamWithVersion(cli.version, options.Filters)</div><div class="line"></div><div class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                        <span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                query.Set(<span class="string">"filters"</span>, filterJSON)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        resp, err := cli.get(ctx, <span class="string">"/containers/json"</span>, query, <span class="literal">nil</span>)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> containers []types.Container</div><div class="line">        err = json.NewDecoder(resp.body).Decode(&amp;containers)</div><div class="line">        ensureReaderClosed(resp)</div><div class="line">        <span class="keyword">return</span> containers, err</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å‰é¢æ˜¯åœ¨æ‹¼è¯·æ±‚çš„å‚æ•°ï¼Œ<code>resp, err := cli.get(ctx, &quot;/containers/json&quot;, query, nil)</code>è¿™é‡Œå‘èµ·äº†è¯·æ±‚ï¼Œè¿”å›äº†containerçš„åˆ—è¡¨ã€‚å›åˆ°<code>cli/command/container/list.go</code>ï¼Œæ¥æ”¶åˆ°è¿”å›å€¼ä¹‹åï¼Œè¿™æ—¶å€™è¿˜æ˜¯jsonï¼Œä¸‹é¢è¿›è¡Œäº†æ ¼å¼åŒ–è¾“å‡ºï¼Œå¤§å®¶åº”è¯¥éƒ½åšè¿‡æ‰“å°<code>9*9ä¹˜æ³•è¡¨</code>çš„ç»å†ï¼Œè¿™é‡Œçš„æ ¼å¼åŒ–æ˜¯åŒæ ·çš„é“ç†ï¼Œä¸æ˜ç™½çš„åŒå­¦å¯ä»¥ç»§ç»­å¾€æŒ–ï¼Œæˆ‘å·ä¸ªæ‡’ï¼Œå°±ä¸ç»§ç»­äº†ã€‚</p>
<p>è‡³æ­¤<code>docker ps</code>çš„æµç¨‹å°±èµ°å®Œäº†ï¼Œå¤§å®¶å¯ä»¥å¯¹æºç åšä¸€äº›ä¿®æ”¹ï¼Œç„¶åè¿›åˆ°å®¹å™¨ä¸­æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make binary</div></pre></td></tr></table></figure>
<p>å°±å¯ä»¥ç”Ÿäº§æ–°çš„docker clientï¼Œæ‰§è¡Œä¸€ä¸‹å°±èƒ½å¾—åˆ°æƒ³è¦çš„è¾“å‡ºå•¦ã€‚</p>
<p>è°¢è°¢å¤§å®¶ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£ğŸ™‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/07/Moby-LinuxKit-åˆä½“éªŒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/07/Moby-LinuxKit-åˆä½“éªŒ/" itemprop="url">Moby & LinuxKit åˆä½“éªŒ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-07T21:14:16+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Dockerçš„å¼€æºéƒ¨åˆ†è¢«æ”¹åæˆäº†<a href="https://github.com/moby/moby" target="_blank" rel="external">Moby</a>ï¼ŒåŒæ—¶Dockerå…¬å¸è¿˜å¼€æºäº†ä¸€ä¸ª<a href="https://github.com/linuxkit/linuxkit" target="_blank" rel="external">LinuxKit</a>çš„é¡¹ç›®ï¼Œå¤§å®¶å¯ä»¥å…ˆå»çœ‹ä¸€ä¸‹readmeã€‚</p>
<p>Mobyæ˜¯ä¸€ä¸ªç»„è£…å®¹å™¨ç³»ç»Ÿçš„æ¡†æ¶ã€‚å®ƒåŒ…å«ä¸€ä¸ªå®¹å™¨åŒ–ç»„ä»¶åº“å’Œä¸€ä¸ªå°†è¿™äº›ç»„ä»¶ç»„è£…æˆç‹¬ç«‹çš„å®¹å™¨ç³»ç»Ÿçš„æ¡†æ¶ã€‚ç›®å‰ï¼ŒDockeræ­£åœ¨è¢«æ‹†åˆ†æˆæ¨¡å—åŒ–çš„ç»„ä»¶ï¼Œå°†æ¥ï¼ŒDockerä¼šä»è¿™äº›è¢«Mobyæ‰“åŒ…çš„ç»„ä»¶ä¸­è¢«ç»„è£…å‡ºæ¥ã€‚</p>
<p>LinuxKitæ˜¯ä¸€ä¸ªç”¨æ¥æ„é€ æœ€å°Linuxå‘è¡Œç‰ˆçš„å·¥å…·é›†ã€‚å®ƒé€šè¿‡Mobyæ¥åˆ›å»ºé•œåƒï¼ˆimageï¼‰ï¼Œä½¿ç”¨LinuxKitå·¥å…·æ¥è¿è¡Œè¿™äº›é•œåƒã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥ä½“éªŒä¸€ä¸‹ï¼Œé¦–å…ˆç¡®ä¿ä½ å·²ç»å®‰è£…äº†<a href="https://docs.Docker.com/engine/installation/linux/docker-ce/ubuntu/#recommended-extra-packages-for-trusty-1404" target="_blank" rel="external">Docker</a>å’Œ<a href="https://golang.org/doc/install" target="_blank" rel="external">Golang</a>ã€‚</p>
<h3 id="æ„å»ºMoby"><a href="#æ„å»ºMoby" class="headerlink" title="æ„å»ºMoby"></a>æ„å»ºMoby</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">âœ  git clone https://github.com/linuxkit/linuxkit.git</div><div class="line">âœ  cd linuxkit</div><div class="line">âœ  make &amp;&amp; sudo make install</div><div class="line">âœ  moby version</div><div class="line">moby version 0.0</div><div class="line">commit: 1ff0e3beeeb1e741b9c5a54574f01ac5eee525a5</div></pre></td></tr></table></figure>
<h3 id="æ„å»ºlinuxé•œåƒ"><a href="#æ„å»ºlinuxé•œåƒ" class="headerlink" title="æ„å»ºlinuxé•œåƒ"></a>æ„å»ºlinuxé•œåƒ</h3><p>æ„å»ºé•œåƒæ˜¯é€šè¿‡yamlæ–‡ä»¶ï¼ˆæ ¼å¼å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://github.com/moby/tool/blob/master/docs/yaml.md" target="_blank" rel="external">LinuxKit YAML</a>ï¼‰ï¼Œlinuxkitç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>linuxkit.yml</code>å¯ä»¥ç”¨ï¼Œexamplesç›®å½•ä¸‹ä¹Ÿæœ‰å¾ˆå¤šå¯ç”¨çš„yamlæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»»é€‰ä¸€ä¸ªæ¥æ„å»ºï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨<code>linuxkit.yml</code>æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) moby build linuxkit.yml</div><div class="line">æœ€ååœ¨å½“å‰ç›®å½•ä¸‹è¾“å‡ºäº†3ä¸ªæ–‡ä»¶</div><div class="line">Create outputs:</div><div class="line">  linuxkit-kernel linuxkit-initrd.img linuxkit-cmdline</div></pre></td></tr></table></figure>
<h3 id="è¿è¡ŒLinuxKité•œåƒ"><a href="#è¿è¡ŒLinuxKité•œåƒ" class="headerlink" title="è¿è¡ŒLinuxKité•œåƒ"></a>è¿è¡ŒLinuxKité•œåƒ</h3><p>è¿è¡Œé€šè¿‡linuxkitè‡ªå¸¦çš„linuxkitå‘½ä»¤ï¼Œå‘½ä»¤åœ¨linuxkit/binç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯ä½“éªŒï¼Œä¹Ÿæ²¡å¿…è¦å†™PATHï¼Œå°±ç›´æ¥å†™å…¨è·¯å¾„å§ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) bin/linuxkit run linuxkit</div><div class="line">...æ»¡å±æ»¡å±çš„è¾“å‡ºï¼Œæœ€åæ˜¯ç†Ÿæ‚‰çš„ğŸ³</div><div class="line">Welcome to LinuxKit</div><div class="line"></div><div class="line">                        ##         .</div><div class="line">                  ## ## ##        ==</div><div class="line">               ## ## ## ## ##    ===</div><div class="line">           /"""""""""""""""""\___/ ===</div><div class="line">          &#123;                       /  ===-</div><div class="line">           \______ O           __/</div><div class="line">             \    \         __/</div><div class="line">              \____\_______/</div><div class="line">...</div></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å°±æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±æ„å»ºçš„linuxæœ€å°å‘è¡Œç‰ˆé‡Œé¢äº†ï¼Œæ•²å‡ ä¸ªå‘½ä»¤è¯•è¯•å§ï¼Œé€€å‡ºæ˜¯<code>halt</code>ã€‚</p>
<p>è¿™ä¸ªé•œåƒåªæœ‰54Mï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å°äº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) ls -alh | grep linuxkit</div><div class="line">-rw-r--r--  1 vagrant vagrant   42 Sep  7 11:52 linuxkit-cmdline</div><div class="line">-rw-r--r--  1 vagrant vagrant  54M Sep  7 11:52 linuxkit-initrd.img</div><div class="line">-rw-r--r--  1 vagrant vagrant 6.3M Sep  7 11:52 linuxkit-kernel</div><div class="line">drwxr-xr-x  2 vagrant vagrant 4.0K Sep  7 12:11 linuxkit-state</div><div class="line">-rw-rw-r--  1 vagrant vagrant 1.7K Sep  7 10:33 linuxkit.yml</div></pre></td></tr></table></figure>
<p>Mobyå’ŒLinuxKitæ˜¯éå¸¸ä¸é”™çš„å·¥å…·ï¼Œä½†ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬æ˜¯ç”¨ä¸ä¸Šçš„ã€‚å¦‚æœä½ éœ€è¦æ„å»ºå®šåˆ¶çš„linuxå‘è¡Œç‰ˆï¼Œé‚£ä»–ä»¬å¯ä»¥èŠ‚çº¦å¾ˆå¤šæ—¶é—´ã€‚ä½†å¦‚æœä½ åªæ˜¯æƒ³å°†åº”ç”¨æ”¾åœ¨å®¹å™¨é‡Œè·‘èµ·æ¥ï¼Œé‚£è¿˜æ˜¯ç›´æ¥ç”¨Dockerå§ï¼</p>
<p>å¦å¤–ï¼ŒMobyå’ŒLinuxKitåº”è¯¥è¿˜æ²¡æœ‰æˆç†Ÿï¼Œå‘½ä»¤ä¸€å¤©ä¸€ä¸ªå˜åŒ–ï¼ˆå¤¸å¼ äº†ï¼‰ï¼Œå¦‚æœä½ å‘ç°ä¸Šé¢çš„å‘½ä»¤å¤±æ•ˆäº†ï¼Œå»ºè®®googleä¸€ä¸‹ï¼Œæˆ–è€…è”ç³»æˆ‘ï¼ˆçŸ¥ä¹ or whaterverï¼‰</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/07/æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤dockerç³»åˆ—æ–‡ç« ç›®å½•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/07/æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤dockerç³»åˆ—æ–‡ç« ç›®å½•/" itemprop="url">æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤Dockerç³»åˆ—æ–‡ç« ç›®å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-07T17:24:33+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.sel.zju.edu.cn/?p=112" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸€ï¼‰ï¼šDOCKERæ¶æ„</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=147" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆäºŒï¼‰ï¼šDOCKER CLIENTåˆ›å»ºä¸å‘½ä»¤æ‰§è¡Œ</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=158" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸‰ï¼‰ï¼šDOCKER DAEMONå¯åŠ¨</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=165" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå››ï¼‰ï¼šDOCKER DAEMONä¹‹NEWDAEMONå®ç°</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=259" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆäº”ï¼‰ï¼šDOCKER SERVERçš„åˆ›å»º</a>-2014.12.09</p>
<p><a href="http://www.sel.zju.edu.cn/?p=399" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå…­ï¼‰ï¼šDOCKER DAEMONç½‘ç»œ</a>-2015.01.05</p>
<p><a href="http://www.sel.zju.edu.cn/?p=508" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸ƒï¼‰ï¼šDOCKER CONTAINERç½‘ç»œ ï¼ˆä¸Šï¼‰</a>-2015.01.26</p>
<p><a href="http://www.sel.zju.edu.cn/?p=537" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå…«ï¼‰ï¼šDOCKER CONTAINERç½‘ç»œï¼ˆä¸‹ï¼‰</a>-2015.03.12</p>
<p><a href="http://www.sel.zju.edu.cn/?p=549" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¹ï¼‰ï¼šDOCKERé•œåƒ</a>-2015.03.12</p>
<p><a href="http://www.sel.zju.edu.cn/?p=444" target="_blank" rel="external">DOCKERç½‘ç»œè¯¦è§£åŠPIPEWORKæºç è§£è¯»ä¸å®è·µ</a>-2015.01.16</p>
<p><a href="http://www.sel.zju.edu.cn/?p=556" target="_blank" rel="external">DOCKERèƒŒåçš„å†…æ ¸çŸ¥è¯†â€”â€”NAMESPACEèµ„æºéš”ç¦»</a>-2015.03.13</p>
<p><a href="http://www.sel.zju.edu.cn/?p=573" target="_blank" rel="external">DOCKERèƒŒåçš„å†…æ ¸çŸ¥è¯†â€”â€”CGROUPSèµ„æºé™åˆ¶</a>-2015.04.22</p>
<p><a href="http://www.sel.zju.edu.cn/?p=577" target="_blank" rel="external">DOCKERèƒŒåçš„å®¹å™¨ç®¡ç†â€”â€”LIBCONTAINERæ·±åº¦è§£æ</a>-2015.06.03</p>
<p><a href="http://www.sel.zju.edu.cn/?p=296" target="_blank" rel="external">ç©è½¬DOCKERé•œåƒ</a>-2014.12.16</p>
<p><a href="http://www.sel.zju.edu.cn/?p=467" target="_blank" rel="external">æ·±å…¥ç†è§£ETCDæŠ€æœ¯åˆ†äº«PPT</a>-2015.01.20</p>
<p><a href="http://www.sel.zju.edu.cn/?p=523" target="_blank" rel="external">ETCDï¼šä»åº”ç”¨åœºæ™¯åˆ°å®ç°åŸç†çš„å…¨æ–¹ä½è§£è¯»</a>-2015.02.01</p>
<p><a href="http://www.sel.zju.edu.cn/?p=283" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹å®‰å…¨ç¯‡</a>-2014.12.11</p>
<p><a href="http://www.sel.zju.edu.cn/?p=331" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹PODç¯‡</a>-2014.12.19</p>
<p><a href="http://www.sel.zju.edu.cn/?p=360" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹æœåŠ¡ç¯‡</a>-2014.12.23</p>
<p><a href="http://www.sel.zju.edu.cn/?p=353" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹ç½‘ç»œç¯‡</a>-2014.12.29</p>
<p><a href="http://www.sel.zju.edu.cn/?p=394" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹VOLUMES</a>-2015.01.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=417" target="_blank" rel="external">KUBERNETES MINION NODE ç»„ä»¶ ä¹‹ KUBELET</a>-2015.01.13</p>
<p><a href="http://www.sel.zju.edu.cn/?p=484" target="_blank" rel="external">KUBERNETESä»£ç èµ°è¯»ä¹‹MINION NODE ç»„ä»¶ KUBE-PROXY</a>-2015.01.22</p>
<p><a href="http://www.sel.zju.edu.cn/?p=588" target="_blank" rel="external">4S: SERVICES ACCOUNT, SECRET, SECURITY CONTEXT AND SECURITY IN KUBERNETES</a>-2015.07.30</p>
<p><a href="http://www.sel.zju.edu.cn/?p=595" target="_blank" rel="external">KUBERNETES NODE COMPONENTS â€“ KUBELET</a>-2015.08.07</p>
<p><a href="http://www.sel.zju.edu.cn/?p=609" target="_blank" rel="external">KUBERNETES APISERVERæºç åˆ†æâ€”â€”APIè¯·æ±‚çš„è®¤è¯è¿‡ç¨‹</a>-2015.08.09</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/02/pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/02/pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²/" itemprop="url">pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-02T22:35:33+08:00">
                2017-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>èƒŒæ™¯ï¼šæˆ‘å¸ä»£ç éƒ½æ˜¯åŸºäºpython2</p>
<p>ä»Šå¤©æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œç”¨æˆ·æäº¤çš„è¯„è®ºå­—æ•°å¦‚æœå¤§äº20ä¸ªå­—è¦ç»™ç”¨æˆ·å‘çº¢åŒ…ã€‚æ¯«ä¸è¿Ÿç–‘ï¼Œæˆ‘å†™ä¸‹äº†ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> len(content) &gt; <span class="number">20</span>:</div><div class="line">	<span class="comment"># å‘çº¢åŒ…</span></div></pre></td></tr></table></figure>
<p>æˆ‘è½¬å¿µä¸€æƒ³ï¼Œäº‹æƒ…ä¸å¤§å¯¹ï¼Œæˆ‘è¿™ç®—çš„æ˜¯å­—ç¬¦æ•°ï¼ˆè¿™ä¸ªè¡¨è¿°æ˜¯æ­£ç¡®çš„ï¼Œæ˜¯å­—ç¬¦ï¼‰å•Š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"abcd"</span>)  <span class="comment"># ç­‰äº4</span></div><div class="line">len(<span class="string">"I love python"</span>)  <span class="comment"># ç­‰äº13</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­æ˜¾è€Œæ˜“è§ï¼Œå°å­¦ç”Ÿæ°´å¹³ï¼Œå†çœ‹ä¸‹é¢çš„</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># è¿™ä¸ªè¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</span></div><div class="line">len(<span class="string">u"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># è¿™ä¸ªåˆè¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</span></div></pre></td></tr></table></figure>
<p>å¤§å®¶å¯ä»¥æœ¬åœ°æ‰“å¼€pythonè¯•ä¸€ä¸‹ï¼Œç»“æœæ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># ç­‰äº21</span></div><div class="line">len(<span class="string">u"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># ç­‰äº7</span></div></pre></td></tr></table></figure>
<p>å…¶å®æˆ‘æƒ³è¦çš„æ˜¯ä¸‹é¢è¿™ä¸ªï¼Œä½†æ˜¯æˆ‘åœ¨ä»£ç é‡Œç›´æ¥é‚£ä¹ˆå†™ï¼Œæˆ‘æ“ä½œçš„å­—ç¬¦ä¸²å‰é¢åˆ°åº•æœ‰æ²¡æœ‰<code>u</code>å‘¢ï¼Œè¿™ä¸ª<code>u</code>æˆ‘çŸ¥é“æ˜¯<code>unicode</code>å­—ç¬¦ä¸²ï¼Œå®ƒå’Œæ²¡æœ‰<code>u</code>çš„å­—ç¬¦ä¸²åˆ°åº•åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ</p>
<p>å‡ å¹´å‰æˆ‘æ›¾ç»ä¸‹å†³å¿ƒå¼„æ‡‚è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½å½“æ—¶ä¹Ÿç¡®å®æ˜ç™½äº†ï¼Œä½†æ˜¯ç°åœ¨å·®ä¸å¤šå·²ç»å…¨å¿˜äº†ã€‚æˆ‘è‡ªå·±æ€»ç»“äº†ä¸€ä¸‹ï¼Œä¸€æ˜¯ä¹‹å‰ä¸€ç›´æ˜¯ç”¨python3ï¼Œpython3åšäº†ä¸€äº›ä¿®æ”¹ã€‚äºŒæ˜¯è¿™ä¸ªé—®é¢˜ç¡®å®ä¸åº”è¯¥äº¤ç»™ç¨‹åºå‘˜æ¥è§£å†³ï¼ˆæˆ‘æ‰¿è®¤æˆ‘çš„è®°æ€§ç¡®å®ä¸å¥½ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œæ—§çš„ç³»ç»Ÿé‚£ä¹ˆå¤šï¼Œéš¾ä¿ä½ ä¸‹æ¬¡è·³æ§½çš„å…¬å¸æ²¡æœ‰ä¸€äº›ä¸Šäº†å¹´çºªçš„ä»£ç ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥æ¢³ç†ä¸€ä¸‹å§ã€‚</p>
<h2 id="å­—ç¬¦ä¸å­—èŠ‚"><a href="#å­—ç¬¦ä¸å­—èŠ‚" class="headerlink" title="å­—ç¬¦ä¸å­—èŠ‚"></a>å­—ç¬¦ä¸å­—èŠ‚</h2><p>ä¸€ä¸ªå­—ç¬¦ä¸ç­‰ä»·äºä¸€ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦æ˜¯äººç±»èƒ½å¤Ÿè¯†åˆ«çš„ç¬¦å·ï¼Œè€Œè¿™äº›ç¬¦å·è¦ä¿å­˜åˆ°è®¡ç®—æœºçš„å­˜å‚¨ä¸­å°±éœ€è¦ç”¨è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å­—èŠ‚æ¥è¡¨ç¤ºã€‚ä¸€ä¸ªå­—ç¬¦å¾€å¾€æœ‰å¤šç§è¡¨ç¤ºæ–¹æ³•ï¼Œä¸åŒçš„è¡¨ç¤ºæ–¹æ³•ä¼šä½¿ç”¨ä¸åŒçš„å­—èŠ‚æ•°ã€‚è¿™é‡Œæ‰€è¯´çš„ä¸åŒçš„è¡¨ç¤ºæ–¹æ³•å°±æ˜¯æŒ‡<code>å­—ç¬¦ç¼–ç </code>ï¼Œæ¯”å¦‚å­—æ¯A-Zéƒ½å¯ä»¥ç”¨<code>ASCII</code>ç è¡¨ç¤ºï¼ˆå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨<code>UNICODE</code>è¡¨ç¤ºï¼ˆå ä¸¤ä¸ªå­—èŠ‚ï¼‰ï¼Œè¿˜å¯ä»¥ç”¨<code>UTF-8</code>è¡¨ç¤ºï¼ˆå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼‰ã€‚å­—ç¬¦ç¼–ç çš„ä½œç”¨å°±æ˜¯å°†äººç±»å¯è¯†åˆ«çš„å­—ç¬¦è½¬æ¢ä¸ºæœºå™¨å¯è¯†åˆ«çš„å­—èŠ‚ç ï¼Œä»¥åŠåå‘è¿‡ç¨‹ã€‚</p>
<p><strong>UNICDOEæ‰æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²ï¼Œè€Œç”¨ASCIIã€UTF-8ã€GBKç­‰å­—ç¬¦ç¼–ç è¡¨ç¤ºçš„æ˜¯å­—èŠ‚ä¸²</strong>ã€‚å…³äºè¿™ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Pythonçš„å®˜æ–¹æ–‡æ¡£ä¸­ç»å¸¸å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æè¿°<strong>â€œUnicode stringâ€</strong> , <strong>â€œtranslating a Unicode string into a sequence of bytesâ€</strong>ã€‚ï¼ˆæ³¨æ„ï¼šè‹±æ–‡ä¸­stringæ˜¯æˆ‘ä»¬è¯´çš„å­—ç¬¦ä¸²ï¼Œbytesæ˜¯å­—èŠ‚ä¸²ï¼‰</p>
<p>æˆ‘ä»¬å†™<code>ä»£ç </code>æ˜¯å†™åœ¨<code>æ–‡ä»¶</code>ä¸­çš„ï¼Œè€Œ<code>å­—ç¬¦</code>æ˜¯ä»¥<code>å­—èŠ‚</code>å½¢å¼ä¿å­˜åœ¨<code>æ–‡ä»¶</code>ä¸­çš„ï¼Œå› æ­¤å½“æˆ‘ä»¬åœ¨æ–‡ä»¶ä¸­å®šä¹‰ä¸ª<code>å­—ç¬¦ä¸²</code>æ—¶è¢«å½“åš<code>å­—èŠ‚ä¸²</code>ä¹Ÿæ˜¯å¯ä»¥ç†è§£çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œè€Œä¸æ˜¯<code>å­—èŠ‚ä¸²</code>ï¼ˆæˆ‘ä»¬å†™ä»£ç å¤„ç†çš„æ˜¯æˆ‘ä»¬èƒ½æƒ³è±¡çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ï¼Œåº”è¯¥ä¸ä¼šæœ‰äººæƒ³è±¡å­—èŠ‚ä¸²å§ï¼‰ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€ï¼Œåº”è¯¥ä¸¥æ ¼åŒºåˆ†ä¸¤è€…çš„å…³ç³»å¹¶æä¾›å·§å¦™çš„å®Œç¾çš„æ”¯æŒã€‚JAVAè¯­è¨€å°±å¾ˆå¥½ï¼Œæˆ‘è®¤è¯†çš„JAVAç¨‹åºå‘˜ä»æ¥æ²¡æœ‰è€ƒè™‘è¿‡è¿™äº›ä¸åº”è¯¥ç”±ç¨‹åºå‘˜æ¥å¤„ç†çš„é—®é¢˜ï¼ˆæˆ‘ä¸€ç›´è¿™ä¹ˆè®¤ä¸ºï¼‰ã€‚é—æ†¾çš„æ˜¯ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€è¯•å›¾æ··æ·†<code>â€œå­—ç¬¦ä¸²â€</code>å’Œ<code>â€œå­—èŠ‚ä¸²â€</code>ï¼Œä»–ä»¬<em>æŠŠå­—èŠ‚ä¸²å½“åšå­—ç¬¦ä¸²æ¥ä½¿ç”¨</em>ï¼ŒPHPå’ŒPython2éƒ½å±äºè¿™ç§ç¼–ç¨‹è¯­è¨€ã€‚æœ€èƒ½è¯´æ˜è¿™ä¸ªé—®é¢˜çš„æ“ä½œå°±æ˜¯å–ä¸€ä¸ªåŒ…å«ä¸­æ–‡å­—ç¬¦çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼š</p>
<ul>
<li>å¯¹<code>å­—ç¬¦ä¸²</code>å–é•¿åº¦ï¼Œç»“æœåº”è¯¥æ˜¯æ‰€æœ‰<code>å­—ç¬¦</code>çš„ä¸ªæ•°ï¼Œæ— è®ºä¸­æ–‡è¿˜æ˜¯è‹±æ–‡</li>
<li>å¯¹<code>å­—ç¬¦ä¸²</code>å¯¹åº”çš„<code>å­—èŠ‚ä¸²</code>å–é•¿åº¦ï¼Œå°±è·Ÿç¼–ç (encode)è¿‡ç¨‹ä½¿ç”¨çš„<code>å­—ç¬¦ç¼–ç </code>æœ‰å…³äº†(æ¯”å¦‚ï¼š<code>UTF-8ç¼–ç </code>ï¼Œä¸€ä¸ª<code>ä¸­æ–‡å­—ç¬¦</code>éœ€è¦ç”¨<code>3ä¸ªå­—èŠ‚</code>æ¥è¡¨ç¤ºï¼›<code>GBKç¼–ç </code>ï¼Œä¸€ä¸ª<code>ä¸­æ–‡å­—ç¬¦</code>éœ€è¦<code>2ä¸ªå­—èŠ‚</code>æ¥è¡¨ç¤º)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">7</span>]: a = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">9</span>]: <span class="keyword">print</span> len(a), type(a)</div><div class="line"><span class="number">2</span> &lt;type <span class="string">'unicode'</span>&gt;</div><div class="line"></div><div class="line">In [<span class="number">10</span>]: b = a.encode(<span class="string">'utf-8'</span>)</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: <span class="keyword">print</span> len(b), type(b)</div><div class="line"><span class="number">6</span> &lt;type <span class="string">'str'</span>&gt;</div><div class="line"></div><div class="line">In [<span class="number">12</span>]: c = a.encode(<span class="string">'gbk'</span>)</div><div class="line"></div><div class="line">In [<span class="number">13</span>]: <span class="keyword">print</span> len(c), type(c)</div><div class="line"><span class="number">4</span> &lt;type <span class="string">'str'</span>&gt;</div></pre></td></tr></table></figure>
<h2 id="ç¼–ç ä¸è§£ç "><a href="#ç¼–ç ä¸è§£ç " class="headerlink" title="ç¼–ç ä¸è§£ç "></a>ç¼–ç ä¸è§£ç </h2><p>UNICODEå­—ç¬¦ç¼–ç ï¼Œä¹Ÿæ˜¯ä¸€å¼ å­—ç¬¦ä¸æ•°å­—çš„æ˜ å°„ï¼Œä½†æ˜¯è¿™é‡Œçš„æ•°å­—è¢«ç§°ä¸ºä»£ç ç‚¹(code point), å®é™…ä¸Šå°±æ˜¯åå…­è¿›åˆ¶çš„æ•°å­—ã€‚</p>
<p><a href="https://docs.python.org/2/howto/unicode.html#encodings" target="_blank" rel="external">Pythonå®˜æ–¹æ–‡æ¡£</a>ä¸­å¯¹Unicodeå­—ç¬¦ä¸²ã€å­—èŠ‚ä¸²ä¸ç¼–ç ä¹‹é—´çš„å…³ç³»æœ‰è¿™æ ·ä¸€æ®µæè¿°ï¼š</p>
<pre><code>a Unicode string is a sequence of code points, which are numbers from 0 to 0x10ffff.
This sequence needs to be represented as a set of bytes (meaning, values from 0â€“255) in memory.
The rules for translating a Unicode string into a sequence of bytes are called an encoding.

Unicodeå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªä»£ç ç‚¹ï¼ˆcode pointï¼‰åºåˆ—ï¼Œä»£ç ç‚¹å–å€¼èŒƒå›´ä¸º0åˆ°0x10FFFFï¼ˆå¯¹åº”çš„åè¿›åˆ¶ä¸º1114111ï¼‰ã€‚
è¿™ä¸ªä»£ç ç‚¹åºåˆ—åœ¨å­˜å‚¨ï¼ˆåŒ…æ‹¬å†…å­˜å’Œç‰©ç†ç£ç›˜ï¼‰ä¸­éœ€è¦è¢«è¡¨ç¤ºä¸ºä¸€ç»„å­—èŠ‚(0åˆ°255ä¹‹é—´çš„å€¼)ï¼Œ
è€Œå°†Unicodeå­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è§„åˆ™ç§°ä¸ºç¼–ç ã€‚
</code></pre><p>è¿™é‡Œè¯´çš„ç¼–ç ä¸æ˜¯æŒ‡å­—ç¬¦ç¼–ç ï¼Œè€Œæ˜¯æŒ‡<strong>ç¼–ç çš„è¿‡ç¨‹ä»¥åŠè¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨åˆ°çš„Unicodeå­—ç¬¦çš„ä»£ç ç‚¹ä¸å­—èŠ‚çš„æ˜ å°„è§„åˆ™</strong>ã€‚è¿™ä¸ªæ˜ å°„ä¸å¿…æ˜¯ç®€å•çš„ä¸€å¯¹ä¸€æ˜ å°„ï¼Œå› æ­¤ç¼–ç è¿‡ç¨‹ä¹Ÿä¸å¿…å¤„ç†æ¯ä¸ªå¯èƒ½çš„Unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ï¼š</p>
<p>å°†<code>Unicodeå­—ç¬¦ä¸²</code>è½¬æ¢ä¸º<code>ASCIIç¼–ç </code>çš„è§„åˆ™å¾ˆç®€å•â€“å¯¹äºæ¯ä¸ª<code>ä»£ç ç‚¹</code>ï¼š</p>
<ul>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&lt;128ï¼Œåˆ™æ¯ä¸ª<code>å­—èŠ‚</code>ä¸ä»£ç ç‚¹çš„å€¼ç›¸åŒ</li>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&gt;=128ï¼Œåˆ™<code>Unicodeå­—ç¬¦</code>æ— æ³•åœ¨æ­¤ç¼–ç ä¸­è¿›è¡Œè¡¨ç¤ºï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼ŒPythonä¼šå¼•å‘ä¸€ä¸ª<code>UnicodeEncodeError</code>å¼‚å¸¸ï¼‰</li>
</ul>
<p>å°†<code>Unicodeå­—ç¬¦ä¸²</code>è½¬æ¢ä¸º<code>UTF-8ç¼–ç </code>ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&lt;128ï¼Œåˆ™ç”±ç›¸åº”çš„<code>å­—èŠ‚å€¼</code>è¡¨ç¤ºï¼ˆä¸Unicodeè½¬ASCIIå­—èŠ‚ä¸€æ ·ï¼‰</li>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&gt;=128ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª2ä¸ªå­—èŠ‚ï¼Œ3ä¸ªå­—èŠ‚æˆ–4ä¸ªå­—èŠ‚çš„åºåˆ—ï¼Œè¯¥åºåˆ—ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½åœ¨128åˆ°255ä¹‹é—´ã€‚</li>
</ul>
<p>ç®€å•æ€»ç»“ï¼š</p>
<ul>
<li>ç¼–ç (<code>encode</code>)ï¼šå°†<code>Unicodeå­—ç¬¦ä¸²</code>ï¼ˆä¸­çš„ä»£ç ç‚¹)è½¬æ¢ç‰¹å®š<code>å­—ç¬¦ç¼–ç </code>å¯¹åº”çš„<code>å­—èŠ‚ä¸²</code>çš„è¿‡ç¨‹å’Œè§„åˆ™</li>
<li>è§£ç (decode)ï¼šå°†<strong>ç‰¹å®šå­—ç¬¦ç¼–ç çš„å­—èŠ‚ä¸²</strong>è½¬æ¢ä¸ºå¯¹åº”çš„<strong>Unicodeå­—ç¬¦ä¸²</strong>(ä¸­çš„ä»£ç ç‚¹)çš„è¿‡ç¨‹å’Œè§„åˆ™</li>
</ul>
<p>å¯è§ï¼Œæ— è®ºæ˜¯ç¼–ç è¿˜æ˜¯è§£ç ï¼Œéƒ½éœ€è¦ä¸€ä¸ªé‡è¦å› ç´ ï¼Œå°±æ˜¯ç‰¹å®šçš„å­—ç¬¦ç¼–ç ã€‚å› ä¸ºä¸€ä¸ªå­—ç¬¦ç”¨ä¸åŒçš„å­—ç¬¦ç¼–ç è¿›è¡Œç¼–ç åçš„å­—èŠ‚å€¼ä»¥åŠå­—èŠ‚ä¸ªæ•°å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸åŒçš„ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p>è€Œä¸”å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œç¼–ç å’Œè§£ç éƒ½æ˜¯åŸºäº<strong>Unicodeå­—ç¬¦ä¸²</strong>ï¼Œ<em>æ²¡æœ‰ç¬¬äºŒç§å­—ç¬¦ä¸²æºå’Œ</em>ï¼Œå…¶ä»–éƒ½æ˜¯ç¼–ç æ–¹å¼ï¼Œä¸€å®šè¦æ·±åˆ»åœ°è®¤è¯†åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<h2 id="Pythonç¼–ç "><a href="#Pythonç¼–ç " class="headerlink" title="Pythonç¼–ç "></a>Pythonç¼–ç </h2><h3 id="Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"></a>Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç£ç›˜ä¸Šçš„æ–‡ä»¶éƒ½æ˜¯ä»¥<code>äºŒè¿›åˆ¶æ ¼å¼</code>å­˜æ”¾çš„ï¼Œå…¶ä¸­<code>æ–‡æœ¬æ–‡ä»¶</code>éƒ½æ˜¯ä»¥<code>æŸç§ç‰¹å®šç¼–ç </code>çš„<code>å­—èŠ‚</code>å½¢å¼å­˜æ”¾çš„ã€‚å¯¹äºç¨‹åºæºä»£ç æ–‡ä»¶çš„å­—ç¬¦ç¼–ç æ˜¯ç”±ç¼–è¾‘å™¨æŒ‡å®šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨vimæ¥ç¼–å†™Pythonç¨‹åºæ—¶ä¼šæŒ‡å®šæ–‡ä»¶ç¼–ç ä¸ºUTF-8ï¼Œé‚£ä¹ˆPythonä»£ç è¢«ä¿å­˜åˆ°ç£ç›˜æ—¶å°±ä¼šè¢«è½¬æ¢ä¸ºUTF-8ç¼–ç å¯¹åº”çš„å­—èŠ‚ï¼ˆencodeè¿‡ç¨‹ï¼‰åå†™å…¥ç£ç›˜ã€‚å½“æ‰§è¡ŒPythonä»£ç æ–‡ä»¶ä¸­çš„ä»£ç æ—¶ï¼ŒPythonè§£é‡Šå™¨åœ¨è¯»å–Pythonä»£ç æ–‡ä»¶ä¸­çš„å­—èŠ‚ä¸²ä¹‹åï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸ºUNICODEå­—ç¬¦ä¸²ï¼ˆdecodeè¿‡ç¨‹ï¼‰ä¹‹åæ‰æ‰§è¡Œåç»­æ“ä½œã€‚</p>
<p>ä¸Šé¢å·²ç»è§£é‡Šè¿‡ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼ˆdecodeï¼Œè§£ç ï¼‰éœ€è¦æˆ‘ä»¬æŒ‡å®šæ–‡ä»¶ä¸­ä¿å­˜çš„å­—èŠ‚ä½¿ç”¨çš„å­—ç¬¦ç¼–ç æ˜¯ä»€ä¹ˆï¼Œæ‰èƒ½çŸ¥é“è¿™äº›å­—èŠ‚åœ¨UNICODEè¿™å¼ ä¸‡å›½ç å’Œç»Ÿä¸€ç ä¸­æ‰¾åˆ°å…¶å¯¹åº”çš„ä»£ç ç‚¹æ˜¯ä»€ä¹ˆã€‚è¿™é‡ŒæŒ‡å®šå­—ç¬¦ç¼–ç çš„æ–¹å¼å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œä¸€å›¾èƒœåƒè¨€ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div></pre></td></tr></table></figure>
<p><img src="/img/python_source_file_execute.png" alt="pythonæºæ–‡ä»¶æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"></p>
<h3 id="é»˜è®¤ç¼–ç "><a href="#é»˜è®¤ç¼–ç " class="headerlink" title="é»˜è®¤ç¼–ç "></a>é»˜è®¤ç¼–ç </h3><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ä»£ç æ–‡ä»¶å¼€å§‹çš„éƒ¨åˆ†æŒ‡å®šå­—ç¬¦ç¼–ç ï¼ŒPythonè§£é‡Šå™¨ä¼šä½¿ç”¨å“ªç§å­—ç¬¦ç¼–ç æŠŠä»ä»£ç æ–‡ä»¶ä¸­è¯»å–åˆ°çš„å­—èŠ‚è½¬æ¢ä¸º<strong>UNICODEä»£ç ç‚¹</strong>å‘¢ï¼Ÿå°±åƒæˆ‘ä»¬é…ç½®æŸäº›è½¯ä»¶æ—¶ï¼Œæœ‰å¾ˆå¤šé»˜è®¤é€‰é¡¹ä¸€æ ·ï¼ŒPythonè§£é‡Šå™¨å†…éƒ¨è®¾ç½®äº†é»˜è®¤çš„<code>å­—ç¬¦ç¼–ç </code>ã€‚å› æ­¤å¤§å®¶æ‰€è¯´çš„Pythonä¸­æ–‡å­—ç¬¦é—®é¢˜å°±å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå½“æ— æ³•é€šè¿‡<strong>é»˜è®¤çš„å­—ç¬¦ç¼–ç </strong>å¯¹å­—èŠ‚è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±ä¼šå‡ºç°è§£ç é”™è¯¯(UnicodeEncodeError)ã€‚</p>
<p>Python2å’ŒPython3çš„è§£é‡Šå™¨ä½¿ç”¨çš„é»˜è®¤ç¼–ç æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>sys.getdefaultencoding()</code>æ¥è·å–é»˜è®¤ç¼–ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># python2</span></div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> sys</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: sys.getdefaultencoding()</div><div class="line">Out[<span class="number">3</span>]: <span class="string">'ascii'</span></div><div class="line"></div><div class="line"><span class="comment"># python3</span></div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> sys</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: sys.getdefaultencoding()</div><div class="line">Out[<span class="number">3</span>]: <span class="string">'utf-8'</span></div></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œå¯¹äºPython2æ¥è®²ï¼ŒPythonè§£é‡Šå™¨åœ¨è¯»å–åˆ°ä¸­æ–‡å­—ç¬¦çš„å­—èŠ‚ç å°è¯•è§£ç æ“ä½œæ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹å½“å‰ä»£ç æ–‡ä»¶å¤´éƒ¨æ˜¯å¦æœ‰æŒ‡æ˜å½“å‰ä»£ç æ–‡ä»¶ä¸­ä¿å­˜çš„å­—èŠ‚ç å¯¹åº”çš„å­—ç¬¦ç¼–ç æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤å­—ç¬¦ç¼–ç â€ASCIIâ€è¿›è¡Œè§£ç å¯¼è‡´è§£ç å¤±è´¥ï¼Œå¯¼è‡´å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Non-ASCII character <span class="string">'\xc4'</span> <span class="keyword">in</span> file xxx.py on line <span class="number">11</span>, but no encoding declared; see http://python.org/dev/peps/pep<span class="number">-0263</span>/ <span class="keyword">for</span> details</div></pre></td></tr></table></figure>
<p>å¯¹äºPython3æ¥è®²ï¼Œæ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯Python3çš„è§£é‡Šå™¨ä»¥â€UTF-8â€ä½œä¸ºé»˜è®¤ç¼–ç ï¼Œä½†æ˜¯è¿™å¹¶ä¸è¡¨ç¤ºå¯ä»¥å®Œå…¨å…¼å®¹ä¸­æ–‡é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨Windowsä¸Šè¿›è¡Œå¼€å‘æ—¶ï¼ŒPythonå·¥ç¨‹åŠä»£ç æ–‡ä»¶éƒ½ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„GBKç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´Pythonä»£ç æ–‡ä»¶æ˜¯è¢«è½¬æ¢æˆGBKæ ¼å¼çš„å­—èŠ‚ç ä¿å­˜åˆ°ç£ç›˜ä¸­çš„ã€‚Python3çš„è§£é‡Šå™¨æ‰§è¡Œè¯¥ä»£ç æ–‡ä»¶æ—¶ï¼Œè¯•å›¾ç”¨UTF-8è¿›è¡Œè§£ç æ“ä½œæ—¶ï¼ŒåŒæ ·ä¼šè§£ç å¤±è´¥ï¼Œå¯¼è‡´å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Non-UTF<span class="number">-8</span> code starting <span class="keyword">with</span> <span class="string">'\xc4'</span> <span class="keyword">in</span> file xxx.py on line <span class="number">11</span>, but no encoding declared; see http://python.org/dev/peps/pep<span class="number">-0263</span>/ <span class="keyword">for</span> details</div></pre></td></tr></table></figure>
<h2 id="å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²"><a href="#å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²" class="headerlink" title="å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²"></a>å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²</h2><p>å…¶å®Python3ä¸­å¯¹å­—ç¬¦ä¸²æ”¯æŒçš„æ”¹è¿›ï¼Œä¸ä»…ä»…æ˜¯æ›´æ”¹äº†é»˜è®¤ç¼–ç ï¼Œè€Œæ˜¯é‡æ–°è¿›è¡Œäº†å­—ç¬¦ä¸²çš„å®ç°ï¼Œè€Œä¸”å®ƒå·²ç»å®ç°äº†<strong>å¯¹UNICODEçš„å†…ç½®æ”¯æŒ</strong>ï¼Œä»è¿™æ–¹é¢æ¥è®²Pythonå·²ç»å’ŒJAVAç­‰è¯­è¨€ä¸€æ ·ä¼˜ç§€ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹Python2ä¸Python3ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p>
<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>Python2ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒç”±ä»¥ä¸‹ä¸‰ä¸ªç±»æä¾›</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">basestring</span><span class="params">(object)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">str</span><span class="params">(basestring)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">unicode</span><span class="params">(basestring)</span></span></div></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>help(str)</code>å’Œ<code>help(bytes)</code>ä¼šå‘ç°ç»“æœéƒ½æ˜¯<code>strç±»</code>çš„å®šä¹‰ï¼Œè¿™ä¹Ÿè¯´æ˜Python2ä¸­strå°±æ˜¯<strong>å­—èŠ‚ä¸²</strong>ï¼Œè€Œåæ¥çš„<strong>unicodeå¯¹è±¡å¯¹åº”æ‰æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²</strong>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: <span class="keyword">print</span> type(a), len(a)</div><div class="line">&lt;type <span class="string">'str'</span>&gt; <span class="number">6</span></div><div class="line"></div><div class="line">In [<span class="number">4</span>]: <span class="keyword">print</span> type(b), len(b)</div><div class="line">&lt;type <span class="string">'unicode'</span>&gt; <span class="number">2</span></div></pre></td></tr></table></figure>
<h3 id="python3"><a href="#python3" class="headerlink" title="python3"></a>python3</h3><p>Python3ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒè¿›è¡Œäº†å®ç°ç±»å±‚æ¬¡çš„ä¸Šç®€åŒ–ï¼Œå»æ‰äº†unicodeç±»ï¼Œæ·»åŠ äº†ä¸€ä¸ªbytesç±»ã€‚ä»è¡¨é¢ä¸Šæ¥çœ‹ï¼Œå¯ä»¥è®¤ä¸ºPython3ä¸­çš„strå’ŒunicodeåˆäºŒä¸ºä¸€äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">bytes</span><span class="params">(object)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">str</span><span class="params">(object)</span></span></div></pre></td></tr></table></figure>
<p>å®é™…ä¸Šï¼ŒPython3ä¸­å·²ç»æ„è¯†åˆ°ä¹‹å‰çš„é”™è¯¯ï¼Œå¼€å§‹æ˜ç¡®çš„åŒºåˆ†å­—ç¬¦ä¸²ä¸å­—èŠ‚ã€‚å› æ­¤Python3ä¸­çš„strå·²ç»æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²ï¼Œè€Œå­—èŠ‚æ˜¯ç”¨å•ç‹¬çš„bytesç±»æ¥è¡¨ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython3é»˜è®¤å®šä¹‰çš„å°±æ˜¯å­—ç¬¦ä¸²ï¼Œå®ç°äº†å¯¹UNICODEçš„å†…ç½®æ”¯æŒï¼Œå‡è½»äº†ç¨‹åºå‘˜å¯¹å­—ç¬¦ä¸²å¤„ç†çš„è´Ÿæ‹…ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: c = a.encode(<span class="string">"gbk"</span>)</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: print(type(a), len(a))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2</span></div><div class="line"><span class="class"></span></div><div class="line"><span class="class"><span class="title">In</span> [5]:</span> print(type(b), len(b))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2</span></div><div class="line"><span class="class"></span></div><div class="line"><span class="class"><span class="title">In</span> [6]:</span> print(type(c), len(c))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">bytes</span>'&gt; 4</span></div></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ç¼–ç è½¬æ¢"><a href="#å­—ç¬¦ç¼–ç è½¬æ¢" class="headerlink" title="å­—ç¬¦ç¼–ç è½¬æ¢"></a>å­—ç¬¦ç¼–ç è½¬æ¢</h2><p>ä¸Šé¢æåˆ°ï¼ŒUNICODEå­—ç¬¦ä¸²å¯ä»¥ä¸ä»»æ„å­—ç¬¦ç¼–ç çš„å­—èŠ‚è¿›è¡Œç›¸äº’è½¬æ¢ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/img/unicode_string.png" alt="unicode å­—ç¬¦ä¸²"></p>
<p>é‚£ä¹ˆå¤§å®¶å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸åŒçš„å­—ç¬¦ç¼–ç çš„å­—èŠ‚å¯ä»¥é€šè¿‡Unicodeç›¸äº’è½¬æ¢å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p>
<p><strong>Python2ä¸­çš„å­—ç¬¦ä¸²è¿›è¡Œå­—ç¬¦ç¼–ç è½¬æ¢è¿‡ç¨‹æ˜¯</strong>ï¼š</p>
<p>å­—èŠ‚ä¸²â€“&gt;decode(â€˜åŸæ¥çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;Unicodeå­—ç¬¦ä¸²â€“&gt;encode(â€˜æ–°çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;å­—èŠ‚ä¸²</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span>  <span class="comment"># utf-8ç¼–ç çš„å­—èŠ‚ä¸²</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = a.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>)  <span class="comment"># å…ˆè½¬æ¢æˆunicodeå­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œgbkç¼–ç </span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: <span class="keyword">print</span> b.decode(<span class="string">'gbk'</span>)  <span class="comment"># è§£ç æˆunicodeå­—ç¬¦ä¸²</span></div><div class="line">ä¸­å›½</div></pre></td></tr></table></figure>
<p><strong>Python3ä¸­å®šä¹‰çš„å­—ç¬¦ä¸²é»˜è®¤å°±æ˜¯unicodeï¼Œå› æ­¤ä¸éœ€è¦å…ˆè§£ç ï¼Œå¯ä»¥ç›´æ¥ç¼–ç æˆæ–°çš„å­—ç¬¦ç¼–ç ï¼š</strong></p>
<p>å­—ç¬¦ä¸²â€“&gt;encode(â€˜æ–°çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;å­—èŠ‚ä¸²</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = a.encode(<span class="string">"gbk"</span>)</div><div class="line"></div><div class="line">In [<span class="number">3</span>]: print(b.decode(<span class="string">"gbk"</span>))</div><div class="line">ä¸­å›½</div></pre></td></tr></table></figure>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>pythonå­—ç¬¦ä¸²ç¼–ç å·®ä¸å¤šå°±æ˜¯è¿™äº›å†…å®¹äº†ï¼Œææ¸…æ¥šåŸç†å…¶å®è®°å¿†ä¹Ÿä¸éš¾ã€‚ç¥å¤§å®¶ä¸ä¼šå†æ‰åˆ°pythonå­—ç¬¦ç¼–ç çš„å‘ä¸­ï¼Œç¥æˆ‘å¸èƒ½å°½å¿«è¿ç§»åˆ°python3ï¼</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/30/goå’Œpythonå˜é‡èµ‹å€¼çš„ä¸€ä¸ªå°é—®é¢˜/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/30/goå’Œpythonå˜é‡èµ‹å€¼çš„ä¸€ä¸ªå°é—®é¢˜/" itemprop="url">goå’Œpythonå˜é‡èµ‹å€¼çš„ä¸€ä¸ªå°é—®é¢˜</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-30T19:37:23+08:00">
                2017-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¹³æ—¶å†™å¾—å¤šçš„æ˜¯pythonï¼Œæœ€è¿‘çœ‹äº†ä¸€ç‚¹goï¼Œä»Šå¤©ç¢°åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</div><div class="line">    Name <span class="keyword">string</span></div><div class="line">    Age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">pase_student</span><span class="params">()</span></span> &#123;</div><div class="line">    m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*student)</div><div class="line">    stus := []student&#123;</div><div class="line">        &#123;Name: <span class="string">"zhou"</span>, Age: <span class="number">24</span>&#125;,</div><div class="line">        &#123;Name: <span class="string">"li"</span>, Age: <span class="number">23</span>&#125;,</div><div class="line">        &#123;Name: <span class="string">"wang"</span>, Age: <span class="number">22</span>&#125;,</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> _, stu := <span class="keyword">range</span> stus &#123;</div><div class="line">        m[stu.Name] = &amp;stu</div><div class="line">    &#125;</div><div class="line">    fmt.Println(m[<span class="string">"zhou"</span>].Name)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    pase_student()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»£ç å¾ˆç®€å•ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ä¼šæ‰“å°å‡ºä»€ä¹ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">time.sleep(<span class="number">60</span>)  <span class="comment"># æ€è€ƒ</span></div></pre></td></tr></table></figure>
<p>ç»“æœæ˜¯<code>wang</code>!ï¼ŒæƒŠå–œä¸æƒŠå–œï¼éå†èµ‹å€¼å•ŠåŒå­¦ä»¬ï¼Œè¿™ä¹ˆç®€å•çš„æ“ä½œéƒ½èƒ½å‡ºå¹ºè›¾å­ï¼ŒWTFï¼</p>
<p>ä¸ºä»€ä¹ˆæ˜¯<code>wang</code>å‘¢ï¼Ÿ<del>ä½ tmç»™æˆ‘</del>è§£é‡Šè§£é‡Š<del>ä»€ä¹ˆæ˜¯æƒŠå–œ</del>ï¼š</p>
<p>forå¾ªç¯çš„æ—¶å€™ï¼Œå˜é‡stuçš„æŒ‡é’ˆæ˜¯ä¸å˜çš„ï¼Œæ¯æ¬¡å¾ªç¯ä»…ä»…æ˜¯å¯¹studentç»“æ„ä½“çš„<strong>å€¼</strong>æ‹·è´ï¼Œä¸Šé¢çš„forå¾ªç¯å’Œä¸‹é¢æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> stu student </div><div class="line"><span class="keyword">for</span> _, stu = <span class="keyword">range</span> stus &#123;</div><div class="line">	m[stu.Name] = &amp;stu</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥<code>&amp;stu</code>è‡ªå§‹è‡³ç»ˆéƒ½æ˜¯ä¸€ä¸ªåœ°å€ï¼Œå˜åŒ–çš„æ˜¯è¿™ä¸ªåœ°å€ä¸Šå­˜å‚¨çš„å€¼ã€‚<code>&amp;stu</code>æœ€ç»ˆå­˜å‚¨çš„å€¼æ˜¯<code>student{Name: &quot;wang&quot;, Age: 22}</code>ç»“æ„ä½“ï¼Œæ‰€ä»¥æ‹¿å‡ºæ¥çš„æ˜¯<code>wang</code>ã€‚</p>
<p>å¯ä»¥å°†<code>m</code>æ‰“å‡ºæ¥çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">map</span>[zhou:<span class="number">0xc42000a260</span> li:<span class="number">0xc42000a260</span> wang:<span class="number">0xc42000a260</span>]</div></pre></td></tr></table></figure>
<p>éªŒè¯äº†æˆ‘ä»¬ä¸Šé¢çš„æƒ³æ³•ï¼Œå¤§å®¶çš„valueéƒ½æ˜¯åŒä¸€ä¸ªåœ°å€ã€‚</p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ—¥å¸¸å†™cï¼Œc++ç­‰å¼ºç±»å‹è¯­è¨€çš„åŒå­¦å¯èƒ½ä¼šè¯´ï¼Œç¥ç»ç—…å•Šï¼è¿™æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼ä¸å°±æ˜¯è¿™æ ·çš„å—ï¼è¯·åŸè°…æˆ‘ï¼Œæˆ‘æ—¥å¸¸å†™pythonçš„ [æ‚è„¸]ã€‚</p>
<p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨goä¸­ï¼Œå˜é‡åæ˜¯<code>å­˜å‚¨åœ°å€çš„åå­—</code>ã€‚å®ƒåœ¨ç¼–è¯‘æ—¶ç»‘å®šå·²ç»å®Œæˆï¼Œè¿è¡Œæ—¶æ˜¯ä¸å¯ä»¥æ”¹å˜çš„ï¼Œä½ åªèƒ½æ”¹å˜åœ°å€ä¸­å­˜å‚¨çš„å€¼ã€‚</p>
<p>è€Œåœ¨pythonä¸­ï¼Œå˜é‡æ˜¯å¯¹è±¡çš„åå­—ï¼Œè¿è¡Œæ—¶å˜é‡å¯ä»¥ç»‘å®šåˆ°ä»»æ„çš„å¯¹è±¡ä¸Šã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">4</span>]: a = <span class="number">123456</span></div><div class="line"></div><div class="line">In [<span class="number">5</span>]: id(a)</div><div class="line">Out[<span class="number">5</span>]: <span class="number">4426596208</span></div><div class="line"></div><div class="line">In [<span class="number">6</span>]: a = <span class="number">1234567</span></div><div class="line"></div><div class="line">In [<span class="number">7</span>]: id(a)</div><div class="line">Out[<span class="number">7</span>]: <span class="number">4426592592</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šç”±äºpythonå¯¹intç±»å‹å®ç°äº†<strong>å°æ•´æ•°å¯¹è±¡æ± </strong>ï¼Œä¸è¦ç”¨<strong>0-255</strong>çš„æ•´æ•°åšå®éªŒï¼Œä¸ç„¶ä½ å¾—åˆ°idä¼šæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ å¾ªç¯ä¸€ä¸ªlistçš„æ—¶å€™ï¼Œæ¯æ¬¡å¾—åˆ°çš„æ˜¯ä¸åŒå¯¹è±¡ï¼Œå˜é‡æŒ‡å‘äº†ä¸åŒçš„åœ°å€ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">9</span>]: <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">2222</span>, <span class="number">2223</span>, <span class="number">2224</span>]:</div><div class="line">   ...:     print(id(i))</div><div class="line">   ...:</div><div class="line"><span class="number">4426596208</span></div><div class="line"><span class="number">4426592336</span></div><div class="line"><span class="number">4426596080</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œpythonä¸ºæˆ‘ä»¬åˆ›å»ºäº†3ä¸ª<code>PyIntObject</code>ï¼Œ<strong>i</strong>åªæ˜¯ä»–ä»¬çš„åå­—ã€‚è€Œåœ¨goä¸­ï¼Œå¯ä»¥è®¤ä¸ºåªæœ‰ä¸€ä¸ªobjectï¼Œå€¼å˜åŒ–äº†3æ¬¡ã€‚</p>
<p>pythonä¸­è¯´çš„<code>èµ‹å€¼å°±æ˜¯å»ºç«‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨</code>ï¼Œæ˜¯å®è¯ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/13/ssl-traffic-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/13/ssl-traffic-analysis/" itemprop="url">SSL/TLS ä¼šè¯æµé‡åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-13T12:50:39+08:00">
                2017-08-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç½‘ç»œ/" itemprop="url" rel="index">
                    <span itemprop="name">ç½‘ç»œ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åŸæ–‡ï¼š<a href="http://blog.fourthbit.com/2014/12/23/traffic-analysis-of-an-ssl-slash-tls-session" target="_blank" rel="external">http://blog.fourthbit.com/2014/12/23/traffic-analysis-of-an-ssl-slash-tls-session</a></p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¼šç»™å¤§å®¶å±•ç¤ºå½“æˆ‘ä»¬ä½¿ç”¨SSL/TLSçš„æ—¶å€™ï¼Œåœ¨åè®®å±‚é¢ä¸Šå‘ç”Ÿäº†ä»€ä¹ˆã€‚ä¸ºäº†ä¾¿äºåˆ†æï¼Œæˆ‘å°†ä¼šä½¿ç”¨ä¸€ä¸ªåŸºäºOpenSSLå®ç°çš„éé˜»å¡TCPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚</p>
<p>æˆ‘ä»¬è¦è®°ä½ï¼ŒSSL/TLSèƒ½è®©åº”ç”¨åƒåº•å±‚åŸºç¡€è®¾æ–½ï¼ˆç½‘ç»œå’Œä¸»æœºï¼‰ä¸€æ ·å®‰å…¨ï¼Œç¡®ä¿é€šä¿¡å®‰å…¨æ˜¯å®ƒå”¯ä¸€åšçš„äº‹ã€‚SSL/TLSæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åè®®ï¼Œå®ƒå¤„äºåº”ç”¨å±‚ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯HTTPï¼Œå…¶ä»–åŒæ ·ä¹Ÿå¯ä»¥ï¼‰å’Œä¼ è¾“å±‚ï¼ˆTCPï¼‰ä¹‹é—´ã€‚å¦‚æ­¤ï¼ŒTLSä¸éœ€è¦ä¸Šä¸‹å±‚åè®®æœ‰å¤§çš„æ”¹åŠ¨ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ï¼Œå®ƒå‡ ä¹æ˜¯é€æ˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·æ ¹æœ¬ä¸éœ€è¦çŸ¥é“è¿™ä¸ªåè®®çš„å­˜åœ¨ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¸¦æ¥äº†ä¸€äº›å¼Šç«¯ï¼Œå®ƒåœ¨ä¸€äº›åŸºç¡€æ–¹é¢å¯¹åè®®åšäº†é™åˆ¶ï¼ˆæ¯”å¦‚ä¸æ”¯æŒUDPï¼‰ã€‚</p>
<p>è‡ªSSL/TLSè¯ç”Ÿä»¥æ¥ï¼Œå®ƒå·²ç»æœ‰äº†ç›¸å½“å¤§çš„æ”¹è¿›ã€‚ç°åœ¨ï¼ŒSSL 2.0å’Œ3.0è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œä»–ä»¬å·²ç»è¢«TLS 1.0/1.1/1.2 æ›¿æ¢ã€‚è¿™äº›åè®®çš„å†å²æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„è¯é¢˜ã€‚</p>
<h2 id="åè®®æè¿°"><a href="#åè®®æè¿°" class="headerlink" title="åè®®æè¿°"></a>åè®®æè¿°</h2><p>å°±åƒä¸Šé¢æåˆ°çš„ï¼ŒTLSåè®®åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¸­é—´ã€‚å®ƒè¢«åˆ†å‰²æˆä¸¤ä¸ªä¸»è¦çš„å­å±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªåè®®çš„ä¸»è¦ç»“æ„å’Œå®ƒåœ¨ç½‘ç»œåè®®æ ˆä¸­çš„ä½ç½®ã€‚</p>
<p><img src="/img/protocol_description.png" alt="tls structure"></p>
<p>ä¸‹é¢çš„å­å±‚åœ¨TCPä¹‹ä¸Šï¼Œå› ä¸ºTCPæ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„å¯é çš„åè®®ã€‚è¿™ä¸€å±‚ä¸»è¦åŒ…æ‹¬TLSè®°å½•åè®®ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè®°å½•åè®®é¦–å…ˆå°†ä¸Šå±‚åè®®çš„æ•°æ®å˜æˆ2^14bytesæˆ–æ›´å°‘çš„å—ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œå‹ç¼©ï¼ˆå¯é€‰ï¼‰ï¼ŒåŠ ä¸Šä¸€ä¸ªæ¶ˆæ¯è®¤è¯ç ï¼ˆMessage Authentication Codeï¼‰ï¼Œæœ€åï¼Œæ ¹æ®åå•†çš„åŠ å¯†ç»†åˆ™å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å¹¶æ·»åŠ ä¸€ä¸ªSSLè®°å½•å¤´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªå—éƒ½ä¼šè¢«æ‰“åŒ…è¿›ä¸€ä¸ªç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“å¹¶ä¸ä¿å­˜åº”ç”¨å±‚æ¶ˆæ¯çš„è¾¹ç•Œï¼Œè¿™å°±æ„å‘³ç€å¤šæ¡ç›¸åŒç±»å‹çš„æ¶ˆæ¯å¯èƒ½ä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ã€‚</p>
<p>ä¸‹é¢çš„å›¾æè¿°äº†å»ºç«‹ä¸€ä¸ªSSL Recordçš„è¿‡ç¨‹</p>
<p><img src="/img/ssl_record.png" alt="ssl record"></p>
<p>ä¸Šé¢çš„å­å±‚åœ¨SSLè®°å½•åè®®(SSL Record Protocol)ä¹‹ä¸Šï¼Œå®ƒç”±å››ä¸ªå­åè®®ç»„æˆã€‚æ¯ä¸ªå­åè®®éƒ½æœ‰éå¸¸æ˜ç¡®çš„ç›®çš„ï¼Œå¹¶åœ¨é€šä¿¡çš„ä¸åŒé˜¶æ®µè¢«åº”ç”¨ï¼š</p>
<ol>
<li><p>æ¡æ‰‹åè®®ï¼ˆHandShake Protocolï¼‰ï¼šå®ƒä½¿åŒæ–¹å¯ä»¥ç›¸äº’è®¤è¯ï¼Œä»¥åŠä¸ºæœ¬æ¬¡è¿æ¥åå•†å‡ºä¸€ä¸ªåŠ å¯†å¥—ä»¶ï¼ˆcipher suiteï¼‰å’Œå…¶ä»–å‚æ•°ã€‚SSLæ¡æ‰‹åè®®æ¶‰åŠåˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´4ç»„æ¶ˆæ¯äº¤æ¢ã€‚æ¯ä¸€ç»„éƒ½æ˜¯åœ¨ç‹¬ç«‹çš„TCPæ®µï¼ˆsegmentï¼‰ä¸­ä¼ è¾“ã€‚ä¸‹é¢çš„å›¾ä¸ºè¿™ä¸ªè¿‡ç¨‹åšäº†æ€»ç»“ï¼Œå®ƒåŒ…å«å¥½å‡ ä¸ªæ­¥éª¤ï¼Œä¸€äº›æ­¥éª¤æ˜¯å¯é€‰çš„ã€‚æ³¨æ„ï¼Œ<em>ChangeCipherSpec</em>ä¸å±äºè¿™ä¸ªåè®®ï¼Œä»–ä»¬æ˜¯ç‹¬ç«‹çš„åè®®ï¼Œä¸‹é¢ä¼šè®²åˆ°ã€‚<br><img src="/img/handshake.png" alt="handshake"></p>
</li>
<li><p>ChangeCipherSpecåè®®ï¼šå®ƒä½¿ä¹‹å‰åŒæ–¹åå•†å¾—åˆ°çš„å‚æ•°èµ·ä½œç”¨ï¼Œé€šä¿¡å˜æˆåŠ å¯†çš„ã€‚</p>
</li>
<li>Alertåè®®ï¼šç”¨äºé€šä¿¡å¼‚å¸¸ï¼Œå¹¶é¢„è­¦å¯èƒ½é™ä½é€šä¿¡å®‰å…¨æ€§çš„é—®é¢˜</li>
<li>åº”ç”¨æ•°æ®åè®®ï¼ˆApplication Data Protocolï¼‰ï¼šå®ƒæ¥å—ä»»æ„å¤§å°çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯åº”ç”¨å±‚æ•°æ®ï¼‰ï¼Œå°†æ•°æ®å–‚ç»™å®‰å…¨é€šé“ï¼ˆfeeds it through the secure channelï¼‰ã€‚</li>
</ol>
<p>å¤šæ¡æ¶ˆæ¯å¯ä»¥è¢«ä¸²è”æˆä¸€æ¡è®°å½•å±‚ï¼ˆRecord Layerï¼‰æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™äº›æ¶ˆæ¯å¿…é¡»å½’å±äºç›¸åŒçš„å­åè®®ã€‚ç»“æœæ˜¯ï¼Œè¿™4ä¸ªåè®®çš„æ¯ä¸ªéƒ½å¿…é¡»æ˜¯è‡ªå®šç•Œçš„ï¼ˆæ¯”å¦‚ï¼Œéƒ½éœ€è¦åŒ…å«è‡ªå·±çš„é•¿åº¦å­—æ®µï¼‰ã€‚</p>
<h2 id="è®°å½•åè®®æ ¼å¼ï¼ˆRecord-Protocol-formatï¼‰"><a href="#è®°å½•åè®®æ ¼å¼ï¼ˆRecord-Protocol-formatï¼‰" class="headerlink" title="è®°å½•åè®®æ ¼å¼ï¼ˆRecord Protocol formatï¼‰"></a>è®°å½•åè®®æ ¼å¼ï¼ˆRecord Protocol formatï¼‰</h2><p>TLS è®°å½•å¤´ï¼ˆRecord headerï¼‰åŒ…å«3ä¸ªå­—æ®µï¼Œé«˜å±‚åè®®å»ºç«‹åœ¨å®ƒä¹‹ä¸Šï¼š</p>
<ol>
<li>Byte 0ï¼šTLSè®°å½•ç±»å‹ï¼ˆTLS recode typeï¼‰</li>
<li>Bytes 1-2: TLS version (major/minor)</li>
<li>Bytes 3-4: Length of data in the record (excluding the header itself). The maximum supported is 16384 (16K)</li>
</ol>
<p><img src="/img/record_protocol_format.png" alt="record protocol format"></p>
<h2 id="æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake-Protocol-formatï¼‰"><a href="#æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake-Protocol-formatï¼‰" class="headerlink" title="æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake Protocol formatï¼‰"></a>æ¡æ‰‹åè®®æ ¼å¼ï¼ˆHandshake Protocol formatï¼‰</h2><p>è¿™æ˜¯TLSç§æœ€å¤æ‚çš„å­åè®®ã€‚TLSæ ‡å‡†ä¸»è¦ä¹Ÿåœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒä¸ºå»ºç«‹ä¸€ä¸ªå®‰å…¨çš„è¿æ¥å¤„ç†äº†æ‰€æœ‰ç»†èŠ‚ã€‚ä¸‹é¢çš„å›¾å±•ç¤ºäº†æ¡æ‰‹åè®®æ¶ˆæ¯çš„ä¸»ä½“ç»“æ„ã€‚TLSæ ‡å‡†å­˜åœ¨10ç§ï¼ˆä¸åŒ…æ‹¬æ‰©å±•ï¼‰æ¡æ‰‹æ¶ˆæ¯ç±»å‹ï¼Œä¸‹é¢ä¸€ä¸€åšäº†å±•ç¤ºã€‚</p>
<p><img src="/img/handshake_message_structure.png" alt="handshake message general structure"></p>
<ul>
<li>HelloRequestï¼šå…è®¸æœåŠ¡å™¨é‡å¯æ¡æ‰‹åå•†ã€‚ä¸å¸¸ç”¨ã€‚å¦‚æœä¸€ä¸ªè¿æ¥è¢«æŒ‚èµ·äº†è¶³å¤Ÿé•¿æ—¶é—´åªæ˜¯å®‰å…¨æ€§ä¸‹é™ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨æ­¤æ¶ˆæ¯è¿«ä½¿å®¢æˆ·ç«¯é‡æ–°åå•†æ–°çš„ä¼šè¯ç§˜é’¥ï¼ˆkeysï¼‰ã€‚</li>
</ul>
<p><img src="/img/hello_request.png" alt="hello request"></p>
<ul>
<li>ClientHelloï¼šè¿™æ¡æ¶ˆæ¯ä»£è¡¨äº†ä¸€ä¸ªTLSæ¡æ‰‹åå•†çš„å¼€å§‹ã€‚å‘é€å®ƒçš„åŒæ—¶ä¼šå¸¦ä¸Šå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼ŒæœåŠ¡ç«¯ä¼šæŒ‘é€‰æœ€åˆé€‚çš„é‚£ä¸ªï¼ˆå®‰å…¨æ€§æœ€å¼ºçš„é‚£ä¸ªï¼‰ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€ä¸ªå‹ç¼©æ–¹æ³•åˆ—è¡¨ï¼Œä¸€ä¸ªæ‰©å±•åˆ—è¡¨ã€‚é€šè¿‡åŒ…å«<code>SessionId</code>å­—æ®µï¼Œå®ƒä¹Ÿèµ‹äºˆäº†å®¢æˆ·ç«¯é‡æ–°å¼€å§‹ä¹‹å‰çš„ä¼šè¯çš„èƒ½åŠ›ã€‚</li>
</ul>
<p><img src="/img/client_hello.png" alt="client hello"></p>
<ul>
<li>ServerHelloï¼šServerHelloæ¶ˆæ¯å’ŒClientHelloæ¶ˆæ¯å¾ˆç±»ä¼¼ï¼Œé™¤äº†å®ƒåªåŒ…å«ä¸€ä¸ªå¯†ç å¥—ä»¶å’Œä¸€ä¸ªåŠ å¯†æ–¹æ³•ã€‚å¦‚æœä»–åŒ…å«äº†ä¸€ä¸ªSessionIdï¼ˆä¾‹å¦‚ï¼šSessionIdé•¿åº¦å¤§äº0ï¼‰ï¼Œå°±æ˜¯é€šçŸ¥å®¢æˆ·ç«¯åœ¨ä»¥åé‡ç”¨è¿™ä¸ªä¼šè¯ã€‚</li>
</ul>
<p><img src="/img/server_hello.png" alt="server hello"></p>
<ul>
<li>Certificateï¼šè¿™ä¸ªæ¶ˆæ¯çš„æ¶ˆæ¯ä½“åŒ…å«äº†ä¸€ä¸ªå…¬é’¥è¯ä¹¦é“¾ã€‚è¯ä¹¦é“¾ä½¿TLSæ”¯æŒè¯ä¹¦åˆ†å±‚å’Œå…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼šPublic Key Infrastructuresï¼‰</li>
</ul>
<p><img src="/img/certificate.png" alt="certificate"></p>
<ul>
<li>ServerKeyExchangeï¼šè¯¥æ¶ˆæ¯æºå¸¦å®¢æˆ·ç«¯éœ€è¦ä»æœåŠ¡å™¨è·å¾—çš„å¯†é’¥äº¤æ¢ç®—æ³•å‚æ•°ï¼Œä»¥ä¾¿ä¹‹åèƒ½ä½¿ç”¨å¯¹ç§°åŠ å¯†ã€‚è¿™æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰å¯†é’¥äº¤æ¢éƒ½è¦æ±‚æœåŠ¡å™¨æ˜ç¡®åœ°å‘é€æ­¤æ¶ˆæ¯ã€‚å®é™…ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒCertificateæ¶ˆæ¯è¶³ä»¥ä½¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å®‰å…¨åœ°é€šä¿¡ä¸€ä¸ªé¢„å…ˆå¯†é’¥ã€‚è¿™äº›å‚æ•°çš„æ ¼å¼å®Œå…¨å–å†³äºæ‰€é€‰æ‹©çš„å¯†é’¥å¥—ä»¶ï¼ˆCipherSuiteï¼‰ï¼Œå®ƒå…ˆå‰ç”±æœåŠ¡å™¨é€šè¿‡ServerHelloæ¶ˆæ¯è®¾ç½®ã€‚</li>
</ul>
<p><img src="/img/server_key_exchange.png" alt="server key exchange"></p>
<ul>
<li>CertificateRequestï¼šå½“æœåŠ¡å™¨éœ€è¦å®¢æˆ·ç«¯èº«ä»½éªŒè¯æ—¶ä½¿ç”¨å®ƒã€‚åœ¨WebæœåŠ¡å™¨ä¸­ä¸å¸¸ç”¨ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸é‡è¦ã€‚è¯¥æ¶ˆæ¯ä¸ä»…å‘å®¢æˆ·ç«¯è¯¢é—®è¯ä¹¦ï¼Œè¿˜ä¼šå‘ŠçŸ¥å“ªäº›è¯ä¹¦ç±»å‹æ˜¯å¯æ¥å—çš„ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æŒ‡å‡ºé‚£äº›è¯ä¹¦æœºæ„æ˜¯å¯ä¿¡èµ–çš„ã€‚</li>
</ul>
<p><img src="/img/certificate_request.png" alt="certificate request"></p>
<ul>
<li>ServerHelloDoneï¼šè¯¥æ¶ˆæ¯å®Œæˆäº†æ¡æ‰‹åå•†çš„æœåŠ¡å™¨éƒ¨åˆ†ã€‚å®ƒæ²¡æœ‰é™„åŠ ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="/img/server_hello_done.png" alt="server hello done"></p>
<ul>
<li>ClientKeyExchangeï¼šå®ƒä¸ºæœåŠ¡å™¨æä¾›å¿…è¦çš„æ•°æ®ï¼Œä»¥ç”Ÿæˆå¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚æ¶ˆæ¯æ ¼å¼ä¸ServerKeyExchangeéå¸¸ç›¸ä¼¼ï¼Œå› ä¸ºå®ƒä¸»è¦å–å†³äºæœåŠ¡å™¨é€‰æ‹©çš„å¯†é’¥äº¤æ¢ç®—æ³•ã€‚</li>
</ul>
<p><img src="/img/client_key_exchange.png" alt="client key exchange"></p>
<ul>
<li>CertificateVerifyï¼šå®¢æˆ·ç«¯ä½¿ç”¨è¯¥æ¶ˆæ¯æ¥è¯æ˜æœåŠ¡å™¨æ‹¥æœ‰ä¸å…¶å…¬é’¥è¯ä¹¦ç›¸å¯¹åº”çš„ç§é’¥ã€‚è¯¥æ¶ˆæ¯ä¿å­˜æœ‰å®¢æˆ·ç«¯æ•°å­—ç­¾åçš„æ•£â€‹â€‹åˆ—ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘å‡ºCertificateRequestï¼Œåˆ™éœ€è¦å‘é€éœ€è¦éªŒè¯çš„è¯ä¹¦ã€‚åŒæ ·çš„ï¼Œä¿¡æ¯çš„ç¡®åˆ‡å°ºå¯¸å’Œç»“æ„å–å†³äºå•†å®šçš„ç®—æ³•ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œè¾“å…¥åˆ°å“ˆå¸Œå‡½æ•°çš„ä¿¡æ¯æ˜¯ç›¸åŒçš„ã€‚</li>
</ul>
<p><img src="/img/certificate_verify.png" alt="certificate verify"></p>
<ul>
<li>Finishedï¼šæ­¤æ¶ˆæ¯è¡¨ç¤ºTLSåå•†å·²å®Œæˆï¼Œå¯†ç å¥—ä»¶ï¼ˆCipherSuiteï¼‰å·²æ¿€æ´»ã€‚åº”è¯¥å‘é€å·²ç»åŠ å¯†ï¼Œå› ä¸ºåå•†æˆåŠŸå®Œæˆï¼Œæ‰€ä»¥å¿…é¡»åœ¨æ­¤ä¹‹å‰å‘é€ä¸€ä¸ª<code>ChangeCipherSpec</code>åè®®æ¶ˆæ¯æ¥æ¿€æ´»åŠ å¯†ã€‚Finishæ¶ˆæ¯åŒ…å«ä¸€ä¸ªç”¨æ‰€æœ‰å…ˆå‰çš„æ¡æ‰‹æ¶ˆæ¯ç»„åˆçš„å“ˆå¸Œï¼Œå…¶åæ˜¯è¯†åˆ«æœåŠ¡å™¨/å®¢æˆ·ç«¯è§’è‰²çš„ç‰¹æ®Šå·ç ï¼Œä¸»å¯†é’¥å’Œå¡«å……ã€‚æ‰€äº§ç”Ÿçš„å“ˆå¸Œä¸<code>CertificateVerify</code>å“ˆå¸Œä¸åŒï¼Œå› ä¸ºå­˜åœ¨æ›´å¤šçš„æ¡æ‰‹æ¶ˆæ¯ã€‚</li>
</ul>
<p><img src="/img/finish.png" alt="finish"></p>
<h2 id="ChangeCipherSpecåè®®æ ¼å¼"><a href="#ChangeCipherSpecåè®®æ ¼å¼" class="headerlink" title="ChangeCipherSpecåè®®æ ¼å¼"></a>ChangeCipherSpecåè®®æ ¼å¼</h2><p>è¿™æ˜¯æœ€ç®€å•çš„åè®®ï¼šå®ƒåªæœ‰ä¸€æ¡æ¶ˆæ¯ã€‚è¯¥æ¶ˆæ¯å¿…é¡»æ˜¯å•ç‹¬çš„åè®®è€Œä¸æ˜¯æ¡æ‰‹åè®®çš„ä¸€éƒ¨åˆ†çš„åŸå› æ˜¯ç”±äºè®°å½•å±‚å°è£…ï¼ˆRecord Layer encapsulationï¼‰ã€‚ TLSåè®®åŒæ—¶å¯¹æ•´ä¸ªè®°å½•å±‚æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚ ChangeCipherSpecæ¶ˆæ¯è¡¨ç¤ºåŠ å¯†çš„æ¿€æ´»ï¼Œå¹¶ä¸”ç”±äºåŠ å¯†ä¸èƒ½åº”ç”¨äºæ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä»»ä½•å…¶ä»–æ¶ˆæ¯éƒ½ä¸å¯èƒ½éµå¾ªChangeCipherSpecã€‚é¿å…è¿™äº›ç»„åˆçš„æœ€ä½³æ–¹æ³•æ˜¯å°†æ­¤æ¶ˆæ¯å‡çº§ä¸ºåè®®çŠ¶æ€ã€‚</p>
<p>ä¸‹é¢å±•ç¤ºChangeCipherSpecæ¶ˆæ¯æ˜¯å¦‚ä½•æ„é€ çš„ï¼š</p>
<p><img src="/img/change_cipher_spec.png" alt="change cipher spec"></p>
<h2 id="Alertåè®®æ ¼å¼"><a href="#Alertåè®®æ ¼å¼" class="headerlink" title="Alertåè®®æ ¼å¼"></a>Alertåè®®æ ¼å¼</h2><p>è­¦æŠ¥åè®®ä¹Ÿå¾ˆç®€å•ã€‚å®ƒå®šä¹‰äº†ä¸¤ä¸ªå­—æ®µï¼šä¸¥é‡æ€§çº§åˆ«å’Œè­¦æŠ¥æè¿°ã€‚ç¬¬ä¸€ä¸ªå­—æ®µè¡¨ç¤ºè­¦æŠ¥çš„ä¸¥é‡æ€§ï¼ˆè­¦å‘Šä¸º1ï¼Œè‡´å‘½çš„2ï¼‰ï¼Œè€Œç¬¬äºŒä¸ªå­—æ®µåˆ™è¡¨ç¤ºå‡†ç¡®çš„æ¡ä»¶ã€‚æ”¯æŒçš„è­¦æŠ¥æè¿°å–å†³äºSSL/TLSç‰ˆæœ¬ã€‚</p>
<p><img src="/img/alert_protocol_format.png" alt="alert protocol format"></p>
<h2 id="ApplicationDataåè®®æ ¼å¼"><a href="#ApplicationDataåè®®æ ¼å¼" class="headerlink" title="ApplicationDataåè®®æ ¼å¼"></a>ApplicationDataåè®®æ ¼å¼</h2><p>è¯¥åè®®çš„ä»»åŠ¡æ˜¯æ­£ç¡®åœ°å°è£…æ¥è‡ªç½‘ç»œå †æ ˆçš„åº”ç”¨å±‚çš„æ•°æ®ï¼Œä»è€Œå¯ä»¥é€šè¿‡åº•å±‚åè®®ï¼ˆTCPï¼‰æ— ç¼åœ°å¤„ç†æ•°æ®ï¼Œè€Œä¸ä¼šå¼ºåˆ¶æ›´æ”¹ä»»ä½•è¿™äº›å±‚ã€‚æ­¤åè®®ä¸­æ¶ˆæ¯çš„æ ¼å¼éµå¾ªä¸ä»¥å‰åè®®ç›¸åŒçš„ç»“æ„ã€‚</p>
<p><img src="/img/application_protocol_format.png" alt="applicationdata protocol format"></p>
<h2 id="åˆ†æSSL-TLSæµé‡"><a href="#åˆ†æSSL-TLSæµé‡" class="headerlink" title="åˆ†æSSL/TLSæµé‡"></a>åˆ†æSSL/TLSæµé‡</h2><p>æˆ‘å°†ä½¿ç”¨Wiresharkè¿›è¡ŒæŠ“åŒ…ã€‚å®¢æˆ·ç«¯åŸºäºSchemeçš„æ–¹å¼æ”¯æŒSSL/TLSï¼ŒæœåŠ¡ç«¯æ˜¯OpenSSLåˆ†å‘çš„ä¸€éƒ¨åˆ†ï¼ˆå…·æœ‰è¯ä¹¦ï¼‰ã€‚æœåŠ¡å™¨ç›‘å¬åœ¨443ç«¯å£ï¼Œæ‰€æœ‰é€šä¿¡å°†é€šè¿‡ç¯å›è®¾å¤‡è¿›è¡Œã€‚åœ¨Wiresharkä¸­å°†è§†å›¾é™åˆ¶ä¸ºTLSæ•°æ®åŒ…çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨åè®®è¿‡æ»¤å™¨â€œsslâ€ã€‚</p>
<h3 id="ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰"><a href="#ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰" class="headerlink" title="ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰"></a>ç¬¬ä¸€ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰</h3><p>ä¸€æ—¦æœåŠ¡å™¨è¿è¡Œå¹¶ç­‰å¾…è¿æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥å¯åŠ¨å®ƒã€‚è¿™æ˜¯å®¢æˆ·ç«¯å‘é€çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…</p>
<p><img src="/img/first_flight.png" alt="first flight"></p>
<h3 id="ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰"><a href="#ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰" class="headerlink" title="ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰"></a>ç¬¬äºŒä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰</h3><p>ç¬¬ä¸€ä¸ªåŒ…åªåŒ…å«ä¸€ä¸ªä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„TLSæ¡æ‰‹æ¶ˆæ¯ï¼ˆClientHelloï¼‰ã€‚ç„¶è€Œï¼ŒæœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ä½œä¸ºClientHelloå“åº”çš„ä¸‹ä¸€ä¸ªTCPæ•°æ®åŒ…æºå¸¦3ä¸ªæ¡æ‰‹æ¶ˆæ¯ã€‚è¿™äº›æ¶ˆæ¯æ˜¯ServerHelloï¼ŒCertificateå’ŒServerHelloDoneï¼ˆæ²¡æœ‰å‘é€ServerKeyExchangeæˆ–CertificateRequestï¼‰ã€‚åœ¨ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ä¹‹åï¼Œæˆ‘å°†çœç•¥è¾ƒä½çš„å †æ ˆåè®®ï¼ˆTCP/IPï¼‰ã€‚</p>
<p><img src="/img/second_flight.png" alt="second flight"></p>
<h3 id="ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰"><a href="#ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-gt-æœåŠ¡ç«¯ï¼‰" class="headerlink" title="ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰"></a>ç¬¬ä¸‰ä¸ªåŒ…ï¼ˆå®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼‰</h3><p>ç›®å‰çœ‹ä¸Šå»éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä¸ä¸Šè¿°çš„åè®®ä¸€è‡´ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç°åœ¨å·²ç»åŒæ„ä½¿ç”¨çš„ç®—æ³•ï¼ˆå¯†é’¥äº¤æ¢çš„RSAï¼Œå¯¹ç§°åŠ å¯†çš„AES-256-CBCå’Œæ¶ˆæ¯æ•£åˆ—çš„SHAï¼‰ï¼Œå‹ç¼©ï¼ˆæ— å‹ç¼©ï¼‰å’Œä½¿ç”¨çš„TLSæ‰©å±•ï¼ˆSessionTicket TLSï¼Œé‡æ–°è°ˆåˆ¤ä¿¡æ¯ï¼‰ã€‚æ­¤å¤–ï¼Œå®¢æˆ·ç«¯ç°åœ¨æ‹¥æœ‰æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œå› æ­¤å¯ä»¥å†³å®šæ˜¯å¦ä¿¡ä»»æœåŠ¡å™¨ã€‚ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ç”±å®¢æˆ·ç«¯å‘é€ï¼Œå¹¶æºå¸¦ä»¥ä¸‹æ¶ˆæ¯ï¼šClientKeyExchangeï¼ŒChangeCipherSpecï¼ŒFinishedï¼ˆå·²ç»åŠ å¯†ï¼‰ã€‚</p>
<p><img src="/img/third_flight.png" alt="third flight"></p>
<h3 id="ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰"><a href="#ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-gt-å®¢æˆ·ç«¯ï¼‰" class="headerlink" title="ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰"></a>ç¬¬å››ä¸ªåŒ…ï¼ˆæœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼‰</h3><p>åœ¨å®¢æˆ·ç«¯å‘é€ChangeCipherSpecå’ŒFinishedä¹‹åï¼ŒæœåŠ¡å™¨é¢„æœŸæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œä»¥ä¾¿åŒå‘å¯åŠ¨é‡‡ç”¨å¯¹ç§°å¯†é’¥å’Œæ‰€æœ‰åå•†çš„å¯†ç å¥—ä»¶å‚æ•°çš„åŠ å¯†é€šä¿¡ã€‚æœåŠ¡å™¨å¿…é¡»å‘é€è‡ªå·±çš„ChangeCipherSpecå’ŒFinishedçš„æ¶ˆæ¯ï¼Œä»¥ä½¿æ¡æ‰‹è¿‡ç¨‹å¯ä»¥è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚åœ¨è¿™ä¸ªæ¶ˆæ¯ä¸­å‘ç”Ÿçš„ä¸€ä»¶éå¸¸æœ‰è¶£çš„äº‹æƒ…æ˜¯ï¼Œæˆ‘ä»¬çœ‹åˆ°å…¶ä¸­ä¸€ä¸ªæ‰©å±•ï¼Œæ‰©å±•åç§°ä¸ºTransport Layer Securityï¼ˆä¼ è¾“å±‚å®‰å…¨TLSï¼‰ä¼šè¯æ¢å¤ï¼Œè€Œæ— éœ€æœåŠ¡å™¨ç«¯çŠ¶æ€ï¼Œå®ƒæ˜ç¡®è¯´æ˜äº†å®ƒçš„ä½œç”¨ã€‚ä½ åº”è¯¥è®°å¾—ï¼Œå®ƒè¢«è¦æ±‚ä½œä¸ºæˆ‘ä»¬çš„ClientHelloçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ç”±æœåŠ¡å™¨åœ¨å…¶ServerHelloä¸­å®ç°ã€‚æœ‰å…³ä¸æ­¤æ‰©å±•ç›¸å…³çš„æ¶ˆæ¯çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥æ‰¾<a href="http://www.ietf.org/rfc/rfc5077.txt" target="_blank" rel="external">RFC5077</a>è§„èŒƒã€‚å¦‚æ–‡æ¡£ä¸­æ‰€è¿°ï¼Œæ­¤æ‰©å±•æ¡æ‰‹æ¶ˆæ¯å·²è¢«åˆ†é…å·ç 4ã€‚</p>
<p><img src="/img/fourth_flight.png" alt="fourth flight"></p>
<h3 id="åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯-lt-gt-æœåŠ¡ç«¯ï¼‰"><a href="#åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯-lt-gt-æœåŠ¡ç«¯ï¼‰" class="headerlink" title="åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯&lt;-&gt;æœåŠ¡ç«¯ï¼‰"></a>åº”ç”¨å±‚æ•°æ®ï¼ˆå®¢æˆ·ç«¯&lt;-&gt;æœåŠ¡ç«¯ï¼‰</h3><p>æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®Œæˆæ¡æ‰‹ã€‚åŠ å¯†é€šä¿¡å°±ä½ï¼Œåº”ç”¨æ•°æ®å¯ä»¥å®‰å…¨ä¼ è¾“ã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è®°å½•ï¼Œå•ä¸ªTCPæ•°æ®åŒ…å¯ä»¥æºå¸¦å‡ ä¸ªæ¶ˆæ¯ï¼š</p>
<p><img src="/img/application_data.png" alt="application data"></p>
<h3 id="å…³é—­è¿æ¥"><a href="#å…³é—­è¿æ¥" class="headerlink" title="å…³é—­è¿æ¥"></a>å…³é—­è¿æ¥</h3><p>ç”±äºæˆ‘ä»¬çš„è¿æ¥æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥æƒ³çŸ¥é“åœ¨æ•°æ®åŒ…ä¸­å‘é€ä»€ä¹ˆçš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿Wiresharkæˆ–ç±»ä¼¼çš„å·¥å…·çŸ¥é“ä¼ è¾“ä¸­ä½¿ç”¨çš„å¯†é’¥ã€‚å°½ç®¡è¿™æ˜¯å¯èƒ½çš„ï¼Œæˆ‘è®¤ä¸ºä¸ºäº†åˆ†æçš„ç›®çš„ï¼Œå½“å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿æ¥æ—¶ï¼ŒçŸ¥é“å®¢æˆ·ç«¯ä¼šå‘å‡ºä¸€ä¸ªè­¦å‘Šæ¶ˆæ¯å°±è¶³å¤Ÿäº†ã€‚æ­¤è­¦æŠ¥æ¶ˆæ¯çš„ç±»å‹åº”ä¸ºCloseNotifyï¼ˆç±»å‹0ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å°†æ— æ³•ä»åŸå§‹æ•°æ®ä¸­çœ‹åˆ°å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ˜¯ä»¥ä¸‹è­¦æŠ¥æ¶ˆæ¯çš„å‘ä»¶äººï¼š</p>
<p><img src="/img/closing_connection.png" alt="closing message"></p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä»æµé‡åˆ†æå¯ä»¥çœ‹å‡ºï¼Œæ ‡å‡†åº“å’Œå®¢æˆ·ç«¯çš„å®ç°éµå¾ªäº†TLS 1.0è§„èŒƒã€‚å¸Œæœ›è¿™å¯¹æ‚¨äº†è§£SSL/TLSåè®®çš„å†…éƒ¨æœºåˆ¶æ˜¯æœ‰ç”¨çš„ã€‚æˆ‘å‘ç°æ£€æŸ¥åå…­è¿›åˆ¶åŸå§‹æ•°æ®ï¼ˆç‰¹åˆ«æ˜¯åƒWiresharkè¿™æ ·å¼ºå¤§çš„å·¥å…·ï¼‰æ˜¯ä¸€ç§éå¸¸æœ‰æ„ä¹‰å’Œæœ‰è¶£çš„å·¥ä½œæ–¹å¼ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/19/Djangoå¤–é”®èµ‹å€¼/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/19/Djangoå¤–é”®èµ‹å€¼/" itemprop="url">Djangoå¤–é”®èµ‹å€¼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-12-19T10:46:48+08:00">
                2016-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Django/" itemprop="url" rel="index">
                    <span itemprop="name">Django</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>class Article(models.Model):
    title = models.CharField(max_length=1024, default=&apos;&apos;)
    ...
    def __str__(self):
        return &apos;Article pk:%d %s&apos; % (self.pk, self.title[:30])

class ArticleContent(models.Model):
    article = cached_fields.OneToOneField(Article)
    ...
</code></pre><p>å†™ä»£ç çš„çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡ï¼Œå½“æˆ‘ç»™ä¸€ä¸ªinstanceçš„å¤–é”®ï¼ˆä»¥_idç»“å°¾ï¼‰èµ‹å€¼ï¼ˆæ•°å­—ï¼‰çš„æ—¶å€™    ï¼Œè¿™ä¸ªå¤–é”®å¯¹åº”çš„instanceçš„å€¼å¹¶ä¸ä¼šæ”¹å˜ã€‚</p>
<pre><code>In [44]: ac = ArticleContent.objects.get(article_id=14269)
In [45]: ac.article_id
Out[45]: 14269
In [46]: ac.article_id = 14266
In [47]: ac.save()
In [48]: ac.article
Out[48]: &lt;Article: Article pk:14266 EC: Russia, Ukraine to Meet in&gt;
In [49]: ac.article.pk
Out[49]: 14266
</code></pre><p>å¦‚ä¸Šé¢çš„ä»£ç æ‰€ç¤ºï¼Œä¸ºäº†æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆ‘ç¿»äº†ä¸€ä¸‹Djangoçš„æºç ï¼š</p>
<pre><code>django/db/models/fields/related_descriptors.py 
145     def __get__(self, instance, cls=None):
146         &quot;&quot;&quot;
147         Get the related instance through the forward relation.
148
149         With the example above, when getting ``child.parent``:
150
151         - ``self`` is the descriptor managing the ``parent`` attribute
152         - ``instance`` is the ``child`` instance
153         - ``cls`` is the ``Child`` class (we don&apos;t need it)
154         &quot;&quot;&quot;
155         if instance is None:
156             return self
157
158         # The related instance is loaded from the database and then cached in
159         # the attribute defined in self.cache_name. It can also be pre-cached
160         # by the reverse accessor (ReverseOneToOneDescriptor).
161         try:
162             rel_obj = getattr(instance, self.cache_name)
163         except AttributeError:
164             val = self.field.get_local_related_value(instance)
165             if None in val:
166                 rel_obj = None
167             else:
168                 qs = self.get_queryset(instance=instance)
169                 qs = qs.filter(self.field.get_reverse_related_filter(instance))
170                 # Assuming the database enforces foreign keys, this won&apos;t fail.
171                 rel_obj = qs.get()
172                 # If this is a one-to-one relation, set the reverse accessor
173                 # cache on the related object to the current instance to avoid
174                 # an extra SQL query if it&apos;s accessed later on.
175                 if not self.field.remote_field.multiple:
176                     setattr(rel_obj, self.field.remote_field.get_cache_name(), instance)
177             setattr(instance, self.cache_name, rel_obj)
178
179         if rel_obj is None and not self.field.null:
180             raise self.RelatedObjectDoesNotExist(
181                 &quot;%s has no %s.&quot; % (self.field.model.__name__, self.field.name)
182             )
183         else:
184             return rel_obj
</code></pre><p>æ³¨é‡Šå¾—éå¸¸åˆ°ä½ï¼Œå½“æˆ‘ä»¬è¯·æ±‚<code>ac.article</code>çš„æ—¶å€™ï¼Œä¼šå…ˆå»æ£€æŸ¥å¯¹åº”çš„cacheï¼ˆåœ¨è¿™é‡Œæ˜¯<code>_article_cache</code>ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»çœ‹<code>cache_name</code>çš„ç”Ÿæˆè§„åˆ™ï¼Œå°±æ˜¯å¤–é”®åå‰é¢åŠ ä¸‹åˆ’çº¿ï¼Œåé¢åŠ cacheï¼‰å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨é‚£ä¹ˆå°±è¿›è¡Œæ•°æ®åº“è¯·æ±‚ï¼Œè¯·æ±‚å®Œä¹‹åä¼šä¿å­˜åˆ°cacheä¸­ã€‚</p>
<p>æˆ‘ä»¬å†çœ‹çœ‹<code>__set__</code>ï¼Œä»£ç å¤ªé•¿å°±ä¸è´´äº†ï¼ˆå°±åœ¨<code>__get__</code>æ–¹æ³•ä¸‹é¢ï¼‰ã€‚é™¤äº†ç»™å¤–é”®å­—æ®µï¼ˆ<code>article</code>ï¼‰èµ‹å€¼å¤–ï¼Œè¿˜ä¼šå°†pkå­—æ®µï¼ˆ<code>article_id</code>ï¼Œæ˜¯<code>lh_field.attname</code>çš„å€¼ï¼‰è®¾ç½®ä¸ºNoneï¼Œè¿™æ ·ä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™å°±èƒ½æ‹¿åˆ°æ­£ç¡®çš„å€¼ã€‚</p>
<p>ä»¥ä¸Šéƒ½æ˜¯ForeignKeyçš„Magicï¼Œè€Œå½“æˆ‘ä»¬ç»™<code>article_id</code>èµ‹å€¼çš„æ—¶å€™ï¼Œåªæ˜¯åœ¨ç»™ä¸€ä¸ªæ™®é€šçš„attributeèµ‹å€¼è€Œå·²ï¼Œæ²¡æœ‰ä»»ä½•magicï¼Œä¸ä¼šæ¸…ç†å¯¹åº”å¤–é”®çš„cacheï¼Œè¿™æ—¶å€™æ‹¿åˆ°çš„instanceä»ç„¶æ˜¯cacheä¸­åŸæ¥çš„é‚£ä¸ªinstanceã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/03/Django-rediså¦‚ä½•æ”¯æŒå­˜å–æ•´å‹å’Œå¸ƒå°”å€¼/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/03/Django-rediså¦‚ä½•æ”¯æŒå­˜å–æ•´å‹å’Œå¸ƒå°”å€¼/" itemprop="url">Django-rediså¦‚ä½•æ”¯æŒå­˜å–æ•´å‹å’Œå¸ƒå°”å€¼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-11-03T05:16:48+08:00">
                2016-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Django/" itemprop="url" rel="index">
                    <span itemprop="name">Django</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>redisæ”¯æŒ5ç§æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œhashï¼ˆå“ˆå¸Œï¼‰ï¼Œlistï¼ˆåˆ—è¡¨ï¼‰ï¼Œsetï¼ˆé›†åˆï¼‰åŠzset(sorted setï¼šæœ‰åºé›†åˆ)ã€‚æ•´å‹å€¼å’Œå¸ƒå°”å€¼å¹¶ä¸åœ¨å…¶ä¸­ã€‚å­˜å‚¨æ•´å‹å’Œå¸ƒå°”å€¼æ—¶ï¼Œredisä¼šå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p>
<pre><code>127.0.0.1:6379&gt; SET test_key 1
OK
127.0.0.1:6379&gt; GET test_key
&quot;1&quot;
127.0.0.1:6379&gt; SET test_key True
OK
127.0.0.1:6379&gt; GET test_key
&quot;True&quot;
127.0.0.1:6379&gt; SET test_key TRUE
OK
127.0.0.1:6379&gt; GET test_key
&quot;TRUE&quot;
127.0.0.1:6379&gt; SET test_key true
OK
127.0.0.1:6379&gt; GET test_key
&quot;true&quot;
</code></pre><p>ä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨äº†<code>django-redis</code>ä¹‹åå‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸å­˜å–æ•´å‹å’Œå¸ƒå°”å€¼ï¼Œè¿™æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿç­”æ¡ˆè‡ªç„¶æ˜¯åœ¨æºç ä¸­ï¼Œç›´è§‰å‘Šè¯‰æˆ‘ä»¬ï¼Œ<code>setå‡½æ•°</code>é‡Œä¸€å®šåšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<pre><code># django_redis.client.default.py
def set(self, key, value, timeout=DEFAULT_TIMEOUT, version=None, client=None, nx=False, xx=False):
    &quot;&quot;&quot;
    Persist a value to the cache, and set an optional expiration time.
    Also supports optional nx parameter. If set to True - will use redis setnx instead of set.
    &quot;&quot;&quot;

    if not client:
        client = self.get_client(write=True)

    nkey = self.make_key(key, version=version)
    nvalue = self.encode(value)

    ......
</code></pre><p><code>set</code>æ–¹æ³•ä¸­è°ƒç”¨äº†ç±»çš„<code>encode</code>çš„æ–¹æ³•å¯¹<code>value</code>è¿›è¡Œäº†å¤„ç†ï¼Œæˆ‘ä»¬å†çœ‹<code>encode</code>ï¼š</p>
<pre><code>django_redis.client.default.py
def encode(self, value): &quot;&quot;&quot; Encode the given value. &quot;&quot;&quot;

if isinstance(value, bool) or not isinstance(value, integer_types):
    value = self._serializer.dumps(value)
    value = self._compressor.compress(value)
    return value

return value
</code></pre><p>çœ‹åˆ°äº†å§ï¼Œå¦‚æœæ˜¯<code>å¸ƒå°”å€¼</code>ï¼Œé‚£ä¹ˆè¦è°ƒç”¨ä¸€ä¸ª<code>dumps</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ‰¾åˆ°è¿™ä¸ª<code>dumps</code>æ–¹æ³•ï¼š</p>
<pre><code>django_redis.serializers.pickle.py
class PickleSerializer(BaseSerializer): ......

def dumps(self, value):
    return pickle.dumps(value, self._pickle_version)

def loads(self, value):
    return pickle.loads(force_bytes(value))
</code></pre><p>åŸæ¥æ˜¯ç”¨äº†<a href="https://docs.python.org/3/library/pickle.html" target="_blank" rel="external">pickle</a>æ¥åšäº†åºåˆ—åŒ–ï¼Œè¿™æ ·æ‹¿å‡ºæ¥çš„æ—¶å€™è°ƒç”¨<code>pickle.loads</code>æ–¹æ³•ï¼Œå°±å¯ä»¥è¿˜åŸä¸ºåŸæ¥çš„å¯¹è±¡äº†ã€‚è¿™ä¹Ÿæ˜¯<code>django-redis</code>æ”¯æŒå­˜å‚¨ä»»æ„<code>python</code>å¯¹è±¡çš„åŸå› ï¼Œ<a href="https://docs.python.org/3/library/pickle.html" target="_blank" rel="external">pickle</a>å¸®äº†å¤§å¿™ã€‚</p>
<p>è‡³äº<code>int</code>çš„å­˜å–å°±ç®€å•äº†ï¼Œæˆ‘ä»¬ä»<code>get</code>æ–¹æ³•çœ‹è¿‡å»ï¼š</p>
<pre><code>django_redis.client.default.py
def get(self, key, default=None, version=None, client=None): &quot;&quot;&quot; Retrieve a value from the cache. Returns decoded value if key is found, the default if not. &quot;&quot;&quot; if client is None: client = self.get_client(write=False)

key = self.make_key(key, version=version)

try:
    value = client.get(key)
except _main_exceptions as e:
    raise ConnectionInterrupted(connection=client, parent=e)

if value is None:
    return default

return self.decode(value)
</code></pre><p>å¯ä»¥çœ‹åˆ°å¯¹ä»<code>redis</code>ä¸­å–å‡ºæ¥çš„å€¼è°ƒç”¨äº†<code>decode</code>æ–¹æ³•ï¼š</p>
<pre><code>django_redis.client.default.py
def decode(self, value): 
&quot;&quot;&quot; 
Decode the given value. 
&quot;&quot;&quot; 
try: 
    value = int(value)
except (ValueError, TypeError):
    try:
        value = self._compressor.decompress(value)
    except CompressorError:
        # Handle little values, chosen to be not compressed pass
        value = self._serializer.loads(value) return value
</code></pre><p>ä¸€ç›®äº†ç„¶äº†å§ï¼Œæ€»ç»“çš„è¯å°±æ˜¯ï¼š<code>redis</code>å­˜çš„æ—¶å€™è¿˜æ˜¯å­˜çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å–å‡ºæ¥çš„æ—¶å€™ä¼šå°è¯•å»<code>int</code>ä¸€ä¸‹ã€‚</p>
<p>å¤§å®¶å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼Œå¦‚æœå€¼æ˜¯<code>&#39;123&#39;</code>è¿™æ ·çš„å­—ç¬¦ä¸²æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ ·å¹¶ä¸ä¼šæœ‰é—®é¢˜å•¦ï¼Œå› ä¸ºå­—ç¬¦ä¸²å­˜åˆ°æ•°æ®åº“ä¹‹å‰ä¼šå…ˆåš<code>pickle.dumps</code>ï¼Œè¿™æ ·å°±å¯ä»¥åŒºåˆ†å¼€<strong>æ•°å­—è½¬æ¢æˆçš„å­—ç¬¦ä¸²</strong>å’Œ<strong>çœŸå®çš„å­—ç¬¦ä¸²</strong>äº†ã€‚</p>
<p>å¦å¤–ï¼Œå°†<code>æ•´å‹</code>è¿›è¡Œ<code>pickle</code>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å› ä¸ºæ•°å­—çš„å­˜å‚¨æ˜¯å¾ˆå¹³å¸¸çš„éœ€æ±‚ï¼Œè€Œ<code>pickle</code>ä¹‹åä¼šå¸¦ä¸Šå¯¹è±¡çš„å„ç§é™„åŠ ä¿¡æ¯ï¼Œä¼šå¢åŠ ç©ºé—´æ¶ˆè€—ï¼Œæ‰€ä»¥ä½œè€…æ‰æœ‰äº†è¿™æ ·çš„è®¾è®¡ã€‚</p>
<p>å¦‚æœå¤§å®¶éœ€è¦å†™è‡ªå·±çš„<code>redis client</code>çš„è¯ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™äº›è®¾è®¡ï¼Œä¼šç»™ä½¿ç”¨å¸¦æ¥å¾ˆå¤§çš„æ–¹ä¾¿ã€‚</p>
<p><strong>Note</strong>: <code>Python3</code> ä¸­<code>pickle</code>å’Œ<code>cPickle</code>å·²ç»åˆå¹¶ä¸º<code>pickle</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/17/Django-modelå»æ‰unique_togetheræŠ¥é”™/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/17/Django-modelå»æ‰unique_togetheræŠ¥é”™/" itemprop="url">Django modelå»æ‰unique_togetheræŠ¥é”™</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-10-17T08:46:48+08:00">
                2016-10-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Django/" itemprop="url" rel="index">
                    <span itemprop="name">Django</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œæˆ‘æœ‰ä¸€ä¸ªå­˜å‚¨è€ƒè¯•çš„è¡¨</p>
<pre><code>class Exam(models.Model):
    category = models.ForiegnKey(Category)
    name = models.CharField(max_length=128)
    date = models.DateField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        unique_together = (&apos;category&apos;, &apos;date&apos;)
</code></pre><p>categoryè¡¨ç¤ºè€ƒè¯•çš„ç±»å‹ï¼Œdateè¡¨ç¤ºè€ƒè¯•çš„æ—¥æœŸã€‚å»ºè¡¨çš„æ—¶å€™è€ƒè™‘åˆ°ä¸€ä¸ªç±»å‹çš„è€ƒè¯•åœ¨åŒä¸€ä¸ªåº”è¯¥åªæœ‰ä¸€ä¸ªè€ƒè¯•ï¼Œæ‰€ä»¥å°±åŠ äº†ä¸€ä¸ª<code>unique_together</code>ã€‚ä½†æ˜¯ç”±äºä¸šåŠ¡éœ€è¦ï¼Œè¿™ä¸ªunique_togetherä¸éœ€è¦äº†ã€‚</p>
<p>ç”¨è¿‡djangoçš„äººéƒ½çŸ¥é“ï¼Œè¿™ä¸æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œåˆ æ‰<code>unique_together</code>çš„ä»£ç ï¼Œç„¶åmakemigrationså‘—ï¼Œç¡®å®ï¼Œæˆ‘å°±è¿™ä¹ˆåšäº†ã€‚ä½†æ˜¯å½“æˆ‘migrateçš„æ—¶å€™å´æŠ¥é”™äº†ï¼Œé”™è¯¯å¦‚ä¸‹ï¼š</p>
<pre><code>django.db.utils.OperationalError: (1553, &quot;Cannot drop index &apos;insurance_exam_category_id_a430e581_uniq&apos;: needed in a foreign key constraint&quot;)
</code></pre><p>æ•°æ®åº“ä¸è®©æˆ‘åˆ é™¤è¿™ä¸ªindexï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘æœ‰ä¸€ä¸ªå¤–é”®çº¦æŸç”¨åˆ°äº†è¿™ä¸ªå®ƒã€‚æˆ‘å°±å¥‡æ€ªäº†ï¼Œcategoryæ˜¯å¤–é”®æ²¡é”™ï¼Œä½†æ˜¯æˆ‘è¿™ä¸ªæ˜¯<code>unique_together</code>å•Šï¼Œæ€ä¹ˆå¯èƒ½æœ‰å“ªä¸ªå¤–é”®ç”¨åˆ°äº†å®ƒå‘¢ï¼Ÿ</p>
<p>æ²¡åŠæ³•ï¼Œæˆ‘åªèƒ½åˆ°æ•°æ®åº“é‡Œå¯»æ‰¾ç­”æ¡ˆï¼Œ<code>show create table exam</code>ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>| insurance_exam | CREATE TABLE `insurance_exam` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(128) NOT NULL,
  `date` date NOT NULL,
  `created_at` datetime(6) NOT NULL,
  `updated_at` datetime(6) NOT NULL,
  `category_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `insurance_exam_category_id_a430e581_uniq` (`category_id`,`date`),
  CONSTRAINT `insurance_exam_category_id_a2238260_fk_insurance_category_id` FOREIGN KEY (`category_id`) REFERENCES `insurance_category` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1062 DEFAULT CHARSET=utf8mb4 |
</code></pre><p>å¯ä»¥çœ‹åˆ°UNIQUE KEYé‚£ä¸€è¡Œå°±æ˜¯<code>unique_together</code>ï¼Œä¸‹é¢ä¸€è¡Œæ˜¯categoryå¤–é”®ã€‚æ²¡æœ‰å…¶ä»–ä¸œè¥¿äº†å•Šï¼Œåˆ°åº•å“ªä¸ªå¤–é”®ç”¨åˆ°äº†æˆ‘ä»¬çš„<code>unique_together</code>ï¼Ÿ</p>
<p>å¤–é”®åªèƒ½æ˜¯categoryäº†ï¼Œä¹Ÿæ²¡æœ‰åˆ«çš„å¤–é”®å•Šã€‚åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p>
<p>åŸå› æ˜¯è¿™æ ·çš„ï¼šåœ¨Mysqlä¸­å¤–é”®ä¼šè‡ªåŠ¨åœ¨è¡¨ä¸Šæ·»åŠ ä¸€ä¸ªindexï¼Œä¹Ÿå°±è¯´å¦‚æœæ²¡æœ‰unique_togetherï¼Œæˆ‘ä»¬çš„è¡¨åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>| insurance_exam | CREATE TABLE `insurance_exam` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(128) NOT NULL,
  `date` date NOT NULL,
  `created_at` datetime(6) NOT NULL,
  `updated_at` datetime(6) NOT NULL,
  `category_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `category_id` (`category_id`),
  CONSTRAINT `insurance_exam_category_id_a2238260_fk_insurance_category_id` FOREIGN KEY (`category_id`) REFERENCES `insurance_category` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1062 DEFAULT CHARSET=utf8mb4 |
</code></pre><p>ä½†æ˜¯å› ä¸ºæœ‰äº†<code>unique_together</code>çš„<code>unique_key</code>ï¼Œå¹¶ä¸”categoryåœ¨è”åˆç´¢å¼•çš„å·¦è¾¹ï¼Œæ ¹æ®æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œcategoryçš„ç´¢å¼•å°±æœ‰äº†ï¼Œæ‰€ä»¥å°±ä¸ä¼šå¦å¤–å»ºç´¢å¼•ï¼Œè¿™ä¸ªæ—¶å€™categoryçš„å¤–é”®çº¦æŸå°±ä¾èµ–äº†è¿™ä¸ª<code>unique_key</code>ï¼Œæ‰€ä»¥åˆ é™¤çš„æ—¶å€™ä¼šå‡ºç°é‚£æ ·çš„æŠ¥é”™ã€‚</p>
<p>æœºæ™ºçš„å°ä¼™ä¼´åº”è¯¥æƒ³åˆ°äº†ï¼Œå¦‚æœæˆ‘ä»¬è¦å»æ‰<code>unique_together</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†categoryçš„KEYåŠ å›å»ï¼Œè¿™æ ·å°±å¯ä»¥å°†<code>unique_together</code>åˆ æ‰äº†ã€‚sqlå¦‚ä¸‹ï¼š</p>
<pre><code>alter table exam add index(category_id);
</code></pre><p>è¿™æ ·ï¼Œmigrateå°±èƒ½æˆåŠŸäº†ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/10/python-string-intern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/10/python-string-intern/" itemprop="url">python_string_intern</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-07-10T10:12:09+08:00">
                2016-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™ç¯‡æ–‡ç« ä¼šä»‹ç»<code>CPython 2.7.12</code>ä¸­å­—ç¬¦ä¸²<code>intern</code>çš„çŸ¥è¯†ã€‚</p>
<p>é¦–å…ˆä¸¾ä¸€ä¸ªä¾‹å­è¯´æ˜å†…ç½®çš„<code>intern</code>å‡½æ•°çš„ç”¨æ³•ï¼š</p>
<pre><code>&gt;&gt;&gt; s1 = &apos;foo!&apos;
&gt;&gt;&gt; s2 = &apos;foo!&apos;
&gt;&gt;&gt; s1 is s2
False
&gt;&gt;&gt; s1 = intern(&apos;foo!&apos;)
&gt;&gt;&gt; s1
&apos;foo!&apos;
&gt;&gt;&gt; s2 = intern(&apos;foo!&apos;)
&gt;&gt;&gt; s1 is s2
True
</code></pre><p>ä½ åº”è¯¥å·²ç»ä½“ä¼šåˆ°äº†ç”¨æ³•ï¼Œä½†æ˜¯ï¼Œåœ¨<code>python</code>å†…éƒ¨å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿ</p>
<h2 id="String-Internï¼ˆå­—ç¬¦ä¸²é©»ç•™ï¼‰"><a href="#String-Internï¼ˆå­—ç¬¦ä¸²é©»ç•™ï¼‰" class="headerlink" title="String Internï¼ˆå­—ç¬¦ä¸²é©»ç•™ï¼‰"></a>String Internï¼ˆå­—ç¬¦ä¸²é©»ç•™ï¼‰</h2><p>###<code>PyStringObject</code>ç»“æ„ä½“</p>
<p>æˆ‘ä»¬éœ€è¦æ·±å…¥<code>CPython</code>çš„æºç ï¼Œè¡¨ç¤º<code>Python</code>å­—ç¬¦ä¸²çš„<code>C</code>ç»“æ„ä½“<code>PyStringObject</code>åœ¨<code>stringobject.h</code>æ–‡ä»¶ä¸­ï¼š</p>
<pre><code>typedef struct {
    PyObject_VAR_HEAD
    long ob_shash;
    int ob_sstate;
    char ob_sval[1];

    /* Invariants:
     *     ob_sval contains space for &apos;ob_size+1&apos; elements.
     *     ob_sval[ob_size] == 0.
     *     ob_shash is the hash of the string or -1 if not computed yet.
     *     ob_sstate != 0 iff the string object is in stringobject.c&apos;s
     *       &apos;interned&apos; dictionary; in this case the two references
     *       from &apos;interned&apos; to this object are *not counted* in ob_refcnt.
     */
} PyStringObject;
</code></pre><p>æ ¹æ®æ³¨é‡Šï¼Œå¦‚æœå­—ç¬¦ä¸²è¢«<code>interned</code>ï¼Œå˜é‡<code>ob_sstate</code>çš„å€¼å°†ä¸å†ç­‰äº<code>0</code>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥æ¥è§¦è¿™ä¸ªå˜é‡ï¼Œè€Œæ˜¯é€šè¿‡ä¸‹é¢å®šä¹‰çš„å®<code>PyString_CHECK_INTERNED</code>æ¥è¯»å–å®ƒï¼š</p>
<pre><code>#define PyString_CHECK_INTERNED(op) (((PyStringObject *)(op))-&gt;ob_sstate)
</code></pre><p>###internedå­—å…¸</p>
<p>ç„¶åï¼Œè®©æˆ‘ä»¬æ¥çœ‹<code>stringobject.c</code>ã€‚<code>24è¡Œ</code>å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œ<code>interned</code>å­—ç¬¦ä¸²å°†ä¼šå­˜æ”¾åœ¨è¿™ä¸ªå¯¹è±¡é‡Œã€‚</p>
<pre><code>static PyObject *interned;
</code></pre><p>å®é™…ä¸Šï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„<code>Python</code>å­—å…¸ï¼Œåœ¨ç¬¬<code>4744è¡Œ</code>è¢«åˆå§‹åŒ–</p>
<pre><code>interned = PyDict_New();
</code></pre><p>æœ€ç»ˆï¼Œæ‰€æœ‰çš„é­”æ³•éƒ½åœ¨ç¬¬<code>4731è¡Œ``PyString_InternInPlace</code>å‡½æ•°ä¸­å‘ç”Ÿã€‚ä¸‹é¢æ˜¯å‡½æ•°å®ç°ï¼š</p>
<pre><code>PyString_InternInPlace(PyObject **p)
{
    register PyStringObject *s = (PyStringObject *)(*p);
    PyObject *t;
    if (s == NULL || !PyString_Check(s))
        Py_FatalError(&quot;PyString_InternInPlace: strings only please!&quot;);
    /* If it&apos;s a string subclass, we don&apos;t really know what putting
       it in the interned dict might do. */
    if (!PyString_CheckExact(s))
        return;
    if (PyString_CHECK_INTERNED(s))
        return;
    if (interned == NULL) {
        interned = PyDict_New();
        if (interned == NULL) {
            PyErr_Clear(); /* Don&apos;t leave an exception */
            return;
        }
    }
    t = PyDict_GetItem(interned, (PyObject *)s);
    if (t) {
        Py_INCREF(t);
        Py_DECREF(*p);
        *p = t;
        return;
    }

    if (PyDict_SetItem(interned, (PyObject *)s, (PyObject *)s) &lt; 0) {
        PyErr_Clear();
        return;
    }
    /* The two references in interned are not counted by refcnt.
       The string deallocator will take care of this */
    Py_REFCNT(s) -= 2;
    PyString_CHECK_INTERNED(s) = SSTATE_INTERNED_MORTAL;
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>interned</code>å­—å…¸ä¸­çš„<code>keys</code>éƒ½æ˜¯æŒ‡å‘å­—ç¬¦ä¸²å¯¹è±¡çš„æŒ‡é’ˆï¼Œ<code>values</code>ä¹Ÿæ˜¯åŒæ ·çš„æŒ‡é’ˆã€‚å¦å¤–ï¼Œå­—ç¬¦ä¸²çš„æ´¾ç”Ÿç±»ä¸èƒ½è¢«<code>intern</code>ã€‚ä¸è€ƒè™‘<code>é”™è¯¯æ£€æŸ¥</code>å’Œ<code>å¼•ç”¨è®¡æ•°</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹ä¼ªä»£ç é‡å†™è¿™ä¸ªå‡½æ•°ï¼š</p>
<pre><code>interned = None

def intern(string):
    if string is None or not type(string) is str:
        raise TypeError

    if string.is_interned:
        return string

    if interned is None:
        global interned
        interned = {}

    t = interned.get(string)
    if t is not None:
        return t

    interned[string] = string
    string.is_interned = True
    return string
</code></pre><p>ç®€å•å§ï¼</p>
<p>###å­—ç¬¦ä¸²internçš„å¥½å¤„</p>
<p>####å…±äº«å¯¹è±¡</p>
<p>ä¸ºä»€ä¹ˆä½ è¦ä½¿ç”¨å­—ç¬¦ä¸²<code>intern</code>ï¼Ÿé¦–å…ˆï¼Œå…±äº«å­—ç¬¦ä¸²å¯¹è±¡å¯ä»¥å‡å°‘å†…å­˜å ç”¨ã€‚è®©æˆ‘ä»¬å›åˆ°ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œä¸€å¼€å§‹ï¼Œå˜é‡<code>s1</code>å’Œ<code>s2</code>æŒ‡å‘ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ã€‚</p>
<p><img src="http://guilload.com/assets/media/python-string-interning/foo.png" alt="The two variables reference two different objects"></p>
<p>åœ¨<code>intern</code>ä¹‹åï¼Œä»–ä»¬éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ã€‚ç¬¬äºŒä¸ªå¯¹è±¡å ç”¨çš„å†…å­˜è¢«èŠ‚çœä¸‹æ¥äº†ã€‚</p>
<p><img src="http://guilload.com/assets/media/python-string-interning/bar.png" alt="Now, the two variables reference the same object"></p>
<p>åœ¨å¤„ç†ä¸€äº›ä½ä¿¡æ¯ç†µçš„å¤§åˆ—è¡¨çš„æ—¶å€™ï¼Œ<code>intern</code>éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è§£æä¸€ä¸ªè¯­æ–™åº“ï¼Œwe could benefit from the very heavy-tailed distribution of word frequencies in human languages to intern strings to our advantageã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨<code>NLTK</code>æ¥å¯¼å…¥<code>Hamlet by Shakespeare</code>ï¼Œä½¿ç”¨<code>Heapy</code>æ¥è§‚å¯Ÿ<code>intern</code>å‰åå¯¹è±¡çš„å †æ ˆä½¿ç”¨ï¼š</p>
<pre><code>import guppy
import nltk

hp = guppy.hpy()
hp.setrelheap()

hamlet = nltk.corpus.shakespeare.words(&apos;hamlet.xml&apos;)
print hp.heap()

hamlet = [intern(wrd) for wrd in nltk.corpus.shakespeare.words(&apos;hamlet.xml&apos;)]
print hp.heap()



$ python intern.py

Partition of a set of 31187 objects. Total size = 1725752 bytes.
 Index  Count   %     Size   % Cumulative  % Kind (class / dict of class)
     0  31166 100  1394864  81   1394864  81 str
...

Partition of a set of 4555 objects. Total size = 547840 bytes.
 Index  Count   %     Size   % Cumulative  % Kind (class / dict of class)
     0      4   0   328224  60    328224  60 list
     1   4529  99   215776  39    544000  99 str
...
</code></pre><p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æå¤§åœ°å‡å°‘äº†å­—ç¬¦ä¸²å¯¹è±¡çš„æ•°é‡ï¼ˆä»<code>31187</code>å‡å°‘åˆ°<code>4555</code>ï¼‰ï¼Œå¹¶ä¸”å†…å­˜å ç”¨å‡å°‘äº†<code>6.5</code>å€</p>
<p>####æŒ‡é’ˆæ¯”è¾ƒ</p>
<p>ç¬¬äºŒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>O(1)</code>çš„æŒ‡é’ˆæ¯”è¾ƒæ¥ä»£æ›¿<code>O(n)</code>çš„å­—èŠ‚æ¯”è¾ƒ</p>
<p>ä¸ºäº†éªŒè¯è¿™ä¸ªï¼Œæˆ‘æµ‹é‡äº†åœ¨æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰çš„æ—¶ï¼Œ<code>intern</code>ä¸å¦åˆ†åˆ«çš„æ—¶é—´ã€‚ä¸‹é¢çš„å›¾åº”è¯¥èƒ½è¯´æœä½ ï¼š</p>
<p><img src="http://guilload.com/assets/media/python-string-interning/qux.png" alt="Pointer comparison vs. byte-per-byte comparison"></p>
<p>###Native interning</p>
<p>åœ¨ä¸€äº›æ¡ä»¶ä¸‹ï¼Œå­—ç¬¦ä¸²ä¼šè¢«åŸç”Ÿ<code>interning</code>ã€‚è¿˜æ˜¯ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ç”¨<code>foo</code>è€Œä¸æ˜¯<code>fooï¼</code>ï¼Œå­—ç¬¦ä¸²<code>s1</code>å’Œ<code>s2</code>å°±ä¼šè¢«è‡ªåŠ¨åœ°<code>intern</code>ã€‚</p>
<pre><code>&gt;&gt;&gt; s1 = &apos;foo&apos;
&gt;&gt;&gt; s2 = &apos;foo&apos;
&gt;&gt;&gt; s1 is s2
True
</code></pre><p>###Interned or not interned?</p>
<p>å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘ä¸€ç›´åœ¨æƒ³ï¼Œåœ¨åå°ï¼Œå­—ç¬¦ä¸²ä¼šæ ¹æ®ä¸€ä¸ªå‚è€ƒå­—ç¬¦ä¸²é•¿åº¦å’Œæ„æˆå®ƒä»¬çš„å­—ç¬¦çš„è§„åˆ™æ¥æ‰§è¡Œ<code>intern</code>ã€‚æˆ‘çš„æƒ³æ³•ç¦»æ­£ç¡®ç­”æ¡ˆå¾ˆè¿‘ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘æ“ä½œå‡ ç»„åˆ›å»ºæ–¹æ³•ä¸åŒçš„å­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘æ— æ³•æ¨æµ‹å‡ºè¿™æ¡è§„åˆ™åˆ°åº•æ˜¯ä»€ä¹ˆï¼</p>
<pre><code>&gt;&gt;&gt; &apos;foo&apos; is &apos;foo&apos;
True
&gt;&gt;&gt; &apos;foo!&apos; is &apos;foo!&apos;
False
&gt;&gt;&gt; &apos;foo&apos; + &apos;bar&apos; is &apos;foobar&apos;
True
&gt;&gt;&gt; &apos;&apos;.join([&apos;f&apos;]) is &apos;&apos;.join([&apos;f&apos;])
True
&gt;&gt;&gt; &apos;&apos;.join([&apos;f&apos;, &apos;o&apos;, &apos;o&apos;]) is &apos;&apos;.join([&apos;f&apos;, &apos;o&apos;, &apos;o&apos;])
False
&gt;&gt;&gt; &apos;a&apos; * 20 is &apos;aaaaaaaaaaaaaaaaaaaa&apos;
True
&gt;&gt;&gt; &apos;a&apos; * 21 is &apos;aaaaaaaaaaaaaaaaaaaaa&apos;
False
&gt;&gt;&gt; &apos;foooooooooooooooooooooooooooooo&apos; is &apos;foooooooooooooooooooooooooooooo&apos;
True
</code></pre><p>åœ¨çœ‹å®Œè¿™äº›ä¾‹å­åï¼Œä½ è¦æ‰¿è®¤ï¼Œç¡®å®éå¸¸éš¾ä»¥ç¡®å®šç³»ç»Ÿæ˜¯æ ¹æ®ä»€ä¹ˆæ¥æ‰§è¡ŒåŸç”Ÿçš„<code>intern</code>ã€‚æˆ‘ä»¬è¿˜éœ€è¦é˜…è¯»æ›´å¤šçš„<code>CPython</code>ä»£ç æ¥æ‰¾å‡ºç­”æ¡ˆã€‚</p>
<p>####Fact 1: all length 0 and length 1 strings are interned</p>
<p>è¿˜æ˜¯åœ¨<code>stringobject.c</code>ï¼Œæˆ‘ä»¬è¿™äº›è¦çœ‹<code>PyString_FromStringAndSize</code>å’Œ <code>PyString_FromString</code>å‡½æ•°ä¸­éƒ½æœ‰çš„ä¸€äº›ä»£ç ï¼š</p>
<pre><code>/* share short strings */
if (size == 0) {
    PyObject *t = (PyObject *)op;
    PyString_InternInPlace(&amp;t);
    op = (PyStringObject *)t;
    nullstring = op;
    Py_INCREF(op);
} else if (size == 1 &amp;&amp; str != NULL) {
    PyObject *t = (PyObject *)op;
    PyString_InternInPlace(&amp;t);
</code></pre><p>éå¸¸æ¸…æ™°ï¼šæ‰€æœ‰é•¿åº¦ä¸º<code>0</code>å’Œ<code>1</code>çš„å­—ç¬¦ä¸²éƒ½ä¼šè¢«<code>intern</code>ã€‚</p>
<p>####Fact 2: åœ¨ç¼–è¯‘æœŸé—´å­—ç¬¦ä¸²ä¼šè¢«<code>interned</code></p>
<p>ä½ å†™çš„<code>Python</code>ä»£ç å¹¶ä¸æ˜¯ç›´æ¥è¢«è§£é‡Šå™¨æ‰§è¡Œï¼Œä»£ç ä¼šé€šè¿‡ä¸€ä¸ªç»å…¸çš„ç¼–è¯‘é“¾æ¥ç”Ÿæˆä¸€ç§ä¸­é—´è¯­è¨€ï¼š<code>bytecode</code>ï¼ˆå­—èŠ‚ç ï¼‰ã€‚<code>python</code>å­—èŠ‚ç æ˜¯è¢«<code>Python</code>è§£é‡Šå™¨è¿™ä¸ªè™šæ‹Ÿæœºæ‰§è¡Œçš„ä¸€ç³»ç±»æŒ‡ä»¤ã€‚ä½ å¯ä»¥åœ¨<a href="https://docs.python.org/2/library/dis.html#bytecodes" target="_blank" rel="external">è¿™é‡Œ</a>çœ‹åˆ°æ‰€æœ‰çš„æŒ‡ä»¤ã€‚é€šè¿‡ä½¿ç”¨<code>dis</code>æ¨¡å—ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå‡½æ•°æˆ–æ¨¡å—æ‰§è¡Œäº†å“ªäº›æŒ‡ä»¤ï¼š</p>
<pre><code>&gt;&gt;&gt; import dis
&gt;&gt;&gt; def foo():
...     print &apos;foo!&apos;
...
&gt;&gt;&gt; dis.dis(foo)
  2           0 LOAD_CONST               1 (&apos;foo!&apos;)
              3 PRINT_ITEM
              4 PRINT_NEWLINE       
              5 LOAD_CONST               0 (None)
              8 RETURN_VALUE
</code></pre><p>æ­£å¦‚ä½ çŸ¥é“çš„ï¼Œåœ¨<code>Python</code>ä¸­ï¼Œä¸€åˆ‡çš†å¯¹è±¡ã€‚ä»£ç ä¹Ÿæ˜¯<code>Python</code>å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºäº†ä¸€å—å­—èŠ‚ç ã€‚ä¸€ä¸ªä»£ç å¯¹è±¡å¸¦æœ‰æ‰§è¡Œæ—¶æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼šå¸¸é‡ï¼Œå˜é‡åç­‰ã€‚æˆ‘ä»¬å‘ç°ï¼Œå½“åœ¨<code>Python</code>ä¸­åˆ›å»ºä»£ç å¯¹è±¡çš„æ—¶å€™ï¼Œæœ‰ä¸€äº›å­—ç¬¦ä¸²è¢«<code>intern</code>äº†ï¼š</p>
<pre><code>PyCodeObject *
PyCode_New(int argcount, int nlocals, int stacksize, int flags,
           PyObject *code, PyObject *consts, PyObject *names,
           PyObject *varnames, PyObject *freevars, PyObject *cellvars,
           PyObject *filename, PyObject *name, int firstlineno,
           PyObject *lnotab)

           ...
           /* Intern selected string constants */
           for (i = PyTuple_Size(consts); --i &gt;= 0; ) {
               PyObject *v = PyTuple_GetItem(consts, i);
               if (!PyString_Check(v))
                   continue;
               if (!all_name_chars((unsigned char *)PyString_AS_STRING(v)))
                   continue;
               PyString_InternInPlace(&amp;PyTuple_GET_ITEM(consts, i));
           }
</code></pre><p>åœ¨<code>codeobject.c</code>ä¸­ï¼Œ<code>constså…ƒç»„</code>åŒ…å«äº†åœ¨ç¼–è¯‘æœŸé—´å®šä¹‰çš„å­—é¢é‡ï¼š<code>å¸ƒå°”å€¼</code>ï¼Œ<code>æµ®ç‚¹æ•°</code>ï¼Œ<code>æ•´æ•°</code>å’Œåœ¨ä½ çš„ç¨‹åºä¸­å£°æ˜çš„å­—ç¬¦ä¸²ã€‚åœ¨è¿™ä¸ªå…ƒç¥–ä¸­å­˜å‚¨çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰è¢«<code>all_name_chars</code>å‡½æ•°è¿‡æ»¤æ‰çš„è¯ï¼Œå°†ä¼šè¢«å…¨éƒ¨<code>intern</code>ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ<code>s1</code>æ˜¯åœ¨ç¼–è¯‘æœŸé—´è¢«å£°æ˜çš„ã€‚ç›¸åçš„æ˜¯ï¼Œ<code>s2</code>æ˜¯åœ¨è¿è¡Œæ—¶äº§ç”Ÿçš„ï¼š</p>
<pre><code>s1 = &apos;foo&apos;
s2 = &apos;&apos;.join([&apos;f&apos;, &apos;o&apos;, &apos;o&apos;])
</code></pre><p>ç»“æœæ˜¯ï¼Œ<code>s1</code>å°†ä¼šè¢«<code>intern</code>ï¼Œ<code>s2</code>ä¸ä¼šã€‚</p>
<p><code>all_name_chars</code>æ–¹æ³•å°†ä¼šè¿‡æ»¤æ‰ä¸æ˜¯ç”±<code>asciiå­—ç¬¦</code>ï¼Œ<code>æ•°å­—</code>å’Œ<code>ä¸‹åˆ’çº¿</code>æ„æˆçš„å­—ç¬¦ä¸²ï¼ˆPythonä¸­å˜é‡åçš„å‘½ä»¤è§„èŒƒï¼‰ï¼š</p>
<pre><code>#define NAME_CHARS \
    &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&quot;

/* all_name_chars(s): true if all chars in s are valid NAME_CHARS */

static int
all_name_chars(unsigned char *s)
{
    static char ok_name_char[256];
    static unsigned char *name_chars = (unsigned char *)NAME_CHARS;

    if (ok_name_char[*name_chars] == 0) {
        unsigned char *p;
        for (p = name_chars; *p; p++)
            ok_name_char[*p] = 1;
    }
    while (*s) {
        if (ok_name_char[*s++] == 0)
            return 0;
    }
    return 1;
}
</code></pre><p>ç†è§£äº†è¿™äº›ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ä¸ºä»€ä¹ˆ<code>&#39;foo!&#39; is &#39;foo!&#39;</code>ç­‰äº<code>False</code>ï¼Œè€Œ<code>&#39;foo&#39; is &#39;foo&#39;</code>ç­‰äº<code>True</code>ï¼Œèƒœåˆ©äº†å—ï¼Ÿè¿˜æ²¡æœ‰ï¼</p>
<p>####å­—èŠ‚ç ä¼˜åŒ–äº§ç”Ÿäº†æ›´å¤šå­—ç¬¦ä¸²å¸¸é‡</p>
<p>è¿™å¬èµ·æ¥å’Œç›´è§‰ä¸ç¬¦ï¼Œä½†æ˜¯åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå­—ç¬¦ä¸²è¿æ¥çš„è¾“å‡ºä¸æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œè€Œæ˜¯åœ¨ç¼–è¯‘æ—¶ï¼š</p>
<pre><code>&gt;&gt;&gt; &apos;foo&apos; + &apos;bar&apos; is &apos;foobar&apos;
True
</code></pre><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<code>&#39;foo&#39; + &#39;bar&#39;</code>ä¹Ÿè¢«<code>intern</code>äº†ï¼Œè¡¨è¾¾å¼ç­‰äº<code>True</code>ã€‚</p>
<p>æ€ä¹ˆåšåˆ°çš„ï¼Ÿå€’æ•°ç¬¬äºŒçš„æºç ç¼–è¯‘å™¨ç”Ÿæˆäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„å­—èŠ‚ç ã€‚è¿™ä¸ªåŸå§‹çš„å­—èŠ‚ç æœ€ç»ˆä¼šè¿›å…¥æœ€åä¸€ä¸ªç¼–è¯‘å™¨ï¼Œè¢«ç§°ä½œ<code>â€œçª¥å­”ä¼˜åŒ–â€</code>(<code>peephole optimization</code>)</p>
<p><img src="http://guilload.com/assets/media/python-string-interning/baz.png" alt="Compilation chain"></p>
<p>è¿™ä¸€æ­¥çš„ç›®æ ‡æ˜¯é€šè¿‡æ›¿æ¢æ›´å¿«çš„æŒ‡ä»¤æ¥äº§ç”Ÿæ›´åŠ é«˜æ•ˆçš„å­—èŠ‚ç ã€‚</p>
<p>##å¸¸é‡åˆå¹¶<code>Constant folding</code></p>
<p>åœ¨<code>çª¥å­”ä¼˜åŒ–</code>æœŸé—´ï¼Œåº”ç”¨åˆ°çš„ä¸€é¡¹æŠ€æœ¯å°±æ˜¯å¸¸é‡åˆå¹¶ï¼Œä½¿ç”¨æ›´åŠ ç®€å•çš„å¸¸é‡ã€‚æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œä½ çœ‹åˆ°äº†ä¸‹é¢è¿™è¡Œï¼š</p>
<pre><code>SECONDS = 24 * 60 * 60
</code></pre><p>ä½ èƒ½åšä»€ä¹ˆæ¥ç®€åŒ–è¿™ä¸ªè¡¨è¾¾å¼ä»¥åœ¨è¿è¡Œæ—¶èŠ‚çº¦å‡ ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚ä½ å¯ä»¥ç”¨è®¡ç®—å¥½çš„å€¼<code>86400</code>æ¥æ›¿æ¢è¿™ä¸ªè¡¨è¾¾å¼ã€‚è¿™å°±æ˜¯<code>foo&#39; + &#39;bar&#39;</code>å‘ç”Ÿçš„äº‹ã€‚è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>foobar</code>å‡½æ•°ï¼Œåˆ†è§£ç›¸å…³çš„å­—èŠ‚ç ï¼š</p>
<pre><code>&gt;&gt;&gt; import dis
&gt;&gt;&gt; def foobar():
...         return &apos;foo&apos; + &apos;bar&apos;
&gt;&gt;&gt; dis.dis(foobar)
  2           0 LOAD_CONST               3 (&apos;foobar&apos;)
              3 RETURN_VALUE
</code></pre><p>çœ‹åˆ°äº†å§ï¼æ ¹æœ¬æ²¡æœ‰çœ‹åˆ°åŠ æ³•å’Œåˆå§‹çš„ä¸¤ä¸ªå¸¸é‡<code>&#39;foo&#39;</code>å’Œ<code>&#39;bar&#39;</code>ã€‚å¦‚æœ<code>CPython</code>å­—èŠ‚ç æ²¡æœ‰è¢«ä¼˜åŒ–ï¼Œé‚£ä¹ˆè¾“å‡ºåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>&gt;&gt;&gt; dis.dis(foobar)
  2           0 LOAD_CONST               1 (&apos;foo&apos;)
              3 LOAD_CONST               2 (&apos;bar&apos;)
              6 BINARY_ADD    
              7 RETURN_VALUE
</code></pre><p>æˆ‘ä»¬è§£å†³ä¸ºä»€ä¹ˆä¸‹é¢çš„è¡¨è¾¾å¼æ­£ç¡®çš„é—®é¢˜ï¼š</p>
<pre><code>&gt;&gt;&gt; &apos;a&apos; * 20 is &apos;aaaaaaaaaaaaaaaaaaaa&apos;
</code></pre><p>####é¿å…å¤§çš„ .pyc æ–‡ä»¶</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆ<code>&#39;a&#39; * 21 is &#39;aaaaaaaaaaaaaaaaaaaaa&#39;</code>ä¸ç­‰äº<code>True</code>å‘¢ï¼Ÿä½ è¿˜è®°å¾—åœ¨ä½ çš„åŒ…é‡Œé¢ä¼šçœ‹åˆ°çš„<code>.pyc</code>æ–‡ä»¶å—ã€‚å¦‚æœä¸€ä¸ªäººå†™äº†è¯¸å¦‚<code>[&#39;foo!&#39;] * 10**9</code>çš„ä»£ç ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿè¿™æ ·ä¼šå¯¼è‡´<code>.pyc</code>æ–‡ä»¶éå¸¸å·¨å¤§ï¼ä¸ºäº†é¿å…è¿™ä¸ªç°è±¡ï¼Œ<code>çª¥å­”ä¼˜åŒ–</code>ä¸­äº§ç”Ÿçš„åºåˆ—é•¿åº¦å¦‚æœå¤§äº<code>20</code>ï¼Œå°†ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p>##è¡¥å……</p>
<p>###çª¥å­”ä¼˜åŒ–<br>é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ç§å¾ˆå±€éƒ¨çš„ä¼˜åŒ–æ–¹å¼ï¼Œç¼–è¯‘å™¨ä»…ä»…åœ¨ä¸€ä¸ªåŸºæœ¬å—æˆ–è€…å¤šä¸ªåŸºæœ¬å—ä¸­ï¼Œé’ˆå¯¹å·²ç»ç”Ÿæˆçš„ä»£ç ï¼Œç»“åˆCPUè‡ªå·±æŒ‡ä»¤çš„ç‰¹ç‚¹ï¼Œé€šè¿‡ä¸€äº›è®¤ä¸ºå¯èƒ½å¸¦æ¥æ€§èƒ½æå‡çš„è½¬æ¢è§„åˆ™ï¼Œæˆ–è€…é€šè¿‡æ•´ä½“çš„åˆ†æï¼Œé€šè¿‡æŒ‡ä»¤è½¬æ¢ï¼Œæå‡ä»£ç æ€§èƒ½ã€‚åˆ«çœ‹è¿™äº›ä»£ç è½¬æ¢å¾ˆå±€éƒ¨ï¼Œå¾ˆå°ï¼Œä½†å¯èƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½æå‡ã€‚</p>
<p>è¿™ä¸ªçª¥å­”ï¼Œä½ å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œç¼–è¯‘å™¨åœ¨å®æ–½çª¥å­”ä¼˜åŒ–æ—¶ï¼Œå°±ä»…ä»…åˆ†æè¿™ä¸ªçª—å£å†…çš„æŒ‡ä»¤ã€‚æ¯æ¬¡è½¬æ¢ä¹‹åï¼Œå¯èƒ½è¿˜ä¼šæš´éœ²ç›¸é‚»çª—å£ä¹‹é—´çš„æŸäº›ä¼˜åŒ–æœºä¼šï¼Œæ‰€ä»¥å¯ä»¥å¤šæ¬¡è°ƒç”¨çª¥å­”ä¼˜åŒ–ï¼Œå°½å¯èƒ½æå‡æ€§èƒ½ã€‚</p>
<p>çª¥å­”ä¼˜åŒ–å¯ä»¥åœ¨å››ä¸ªæ–¹é¢å¯»æ‰¾ä¼˜åŒ–æœºä¼šï¼šå†—ä½™æŒ‡ä»¤åˆ é™¤ï¼ŒåŒ…æ‹¬å†—ä½™çš„loadå’ŒstoreæŒ‡ä»¤ä»¥åŠæ­»ä»£ç (ä¸ä¼šæ‰§è¡Œçš„ä»£ç );æ§åˆ¶æµä¼˜åŒ–ï¼›å¼ºåº¦å‰Šå¼±ï¼›åˆ©ç”¨ç‰¹æœ‰æŒ‡ä»¤ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/img/lufei.jpeg"
               alt="You Wangqiu" />
          <p class="site-author-name" itemprop="name">You Wangqiu</p>
           
              <p class="site-description motion-element" itemprop="description">ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">212</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/michaelyou" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhi-yu-65-2" target="_blank" title="çŸ¥ä¹">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      çŸ¥ä¹
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">You Wangqiu</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
