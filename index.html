<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/img/lufei.ico?v=5.1.2" />






<meta name="description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">
<meta property="og:type" content="website">
<meta property="og:title" content="Youmai ã® Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Youmai ã® Blog">
<meta property="og:description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Youmai ã® Blog">
<meta name="twitter:description" content="ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Youmai ã® Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-63551049-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Youmai ã® Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/06/go-pprof-é‡‡æ ·ä½•æ—¶è¿›è¡Œ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/06/go-pprof-é‡‡æ ·ä½•æ—¶è¿›è¡Œ/" itemprop="url">go pprof é‡‡æ ·ä½•æ—¶è¿›è¡Œ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-06T15:20:36+08:00">
                2017-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> (</div><div class="line">	_ <span class="string">"net/http/pprof"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		log.Println(http.ListenAndServe(<span class="string">"localhost:6060"</span>, <span class="literal">nil</span>))</div><div class="line">	&#125;()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç å¤§å®¶åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰ï¼Œ<code>go tool pprof</code>å·¥å…·çš„é€šç”¨ä»£ç ï¼Œç”¨æ¥åšæ€§èƒ½ç­‰åˆ†æã€‚æˆ‘è¿™ä¸¤å¤©å°è¯•ç”¨äº†ä¸€ä¸‹ï¼Œä¸å…æœ‰äº†ä¸€ä¸ªç–‘é—®ï¼š<code>pprof</code>æ˜¯è¦é‡‡æ ·çš„ï¼Œè¿™ä¸ªé‡‡æ ·æ˜¯ä½•æ—¶è¿›è¡Œçš„ï¼Ÿæ˜¯ç¨‹åºå¯åŠ¨å°±å¼€å§‹é‡‡æ ·è¿˜æ˜¯å½“æˆ‘<code>curl localhost:$PORT/debug/pprof/$PROFILE_TYPE</code>å¼€å§‹ï¼Ÿ</p>
<p>ä¸ºä»€ä¹ˆä¼šè€ƒè™‘è¿™ä¸ªå‘¢ï¼Œä¸»è¦æ˜¯åœ¨çœ‹çš„æ¡†æ¶é‡Œé›†æˆäº†<code>pprof</code>ï¼Œé»˜è®¤æ‰“å¼€ï¼Œå¦‚æœæ˜¯ç¨‹åºä¸€å¼€å§‹å°±é‡‡æ ·ï¼Œé‚£å¯¹äºæ€§èƒ½æ˜¯æœ‰æŸè€—çš„ã€‚è¿™ç§é—®é¢˜åˆ«äººå›ç­”ä½ ï¼Œä½ ä¹Ÿä¸ä¸€å®šç›¸ä¿¡ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹çœ‹<code>pprof</code>çš„ä»£ç å§ã€‚</p>
<p>æ ‡å‡†åº“çš„ä»£ç æ˜¯åœ¨<code>$GOROOT/src</code>ä¸‹é¢ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹<code>pprof</code>ï¼Œåœ¨æˆ‘çš„macä¸Šè·¯å¾„æ˜¯<code>/usr/local/Cellar/go/1.9.2/libexec/src/net/http/pprof/pprof.go</code></p>
<p>é¦–å…ˆæ˜¯<code>init</code>å‡½æ•°ï¼Œæ³¨å†Œäº†æˆ‘ä»¬ç”¨åˆ°çš„åˆ†æurlsï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    http.Handle(<span class="string">"/debug/pprof/"</span>, http.HandlerFunc(Index))</div><div class="line">    http.Handle(<span class="string">"/debug/pprof/cmdline"</span>, http.HandlerFunc(Cmdline))</div><div class="line">    http.Handle(<span class="string">"/debug/pprof/profile"</span>, http.HandlerFunc(Profile))</div><div class="line">    http.Handle(<span class="string">"/debug/pprof/symbol"</span>, http.HandlerFunc(Symbol))</div><div class="line">    http.Handle(<span class="string">"/debug/pprof/trace"</span>, http.HandlerFunc(Trace))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯åœ¨ç¨‹åºå¯åŠ¨å°±æ‰§è¡Œçš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ„Ÿè§‰åªè¦importå°±ä¸‡äº‹å¤§å‰çš„åŸå› ã€‚å…¶å®çœ‹åˆ°è¿™é‡Œåº”è¯¥å°±æ˜ç™½äº†ï¼Œprofileåªæ˜¯æ™®é€šçš„å‡½æ•°è°ƒç”¨è€Œå·²ï¼Œç¨‹åºå¯åŠ¨åªæ˜¯æ³¨å†Œäº†handlerï¼ŒçœŸæ­£çš„é‡‡æ ·åº”è¯¥æ˜¯åœ¨è¯·æ±‚ä¹‹åæ‰§è¡Œçš„ã€‚</p>
<p>ä½†æ˜¯æ¥éƒ½æ¥äº†ï¼Œæˆ‘ä»¬ä¸å¦¨å¾€ä¸‹çœ‹çœ‹ï¼Œæ¯•ç«Ÿéœ€è¦çœ‹æ ‡å‡†åº“çš„æœºä¼šä¸å¤šã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>cpu profile</code>ï¼Œä¹Ÿå°±æ˜¯<code>Profile</code>å‡½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Profile responds with the pprof-formatted cpu profile.</span></div><div class="line"><span class="comment">// The package initialization registers it as /debug/pprof/profile.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Profile</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">    sec, _ := strconv.ParseInt(r.FormValue(<span class="string">"seconds"</span>), <span class="number">10</span>, <span class="number">64</span>)</div><div class="line">    <span class="keyword">if</span> sec == <span class="number">0</span> &#123;</div><div class="line">        sec = <span class="number">30</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> durationExceedsWriteTimeout(r, <span class="keyword">float64</span>(sec)) &#123;</div><div class="line">        w.Header().Set(<span class="string">"Content-Type"</span>, <span class="string">"text/plain; charset=utf-8"</span>)</div><div class="line">        w.Header().Set(<span class="string">"X-Go-Pprof"</span>, <span class="string">"1"</span>)</div><div class="line">        w.WriteHeader(http.StatusBadRequest)</div><div class="line">        fmt.Fprintln(w, <span class="string">"profile duration exceeds server's WriteTimeout"</span>)</div><div class="line">        <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Set Content Type assuming StartCPUProfile will work,</span></div><div class="line">    <span class="comment">// because if it does it starts writing.</span></div><div class="line">    w.Header().Set(<span class="string">"Content-Type"</span>, <span class="string">"application/octet-stream"</span>)</div><div class="line">    <span class="keyword">if</span> err := pprof.StartCPUProfile(w); err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="comment">// StartCPUProfile failed, so no writes yet.</span></div><div class="line">        <span class="comment">// Can change header back to text content</span></div><div class="line">        <span class="comment">// and send error code.</span></div><div class="line">        w.Header().Set(<span class="string">"Content-Type"</span>, <span class="string">"text/plain; charset=utf-8"</span>)</div><div class="line">        w.Header().Set(<span class="string">"X-Go-Pprof"</span>, <span class="string">"1"</span>)</div><div class="line">        w.WriteHeader(http.StatusInternalServerError)</div><div class="line">        fmt.Fprintf(w, <span class="string">"Could not enable CPU profiling: %s\n"</span>, err)</div><div class="line">                <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">    sleep(w, time.Duration(sec)*time.Second)</div><div class="line">    pprof.StopCPUProfile()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è·å–äº†ä¸€ä¸ªé»˜è®¤30ç§’çš„æ—¶é—´ï¼Œæ‰§è¡Œ<code>StartCPUProfile</code>ï¼Œé‡Œé¢åº”è¯¥æ˜¯ä¸ª<code>goroutine</code>ï¼Œè°ƒç”¨è¿”å›åsleepäº†ä¸€ä¸‹ï¼Œç»“æŸ<code>cpu profile</code>ã€‚é‡‡æ ·åº”è¯¥æ˜¯åœ¨<code>StartCPUProfile</code>ï¼Œæ‰§è¡Œsecondsæ—¶é—´ã€‚</p>
<p>å†æ¥çœ‹çœ‹<code>StartCPUProfile</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">StartCPUProfile</span><span class="params">(w io.Writer)</span> <span class="title">error</span></span> &#123;</div><div class="line">    <span class="comment">// The runtime routines allow a variable profiling rate,</span></div><div class="line">    <span class="comment">// but in practice operating systems cannot trigger signals</span></div><div class="line">    <span class="comment">// at more than about 500 Hz, and our processing of the</span></div><div class="line">    <span class="comment">// signal is not cheap (mostly getting the stack trace).</span></div><div class="line">    <span class="comment">// 100 Hz is a reasonable choice: it is frequent enough to</span></div><div class="line">    <span class="comment">// produce useful data, rare enough not to bog down the</span></div><div class="line">    <span class="comment">// system, and a nice round number to make it easy to</span></div><div class="line">    <span class="comment">// convert sample counts to seconds. Instead of requiring</span></div><div class="line">    <span class="comment">// each client to specify the frequency, we hard code it.</span></div><div class="line">    <span class="keyword">const</span> hz = <span class="number">100</span></div><div class="line"></div><div class="line">    cpu.Lock()</div><div class="line">    <span class="keyword">defer</span> cpu.Unlock()</div><div class="line">    <span class="keyword">if</span> cpu.done == <span class="literal">nil</span> &#123;</div><div class="line">        cpu.done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// Double-check.</span></div><div class="line">    <span class="keyword">if</span> cpu.profiling &#123;</div><div class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"cpu profiling already in use"</span>)</div><div class="line">    &#125;</div><div class="line">    cpu.profiling = <span class="literal">true</span></div><div class="line">    runtime.SetCPUProfileRate(hz)</div><div class="line">    <span class="keyword">go</span> profileWriter(w)</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨é‡Šè§£é‡Šäº†å–æ ·é¢‘ç‡çš„ç”±æ¥ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹CPUä¸»é¢‘çš„æ¦‚å¿µï¼š</p>
<blockquote>
<p>CPUçš„ä¸»é¢‘ï¼Œå³CPUå†…æ ¸å·¥ä½œçš„æ—¶é’Ÿé¢‘ç‡ï¼ˆCPU Clock Speedï¼‰ã€‚CPUçš„ä¸»é¢‘çš„åŸºæœ¬å•ä½æ˜¯èµ«å…¹ï¼ˆHzï¼‰ï¼Œä½†æ›´å¤šçš„æ˜¯ä»¥å…†èµ«å…¹ï¼ˆMHzï¼‰æˆ–å‰èµ«å…¹ï¼ˆGHzï¼‰ä¸ºå•ä½ã€‚æ—¶é’Ÿé¢‘ç‡çš„å€’æ•°å³ä¸ºæ—¶é’Ÿå‘¨æœŸã€‚æ—¶é’Ÿå‘¨æœŸçš„åŸºæœ¬å•ä½ä¸ºç§’ï¼ˆsï¼‰ï¼Œä½†æ›´å¤šçš„æ˜¯ä»¥æ¯«ç§’ï¼ˆmsï¼‰ã€å¾®å¦™ï¼ˆusï¼‰æˆ–çº³ç§’ï¼ˆnsï¼‰ä¸ºå•ä½ã€‚åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒCPUæ‰§è¡Œä¸€æ¡è¿ç®—æŒ‡ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨1000 Hzçš„CPUä¸»é¢‘ä¸‹ï¼Œæ¯1æ¯«ç§’å¯ä»¥æ‰§è¡Œä¸€æ¡CPUè¿ç®—æŒ‡ä»¤ã€‚åœ¨1 MHzçš„CPUä¸»é¢‘ä¸‹ï¼Œæ¯1å¾®å¦™å¯ä»¥æ‰§è¡Œä¸€æ¡CPUè¿ç®—æŒ‡ä»¤ã€‚è€Œåœ¨1 GHzçš„CPUä¸»é¢‘ä¸‹ï¼Œæ¯1çº³ç§’å¯ä»¥æ‰§è¡Œä¸€æ¡CPUè¿ç®—æŒ‡ä»¤ã€‚</p>
</blockquote>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒGoè¯­è¨€çš„è¿è¡Œæ—¶ç³»ç»Ÿä¼šä»¥100 Hzçš„çš„é¢‘ç‡å¯¹CPUä½¿ç”¨æƒ…å†µè¿›è¡Œå–æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ç§’å–æ ·100æ¬¡ï¼Œå³æ¯10æ¯«ç§’ä¼šå–æ ·ä¸€æ¬¡ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªé¢‘ç‡å‘¢ï¼Ÿå› ä¸º100 Hzæ—¢è¶³å¤Ÿäº§ç”Ÿæœ‰ç”¨çš„æ•°æ®ï¼Œåˆä¸è‡³äºè®©ç³»ç»Ÿäº§ç”Ÿåœé¡¿ã€‚å¹¶ä¸”100è¿™ä¸ªæ•°ä¸Šä¹Ÿå¾ˆå®¹æ˜“åšæ¢ç®—ï¼Œæ¯”å¦‚æŠŠæ€»å–æ ·è®¡æ•°æ¢ç®—ä¸ºæ¯ç§’çš„å–æ ·æ•°ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œæ‰€è¯´çš„å¯¹CPUä½¿ç”¨æƒ…å†µçš„å–æ ·å°±æ˜¯å¯¹å½“å‰çš„Goroutineçš„å †æ ˆä¸Šçš„ç¨‹åºè®¡æ•°å™¨çš„å–æ ·ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»æ ·æœ¬è®°å½•ä¸­åˆ†æå‡ºå“ªäº›ä»£ç æ˜¯è®¡ç®—æ—¶é—´æœ€é•¿æˆ–è€…è¯´æœ€è€—CPUèµ„æºçš„éƒ¨åˆ†äº†ã€‚</p>
<p>ä»£ç å¾ˆå®¹æ˜“ç†è§£ï¼Œé”ä½cpuï¼Œè®¾ç½®runtimeçš„é‡‡æ ·é¢‘ç‡ï¼Œ<code>profileWriter</code>å°±æ˜¯å®é™…é‡‡æ ·äº†ã€‚</p>
<p>æ‰€ä»¥ç»“è®ºæ˜¯ï¼Œé‡‡æ ·åœ¨è¯·æ±‚ä¹‹åæ‰ä¼šè¿›è¡Œï¼Œçº¿ä¸Šæ‰“å¼€é‡‡æ ·çš„æ¥å£æ²¡æœ‰é—®é¢˜ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://blog.golang.org/profiling-go-programs" target="_blank" rel="external">Profiling Go Programs</a></li>
<li><a href="https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/" target="_blank" rel="external">Profiling Go programs with pprof</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/go-command-tutorial/0.12.html" target="_blank" rel="external">go tool pprof</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/05/goè¯­è¨€æ­»å¾ªç¯åˆ†æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/05/goè¯­è¨€æ­»å¾ªç¯åˆ†æ/" itemprop="url">goè¯­è¨€æ­»å¾ªç¯åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-12-05T12:18:55+08:00">
                2017-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ€è¿‘çœ‹äº†ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="https://gocn.io/article/441" target="_blank" rel="external">å¦‚ä½•å®šä½ golang è¿›ç¨‹ hang æ­»çš„ bug</a>ï¼Œé‡Œé¢æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"io"</span></div><div class="line">    <span class="string">"log"</span></div><div class="line">    <span class="string">"net/http"</span></div><div class="line">    <span class="string">"runtime"</span></div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    runtime.GOMAXPROCS(runtime.NumCPU())</div><div class="line">    <span class="keyword">go</span> server()</div><div class="line">    <span class="keyword">go</span> printNum()</div><div class="line">    <span class="keyword">var</span> i = <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        <span class="comment">// will block here, and never go out</span></div><div class="line">        i++</div><div class="line">    &#125;</div><div class="line">    fmt.Println(<span class="string">"for loop end"</span>)</div><div class="line">    time.Sleep(time.Second * <span class="number">3600</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">printNum</span><span class="params">()</span></span> &#123;</div><div class="line">    i := <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        fmt.Println(i)</div><div class="line">        i++</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">HelloServer</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</div><div class="line">    fmt.Println(<span class="string">"hello world"</span>)</div><div class="line">    io.WriteString(w, <span class="string">"hello, world!\n"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">server</span><span class="params">()</span></span> &#123;</div><div class="line">    http.HandleFunc(<span class="string">"/"</span>, HelloServer)</div><div class="line">    err := http.ListenAndServe(<span class="string">":12345"</span>, <span class="literal">nil</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        log.Fatal(<span class="string">"ListenAndServe: "</span>, err)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œï¼Œä¼šå‘ç°æ‰“å°ä¸€ä¼šå„¿æ•°å­—ååœäº†ï¼Œæˆ‘ä»¬æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl localhost:12345</div></pre></td></tr></table></figure>
<p>ç¨‹åºå¡æ­»ã€‚å…³äºç¨‹åºæŒ‚åœ¨å“ªé‡Œå€ŸåŠ©<code>dlv</code>æ˜¯å¾ˆå¥½å®šä½çš„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dlv debug hang.go</div></pre></td></tr></table></figure>
<p>è¿›å»ä¹‹åè¿è¡Œç¨‹åºï¼Œæ‰“å°åœæ­¢è¿›å…¥å¡æ­»çŠ¶æ€ï¼Œæˆ‘ä»¬æ‰§è¡Œ<code>ctrl C</code>ï¼Œ<code>dlv</code>ä¼šæ˜¾ç¤ºæ–­å¼€çš„åœ°æ–¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">received SIGINT, stopping process (will not forward signal)&gt; main.main() ./hang.<span class="keyword">go</span>:<span class="number">17</span> (PC: <span class="number">0x12dd</span>7c8)</div><div class="line">    <span class="number">12</span>: <span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="number">13</span>:         runtime.GOMAXPROCS(runtime.NumCPU())</div><div class="line">    <span class="number">14</span>:         <span class="keyword">go</span> server()</div><div class="line">    <span class="number">15</span>:         <span class="keyword">go</span> printNum()</div><div class="line">    <span class="number">16</span>:         <span class="keyword">var</span> i = <span class="number">1</span></div><div class="line">=&gt;  <span class="number">17</span>:         <span class="keyword">for</span> &#123;</div><div class="line">    <span class="number">18</span>:                 <span class="comment">// will block here, and never go out</span></div><div class="line">    <span class="number">19</span>:                 i++</div><div class="line">    <span class="number">20</span>:         &#125;</div><div class="line">    <span class="number">21</span>:         fmt.Println(<span class="string">"for loop end"</span>)</div><div class="line">    <span class="number">22</span>:         time.Sleep(time.Second * <span class="number">3600</span>)</div><div class="line">(dlv)</div></pre></td></tr></table></figure>
<p>ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¸æ˜ç™½ï¼Œä¸æ˜ç™½çš„åœ°æ–¹ä¸»è¦æ˜¯å› ä¸ºï¼š</p>
<ul>
<li>æˆ‘åˆçœ‹äº†ä¸¤ç¯‡æ–‡ç« <a href="http://tonybai.com/2017/11/23/the-simple-analysis-of-goroutine-schedule-examples/" target="_blank" rel="external">Goroutineè°ƒåº¦å®ä¾‹ç®€è¦åˆ†æ</a>å’Œ<a href="http://tonybai.com/2017/06/23/an-intro-about-goroutine-scheduler/" target="_blank" rel="external">ä¹Ÿè°ˆgoroutineè°ƒåº¦å™¨</a>ï¼Œæ˜¯åŒä¸€ä½ä½œè€…Tony Baiå†™çš„ï¼Œå†™å¾—éå¸¸å¥½ã€‚ç¬¬äºŒç¯‡æ–‡ç« è§£é‡Šäº†goroutineçš„è°ƒåº¦å’Œcpuæ•°é‡çš„å…³ç³»ï¼ˆä¸å¤šåŠ è§£é‡Šï¼Œå»ºè®®å¤§å®¶çœ‹çœ‹ï¼‰ï¼Œæˆ‘çš„macæ˜¯åŒæ ¸å››çº¿ç¨‹ï¼ˆè¿™é‡Œä¸æ˜ç™½çš„åŒå­¦è‡ªè¡Œgoogle cpu è¶…çº¿ç¨‹ï¼‰ï¼Œgoç‰ˆæœ¬æ˜¯1.9ï¼Œç†è®ºä¸Šè®²å¯ä»¥è·‘4ä¸ªgoroutineè€Œä¸ç”¨è€ƒè™‘æ­»å¾ªç¯ï¼Œä¸€ä¸ªæ­»å¾ªç¯æœ€å¤šæŠŠä¸€ä¸ªcpuæ‰“æ­»ï¼Œä¸Šé¢çš„ä»£ç ä¸­åªæœ‰3ä¸ªgoroutineï¼Œè€Œä¸”ä»–ä»¬çœ‹ä¸Šå»éƒ½æŒ‚ä½äº†ã€‚</li>
<li>ä¸Šé¢è¯´çš„ç†è®ºä¸Šè®²ï¼Œä¸æ˜¯æˆ‘ä¸»è§‚è‡†æµ‹çš„ï¼Œæˆ‘è·‘äº†<code>1</code>ä¸­<a href="http://tonybai.com/2017/11/23/the-simple-analysis-of-goroutine-schedule-examples/" target="_blank" rel="external">ç¬¬ä¸€ç¯‡æ–‡ç« </a>ä¸­çš„ä¸€ä¸ªä¾‹å­:</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">deadloop</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">go</span> deadloop()</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        time.Sleep(time.Second * <span class="number">1</span>)</div><div class="line">        fmt.Println(<span class="string">"I got scheduled!"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç æœ‰ä¸¤ä¸ªgoroutineï¼Œä¸€ä¸ªæ˜¯<code>main goroutine</code>ï¼Œä¸€ä¸ªæ˜¯<code>deadloop goroutine</code>ï¼Œè·‘å¾—æ—¶å€™<code>deadloop gouroutine</code>ä¸ä¼šå¯¹<code>main goroutine</code>é€ æˆå½±å“ï¼Œæ‰“å°ä¸€ç›´åœ¨æŒç»­ï¼Œä½œè€…çš„æ–‡ç« è§£é‡Šäº†åŸå› ã€‚</p>
<ul>
<li><a href="https://gocn.io/article/441" target="_blank" rel="external">å¦‚ä½•å®šä½ golang è¿›ç¨‹ hang æ­»çš„ bug</a>è¿™ç¯‡æ–‡ç« æåˆ°äº†<code>gcwaiting</code>ï¼Œç„¶è€Œæ²¡æœ‰è§£é‡Šã€‚</li>
</ul>
<p>åœ¨<a href="https://gocn.io/article/441" target="_blank" rel="external">å¦‚ä½•å®šä½ golang è¿›ç¨‹ hang æ­»çš„ bug</a>æœ‰è¿™æ ·ä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>å› ä¸ºåœ¨ for å¾ªç¯ä¸­æ²¡æœ‰å‡½æ•°è°ƒç”¨çš„è¯ï¼Œç¼–è¯‘å™¨ä¸ä¼šæ’å…¥è°ƒåº¦ä»£ç ï¼Œæ‰€ä»¥è¿™ä¸ªæ‰§è¡Œ for å¾ªç¯çš„ goroutine æ²¡æœ‰åŠæ³•è¢«è°ƒå‡ºï¼Œè€Œåœ¨å¾ªç¯æœŸé—´ç¢°åˆ° gcï¼Œé‚£ä¹ˆå°±ä¼šå¡åœ¨ gcwaiting é˜¶æ®µï¼Œå¹¶ä¸”æ•´ä¸ªè¿›ç¨‹æ°¸è¿œ hang æ­»åœ¨è¿™ä¸ªå¾ªç¯ä¸Šã€‚å¹¶ä¸å†å¯¹å¤–å“åº”ã€‚</p>
</blockquote>
<p>è¿™ä¸ªå…¶å®å°±æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€æ®µä»£ç å¡æ­»çš„åŸå› ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç¬¬äºŒæ®µä»£ç æ²¡æœ‰å¡æ­»çš„åŸå› ï¼Œå°±æ˜¯åœ¨<code>gc</code>ä¸Šï¼</p>
<p>æˆ‘ä»¬å†çœ‹ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="https://studygolang.com/articles/9004" target="_blank" rel="external">golangçš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æœºåˆ¶</a>ï¼Œè¿™ç¯‡æ–‡ç« å¾ˆçŸ­ï¼Œä½†æ¯å¥è¯éƒ½å¾ˆé‡è¦ï¼š</p>
<blockquote>
<ol>
<li>è®¾ç½®gcwaiting=1ï¼Œè¿™ä¸ªåœ¨æ¯ä¸€ä¸ªGä»»åŠ¡ä¹‹å‰ä¼šæ£€æŸ¥ä¸€æ¬¡è¿™ä¸ªçŠ¶æ€ï¼Œå¦‚æ˜¯ï¼Œåˆ™ä¼šå°†å½“å‰M ä¼‘çœ ï¼›</li>
<li>å¦‚æœè¿™ä¸ªMé‡Œé¢æ­£åœ¨è¿è¡Œä¸€ä¸ªé•¿æ—¶é—´çš„Gä»»åŠ¡ï¼Œå’‹åŠå‘¢ï¼Œéš¾é“ä¼šç­‰å¾…è¿™ä¸ªGä»»åŠ¡è‡ªå·±åˆ‡æ¢å—ï¼Ÿè¿™æ ·çš„è¯å¯è¦ç­‰10mså•Šï¼Œä¸èƒ½ç­‰ï¼åšå†³ä¸èƒ½ç­‰ï¼<br>æ‰€ä»¥ä¼šä¸»åŠ¨å‘å‡ºæŠ¢å æ ‡è®°ï¼ˆç±»ä¼¼äºä¸Šä¸€ç¯‡ï¼‰ï¼Œè®©å½“å‰Gä»»åŠ¡ä¸­æ–­ï¼Œå†è¿è¡Œä¸‹ä¸€ä¸ªGä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ä¼šèµ°åˆ°ç¬¬1æ­¥</li>
</ol>
</blockquote>
<p>é‚£ä¹ˆå¦‚æœè¿™æ—¶å€™è¿è¡Œçš„æ˜¯æ²¡æœ‰å‡½æ•°è°ƒç”¨çš„æ­»å¾ªç¯å‘¢ï¼Œgcä¹Ÿå‘å‡ºäº†æŠ¢å æ ‡è®°ï¼Œä½†æ˜¯å¦‚æœæ­»å¾ªç¯æ²¡æœ‰å‡½æ•°è°ƒç”¨ï¼Œå°±æ²¡æœ‰åœ°æ–¹è¢«æ ‡è®°ï¼Œæ— æ³•è¢«æŠ¢å ï¼Œé‚£å°±åªèƒ½è®¾ç½®<code>gcwaiting=1</code>ï¼Œè€Œ<strong>Mæ²¡æœ‰ä¼‘çœ </strong>ï¼Œ<code>stop the world</code>å¡ä½äº†ï¼ˆæ­»é”ï¼‰ï¼Œ<code>gcwaiting</code>ä¸€ç›´æ˜¯1ï¼Œæ•´ä¸ªç¨‹åºéƒ½å¡ä½äº†ï¼</p>
<p>è¿™é‡Œå…¶å®å·²ç»è§£é‡Šäº†ç¬¬ä¸€ä»½ä»£ç çš„ç°è±¡ï¼Œç¬¬äºŒä»½ä»£ç ä¸ºä»€ä¹ˆæ²¡æœ‰hangä½ç›¸ä¿¡å¤§å®¶ä¹Ÿèƒ½çŒœåˆ°äº†ï¼šä»£ç é‡Œæ²¡æœ‰è§¦å‘gcï¼æˆ‘ä»¬æ¥æ‰‹åŠ¨è§¦å‘ä¸€ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"log"</span></div><div class="line">    <span class="string">"net/http"</span></div><div class="line">    _ <span class="string">"net/http/pprof"</span></div><div class="line">    <span class="comment">// "runtime"</span></div><div class="line">    <span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">deadloop</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">        log.Println(http.ListenAndServe(<span class="string">"localhost:6060"</span>, <span class="literal">nil</span>))</div><div class="line">    &#125;()</div><div class="line">    <span class="keyword">go</span> deadloop()</div><div class="line">    i := <span class="number">3</span></div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        time.Sleep(time.Second * <span class="number">1</span>)</div><div class="line">        i--</div><div class="line">        fmt.Println(<span class="string">"I got scheduled!"</span>)</div><div class="line">        <span class="keyword">if</span> i == <span class="number">0</span> &#123;</div><div class="line">            runtime.GC()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¼šå‘ç°æ‰“å°äº†3è¡Œä¹‹åï¼Œç¨‹åºä¹Ÿå¡æ­»äº†ï¼ŒbingoğŸ‰</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>gcwaiting</code>æ˜¯ä¸æ˜¯ç­‰äº1:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> go build hang2.go</div><div class="line"></div><div class="line"><span class="meta">$</span> GODEBUG="schedtrace=300,scheddetail=1" ./hang2</div><div class="line"></div><div class="line">SCHED 2443ms: gomaxprocs=4 idleprocs=3 threads=7 spinningthreads=0 idlethreads=2 runqueue=0 gcwaiting=0 nmidlelocked=0 stopwait=0 sysmonwait=0</div><div class="line">  P0: status=1 schedtick=4 syscalltick=5 m=5 runqsize=0 gfreecnt=1</div><div class="line">  P1: status=0 schedtick=14 syscalltick=0 m=-1 runqsize=0 gfreecnt=0</div><div class="line">  P2: status=0 schedtick=3 syscalltick=4 m=-1 runqsize=0 gfreecnt=0</div><div class="line">......  </div><div class="line">SCHED 2751ms: gomaxprocs=4 idleprocs=0 threads=7 spinningthreads=0 idlethreads=2 runqueue=0 gcwaiting=1 nmidlelocked=0 stopwait=1 sysmonwait=0</div><div class="line">  P0: status=1 schedtick=4 syscalltick=5 m=5 runqsize=0 gfreecnt=1</div><div class="line">  P1: status=3 schedtick=14 syscalltick=0 m=-1 runqsize=0 gfreecnt=0</div><div class="line">  P2: status=3 schedtick=3 syscalltick=10 m=-1 runqsize=0 gfreecnt=0</div><div class="line">  P3: status=3 schedtick=1 syscalltick=26 m=0 runqsize=0 gfreecnt=0</div><div class="line">  M6: p=-1 curg=-1 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpgc=0 spinning=false blocked=false lockedg=-1</div><div class="line">  M5: p=0 curg=19 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpg</div></pre></td></tr></table></figure>
<p>ä»£ç è¯šä¸æ¬ºæˆ‘ä¹Ÿï¼</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://gocn.io/article/441" target="_blank" rel="external">å¦‚ä½•å®šä½ golang è¿›ç¨‹ hang æ­»çš„ bug</a></li>
<li><a href="http://tonybai.com/2017/11/23/the-simple-analysis-of-goroutine-schedule-examples/" target="_blank" rel="external">Goroutineè°ƒåº¦å®ä¾‹ç®€è¦åˆ†æ</a></li>
<li><a href="http://tonybai.com/2017/06/23/an-intro-about-goroutine-scheduler/" target="_blank" rel="external">ä¹Ÿè°ˆgoroutineè°ƒåº¦å™¨</a></li>
<li><a href="https://studygolang.com/articles/9004" target="_blank" rel="external">golangçš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æœºåˆ¶</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/27/hystrix-goç®€ä»‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/27/hystrix-goç®€ä»‹/" itemprop="url">hystrix-goç®€ä»‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-27T17:45:44+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://github.com/afex/hystrix-go" target="_blank" rel="external">hystrix</a>æ˜¯ä¸€ä¸ªå®¹é”™åº“ï¼Œæ—¨åœ¨éš”ç¦»æŒ‡å‘è¿œç¨‹ç³»ç»Ÿï¼ŒæœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“çš„è¯·æ±‚ï¼Œæœç»çº§è”æ•…éšœï¼Œå¹¶åœ¨å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°å¼¹æ€§ï¼Œæ¯•ç«Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ•…éšœæ˜¯ä¸å¯é¿å…çš„ã€‚</p>
<p>æ­¤é¡¹ç›®è„±èƒäºç”±Netflixå¼€æºçš„åŒåjavaé¡¹ç›®ã€‚<a href="https://github.com/Netflix/Hystrix" target="_blank" rel="external">https://github.com/Netflix/Hystrix</a></p>
<h3 id="åƒHystrixå‘½ä»¤ä¸€æ ·æ‰§è¡Œä»£ç "><a href="#åƒHystrixå‘½ä»¤ä¸€æ ·æ‰§è¡Œä»£ç " class="headerlink" title="åƒHystrixå‘½ä»¤ä¸€æ ·æ‰§è¡Œä»£ç "></a>åƒHystrixå‘½ä»¤ä¸€æ ·æ‰§è¡Œä»£ç </h3><p>å®šä¹‰ä¾èµ–äºå¤–éƒ¨ç³»ç»Ÿçš„åº”ç”¨é€»è¾‘ï¼Œå°†å‡½æ•°ä¼ ç»™<code>Go</code>ã€‚å½“å¤–éƒ¨ç³»ç»Ÿå¤„äºå¥åº·çŠ¶æ€ï¼Œè¿™ä¸ªå‡½æ•°å°†æ˜¯å”¯ä¸€è¢«æ‰§è¡Œçš„ä»£ç ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hystrix.Go(<span class="string">"my_command"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="comment">// talk to other services</span></div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;, <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<h3 id="å®šä¹‰fallbackè¡Œä¸º"><a href="#å®šä¹‰fallbackè¡Œä¸º" class="headerlink" title="å®šä¹‰fallbackè¡Œä¸º"></a>å®šä¹‰fallbackè¡Œä¸º</h3><p>å¦‚æœå¸Œæœ›å¤–éƒ¨ç³»ç»ŸæŒ‚äº†çš„æ—¶å€™æ‰§è¡Œä¸€äº›åŠ¨ä½œï¼Œå¯ä»¥ç»™<code>Go</code>ä¼ é€’ç¬¬äºŒä¸ªå‡½æ•°ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™é‡Œçš„é€»è¾‘å¯ä»¥è®©ä½ çš„åº”ç”¨ä¼˜é›…åœ°å¤„ç†å¤–éƒ¨ç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µã€‚</p>
<p>å½“ç¬¬ä¸€ä¸ªå‡½æ•°è¿”å›errorï¼Œæˆ–è€…åœ¨ä¸€ç³»åˆ—å¥åº·æ£€æŸ¥çš„æƒ…å†µä¸‹å‡½æ•°æ— æ³•è¿è¡Œç»“æŸï¼Œéƒ½ä¼šè§¦å‘fallbackã€‚æ›´è¯¦ç»†çš„<a href="https://github.com/Netflix/Hystrix/wiki/How-it-Works" target="_blank" rel="external">å‚è€ƒåœ¨è¿™é‡Œ</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">hystrix.Go(<span class="string">"my_command"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="comment">// talk to other services</span></div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;, <span class="function"><span class="keyword">func</span><span class="params">(err error)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="comment">// do this when services are down</span></div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="ç­‰å¾…è¾“å‡º"><a href="#ç­‰å¾…è¾“å‡º" class="headerlink" title="ç­‰å¾…è¾“å‡º"></a>ç­‰å¾…è¾“å‡º</h3><p>è°ƒç”¨<code>Go</code>å°±åƒæ‰§è¡Œäº†ä¸€ä¸ªgoroutineï¼Œé™¤äº†ä½ èƒ½è·å–åˆ°ä¸€ä¸ªerrorçš„channelå¹¶ä¸”ç›‘æ§å®ƒã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">output := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">1</span>)</div><div class="line">errors := hystrix.Go(<span class="string">"my_command"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="comment">// talk to other services</span></div><div class="line">	output &lt;- <span class="literal">true</span></div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;, <span class="literal">nil</span>)</div><div class="line"></div><div class="line"><span class="keyword">select</span> &#123;</div><div class="line"><span class="keyword">case</span> out := &lt;-output:</div><div class="line">	<span class="comment">// success</span></div><div class="line"><span class="keyword">case</span> err := &lt;-errors:</div><div class="line">	<span class="comment">// failure</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åŒæ­¥API"><a href="#åŒæ­¥API" class="headerlink" title="åŒæ­¥API"></a>åŒæ­¥API</h3><p>è°ƒç”¨ä¸€ä¸ªå€Ÿå£å¹¶ä¸”ç­‰å¾…è¿”å›æ˜¯ä¸€ä¸ªå¸¸è§çš„åœºæ™¯ï¼ˆå¯¹åº”äºgoroutineï¼‰ï¼ŒHystrixæä¾›äº†ä¸€ä¸ª<code>Do</code>å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªerror</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">err := hystrix.Do(&quot;my_command&quot;, func() error &#123;</div><div class="line">	// talk to other services</div><div class="line">	return nil</div><div class="line">&#125;, nil)</div></pre></td></tr></table></figure>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åœ¨åº”ç”¨å¯åŠ¨æœŸé—´ï¼Œä½ å¯ä»¥è°ƒç”¨<code>ConfigureCommand</code>æ¥ä¸ºæ¯ä¸ªcommandæ·»åŠ é…ç½®ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">hystrix.ConfigureCommand(<span class="string">"my_command"</span>, hystrix.CommandConfig&#123;</div><div class="line">	Timeout:               <span class="number">1000</span>,</div><div class="line">	MaxConcurrentRequests: <span class="number">100</span>,</div><div class="line">	ErrorPercentThreshold: <span class="number">25</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>ä¹Ÿæœ‰åˆ«çš„é…ç½®æ–¹æ³•ï¼Œæ›´è¯¦ç»†çš„ä»‹ç»è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h3><p>æœ€åç»™å¤§å®¶ä¸¾ä¸ªä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"github.com/afex/hystrix-go/hystrix"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	hystrix.Go(<span class="string">"get_baidu"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</div><div class="line">		<span class="comment">// talk to other services</span></div><div class="line">		_, err := http.Get(<span class="string">"https://www.baidu.com/"</span>)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"get error"</span>)</div><div class="line">			<span class="keyword">return</span> err</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">	&#125;, <span class="function"><span class="keyword">func</span><span class="params">(err error)</span> <span class="title">error</span></span> &#123;</div><div class="line">		fmt.Println(<span class="string">"get an error, handle it"</span>)</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">	&#125;)</div><div class="line"> </div><div class="line">	time.Sleep(<span class="number">2</span> * time.Second)  <span class="comment">// è°ƒç”¨Goæ–¹æ³•å°±æ˜¯èµ·äº†ä¸€ä¸ªgoroutineï¼Œè¿™é‡Œè¦sleepä¸€ä¸‹ï¼Œä¸ç„¶çœ‹ä¸åˆ°æ•ˆæœ</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç½‘ç»œè¯·æ±‚ï¼Œå¤§å®¶æŠŠç½‘ç»œæ–­å¼€åå°±èƒ½å¤Ÿæ¨¡æ‹Ÿå¤–éƒ¨æœåŠ¡æŒ‚æ‰çš„æƒ…å†µã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç†”æ–­æœºåˆ¶åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‡ ä¹æ˜¯å¿…å¤‡çš„ç»„ä»¶ï¼Œä¸‹é¢æ€»ç»“ä¸€ä¸‹ï¼š</p>
<h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ol>
<li><p>hystrixä½œç”¨åœ¨å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç¨‹åºä¾èµ–hystrixç›¸å…³çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä¸æ‰€ä¾èµ–çš„æœåŠ¡ï¼Œå½¢æˆéš”ç¦»(goroutineçš„éš”ç¦»)ã€‚ä¾èµ–æœåŠ¡çš„å»¶è¿Ÿä¸å¤±è´¥å˜çš„å¯æ§ã€‚ä¿æŠ¤è°ƒç”¨è€…goroutineçš„æ‰§è¡Œã€‚</p>
</li>
<li><p>é¿å…äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå•ä¸ªç»„ä»¶çš„å¤±è´¥å¯¼è‡´çš„çº§è”å½±å“ã€‚</p>
</li>
<li><p>å¿«é€Ÿå¤±è´¥ï¼Œè¿…é€Ÿæ¢å¤ã€‚  hystrixæœ‰å¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼Œå•ä¸ªç»„ä»¶æœåŠ¡å¤±è´¥ç‡åˆ°ä¸€å®šç¨‹åº¦åï¼Œå†è¯·æ±‚ï¼Œä¼šç›´æ¥å“åº”å¤±è´¥ã€‚å†è¿™ä¹‹åï¼Œä¼šæœ‰é‡è¯•æœºåˆ¶ã€‚å‡å°‘ç³»ç»Ÿåœ¨é”™è¯¯æœåŠ¡è°ƒç”¨ä¸Šçš„å¼€é”€ã€‚</p>
</li>
<li><p>é™çº§åº”ç”¨</p>
</li>
</ol>
<h4 id="hystrixçš„è®¾è®¡åŸåˆ™"><a href="#hystrixçš„è®¾è®¡åŸåˆ™" class="headerlink" title="hystrixçš„è®¾è®¡åŸåˆ™"></a>hystrixçš„è®¾è®¡åŸåˆ™</h4><ol>
<li><p>é˜²æ­¢ä»»ä½•å•ä¸ªä¾èµ–æœåŠ¡è€—å°½æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹</p>
</li>
<li><p>ç›´æ¥å“åº”å¤±è´¥ï¼Œè€Œä¸æ˜¯ä¸€ç›´ç­‰å¾…</p>
</li>
<li><p>æä¾›é”™è¯¯è¿”å›æ¥å£ï¼Œè€Œä¸æ˜¯è®©ç”¨æˆ·çº¿ç¨‹ç›´æ¥å¤„ç†ä¾èµ–æœåŠ¡æŠ›å‡ºçš„å¼‚å¸¸</p>
</li>
<li><p>ä½¿ç”¨éš”ç¦»æˆ–ç†”æ–­æŠ€æœ¯æ¥é™ä½å¹¶é™åˆ¶å•ä¸ªä¾èµ–å¯¹æ•´ä¸ªç³»ç»Ÿé€ æˆçš„å½±å“</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/03/go-scope/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/03/go-scope/" itemprop="url">goè¯­è¨€ä½œç”¨åŸŸè¸©å‘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-03T20:15:38+08:00">
                2017-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»Šå¤©é¥­é¥­ç»™æˆ‘å‡ºäº†ä¸ªé¢˜ç›®ï¼Œä¸‹é¢è¿™æ®µä»£ç ä¸ºä»€ä¹ˆæŠ¥é”™ï¼Œæ€ä¹ˆæ”¹ï¼Ÿ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</div><div class="line">    s <span class="keyword">string</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> a *A</div><div class="line"></div><div class="line">    <span class="keyword">if</span> check(a) &#123;</div><div class="line">        a, err := generate()</div><div class="line">        fmt.Println(a.s, err)</div><div class="line">    &#125;</div><div class="line">    fmt.Println(a.s)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span> <span class="params">(*A, error)</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> &amp;A&#123;s: <span class="string">"b"</span>&#125;, <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(a *A)</span> <span class="title">bool</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œä¸€ä¸‹ï¼Œå‘ç°æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">panic: runtime error: invalid memory address or nil pointer dereference</div><div class="line">[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x1095520]</div><div class="line"></div><div class="line">goroutine 1 [running]:</div><div class="line">main.main()</div><div class="line">        /go_code/src/go_examples/go_scope.go:18 +0x280</div><div class="line">exit status 2</div></pre></td></tr></table></figure>
<p>18è¡Œï¼Œä¹Ÿå°±æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fmt.Println(a.s)</div></pre></td></tr></table></figure>
<p>æŠ¥é”™äº†ï¼ŒæŠ¥é”™æ²¡æ³•æä¾›æ›´å¤šä¿¡æ¯ï¼ˆgoæ–°æ‰‹ï¼Œè€é¸Ÿå¯èƒ½èƒ½çœ‹å‡ºç«¯å€ªï¼‰ï¼Œæˆ‘ä»¬åŠ ä¸€äº›æ‰“å°</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> a *A</div><div class="line">    fmt.Printf(<span class="string">"%p\n"</span>, &amp;a)      <span class="comment">// 1</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> check(a) &#123;</div><div class="line">        a, err := generate()</div><div class="line">        fmt.Printf(<span class="string">"%p\n"</span>, &amp;a)  <span class="comment">// 2</span></div><div class="line">        fmt.Println(a.s, err)   <span class="comment">// 3</span></div><div class="line">    &#125;</div><div class="line">    fmt.Printf(<span class="string">"%p\n"</span>, &amp;a)      <span class="comment">// 4</span></div><div class="line">    fmt.Println(a.s)            </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">0xc42000c028   // 1</div><div class="line">0xc42000c038   // 2</div><div class="line">b &lt;nil&gt;        // 3</div><div class="line">0xc42000c028   // 4</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œ2å¤„çš„<code>a</code>ç«Ÿç„¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„ï¼ˆ1å¤„ï¼‰<code>a</code>ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼</p>
<p>å…¶å®çœ‹åˆ°è¿™é‡Œå¾ˆå¤šäººå¯èƒ½éƒ½æ˜ç™½äº†ï¼Œå…¶å®æ˜¯<code>a, err := generate()</code>é‡Œé¢<code>:=</code>çš„é—®é¢˜ï¼Œæˆ‘ä»¬æœ€åˆçš„è®¾æƒ³æ˜¯golangä¼šå®šä¹‰æ–°å˜é‡<code>err</code>ï¼Œè€Œ<code>a</code>ä¸ºåˆå§‹å®šä¹‰çš„é‚£ä¸ªå˜é‡ï¼ˆ1å¤„ï¼‰ã€‚ä½†å®é™…æƒ…å†µæ˜¯ï¼Œå¯¹äºä½¿ç”¨<code>:=</code>å®šä¹‰çš„å˜é‡ï¼Œå¦‚æœæ–°å˜é‡ä¸é‚£ä¸ªåŒåå·²å®šä¹‰å˜é‡ (è¿™é‡Œå°±æ˜¯1å¤„çš„å˜é‡<code>a</code>)ä¸åœ¨ä¸€ä¸ªä½œç”¨åŸŸä¸­æ—¶ï¼Œé‚£ä¹ˆgolangä¼šé‡æ–°å®šä¹‰è¿™ä¸ªå˜é‡ï¼Œè¿™å°±æ˜¯å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„çœŸå‡¶ã€‚</p>
<p>æ€ä¹ˆæ”¹å‘¢ï¼Œæˆ‘ä»¬é‡å†™ä¸€ä¸‹<code>main</code>å‡½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> a *A</div><div class="line">    <span class="keyword">var</span> err error</div><div class="line"></div><div class="line">    <span class="keyword">if</span> check(a) &#123;</div><div class="line">        a, err = generate()</div><div class="line">        fmt.Println(a.s, err)</div><div class="line">    &#125;</div><div class="line">    fmt.Println(a.s)            </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æ­¤å³å¯~</p>
<p>è¿™ä¸ªå‘çœŸçš„éå¸¸å®¹æ˜“è¸©ï¼Œè€Œä¸”ä¸å¤ªå¥½å‘ç°ï¼Œæ„Ÿè°¢é¥­é¥­ğŸ™</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/17/Dockeræ•°æ®ç®¡ç†-Volumeï¼Œ-bind-mountå’Œtmpfs-mount/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/17/Dockeræ•°æ®ç®¡ç†-Volumeï¼Œ-bind-mountå’Œtmpfs-mount/" itemprop="url">Dockeræ•°æ®ç®¡ç†-Volumeï¼Œ bind mountå’Œtmpfs mount</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-17T20:52:02+08:00">
                2017-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æˆ‘ä»¬å¯ä»¥å°†æ•°æ®å†™åˆ°å®¹å™¨çš„å¯å†™å…¥å±‚ï¼Œä½†æ˜¯è¿™ç§å†™å…¥æ˜¯æœ‰ç¼ºç‚¹çš„ï¼š</p>
<ul>
<li>å½“å®¹å™¨åœæ­¢è¿è¡Œæ—¶ï¼Œå†™å…¥çš„æ•°æ®ä¼šä¸¢å¤±ã€‚ä½ ä¹Ÿå¾ˆéš¾å°†è¿™äº›æ•°æ®ä»å®¹å™¨ä¸­å–å‡ºæ¥ç»™å¦å¤–çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚</li>
<li>å®¹å™¨çš„å¯å†™å…¥å±‚ä¸å®¿ä¸»æœºæ˜¯ç´§å¯†è€¦åˆçš„ã€‚è¿™äº›å†™å…¥çš„æ•°æ®åœ¨å¯ä»¥è½»æ˜“åœ°è¢«åˆ æ‰ã€‚</li>
<li>å†™å…¥å®¹å™¨çš„å¯å†™å…¥å±‚éœ€è¦ä¸€ä¸ª<a href="https://docs.docker.com/engine/userguide/storagedriver/" target="_blank" rel="external">å­˜å‚¨é©±åŠ¨</a>ï¼ˆ<code>storage driver</code>ï¼‰æ¥ç®¡ç†æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ä¸ªå­˜å‚¨é©±åŠ¨é€šè¿‡linuxå†…æ ¸æä¾›äº†ä¸€ä¸ª<code>union filesystem</code>ã€‚ç›¸æ¯”äºæ•°æ®å·ï¼ˆ<code>data volume</code>ï¼‰ï¼Œè¿™ç§é¢å¤–çš„æŠ½è±¡ä¼šé™ä½æ€§èƒ½ã€‚</li>
</ul>
<p>Dockeræä¾›äº†3ç§æ–¹æ³•å°†æ•°æ®ä»Dockerå®¿ä¸»æœºæŒ‚è½½ï¼ˆmountï¼‰åˆ°å®¹å™¨ï¼š<code>volumes</code>ï¼Œ<code>bind mounts</code>å’Œ<code>tmpfs mounts</code>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<code>volumes</code>æ€»æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p>
<p>##é€‰æ‹©åˆé€‚çš„æŒ‚è½½æ–¹å¼</p>
<p>ä¸ç®¡ä½ é€‰æ‹©å“ªç§æŒ‚è½½æ–¹å¼ï¼Œä»å®¹å™¨ä¸­çœ‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ•°æ®åœ¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­è¢«å±•ç¤ºä¸ºä¸€ä¸ªç›®å½•æˆ–è€…ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚</p>
<p>ä¸€ä¸ªç®€å•åŒºåˆ†<code>volumes</code>ï¼Œ<code>bind mounts</code>å’Œ<code>tmpfs mounts</code>ä¸åŒç‚¹çš„æ–¹æ³•æ˜¯ï¼šæ€è€ƒæ•°æ®åœ¨å®¿ä¸»æœºä¸Šæ˜¯å¦‚ä½•å­˜åœ¨çš„ã€‚</p>
<p><img src="/img/types-of-mounts.png" alt="different mount"></p>
<ul>
<li><strong>Volumes</strong>ç”±Dockerç®¡ç†ï¼Œå­˜å‚¨åœ¨å®¿ä¸»æœºçš„æŸä¸ªåœ°æ–¹ï¼ˆåœ¨linuxä¸Šæ˜¯<code>/var/lib/docker/volumes/</code>ï¼‰ã€‚éDockeråº”ç”¨ç¨‹åºä¸èƒ½æ”¹åŠ¨è¿™ä¸€ä½ç½®çš„æ•°æ®ã€‚Volumesæ˜¯Dockeræœ€å¥½çš„æ•°æ®æŒä¹…åŒ–æ–¹æ³•ã€‚</li>
<li><strong>Bind mounts</strong>çš„æ•°æ®å¯ä»¥å­˜æ”¾åœ¨å®¿ä¸»æœºçš„ä»»ä½•åœ°æ–¹ã€‚æ•°æ®ç”šè‡³å¯ä»¥æ˜¯é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•ã€‚éDockeråº”ç”¨ç¨‹åºå¯ä»¥æ”¹å˜è¿™äº›æ•°æ®ã€‚</li>
<li><strong>tmpfs mounts</strong>çš„æ•°æ®åªå­˜å‚¨åœ¨å®¿ä¸»æœºçš„å†…å­˜ä¸­ï¼Œä¸ä¼šå†™å…¥åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚</li>
</ul>
<h2 id="æ›´è¯¦ç»†çš„Diff"><a href="#æ›´è¯¦ç»†çš„Diff" class="headerlink" title="æ›´è¯¦ç»†çš„Diff"></a>æ›´è¯¦ç»†çš„Diff</h2><ul>
<li><p><strong>Volumes</strong>ï¼šç”±Dockeråˆ›å»ºå’Œç®¡ç†ã€‚ä½ å¯ä»¥é€šè¿‡<code>docker volume create</code>å‘½ä»¤æ˜¾å¼åœ°åˆ›å»º<code>volume</code>ï¼ŒDockerä¹Ÿå¯ä»¥åœ¨åˆ›å»ºå®¹å™¨æˆ–æœåŠ¡æ˜¯è‡ªå·±åˆ›å»ºvolumeã€‚</p>
<p>å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªvolumeï¼Œå®ƒä¼šè¢«å­˜æ”¾åœ¨å®¿ä¸»æœºçš„ä¸€ä¸ªç›®å½•ä¸‹ã€‚å½“ä½ å°†è¿™ä¸ªvolumeæŒ‚è½½åˆ°æŸä¸ªå®¹å™¨æ—¶ï¼Œè¿™ä¸ªç›®å½•å°±æ˜¯æŒ‚è½½åˆ°å®¹å™¨çš„ä¸œè¥¿ã€‚è¿™ä¸€ç‚¹å’Œ<code>bind mounts</code>ç±»ä¼¼ï¼Œé™¤äº†volumesæ˜¯ç”±Dockeråˆ›å»ºçš„ï¼Œå’Œå®¿ä¸»æœºçš„æ ¸å¿ƒï¼ˆ<code>core functionality</code>ï¼‰éš”ç¦»ã€‚</p>
<p>ä¸€ä¸ªvolumeå¯ä»¥åŒæ—¶è¢«æŒ‚è½½åˆ°å‡ ä¸ªå®¹å™¨ä¸­ã€‚å³ä½¿æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä½¿ç”¨è¿™ä¸ªvolumeï¼Œvolumeä¾ç„¶å­˜åœ¨ï¼Œä¸ä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚å¯ä»¥é€šè¿‡<code>docker volume prune</code>æ¸…é™¤ä¸å†ä½¿ç”¨çš„volumesã€‚</p>
<p>volumesä¹Ÿæ”¯æŒ<code>volume driver</code>ï¼Œå¯ä»¥å°†æ•°æ®å­˜æ”¾åœ¨å¦å¤–çš„æœºå™¨æˆ–è€…äº‘ä¸Šã€‚</p>
</li>
<li><p><strong>Bind mounts</strong>ï¼šDockeræ—©æœŸå°±æ”¯æŒè¿™ä¸ªç‰¹æ€§ã€‚ä¸volumesç›¸æ¯”ï¼Œ<code>Bind mounts</code>æ”¯æŒçš„åŠŸèƒ½æœ‰é™ã€‚ä½¿ç”¨<code>bind mounts</code>æ—¶ï¼Œå®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•è¢«æŒ‚è½½åˆ°å®¹å™¨ä¸Šã€‚</p>
<blockquote>
<p>è­¦å‘Šï¼šä½¿ç”¨<code>Bind mounts</code>çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ï¼Œå®¹å™¨ä¸­è¿è¡Œçš„ç¨‹åºå¯ä»¥ä¿®æ”¹å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬åˆ›å»ºï¼Œä¿®æ”¹ï¼Œåˆ é™¤é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•ã€‚è¿™ä¸ªåŠŸèƒ½å¯èƒ½ä¼šæœ‰å®‰å…¨é—®é¢˜ã€‚</p>
</blockquote>
</li>
<li><p><strong>tmpfs mounts</strong>ï¼š<code>tmpfs mounts</code>çš„æ•°æ®ä¸ä¼šè½ç›˜ã€‚åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥å­˜å‚¨ä¸€äº›ä¸éœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€æˆ–æ•æ„Ÿæ•°æ®ã€‚ä¾‹å¦‚ï¼Œ<code>swarm</code>æœåŠ¡é€šè¿‡<code>tmpfs mounts</code>æ¥å°†<a href="https://docs.docker.com/engine/swarm/secrets/" target="_blank" rel="external">secrets</a>æŒ‚è½½åˆ°ä¸€ä¸ªæœåŠ¡çš„å®¹å™¨ä¸­å»ã€‚</p>
</li>
</ul>
<h2 id="é€‚åˆVolumesçš„åœºæ™¯"><a href="#é€‚åˆVolumesçš„åœºæ™¯" class="headerlink" title="é€‚åˆVolumesçš„åœºæ™¯"></a>é€‚åˆVolumesçš„åœºæ™¯</h2><ul>
<li>åœ¨ä¸åŒçš„å®¹å™¨ä¸­å…±äº«æ•°æ®ã€‚If you donâ€™t explicitly create it, a volume is created the first time it is mounted into a container. When that container stops or is removed, the volume still exists. Multiple containers can mount the same volume simultaneously, either read-write or read-only. <strong>Volumes are only removed when you explicitly remove them</strong>.</li>
<li>When the Docker host is not guaranteed to have a given directory or file structure. Volumes help you decouple the configuration of the Docker host from the container runtime.</li>
<li>When you want to store your containerâ€™s data on a remote host or a cloud provider, rather than locally.</li>
<li>å½“ä½ éœ€è¦å¤‡ä»½æˆ–è¿ç§»æ•°æ®çš„æ—¶å€™ï¼ŒWhen you need to be able to back up, restore, or migrate data from one Docker host to another, volumes are a better choice. You can stop containers using the volume, then back up the volumeâ€™s directory (such as /var/lib/docker/volumes/<volume-name>).</volume-name></li>
</ul>
<h2 id="é€‚åˆbind-mountsçš„åœºæ™¯"><a href="#é€‚åˆbind-mountsçš„åœºæ™¯" class="headerlink" title="é€‚åˆbind mountsçš„åœºæ™¯"></a>é€‚åˆbind mountsçš„åœºæ™¯</h2><ul>
<li>å®¿ä¸»æœºå’Œå®¹å™¨å…±äº«é…ç½®æ–‡ä»¶ã€‚Dockeræä¾›çš„DNSè§£å†³æ–¹æ¡ˆå°±æ˜¯å¦‚æ­¤ï¼Œå°†å®¿ä¸»æœºçš„<code>/etc/resolv.conf</code>æŒ‚è½½åˆ°æ¯ä¸ªå®¹å™¨ä¸­ã€‚</li>
<li>å¼€å‘ç¯å¢ƒéœ€è¦åœ¨å®¿ä¸»æœºå’Œå®¹å™¨ä¸­å…±äº«ä»£ç ã€‚dockerçš„å¼€å‘å°±æ˜¯å¦‚æ­¤ï¼Œæ¯•ç«Ÿå®¹å™¨ä¸­ä¸€èˆ¬æ˜¯æ²¡æœ‰ç¼–è¾‘å™¨çš„</li>
<li>When the file or directory structure of the Docker host is guaranteed to be consistent with the bind mounts the containers require.</li>
</ul>
<h2 id="é€‚åˆtmpfs-mountsçš„åœºæ™¯"><a href="#é€‚åˆtmpfs-mountsçš„åœºæ™¯" class="headerlink" title="é€‚åˆtmpfs mountsçš„åœºæ™¯"></a>é€‚åˆtmpfs mountsçš„åœºæ™¯</h2><p><code>tmpfs mounts</code>ä¸»è¦ç”¨åœ¨ä½ æ—¢ä¸æƒ³åœ¨å®¹å™¨å†…ï¼Œåˆä¸æƒ³åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¿å­˜æ•°æ®çš„æ—¶å€™ã€‚è¿™å¯èƒ½æ˜¯å‡ºäºå®‰å…¨åŸå› ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½ çš„åº”ç”¨éœ€è¦å†™éå¸¸å¤šçš„éæŒä¹…åŒ–æ•°æ®ï¼Œ<code>tmpfs mounts</code>è¿™æ—¶å€™å¯ä»¥ä¿è¯å®¹å™¨æ€§èƒ½ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/16/docker-swarméƒ¨ç½²åº”ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/16/docker-swarméƒ¨ç½²åº”ç”¨/" itemprop="url">docker swarméƒ¨ç½²åº”ç”¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-16T21:42:58+08:00">
                2017-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h2><h3 id="ä»€ä¹ˆæ˜¯swarm"><a href="#ä»€ä¹ˆæ˜¯swarm" class="headerlink" title="ä»€ä¹ˆæ˜¯swarm"></a>ä»€ä¹ˆæ˜¯swarm</h3><p>ä¸€ä¸ª<code>swarm</code>å°±æ˜¯ä¸€ç»„è¿è¡Œ<code>Docker</code>å¹¶ç»„æˆé›†ç¾¤çš„æœºå™¨ã€‚ä¹‹åï¼Œä½ ç»§ç»­è¿è¡Œä»¥å‰ä½¿ç”¨çš„<code>Dockerå‘½ä»¤</code>ï¼Œä½†ç°åœ¨å®ƒä»¬æ˜¯ç”±<code>swarm manager</code>(ä¹Ÿæ˜¯ä¸€å°æœºå™¨ï¼Œæ‰§è¡Œ<code>docker swarm init</code>çš„å°±æ˜¯<code>manager</code>)åœ¨é›†ç¾¤ä¸Šæ‰§è¡Œã€‚é›†ç¾¤ä¸­çš„æœºå™¨å¯ä»¥æ˜¯ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºã€‚åŠ å…¥é›†ç¾¤åï¼Œå®ƒä»¬è¢«ç§°ä¸º<code>èŠ‚ç‚¹</code>ï¼ˆnodeï¼‰ã€‚</p>
<p><code>swarm manager</code>å¯ä»¥ä½¿ç”¨å‡ ç§ç­–ç•¥æ¥è¿è¡Œå®¹å™¨ï¼Œä¾‹å¦‚â€œæœ€ç©ºçš„èŠ‚ç‚¹â€ï¼ˆ<code>empties node</code>ï¼‰ - å°†å®¹å™¨æ”¾åˆ°åˆ©ç”¨ç‡æœ€ä½çš„æœºå™¨ä¸Šã€‚æˆ–è€…â€œå…¨å±€â€ï¼ˆ<code>global</code>ï¼‰æ¨¡å¼ï¼Œå®ƒç¡®ä¿æ¯å°æœºå™¨åªèƒ½è·å¾—æŒ‡å®šå®¹å™¨çš„ä¸€ä¸ªå®ä¾‹ã€‚ä½ é€šè¿‡åœ¨<code>composeæ–‡ä»¶</code>æ¥æŒ‡ç¤º<code>swarm manager</code>ä½¿ç”¨è¿™äº›ç­–ç•¥ã€‚</p>
<p><code>swarm manager</code>æ˜¯é›†ç¾¤ä¸­å”¯ä¸€å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„æœºå™¨ï¼Œä¹Ÿæ˜¯å”¯ä¸€å¯ä»¥æˆæƒå…¶ä»–æœºå™¨ä½œä¸º<code>worker</code>åŠ å…¥é›†ç¾¤çš„æœºå™¨ã€‚<code>worker</code>åªæä¾›<code>capacity</code>ï¼Œå®ƒæ— æ³•å‘Šè¯‰ä»»ä½•å…¶ä»–æœºå™¨å®ƒå¯ä»¥åšä»€ä¹ˆå’Œä¸èƒ½åšä»€ä¹ˆã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯slack"><a href="#ä»€ä¹ˆæ˜¯slack" class="headerlink" title="ä»€ä¹ˆæ˜¯slack"></a>ä»€ä¹ˆæ˜¯slack</h3><p><code>stack</code>æ˜¯ä¸€ç»„ç›¸äº’å…³è”çš„æœåŠ¡ï¼Œå¯ä»¥è¢«ä¸€èµ·ç¼–æ’ã€‚<code>å•ä¸ªstack</code>èƒ½å¤Ÿå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼ˆå°½ç®¡éå¸¸å¤æ‚çš„åº”ç”¨ç¨‹åºå¯èƒ½å¸Œæœ›ä½¿ç”¨å¤šä¸ªstackï¼‰ã€‚</p>
<h2 id="Set-up-your-swarm"><a href="#Set-up-your-swarm" class="headerlink" title="Set up your swarm"></a>Set up your swarm</h2><p>ä¸€ä¸ª<code>swarm</code>ç”±å¾ˆå¤š<code>node</code>ç»„æˆï¼Œ<code>node</code>å¯ä»¥æ˜¯ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºã€‚åŸºæœ¬æ¦‚å¿µå¾ˆç®€å•ï¼šè¿è¡Œ<code>docker swarm init</code>å¯ç”¨é›†ç¾¤æ¨¡å¼ï¼Œä½¿å½“å‰çš„æœºå™¨æˆä¸º<code>manager</code>ï¼Œç„¶ååœ¨å…¶ä»–æœºå™¨ä¸Šè¿è¡Œ<code>docker swarm join</code>ï¼Œä½¿ä»–ä»¬ä»¥<code>worker</code>èº«ä»½åŠ å…¥é›†ç¾¤ã€‚</p>
<h3 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨æœ¬æœºåˆ›å»ºå‡ å°è™šæ‹Ÿæœºæ¥åˆ›å»ºæˆ‘ä»¬çš„é›†ç¾¤ï¼ˆéœ€è¦å®‰è£…<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="external">VirtualBox</a>ï¼‰</p>
<p>é¦–å…ˆï¼Œä½¿ç”¨<code>docker-machine</code>å‘½ä»¤ï¼Œé€šè¿‡<code>VirtualBox</code>é©±åŠ¨åˆ›å»ºä¸¤å°è™šæ‹Ÿæœºï¼Œ<code>myvm1</code>å’Œ<code>myvm2</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> docker-machine create --driver virtualbox myvm1</div><div class="line"><span class="meta">$</span> docker-machine create --driver virtualbox myvm2</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†<code>myvm1</code>ç”¨ä½œmanagerï¼Œå®ƒå¯ä»¥æ‰§è¡Œdockerå‘½ä»¤å’Œæˆæƒåˆ«çš„workeråŠ å…¥swarmï¼Œ<code>myvm2</code>å°†ä½œä¸ºworkerã€‚</p>
<p>ç™»å½•<code>docker-machine</code>åˆ›å»ºçš„è™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨<code>docker-machine sshå‘½ä»¤</code>,ä¸‹é¢æˆ‘ä»¬è®¾ç½®<code>myvm1</code>ä¸ºmanagerï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ls</div><div class="line">NAME    ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS</div><div class="line">myvm1   -        virtualbox   Running   tcp://192.168.99.101:2376           v17.06.2-ce</div><div class="line">myvm2   -        virtualbox   Running   tcp://192.168.99.102:2376           v17.06.2-ce</div><div class="line">âœ  docker-machine ssh myvm1 "docker swarm init --advertise-addr 192.168.99.101:2377"</div><div class="line"></div><div class="line">Swarm initialized: current node (u5e02o4thu4uurxm9w71kxtu5) is now a manager.</div><div class="line"></div><div class="line">To add a worker to this swarm, run the following command:</div><div class="line"></div><div class="line">    docker swarm join --token SWMTKN-1-02sp63h6alkj7sd57dkv6omkyvkb60y05delt5zvkspe0293ao-dtmm6kqjzbbe33jmo03yrml8t 192.168.99.101:2377</div><div class="line"></div><div class="line">To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›å€¼ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªé…ç½®å¥½çš„<code>docker swarm join</code>å‘½ä»¤ï¼Œå¤åˆ¶è¿™ä¸ªå‘½ä»¤ï¼Œåœ¨myvm2ä¸Šæ‰§è¡Œï¼Œä½¿myvm2åŠ å…¥ä½ çš„swarmä½œä¸ºworkerï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ssh myvm2 "docker swarm join --token SWMTKN-1-02sp63h6alkj7sd57dkv6omkyvkb60y05delt5zvkspe0293ao-dtmm6kqjzbbe33jmo03yrml8t 192.168.99.101:2377"</div><div class="line">This node joined a swarm as a worker.</div></pre></td></tr></table></figure>
<p>ğŸ‰ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª<code>swarm</code>åˆ›å»ºæˆåŠŸäº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç™»ä¸Š<code>myvm1</code>å»çœ‹çœ‹ç°åœ¨çš„èŠ‚ç‚¹æƒ…å†µï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ssh myvm1</div><div class="line">                        ##         .</div><div class="line">                  ## ## ##        ==</div><div class="line">               ## ## ## ## ##    ===</div><div class="line">           /"""""""""""""""""\___/ ===</div><div class="line">      ~~~ &#123;~~ ~~~~ ~~~ ~~~~ ~~~ ~ /  ===- ~~~</div><div class="line">           \______ o           __/</div><div class="line">             \    \         __/</div><div class="line">              \____\_______/</div><div class="line"> _                 _   ____     _            _</div><div class="line">| |__   ___   ___ | |_|___ \ __| | ___   ___| | _____ _ __</div><div class="line">| '_ \ / _ \ / _ \| __| __) / _` |/ _ \ / __| |/ / _ \ '__|</div><div class="line">| |_) | (_) | (_) | |_ / __/ (_| | (_) | (__|   &lt;  __/ |</div><div class="line">|_.__/ \___/ \___/ \__|_____\__,_|\___/ \___|_|\_\___|_|</div><div class="line">Boot2Docker version 17.06.2-ce, build HEAD : ff16afa - Wed Sep  6 00:17:25 UTC 2017</div><div class="line">Docker version 17.06.2-ce, build cec0b72</div><div class="line"></div><div class="line">docker@myvm1:~$ docker node ls</div><div class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</div><div class="line">ggr9eji9z868qrorwerufrr45     myvm2               Ready               Active</div><div class="line">u5e02o4thu4uurxm9w71kxtu5 *   myvm1               Ready               Active              Leader</div></pre></td></tr></table></figure>
<p>ä¸€ç›®äº†ç„¶ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªnodeï¼Œmyvm1æ˜¯ä½œä¸ºleaderå­˜åœ¨</p>
<h2 id="éƒ¨ç½²åº”ç”¨"><a href="#éƒ¨ç½²åº”ç”¨" class="headerlink" title="éƒ¨ç½²åº”ç”¨"></a>éƒ¨ç½²åº”ç”¨</h2><p>æˆ‘ä»¬ä½¿ç”¨<a href="https://github.com/michaelyou/docker_swarm_deploy" target="_blank" rel="external">è¿™ä¸ª</a>ç®€å•çš„pythonåº”ç”¨æ¥ä½œä¸ºéƒ¨ç½²å¯¹è±¡ï¼Œä½ å®Œå…¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„åº”ç”¨ç¨‹åº(ä½†è¿˜æ˜¯å»ºè®®ç”¨æˆ‘ä½¿ç”¨çš„è¿™ä¸ªç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨æ‰“å°äº†containerçš„hostnameï¼Œè¿™æ˜¯ä¸‹é¢è´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªæµ‹è¯•)ã€‚</p>
<p>é¦–å…ˆå°†<code>docker-compose.yml</code>æ‹·è´åˆ°<code>myvm1</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine scp docker-compose.yml myvm1:~</div></pre></td></tr></table></figure>
<p>ç„¶åå°±æ˜¯éƒ¨ç½²äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker-machine ssh myvm1 "docker stack deploy -c docker-compose.yml firstswarmapp"</div><div class="line"></div><div class="line">Creating service firstswarmapp_visualizer</div><div class="line">Creating service firstswarmapp_redis</div><div class="line">Creating service firstswarmapp_web</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™éƒ¨ç½²å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æˆæœï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">âœ  docker-machine ssh myvm1 "docker stack ls"</div><div class="line">NAME                SERVICES</div><div class="line">firstswarmapp       1</div><div class="line">âœ  docker-machine ssh myvm1 "docker stack ps firstswarmapp"</div><div class="line">ID                  NAME                  IMAGE                         NODE                DESIRED STATE       CURRENT STATE                  ERROR               PORTS</div><div class="line">ID                  NAME                         IMAGE                             NODE                DESIRED STATE       CURRENT STATE                 ERROR                              PORTS</div><div class="line">6lfkdnzq27yf        firstswarmapp_redis.1        redis:latest                      myvm1               Running             Running 43 seconds ago</div><div class="line">ui2tdail0fxv        firstswarmapp_visualizer.1   dockersamples/visualizer:stable   myvm1               Running             Running 2 minutes ago</div><div class="line">901cprboy06k        firstswarmapp_web.1          michaelyou/friendlyhello:v1       myvm2               Running             Running 33 minutes ago</div><div class="line">uvju8t48sc2s        firstswarmapp_web.2          michaelyou/friendlyhello:v1       myvm2               Running             Running 33 minutes ago</div><div class="line">sk2z91e4yn9x        firstswarmapp_web.3          michaelyou/friendlyhello:v1       myvm1               Running             Running 34 minutes ago</div><div class="line">tuzdxnfyofyc        firstswarmapp_web.4          michaelyou/friendlyhello:v1       myvm2               Running             Running 33 minutes ago</div><div class="line">715at7211p8k        firstswarmapp_web.5          michaelyou/friendlyhello:v1       myvm1               Running             Running 34 minutes ago</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸€å…±æœ‰7ä¸ª<code>container</code>ã€‚<code>web</code>5ä¸ªï¼Œåˆ†å¸ƒåœ¨ä¸¤å°æœºå™¨ä¸Šï¼Œ<code>redis</code>å’Œ<code>visualizer</code>å„ä¸€ä¸ªï¼Œåœ¨<code>managerèŠ‚ç‚¹</code>ä¸Šã€‚è¿™å’Œæˆ‘ä»¬åœ¨<code>docker-compose.yml</code>ä¸­å®šä¹‰çš„ä¸€æ ·ã€‚</p>
<p><code>myvm1</code>å’Œ<code>myvm2</code>çš„åœ°å€éƒ½å¯ä»¥è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ã€‚ä½ åˆ›å»ºçš„ç½‘ç»œåœ¨å®ƒä»¬ä¹‹é—´æ˜¯å…±äº«ï¼Œå¹¶ä¸”è´Ÿè½½å¹³è¡¡çš„ã€‚è¿è¡Œ<code>docker-machine ls</code>æ¥è·å–ä½ çš„è™šæ‹Ÿæœºçš„IPåœ°å€ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸Šè®¿é—®å®ƒä»¬ï¼Œå¹¶åˆ·æ–°ã€‚ä½ ä¼šçœ‹åˆ°äº”ä¸ªå¯èƒ½çš„å®¹å™¨IDï¼Œå®ƒä»¬éšæœºå¾ªç¯ï¼Œæ˜¾ç¤ºäº†è´Ÿè½½å¹³è¡¡çš„å­˜åœ¨ã€‚</p>
<p>ä¸¤ä¸ªIPåœ°å€éƒ½èƒ½å·¥ä½œçš„åŸå› æ˜¯ç¾¤é›†ä¸­çš„èŠ‚ç‚¹åŠ å…¥äº†ä¸€ä¸ªå…¥å£è·¯ç”±ç½‘æ ¼ï¼ˆrouting meshï¼‰ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨é›†ç¾¤ä¸­æŸä¸ªç«¯å£éƒ¨ç½²çš„æœåŠ¡å§‹ç»ˆå°†è¯¥ç«¯å£ä¿ç•™ç»™å…¶è‡ªå·±ï¼Œæ— è®ºå®é™…è¿è¡Œå®¹å™¨çš„æ˜¯å“ªä¸ªèŠ‚ç‚¹ã€‚ä»¥ä¸‹æ˜¯åœ¨ä¸€ä¸ªä¸‰èŠ‚ç‚¹é›†ç¾¤çš„8080ç«¯å£ä¸Šéƒ¨ç½²çš„åä¸ºmy-webçš„æœåŠ¡çš„è·¯ç”±ç½‘æ ¼ç¤ºæ„å›¾ï¼š</p>
<p><img src="/img/ingress-routing-mesh.png" alt="ingress-routing-mesh"></p>
<p>å¦‚æœæƒ³è¦å¢åŠ å®¹å™¨ä¸ªæ•°ï¼Œåªè¦ä¿®æ”¹<code>docker-compose.yml</code>æ–‡ä»¶ä¸­çš„replicasçš„æ•°é‡ï¼Œç„¶åé‡æ–°æ‰§è¡Œdeployå°±å¯ä»¥äº†ã€‚</p>
<p>å¦‚æœè¦åŠ å…¥æ–°çš„nodeï¼Œåªè¦åœ¨æ–°çš„æœºå™¨ä¸Šæ‰§è¡Œæˆ‘ä»¬åœ¨<code>myvm2</code>ä¸Šæ‰§è¡Œçš„<code>docker swarm join</code>å‘½ä»¤å°±å¯ä»¥äº†ï¼ŒåŠ å…¥æ–°çš„èŠ‚ç‚¹åï¼Œé‡æ–°æ‰§è¡Œdeployï¼Œæˆ‘ä»¬å°±èƒ½ç”¨ä¸Šæ–°çš„æœºå™¨äº†ï¼ˆæ³¨æ„è¦é‡æ–°æ‰§è¡Œdeployï¼Œä¸ä¼šè‡ªåŠ¨deployï¼Œè¿™ä¸€ç‚¹å’Œelasticsearchç­‰è½¯ä»¶ä¸ä¸€æ ·ï¼‰ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬éƒ¨ç½²äº†visualizerï¼Œå¯ä»¥é€šè¿‡ç½‘é¡µæ¥çœ‹çœ‹æˆ‘ä»¬é›†ç¾¤ç°åœ¨çš„æƒ…å†µï¼š</p>
<p><img src="/img/my_swarm.png" alt="my swarm"></p>
<p>è·Ÿ<code>docker stack ps</code>è¾“å‡ºæ˜¯ä¸€è‡´çš„ã€‚</p>
<h2 id="æ¸…ç†"><a href="#æ¸…ç†" class="headerlink" title="æ¸…ç†"></a>æ¸…ç†</h2><p>æ¸…ç†stack</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine ssh myvm1 "docker stack rm firstswarmapp"</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™swarmè¿˜æ˜¯åœ¨çš„ï¼Œæ¸…ç†swarmï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine ssh myvm1 "docker swarm leave --force"</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/12/dockeræºç åˆ†æ1-cli/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/12/dockeræºç åˆ†æ1-cli/" itemprop="url">dockeræºç åˆ†æï¼ˆä¸€ï¼‰-cli</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-12T20:41:10+08:00">
                2017-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Dockerä»£ç æ›´æ–°å¾ˆå¿«ï¼Œç½‘ä¸Šå„ä½å¤§ç¥çš„æºç è§£æå¾ˆå¤šå·²ç»æ˜¯å‡ å¹´å‰çš„ç‰ˆæœ¬äº†ã€‚å®ç°ä¸Šæœ‰äº†å¾ˆå¤§æ”¹å˜ï¼ŒåŠ ä¹‹Dockeré¡¹ç›®æ›´åä¸º<a href="https://github.com/moby/moby" target="_blank" rel="external">moby</a>ï¼Œå…¶ä¸­å¾ˆå¤šç»„ä»¶åˆä»mobyä¸­æ‹†åˆ†äº†å‡ºæ¥ï¼Œä¸€å¼€å§‹çœ‹ç®€ç›´æ˜¯ä¸€è„¸æ‡µé€¼å•Šã€‚åœ¨è¿™é‡Œè·Ÿå¤§å®¶åˆ†äº«äº†ä¸€ä¸‹æœ€è¿‘çœ‹çš„<a href="https://github.com/docker/cli" target="_blank" rel="external">docker/cli</a>çš„æºç ï¼ŒæŠ›ç –å¼•ç‰ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p>
<p>åˆ†æçš„<code>docker client</code>ç‰ˆæœ¬æ˜¯<code>17.06.2-ce</code>ã€‚</p>
<p><code>docker client</code>æ˜¯Dockerçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ•²çš„<code>docker * *</code> å‘½ä»¤ï¼Œæˆ‘ä»¬é€šè¿‡ä»–ä¸<code>docker deamon</code>ç¨‹åºè¿›è¡Œäº¤äº’ã€‚å¯ä»¥å°†ä»–çœ‹æˆä¸€ä¸ªæ™®é€šçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œdockerçš„æ ¸å¿ƒ<code>namespace</code>å’Œ<code>cgroup</code>ç­‰æŠ€æœ¯éƒ½ä¸åœ¨è¿™é‡Œã€‚</p>
<h2 id="æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ"><a href="#æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ" class="headerlink" title="æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ"></a>æ­å»ºdocker-clientå¼€å‘ç¯å¢ƒ</h2><p><code>docker_client</code>çš„å¼€å‘ç¯å¢ƒä¹Ÿæ˜¯åœ¨å®¹å™¨ä¸­ï¼Œé¡¹ç›®å·²ç»ç»™æˆ‘ä»¬åšå¥½äº†å°è£…ï¼Œå…·ä½“å¯ä»¥å‚è€ƒé¡¹ç›®Readmeçš„<a href="https://github.com/docker/cli#development" target="_blank" rel="external">Development</a>ç« èŠ‚ã€‚</p>
<p>é—®å‡ ä¸ªé—®é¢˜ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼š</p>
<h4 id="1-å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ"><a href="#1-å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ" class="headerlink" title="1. å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ"></a>1. å¼€å‘æ˜¯åœ¨å®¹å™¨ä¸­ï¼Œå¯æ˜¯å®¹å™¨é‡Œé¢è¿ç¼–è¾‘å™¨éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿ</h4><p>ç­”ï¼š å‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯åœ¨å®¹å™¨ä¸­è°ƒè¯•ï¼Œå¼€å‘è¿˜æ˜¯åœ¨æœ¬åœ°å¼€å‘ï¼Œå®¹å™¨ä¸­çœ‹åˆ°çš„ç›®å½•æ˜¯æˆ‘ä»¬æœ¬åœ°ç›®å½•mountè¿›å»çš„</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> docker.Makefileæ–‡ä»¶</div><div class="line"></div><div class="line">......</div><div class="line">MOUNTS = -v "$(CURDIR)":/go/src/github.com/docker/cli</div><div class="line">......</div><div class="line"><span class="meta">#</span> start container in interactive mode for in-container development</div><div class="line">.PHONY: dev</div><div class="line">dev: build_docker_image</div><div class="line">    docker run -ti --security-opt=seccomp:unconfined $(ENVVARS) $(MOUNTS) \</div><div class="line">        -v /var/run/docker.sock:/var/run/docker.sock \</div><div class="line">        $(DEV_DOCKER_IMAGE_NAME) ash</div><div class="line"></div><div class="line">shell: dev</div><div class="line">......</div></pre></td></tr></table></figure>
<p>ä»shellé‡Œé¢è¿˜æ˜¯å¾ˆå®¹å™¨çœ‹å‡ºæ¥çš„ï¼Œrunçš„æ—¶å€™mountäº†<code>$(CURDIR)</code></p>
<h4 id="2-å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ"><a href="#2-å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ" class="headerlink" title="2. å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ"></a>2. å®¹å™¨é‡Œé¢æ˜¯ä¸æ˜¯è¿˜è£…äº†ä¸€ä¸ªdockerå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨é‡Œé¢æ•²å‘½ä»¤æœ‰å“åº”ï¼Ÿ</h4><p>ç­”ï¼šä¸æ˜¯çš„ï¼Œé‡Œé¢åªæœ‰ä½ ç¼–è¯‘ç”Ÿæˆçš„docker clientç¨‹åºï¼Œæ˜¯æ²¡æœ‰docker deamonç¨‹åºï¼Œè‡³äºä¸ºä»€ä¹ˆèƒ½å“åº”ï¼Œè¿˜æ˜¯çœ‹ä¸Šé¢çš„shellè„šæœ¬ï¼Œ<code>-v /var/run/docker.sock:/var/run/docker.sock</code>è¿™ä¸€è¡Œå°†<code>docker.sock</code>æ–‡ä»¶ä¹Ÿmountäº†è¿›å»ï¼Œ<code>docker.sock</code>æ˜¯<code>docker deamon</code>é»˜è®¤ç›‘å¬çš„Unixå¥—æ¥å­—ï¼ˆUnix domain socketï¼‰ï¼Œå®¹å™¨ä¸­çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ä»–ä¸docker deamonè¿›è¡Œé€šä¿¡ã€‚æ‰€ä»¥è¿™é‡Œdocker clienté€šä¿¡çš„æ˜¯ä½ æœ¬æœºçš„docker daemonã€‚</p>
<p><img src="/img/docker_deamon_socket.png" alt="docker_deamon_socket"></p>
<blockquote>
<p>Note: å…³äº<code>/var/run/docker.sock</code>æ›´å¤šå†…å®¹å¯ä»¥çœ‹<a href="https://medium.com/lucjuggery/about-var-run-docker-sock-3bfd276e12fd" target="_blank" rel="external">è¿™é‡Œ</a></p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬çš„å¼€å‘æµç¨‹æ˜¯ï¼šæœ¬åœ°æ”¹ä»£ç â€“&gt;åˆ°containerä¸­ç¼–è¯‘â€“&gt;è¿è¡Œdocker clientçœ‹æ•ˆæœ</p>
<h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>æ˜¯æ—¶å€™è¡¨æ¼”çœŸæ­£çš„æŠ€æœ¯äº†ï¼</p>
<p>ğŸ˜†ï¼Œå¼€ä¸ªç©ç¬‘ï¼Œä¸‹é¢çš„åˆ†æå¦‚æœæœ‰é—®é¢˜ï¼Œè¿˜è¯·å¤§å®¶ä¸åèµæ•™ï¼</p>
<p>æˆ‘å°½é‡æŠŠæ–‡ä»¶è·¯å¾„åˆ—å‡ºæ¥ï¼Œä¼šè´´ä¸€äº›ä»£ç ï¼Œä½†ä¸»è¦è¿˜æ˜¯è·¯å¾„ï¼Œå»ºè®®å¤§å®¶æŠŠä»£ç cloneä¸‹æ¥ç…§ç€çœ‹ã€‚</p>
<p>dockerâ€”clientæ˜¯åŸºäº<a href="https://github.com/spf13/cobra" target="_blank" rel="external">cobra</a>å†™çš„ï¼Œå»ºè®®å¤§å®¶å…ˆçœ‹ä¸€ä¸‹cobraï¼Œè‡³å°‘å†™ä¸ª<code>hello world</code>ç†Ÿæ‚‰ä¸€ä¸‹åŸºæœ¬ç”¨æ³•ã€‚</p>
<p>æˆ‘ä»¬å¼€å§‹äº†ï¼</p>
<p>å…¥å£æ–‡ä»¶åœ¨<code>cmd/docker/docker.go</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// æ—¥å¿—è¾“å‡ºé‡‡ç”¨äº†ç¬¬ä¸‰æ–¹åº“logrus</span></div><div class="line">    <span class="comment">// Set terminal emulation based on platform as required.</span></div><div class="line">    stdin, stdout, stderr := term.StdStreams()</div><div class="line">    logrus.SetOutput(stderr)</div><div class="line"></div><div class="line">    dockerCli := command.NewDockerCli(stdin, stdout, stderr)</div><div class="line">    </div><div class="line">    <span class="comment">// rootå‘½ä»¤ï¼Œå­å‘½ä»¤éƒ½åœ¨è¿™é‡Œé¢ï¼Œé‡ç‚¹çœ‹</span></div><div class="line">    cmd := newDockerCommand(dockerCli)</div><div class="line"></div><div class="line">    <span class="comment">// å‘½ä»¤æ‰§è¡Œ	</span></div><div class="line">    <span class="keyword">if</span> err := cmd.Execute(); err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">if</span> sterr, ok := err.(cli.StatusError); ok &#123;</div><div class="line">            <span class="keyword">if</span> sterr.Status != <span class="string">""</span> &#123;</div><div class="line">                fmt.Fprintln(stderr, sterr.Status)</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// StatusError should only be used for errors, and all errors should</span></div><div class="line">            <span class="comment">// have a non-zero exit status, so never exit with 0</span></div><div class="line">            <span class="keyword">if</span> sterr.StatusCode == <span class="number">0</span> &#123;</div><div class="line">                os.Exit(<span class="number">1</span>)</div><div class="line">            &#125;</div><div class="line">            os.Exit(sterr.StatusCode)</div><div class="line">        &#125;</div><div class="line">        fmt.Fprintln(stderr, err)</div><div class="line">        os.Exit(<span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿˜æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼Œ<code>newDockerCommand</code>å‡½æ•°è°ƒç”¨äº†<code>commands.AddCommands(cmd, dockerCli)</code>æ¥æ·»åŠ å‘½ä»¤ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">newDockerCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        opts := cliflags.NewClientOptions()</div><div class="line">        <span class="keyword">var</span> flags *pflag.FlagSet</div><div class="line"></div><div class="line">        cmd := &amp;cobra.Command&#123;</div><div class="line">                Use:              <span class="string">"docker [OPTIONS] COMMAND [ARG...]"</span>,</div><div class="line">                Short:            <span class="string">"A self-sufficient runtime for containers"</span>,</div><div class="line">                SilenceUsage:     <span class="literal">true</span>,</div><div class="line">                SilenceErrors:    <span class="literal">true</span>,</div><div class="line">                TraverseChildren: <span class="literal">true</span>,</div><div class="line">                Args:             noArgs,</div><div class="line">                RunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="keyword">if</span> opts.Version &#123;</div><div class="line">                                showVersion()</div><div class="line">                                <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> command.ShowHelp(dockerCli.Err())(cmd, args)</div><div class="line">                &#125;,</div><div class="line">                PersistentPreRunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="comment">// daemon command is special, we redirect directly to another binary</span></div><div class="line">                        <span class="keyword">if</span> cmd.Name() == <span class="string">"daemon"</span> &#123;</div><div class="line">                                <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">                        &#125;</div><div class="line">                        <span class="comment">// flags must be the top-level command flags, not cmd.Flags()</span></div><div class="line">                        opts.Common.SetDefaultOptions(flags)</div><div class="line">                        dockerPreRun(opts)</div><div class="line">                        <span class="keyword">if</span> err := dockerCli.Initialize(opts); err != <span class="literal">nil</span> &#123;</div><div class="line">                                <span class="keyword">return</span> err</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> isSupported(cmd, dockerCli)</div><div class="line">                &#125;,</div><div class="line">        &#125;</div><div class="line">        cli.SetupRootCommand(cmd)</div><div class="line"></div><div class="line">        flags = cmd.Flags()</div><div class="line">        flags.BoolVarP(&amp;opts.Version, <span class="string">"version"</span>, <span class="string">"v"</span>, <span class="literal">false</span>, <span class="string">"Print version information and quit"</span>)</div><div class="line">        flags.StringVar(&amp;opts.ConfigDir, <span class="string">"config"</span>, cliconfig.Dir(), <span class="string">"Location of client config files"</span>)</div><div class="line">        opts.Common.InstallFlags(flags)</div><div class="line"></div><div class="line">        setFlagErrorFunc(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        setHelpFunc(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        cmd.SetOutput(dockerCli.Out())</div><div class="line">        cmd.AddCommand(newDaemonCommand())</div><div class="line">        # æ·»åŠ å­å‘½ä»¤ï¼Œcmdé‡Œç°åœ¨æ˜¯rootå‘½ä»¤</div><div class="line">        commands.AddCommands(cmd, dockerCli)</div><div class="line"></div><div class="line">        setValidateArgs(dockerCli, cmd, flags, opts)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> cmd</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™è¡Œä¸Šé¢çš„<code>cmd.AddCommand(newDaemonCommand())</code>æ˜¯ä¸º<code>docker daemon</code>å‘½ä»¤è¿›è¡Œçš„è¾“å‡ºï¼Œ<code>newDaemonCommand</code>å®šä¹‰åœ¨<code>cmd/docker/daemon_none.go</code>ä¸­ï¼Œä»ä»–çš„<code>RunE</code>æ–¹æ³•å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯è¾“å‡ºäº†ä¸èƒ½è¿è¡Œçš„æç¤ºï¼Œ<code>runtime.GOOS</code>æ˜¯è¾“å‡ºå½“å‰ç³»ç»Ÿçš„åç§°ï¼Œæ¯”å¦‚macæ˜¯<code>Darwin</code>ï¼Œ ubuntuæ˜¯<code>linux</code>ï¼Œå®Œæ•´çœ‹æ¥å°±æ˜¯:</p>
<pre><code>`docker daemon` is not supported on Darwin. Please run `dockerd` directly
</code></pre><p>è®©æˆ‘ä»¬æ¥åˆ°<code>commands.AddCommands</code>å®šä¹‰çš„åœ°æ–¹ï¼Œ<code>cli/command/commands/commands.go</code>æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°<code>cmd.AddCommand</code>çš„è°ƒç”¨ï¼Œè¿™é‡Œå°±æ˜¯åœ¨æ·»åŠ æˆ‘ä»¬çœ‹åˆ°çš„äºŒçº§å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ç´§è·Ÿç€<code>docker</code>åé¢çš„å‘½ä»¤ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddCommands</span><span class="params">(cmd *cobra.Command, dockerCli *command.DockerCli)</span></span> &#123;</div><div class="line">        cmd.AddCommand(</div><div class="line">                ......</div><div class="line"></div><div class="line">                <span class="comment">// container</span></div><div class="line">                container.NewContainerCommand(dockerCli),</div><div class="line">                container.NewRunCommand(dockerCli),</div><div class="line">                </div><div class="line">                ......</div><div class="line">                hide(container.NewPsCommand(dockerCli)),</div><div class="line">                hide(container.NewRenameCommand(dockerCli)),</div><div class="line">                ......</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä»ä¸Šçœ‹åˆ°ä¸‹ï¼Œæ•´é½åˆ’ä¸€ä¸­å‘ç°æœ€åå¥½å¤šå‘½ä»¤è¢«ç”¨hideåŒ…è£¹äº†ã€‚è¿™äº›å‘½ä»¤æ˜¯ä¸€äº›æ—§å‘½ä»¤ï¼Œåœ¨æ–°çš„ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨æ–°çš„å‘½ä»¤æ¥ä»£æ›¿ï¼Œå¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡<code>DOCKER_HIDE_LEGACY_COMMANDS</code>ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆdockerçš„æç¤ºå°†ä¸ä¼šè¾“å‡ºè¿™äº›ã€‚</p>
<p>è¿™é‡Œçš„å‘½ä»¤å¤ªå¤šäº†ï¼Œæˆ‘ä»¬é€šè¿‡<code>docker ps</code>å‘½ä»¤æ¥äº†è§£ä¸€ä¸‹å¤§è‡´çš„æ‰§è¡Œæµç¨‹ã€‚</p>
<p><code>docker ps</code>å‘½ä»¤ä¹Ÿæ˜¯æ—§ç‰ˆçš„å‘½ä»¤ï¼Œ<code>hide(container.NewPsCommand(dockerCli))</code>å°±æ˜¯åœ¨å¤„ç†ä»–ã€‚åœ¨æ–°ç‰ˆæœ¬ä¸­å¯¹åº”çš„æ˜¯<code>docker container ls</code>å‘½ä»¤ã€‚å®ç°ä»£ç åœ¨<code>cli/command/container/list.go</code>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// NewPsCommand creates a new cobra.Command for `docker ps`</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPsCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        options := psOptions&#123;filter: opts.NewFilterOpt()&#125;</div><div class="line"></div><div class="line">        cmd := &amp;cobra.Command&#123;</div><div class="line">                Use:   <span class="string">"ps [OPTIONS]"</span>,</div><div class="line">                Short: <span class="string">"List containers"</span>,</div><div class="line">                Args:  cli.NoArgs,</div><div class="line">                RunE: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">                        <span class="keyword">return</span> runPs(dockerCli, &amp;options)</div><div class="line">                &#125;,</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        flags := cmd.Flags()</div><div class="line"></div><div class="line">        flags.BoolVarP(&amp;options.quiet, <span class="string">"quiet"</span>, <span class="string">"q"</span>, <span class="literal">false</span>, <span class="string">"Only display numeric IDs"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.size, <span class="string">"size"</span>, <span class="string">"s"</span>, <span class="literal">false</span>, <span class="string">"Display total file sizes"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.all, <span class="string">"all"</span>, <span class="string">"a"</span>, <span class="literal">false</span>, <span class="string">"Show all containers (default shows just running)"</span>)</div><div class="line">        flags.BoolVar(&amp;options.noTrunc, <span class="string">"no-trunc"</span>, <span class="literal">false</span>, <span class="string">"Don't truncate output"</span>)</div><div class="line">        flags.BoolVarP(&amp;options.nLatest, <span class="string">"latest"</span>, <span class="string">"l"</span>, <span class="literal">false</span>, <span class="string">"Show the latest created container (includes all states)"</span>)</div><div class="line">        flags.IntVarP(&amp;options.last, <span class="string">"last"</span>, <span class="string">"n"</span>, <span class="number">-1</span>, <span class="string">"Show n last created containers (includes all states)"</span>)</div><div class="line">        flags.StringVarP(&amp;options.format, <span class="string">"format"</span>, <span class="string">""</span>, <span class="string">""</span>, <span class="string">"Pretty-print containers using a Go template"</span>)</div><div class="line">        flags.VarP(&amp;options.filter, <span class="string">"filter"</span>, <span class="string">"f"</span>, <span class="string">"Filter output based on conditions provided"</span>)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> cmd</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">newListCommand</span><span class="params">(dockerCli *command.DockerCli)</span> *<span class="title">cobra</span>.<span class="title">Command</span></span> &#123;</div><div class="line">        cmd := *NewPsCommand(dockerCli)</div><div class="line">        cmd.Aliases = []<span class="keyword">string</span>&#123;<span class="string">"ps"</span>, <span class="string">"list"</span>&#125;</div><div class="line">        cmd.Use = <span class="string">"ls [OPTIONS]"</span></div><div class="line">        <span class="keyword">return</span> &amp;cmd</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>NewPsCommand</code>å¯¹åº”çš„æ˜¯<code>docker ps</code>, <code>newListCommand</code>å¯¹åº”çš„æ˜¯<code>docker container ls</code>ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œ <code>newListCommand</code>é‡Œçš„commandå°±æ˜¯<code>NewPsCommand</code>è¿”å›çš„ï¼Œåªæ˜¯åŠ äº†ä¸€ä¸‹è¯´æ˜è€Œå·²ã€‚</p>
<blockquote>
<p>è¿™é‡Œè¿˜æ¼äº†ä¸€ç‚¹ï¼Œdocker container lsæ˜¯3ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬çŸ¥é“dockeræ˜¯rootå‘½ä»¤ï¼ŒæŒ‰ç…§cobraçš„å†™æ³•ï¼Œcontainerå’Œlsåº”è¯¥æ˜¯åˆ†å¼€çš„ã€‚ä»–ä»¬çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼Œåœ¨<code>cli/command/commands/commands.go</code>æ–‡ä»¶ä¸­<code>container.NewContainerCommand(dockerCli)</code>åŠ å…¥äº†<code>container</code>å‘½ä»¤ï¼Œ<code>NewContainerCommand</code>çš„å®ç°åœ¨<code>cli/command/container/cmd.go</code>ä¸­ï¼Œåœ¨<code>NewContainerCommand</code>å‡½æ•°ä¸­é€šè¿‡<code>newListCommand(dockerCli)</code>åŠ å…¥äº†lså‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¿˜æ·»åŠ äº†å¾ˆå¤šåˆ«çš„æ–¹æ³•ï¼Œé‚£äº›éƒ½æ˜¯<code>container</code>æ”¯æŒçš„å­å‘½ä»¤ã€‚è¿™æ ·å°±å›åˆ°äº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å†…å®¹äº†ï¼Œæ²¡æœ‰é­”æ³•</p>
</blockquote>
<p>æˆ‘ä»¬ç»§ç»­çœ‹<code>NewPsCommand</code>:</p>
<p>é‡Œé¢å®šä¹‰äº†<code>docker ps</code>ï¼ˆä¸‹é¢æ‰€æœ‰çš„å†…å®¹å¯¹<code>docker container ls</code>éƒ½é€‚ç”¨ï¼‰æ”¯æŒçš„ä¸€äº›é€‰é¡¹ï¼ˆflagï¼‰,é€‰é¡¹è¢«æ”¾åœ¨äº†psOptionsè¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œæœ€ç»ˆä¼ ç»™runPså‡½æ•°.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">runPs</span><span class="params">(dockerCli *command.DockerCli, options *psOptions)</span> <span class="title">error</span></span> &#123;</div><div class="line">        ctx := context.Background()</div><div class="line"></div><div class="line">        listOptions, err := buildContainerListOptions(options)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        containers, err := dockerCli.Client().ContainerList(ctx, *listOptions)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        format := options.format</div><div class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(format) == <span class="number">0</span> &#123;</div><div class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(dockerCli.ConfigFile().PsFormat) &gt; <span class="number">0</span> &amp;&amp; !options.quiet &#123;</div><div class="line">                        format = dockerCli.ConfigFile().PsFormat</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        format = formatter.TableFormatKey</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        containerCtx := formatter.Context&#123;</div><div class="line">                Output: dockerCli.Out(),</div><div class="line">                Format: formatter.NewContainerFormat(format, options.quiet, listOptions.Size),</div><div class="line">                Trunc:  !options.noTrunc,</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> formatter.ContainerWrite(containerCtx, containers)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>listOptions, err := buildContainerListOptions(options)</code>å¯¹é€‰é¡¹è¿›è¡Œäº†å¤„ç†ï¼Œé‡ç‚¹åœ¨<code>dockerCli.Client().ContainerList(ctx, *listOptions)</code>ï¼Œ<code>ContainerList</code>æ˜¯ä¸€ä¸ªinterfaceã€‚</p>
<p>å®ç°åœ¨<code>vendor/github.com/docker/docker/client/container_list.go</code>ï¼ˆvendoråœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæˆ‘æ˜¯goæ–°æ‰‹ï¼Œæ‰€ä»¥æ‹…å¿ƒå¤§å®¶ä¸çŸ¥é“ï¼Œé«˜æ‰‹å¿½ç•¥ï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cli *Client)</span> <span class="title">ContainerList</span><span class="params">(ctx context.Context, options types.ContainerListOptions)</span> <span class="params">([]types.Container, error)</span></span> &#123;</div><div class="line">        query := url.Values&#123;&#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.All &#123;</div><div class="line">                query.Set(<span class="string">"all"</span>, <span class="string">"1"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Limit != <span class="number">-1</span> &#123;</div><div class="line">                query.Set(<span class="string">"limit"</span>, strconv.Itoa(options.Limit))</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Since != <span class="string">""</span> &#123;</div><div class="line">                query.Set(<span class="string">"since"</span>, options.Since)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Before != <span class="string">""</span> &#123;</div><div class="line">                query.Set(<span class="string">"before"</span>, options.Before)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Size &#123;</div><div class="line">                query.Set(<span class="string">"size"</span>, <span class="string">"1"</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> options.Filters.Len() &gt; <span class="number">0</span> &#123;</div><div class="line">                filterJSON, err := filters.ToParamWithVersion(cli.version, options.Filters)</div><div class="line"></div><div class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                        <span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                query.Set(<span class="string">"filters"</span>, filterJSON)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        resp, err := cli.get(ctx, <span class="string">"/containers/json"</span>, query, <span class="literal">nil</span>)</div><div class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> containers []types.Container</div><div class="line">        err = json.NewDecoder(resp.body).Decode(&amp;containers)</div><div class="line">        ensureReaderClosed(resp)</div><div class="line">        <span class="keyword">return</span> containers, err</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å‰é¢æ˜¯åœ¨æ‹¼è¯·æ±‚çš„å‚æ•°ï¼Œ<code>resp, err := cli.get(ctx, &quot;/containers/json&quot;, query, nil)</code>è¿™é‡Œå‘èµ·äº†è¯·æ±‚ï¼Œè¿”å›äº†containerçš„åˆ—è¡¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡curlæˆ–ncæ¥è·å¾—åŸå§‹çš„æ•°æ®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">âœ  curl -XGET --unix-socket /var/run/docker.sock http://localhost/containers/json</div><div class="line">æˆ–è€…</div><div class="line">âœ  echo 'GET /containers/json HTTP/1.0\r\n\r\n' | nc -U /var/run/docker.sock</div><div class="line"></div><div class="line">[&#123;"Id":"c64ea306f74980555521ad2fcbb4c54e1b05e7ca0d597838557d4d613ed12039","Names":["/brave_swirles"],"Image":"docker-cli-dev","ImageID":"sha256:b123a157eaf7e4d468647b42be4c8e339e9e4b9e84058a56575dbfa7249161c9","Command":"ash","Created":1505218585,"Ports":[],"Labels":&#123;&#125;,"State":"running","Status":"Up 25 hours","HostConfig":&#123;"NetworkMode":"default"&#125;,"NetworkSettings":&#123;"Networks":&#123;"bridge":&#123;"IPAMConfig":null,"Links":null,"Aliases":null,"NetworkID":"4b149c263b9a12caef2b16482db33fded74eac5396a57da1724428948464e00f","EndpointID":"6a3fb06309f2142b23db84303cbdb5d55b3a41e91cf2468649bd5f2adee11c66","Gateway":"172.17.0.1","IPAddress":"172.17.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"MacAddress":"02:42:ac:11:00:02","DriverOpts":null&#125;&#125;&#125;,"Mounts":[&#123;"Type":"bind","Source":"/Users/youwangqiu/go_code/src/github.com/docker/cli","Destination":"/go/src/github.com/docker/cli","Mode":"","RW":true,"Propagation":"rprivate"&#125;,&#123;"Type":"bind","Source":"/var/run/docker.sock","Destination":"/var/run/docker.sock","Mode":"","RW":true,"Propagation":"rprivate"&#125;]&#125;]</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯ä»¥jsonæ ¼å¼è¿”å›çš„ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<p>å›åˆ°<code>cli/command/container/list.go</code>ï¼Œæ¥æ”¶åˆ°è¿”å›å€¼ä¹‹åï¼Œè¿™æ—¶å€™è¿˜æ˜¯ä¸Šé¢çœ‹åˆ°çš„jsonï¼Œä¸‹é¢è¿›è¡Œäº†æ ¼å¼åŒ–è¾“å‡ºï¼Œå¤§å®¶åº”è¯¥éƒ½æœ‰åšæ‰“å°<code>9*9ä¹˜æ³•è¡¨</code>çš„ç»å†ï¼Œè¿™é‡Œçš„æ ¼å¼åŒ–æ˜¯åŒæ ·çš„é“ç†ï¼Œä¸æ˜ç™½çš„åŒå­¦å¯ä»¥ç»§ç»­å¾€æŒ–ï¼Œæˆ‘å·ä¸ªæ‡’ï¼Œå°±ä¸ç»§ç»­äº†ã€‚</p>
<p>è‡³æ­¤<code>docker ps</code>çš„æµç¨‹å°±èµ°å®Œäº†ï¼Œå¤§å®¶å¯ä»¥å¯¹æºç åšä¸€äº›ä¿®æ”¹ï¼Œç„¶åè¿›åˆ°å®¹å™¨ä¸­æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make binary</div></pre></td></tr></table></figure>
<p>å°±å¯ä»¥ç”Ÿäº§æ–°çš„docker clientï¼Œæ‰§è¡Œä¸€ä¸‹å°±èƒ½å¾—åˆ°æƒ³è¦çš„è¾“å‡ºå•¦ã€‚</p>
<p>è°¢è°¢å¤§å®¶ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£ğŸ™‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/07/Moby-LinuxKit-åˆä½“éªŒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/07/Moby-LinuxKit-åˆä½“éªŒ/" itemprop="url">Moby & LinuxKit åˆä½“éªŒ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-07T21:14:16+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index">
                    <span itemprop="name">Docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Dockerçš„å¼€æºéƒ¨åˆ†è¢«æ”¹åæˆäº†<a href="https://github.com/moby/moby" target="_blank" rel="external">Moby</a>ï¼ŒåŒæ—¶Dockerå…¬å¸è¿˜å¼€æºäº†ä¸€ä¸ª<a href="https://github.com/linuxkit/linuxkit" target="_blank" rel="external">LinuxKit</a>çš„é¡¹ç›®ï¼Œå¤§å®¶å¯ä»¥å…ˆå»çœ‹ä¸€ä¸‹readmeã€‚</p>
<p>Mobyæ˜¯ä¸€ä¸ªç»„è£…å®¹å™¨ç³»ç»Ÿçš„æ¡†æ¶ã€‚å®ƒåŒ…å«ä¸€ä¸ªå®¹å™¨åŒ–ç»„ä»¶åº“å’Œä¸€ä¸ªå°†è¿™äº›ç»„ä»¶ç»„è£…æˆç‹¬ç«‹çš„å®¹å™¨ç³»ç»Ÿçš„æ¡†æ¶ã€‚ç›®å‰ï¼ŒDockeræ­£åœ¨è¢«æ‹†åˆ†æˆæ¨¡å—åŒ–çš„ç»„ä»¶ï¼Œå°†æ¥ï¼ŒDockerä¼šä»è¿™äº›è¢«Mobyæ‰“åŒ…çš„ç»„ä»¶ä¸­è¢«ç»„è£…å‡ºæ¥ã€‚</p>
<p>LinuxKitæ˜¯ä¸€ä¸ªç”¨æ¥æ„é€ æœ€å°Linuxå‘è¡Œç‰ˆçš„å·¥å…·é›†ã€‚å®ƒé€šè¿‡Mobyæ¥åˆ›å»ºé•œåƒï¼ˆimageï¼‰ï¼Œä½¿ç”¨LinuxKitå·¥å…·æ¥è¿è¡Œè¿™äº›é•œåƒã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥ä½“éªŒä¸€ä¸‹ï¼Œé¦–å…ˆç¡®ä¿ä½ å·²ç»å®‰è£…äº†<a href="https://docs.Docker.com/engine/installation/linux/docker-ce/ubuntu/#recommended-extra-packages-for-trusty-1404" target="_blank" rel="external">Docker</a>å’Œ<a href="https://golang.org/doc/install" target="_blank" rel="external">Golang</a>ã€‚</p>
<h3 id="æ„å»ºMoby"><a href="#æ„å»ºMoby" class="headerlink" title="æ„å»ºMoby"></a>æ„å»ºMoby</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">âœ  git clone https://github.com/linuxkit/linuxkit.git</div><div class="line">âœ  cd linuxkit</div><div class="line">âœ  make &amp;&amp; sudo make install</div><div class="line">âœ  moby version</div><div class="line">moby version 0.0</div><div class="line">commit: 1ff0e3beeeb1e741b9c5a54574f01ac5eee525a5</div></pre></td></tr></table></figure>
<h3 id="æ„å»ºlinuxé•œåƒ"><a href="#æ„å»ºlinuxé•œåƒ" class="headerlink" title="æ„å»ºlinuxé•œåƒ"></a>æ„å»ºlinuxé•œåƒ</h3><p>æ„å»ºé•œåƒæ˜¯é€šè¿‡yamlæ–‡ä»¶ï¼ˆæ ¼å¼å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://github.com/moby/tool/blob/master/docs/yaml.md" target="_blank" rel="external">LinuxKit YAML</a>ï¼‰ï¼Œlinuxkitç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>linuxkit.yml</code>å¯ä»¥ç”¨ï¼Œexamplesç›®å½•ä¸‹ä¹Ÿæœ‰å¾ˆå¤šå¯ç”¨çš„yamlæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»»é€‰ä¸€ä¸ªæ¥æ„å»ºï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨<code>linuxkit.yml</code>æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) moby build linuxkit.yml</div><div class="line">æœ€ååœ¨å½“å‰ç›®å½•ä¸‹è¾“å‡ºäº†3ä¸ªæ–‡ä»¶</div><div class="line">Create outputs:</div><div class="line">  linuxkit-kernel linuxkit-initrd.img linuxkit-cmdline</div></pre></td></tr></table></figure>
<h3 id="è¿è¡ŒLinuxKité•œåƒ"><a href="#è¿è¡ŒLinuxKité•œåƒ" class="headerlink" title="è¿è¡ŒLinuxKité•œåƒ"></a>è¿è¡ŒLinuxKité•œåƒ</h3><p>è¿è¡Œé€šè¿‡linuxkitè‡ªå¸¦çš„linuxkitå‘½ä»¤ï¼Œå‘½ä»¤åœ¨linuxkit/binç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯ä½“éªŒï¼Œä¹Ÿæ²¡å¿…è¦å†™PATHï¼Œå°±ç›´æ¥å†™å…¨è·¯å¾„å§ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) bin/linuxkit run linuxkit</div><div class="line">...æ»¡å±æ»¡å±çš„è¾“å‡ºï¼Œæœ€åæ˜¯ç†Ÿæ‚‰çš„ğŸ³</div><div class="line">Welcome to LinuxKit</div><div class="line"></div><div class="line">                        ##         .</div><div class="line">                  ## ## ##        ==</div><div class="line">               ## ## ## ## ##    ===</div><div class="line">           /"""""""""""""""""\___/ ===</div><div class="line">          &#123;                       /  ===-</div><div class="line">           \______ O           __/</div><div class="line">             \    \         __/</div><div class="line">              \____\_______/</div><div class="line">...</div></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å°±æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±æ„å»ºçš„linuxæœ€å°å‘è¡Œç‰ˆé‡Œé¢äº†ï¼Œæ•²å‡ ä¸ªå‘½ä»¤è¯•è¯•å§ï¼Œé€€å‡ºæ˜¯<code>halt</code>ã€‚</p>
<p>è¿™ä¸ªé•œåƒåªæœ‰54Mï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å°äº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">âœ  linuxkit git:(master) ls -alh | grep linuxkit</div><div class="line">-rw-r--r--  1 vagrant vagrant   42 Sep  7 11:52 linuxkit-cmdline</div><div class="line">-rw-r--r--  1 vagrant vagrant  54M Sep  7 11:52 linuxkit-initrd.img</div><div class="line">-rw-r--r--  1 vagrant vagrant 6.3M Sep  7 11:52 linuxkit-kernel</div><div class="line">drwxr-xr-x  2 vagrant vagrant 4.0K Sep  7 12:11 linuxkit-state</div><div class="line">-rw-rw-r--  1 vagrant vagrant 1.7K Sep  7 10:33 linuxkit.yml</div></pre></td></tr></table></figure>
<p>Mobyå’ŒLinuxKitæ˜¯éå¸¸ä¸é”™çš„å·¥å…·ï¼Œä½†ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬æ˜¯ç”¨ä¸ä¸Šçš„ã€‚å¦‚æœä½ éœ€è¦æ„å»ºå®šåˆ¶çš„linuxå‘è¡Œç‰ˆï¼Œé‚£ä»–ä»¬å¯ä»¥èŠ‚çº¦å¾ˆå¤šæ—¶é—´ã€‚ä½†å¦‚æœä½ åªæ˜¯æƒ³å°†åº”ç”¨æ”¾åœ¨å®¹å™¨é‡Œè·‘èµ·æ¥ï¼Œé‚£è¿˜æ˜¯ç›´æ¥ç”¨Dockerå§ï¼</p>
<p>å¦å¤–ï¼ŒMobyå’ŒLinuxKitåº”è¯¥è¿˜æ²¡æœ‰æˆç†Ÿï¼Œå‘½ä»¤ä¸€å¤©ä¸€ä¸ªå˜åŒ–ï¼ˆå¤¸å¼ äº†ï¼‰ï¼Œå¦‚æœä½ å‘ç°ä¸Šé¢çš„å‘½ä»¤å¤±æ•ˆäº†ï¼Œå»ºè®®googleä¸€ä¸‹ï¼Œæˆ–è€…è”ç³»æˆ‘ï¼ˆçŸ¥ä¹ or whaterverï¼‰</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/07/æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤dockerç³»åˆ—æ–‡ç« ç›®å½•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/07/æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤dockerç³»åˆ—æ–‡ç« ç›®å½•/" itemprop="url">æµ™æ±Ÿå¤§å­¦SELå®éªŒå®¤Dockerç³»åˆ—æ–‡ç« ç›®å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-07T17:24:33+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.sel.zju.edu.cn/?p=112" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸€ï¼‰ï¼šDOCKERæ¶æ„</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=147" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆäºŒï¼‰ï¼šDOCKER CLIENTåˆ›å»ºä¸å‘½ä»¤æ‰§è¡Œ</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=158" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸‰ï¼‰ï¼šDOCKER DAEMONå¯åŠ¨</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=165" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå››ï¼‰ï¼šDOCKER DAEMONä¹‹NEWDAEMONå®ç°</a>-2014.12.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=259" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆäº”ï¼‰ï¼šDOCKER SERVERçš„åˆ›å»º</a>-2014.12.09</p>
<p><a href="http://www.sel.zju.edu.cn/?p=399" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå…­ï¼‰ï¼šDOCKER DAEMONç½‘ç»œ</a>-2015.01.05</p>
<p><a href="http://www.sel.zju.edu.cn/?p=508" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¸ƒï¼‰ï¼šDOCKER CONTAINERç½‘ç»œ ï¼ˆä¸Šï¼‰</a>-2015.01.26</p>
<p><a href="http://www.sel.zju.edu.cn/?p=537" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆå…«ï¼‰ï¼šDOCKER CONTAINERç½‘ç»œï¼ˆä¸‹ï¼‰</a>-2015.03.12</p>
<p><a href="http://www.sel.zju.edu.cn/?p=549" target="_blank" rel="external">DOCKERæºç åˆ†æï¼ˆä¹ï¼‰ï¼šDOCKERé•œåƒ</a>-2015.03.12</p>
<p><a href="http://www.sel.zju.edu.cn/?p=444" target="_blank" rel="external">DOCKERç½‘ç»œè¯¦è§£åŠPIPEWORKæºç è§£è¯»ä¸å®è·µ</a>-2015.01.16</p>
<p><a href="http://www.sel.zju.edu.cn/?p=556" target="_blank" rel="external">DOCKERèƒŒåçš„å†…æ ¸çŸ¥è¯†â€”â€”NAMESPACEèµ„æºéš”ç¦»</a>-2015.03.13</p>
<p><a href="http://www.sel.zju.edu.cn/?p=573" target="_blank" rel="external">DOCKERèƒŒåçš„å†…æ ¸çŸ¥è¯†â€”â€”CGROUPSèµ„æºé™åˆ¶</a>-2015.04.22</p>
<p><a href="http://www.sel.zju.edu.cn/?p=577" target="_blank" rel="external">DOCKERèƒŒåçš„å®¹å™¨ç®¡ç†â€”â€”LIBCONTAINERæ·±åº¦è§£æ</a>-2015.06.03</p>
<p><a href="http://www.sel.zju.edu.cn/?p=296" target="_blank" rel="external">ç©è½¬DOCKERé•œåƒ</a>-2014.12.16</p>
<p><a href="http://www.sel.zju.edu.cn/?p=467" target="_blank" rel="external">æ·±å…¥ç†è§£ETCDæŠ€æœ¯åˆ†äº«PPT</a>-2015.01.20</p>
<p><a href="http://www.sel.zju.edu.cn/?p=523" target="_blank" rel="external">ETCDï¼šä»åº”ç”¨åœºæ™¯åˆ°å®ç°åŸç†çš„å…¨æ–¹ä½è§£è¯»</a>-2015.02.01</p>
<p><a href="http://www.sel.zju.edu.cn/?p=283" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹å®‰å…¨ç¯‡</a>-2014.12.11</p>
<p><a href="http://www.sel.zju.edu.cn/?p=331" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹PODç¯‡</a>-2014.12.19</p>
<p><a href="http://www.sel.zju.edu.cn/?p=360" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹æœåŠ¡ç¯‡</a>-2014.12.23</p>
<p><a href="http://www.sel.zju.edu.cn/?p=353" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹ç½‘ç»œç¯‡</a>-2014.12.29</p>
<p><a href="http://www.sel.zju.edu.cn/?p=394" target="_blank" rel="external">GOOGLE KUBERNETESè®¾è®¡æ–‡æ¡£ä¹‹VOLUMES</a>-2015.01.02</p>
<p><a href="http://www.sel.zju.edu.cn/?p=417" target="_blank" rel="external">KUBERNETES MINION NODE ç»„ä»¶ ä¹‹ KUBELET</a>-2015.01.13</p>
<p><a href="http://www.sel.zju.edu.cn/?p=484" target="_blank" rel="external">KUBERNETESä»£ç èµ°è¯»ä¹‹MINION NODE ç»„ä»¶ KUBE-PROXY</a>-2015.01.22</p>
<p><a href="http://www.sel.zju.edu.cn/?p=588" target="_blank" rel="external">4S: SERVICES ACCOUNT, SECRET, SECURITY CONTEXT AND SECURITY IN KUBERNETES</a>-2015.07.30</p>
<p><a href="http://www.sel.zju.edu.cn/?p=595" target="_blank" rel="external">KUBERNETES NODE COMPONENTS â€“ KUBELET</a>-2015.08.07</p>
<p><a href="http://www.sel.zju.edu.cn/?p=609" target="_blank" rel="external">KUBERNETES APISERVERæºç åˆ†æâ€”â€”APIè¯·æ±‚çš„è®¤è¯è¿‡ç¨‹</a>-2015.08.09</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/02/pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="You Wangqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/lufei.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Youmai ã® Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/02/pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²/" itemprop="url">pythonå­—ç¬¦ç¼–ç å’Œå­—ç¬¦ä¸²</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-02T22:35:33+08:00">
                2017-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>èƒŒæ™¯ï¼šæˆ‘å¸ä»£ç éƒ½æ˜¯åŸºäºpython2</p>
<p>ä»Šå¤©æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œç”¨æˆ·æäº¤çš„è¯„è®ºå­—æ•°å¦‚æœå¤§äº20ä¸ªå­—è¦ç»™ç”¨æˆ·å‘çº¢åŒ…ã€‚æ¯«ä¸è¿Ÿç–‘ï¼Œæˆ‘å†™ä¸‹äº†ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> len(content) &gt; <span class="number">20</span>:</div><div class="line">	<span class="comment"># å‘çº¢åŒ…</span></div></pre></td></tr></table></figure>
<p>æˆ‘è½¬å¿µä¸€æƒ³ï¼Œäº‹æƒ…ä¸å¤§å¯¹ï¼Œæˆ‘è¿™ç®—çš„æ˜¯å­—ç¬¦æ•°ï¼ˆè¿™ä¸ªè¡¨è¿°æ˜¯æ­£ç¡®çš„ï¼Œæ˜¯å­—ç¬¦ï¼‰å•Š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"abcd"</span>)  <span class="comment"># ç­‰äº4</span></div><div class="line">len(<span class="string">"I love python"</span>)  <span class="comment"># ç­‰äº13</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­æ˜¾è€Œæ˜“è§ï¼Œå°å­¦ç”Ÿæ°´å¹³ï¼Œå†çœ‹ä¸‹é¢çš„</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># è¿™ä¸ªè¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</span></div><div class="line">len(<span class="string">u"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># è¿™ä¸ªåˆè¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</span></div></pre></td></tr></table></figure>
<p>å¤§å®¶å¯ä»¥æœ¬åœ°æ‰“å¼€pythonè¯•ä¸€ä¸‹ï¼Œç»“æœæ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">len(<span class="string">"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># ç­‰äº21</span></div><div class="line">len(<span class="string">u"æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"</span>)  <span class="comment"># ç­‰äº7</span></div></pre></td></tr></table></figure>
<p>å…¶å®æˆ‘æƒ³è¦çš„æ˜¯ä¸‹é¢è¿™ä¸ªï¼Œä½†æ˜¯æˆ‘åœ¨ä»£ç é‡Œç›´æ¥é‚£ä¹ˆå†™ï¼Œæˆ‘æ“ä½œçš„å­—ç¬¦ä¸²å‰é¢åˆ°åº•æœ‰æ²¡æœ‰<code>u</code>å‘¢ï¼Œè¿™ä¸ª<code>u</code>æˆ‘çŸ¥é“æ˜¯<code>unicode</code>å­—ç¬¦ä¸²ï¼Œå®ƒå’Œæ²¡æœ‰<code>u</code>çš„å­—ç¬¦ä¸²åˆ°åº•åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ</p>
<p>å‡ å¹´å‰æˆ‘æ›¾ç»ä¸‹å†³å¿ƒå¼„æ‡‚è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½å½“æ—¶ä¹Ÿç¡®å®æ˜ç™½äº†ï¼Œä½†æ˜¯ç°åœ¨å·®ä¸å¤šå·²ç»å…¨å¿˜äº†ã€‚æˆ‘è‡ªå·±æ€»ç»“äº†ä¸€ä¸‹ï¼Œä¸€æ˜¯ä¹‹å‰ä¸€ç›´æ˜¯ç”¨python3ï¼Œpython3åšäº†ä¸€äº›ä¿®æ”¹ã€‚äºŒæ˜¯è¿™ä¸ªé—®é¢˜ç¡®å®ä¸åº”è¯¥äº¤ç»™ç¨‹åºå‘˜æ¥è§£å†³ï¼ˆæˆ‘æ‰¿è®¤æˆ‘çš„è®°æ€§ç¡®å®ä¸å¥½ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œæ—§çš„ç³»ç»Ÿé‚£ä¹ˆå¤šï¼Œéš¾ä¿ä½ ä¸‹æ¬¡è·³æ§½çš„å…¬å¸æ²¡æœ‰ä¸€äº›ä¸Šäº†å¹´çºªçš„ä»£ç ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥æ¢³ç†ä¸€ä¸‹å§ã€‚</p>
<h2 id="å­—ç¬¦ä¸å­—èŠ‚"><a href="#å­—ç¬¦ä¸å­—èŠ‚" class="headerlink" title="å­—ç¬¦ä¸å­—èŠ‚"></a>å­—ç¬¦ä¸å­—èŠ‚</h2><p>ä¸€ä¸ªå­—ç¬¦ä¸ç­‰ä»·äºä¸€ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦æ˜¯äººç±»èƒ½å¤Ÿè¯†åˆ«çš„ç¬¦å·ï¼Œè€Œè¿™äº›ç¬¦å·è¦ä¿å­˜åˆ°è®¡ç®—æœºçš„å­˜å‚¨ä¸­å°±éœ€è¦ç”¨è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å­—èŠ‚æ¥è¡¨ç¤ºã€‚ä¸€ä¸ªå­—ç¬¦å¾€å¾€æœ‰å¤šç§è¡¨ç¤ºæ–¹æ³•ï¼Œä¸åŒçš„è¡¨ç¤ºæ–¹æ³•ä¼šä½¿ç”¨ä¸åŒçš„å­—èŠ‚æ•°ã€‚è¿™é‡Œæ‰€è¯´çš„ä¸åŒçš„è¡¨ç¤ºæ–¹æ³•å°±æ˜¯æŒ‡<code>å­—ç¬¦ç¼–ç </code>ï¼Œæ¯”å¦‚å­—æ¯A-Zéƒ½å¯ä»¥ç”¨<code>ASCII</code>ç è¡¨ç¤ºï¼ˆå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨<code>UNICODE</code>è¡¨ç¤ºï¼ˆå ä¸¤ä¸ªå­—èŠ‚ï¼‰ï¼Œè¿˜å¯ä»¥ç”¨<code>UTF-8</code>è¡¨ç¤ºï¼ˆå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼‰ã€‚å­—ç¬¦ç¼–ç çš„ä½œç”¨å°±æ˜¯å°†äººç±»å¯è¯†åˆ«çš„å­—ç¬¦è½¬æ¢ä¸ºæœºå™¨å¯è¯†åˆ«çš„å­—èŠ‚ç ï¼Œä»¥åŠåå‘è¿‡ç¨‹ã€‚</p>
<p><strong>UNICDOEæ‰æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²ï¼Œè€Œç”¨ASCIIã€UTF-8ã€GBKç­‰å­—ç¬¦ç¼–ç è¡¨ç¤ºçš„æ˜¯å­—èŠ‚ä¸²</strong>ã€‚å…³äºè¿™ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Pythonçš„å®˜æ–¹æ–‡æ¡£ä¸­ç»å¸¸å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æè¿°<strong>â€œUnicode stringâ€</strong> , <strong>â€œtranslating a Unicode string into a sequence of bytesâ€</strong>ã€‚ï¼ˆæ³¨æ„ï¼šè‹±æ–‡ä¸­stringæ˜¯æˆ‘ä»¬è¯´çš„å­—ç¬¦ä¸²ï¼Œbytesæ˜¯å­—èŠ‚ä¸²ï¼‰</p>
<p>æˆ‘ä»¬å†™<code>ä»£ç </code>æ˜¯å†™åœ¨<code>æ–‡ä»¶</code>ä¸­çš„ï¼Œè€Œ<code>å­—ç¬¦</code>æ˜¯ä»¥<code>å­—èŠ‚</code>å½¢å¼ä¿å­˜åœ¨<code>æ–‡ä»¶</code>ä¸­çš„ï¼Œå› æ­¤å½“æˆ‘ä»¬åœ¨æ–‡ä»¶ä¸­å®šä¹‰ä¸ª<code>å­—ç¬¦ä¸²</code>æ—¶è¢«å½“åš<code>å­—èŠ‚ä¸²</code>ä¹Ÿæ˜¯å¯ä»¥ç†è§£çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œè€Œä¸æ˜¯<code>å­—èŠ‚ä¸²</code>ï¼ˆæˆ‘ä»¬å†™ä»£ç å¤„ç†çš„æ˜¯æˆ‘ä»¬èƒ½æƒ³è±¡çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ï¼Œåº”è¯¥ä¸ä¼šæœ‰äººæƒ³è±¡å­—èŠ‚ä¸²å§ï¼‰ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€ï¼Œåº”è¯¥ä¸¥æ ¼åŒºåˆ†ä¸¤è€…çš„å…³ç³»å¹¶æä¾›å·§å¦™çš„å®Œç¾çš„æ”¯æŒã€‚JAVAè¯­è¨€å°±å¾ˆå¥½ï¼Œæˆ‘è®¤è¯†çš„JAVAç¨‹åºå‘˜ä»æ¥æ²¡æœ‰è€ƒè™‘è¿‡è¿™äº›ä¸åº”è¯¥ç”±ç¨‹åºå‘˜æ¥å¤„ç†çš„é—®é¢˜ï¼ˆæˆ‘ä¸€ç›´è¿™ä¹ˆè®¤ä¸ºï¼‰ã€‚é—æ†¾çš„æ˜¯ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€è¯•å›¾æ··æ·†<code>â€œå­—ç¬¦ä¸²â€</code>å’Œ<code>â€œå­—èŠ‚ä¸²â€</code>ï¼Œä»–ä»¬<em>æŠŠå­—èŠ‚ä¸²å½“åšå­—ç¬¦ä¸²æ¥ä½¿ç”¨</em>ï¼ŒPHPå’ŒPython2éƒ½å±äºè¿™ç§ç¼–ç¨‹è¯­è¨€ã€‚æœ€èƒ½è¯´æ˜è¿™ä¸ªé—®é¢˜çš„æ“ä½œå°±æ˜¯å–ä¸€ä¸ªåŒ…å«ä¸­æ–‡å­—ç¬¦çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼š</p>
<ul>
<li>å¯¹<code>å­—ç¬¦ä¸²</code>å–é•¿åº¦ï¼Œç»“æœåº”è¯¥æ˜¯æ‰€æœ‰<code>å­—ç¬¦</code>çš„ä¸ªæ•°ï¼Œæ— è®ºä¸­æ–‡è¿˜æ˜¯è‹±æ–‡</li>
<li>å¯¹<code>å­—ç¬¦ä¸²</code>å¯¹åº”çš„<code>å­—èŠ‚ä¸²</code>å–é•¿åº¦ï¼Œå°±è·Ÿç¼–ç (encode)è¿‡ç¨‹ä½¿ç”¨çš„<code>å­—ç¬¦ç¼–ç </code>æœ‰å…³äº†(æ¯”å¦‚ï¼š<code>UTF-8ç¼–ç </code>ï¼Œä¸€ä¸ª<code>ä¸­æ–‡å­—ç¬¦</code>éœ€è¦ç”¨<code>3ä¸ªå­—èŠ‚</code>æ¥è¡¨ç¤ºï¼›<code>GBKç¼–ç </code>ï¼Œä¸€ä¸ª<code>ä¸­æ–‡å­—ç¬¦</code>éœ€è¦<code>2ä¸ªå­—èŠ‚</code>æ¥è¡¨ç¤º)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">7</span>]: a = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">9</span>]: <span class="keyword">print</span> len(a), type(a)</div><div class="line"><span class="number">2</span> &lt;type <span class="string">'unicode'</span>&gt;</div><div class="line"></div><div class="line">In [<span class="number">10</span>]: b = a.encode(<span class="string">'utf-8'</span>)</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: <span class="keyword">print</span> len(b), type(b)</div><div class="line"><span class="number">6</span> &lt;type <span class="string">'str'</span>&gt;</div><div class="line"></div><div class="line">In [<span class="number">12</span>]: c = a.encode(<span class="string">'gbk'</span>)</div><div class="line"></div><div class="line">In [<span class="number">13</span>]: <span class="keyword">print</span> len(c), type(c)</div><div class="line"><span class="number">4</span> &lt;type <span class="string">'str'</span>&gt;</div></pre></td></tr></table></figure>
<h2 id="ç¼–ç ä¸è§£ç "><a href="#ç¼–ç ä¸è§£ç " class="headerlink" title="ç¼–ç ä¸è§£ç "></a>ç¼–ç ä¸è§£ç </h2><p>UNICODEå­—ç¬¦ç¼–ç ï¼Œä¹Ÿæ˜¯ä¸€å¼ å­—ç¬¦ä¸æ•°å­—çš„æ˜ å°„ï¼Œä½†æ˜¯è¿™é‡Œçš„æ•°å­—è¢«ç§°ä¸ºä»£ç ç‚¹(code point), å®é™…ä¸Šå°±æ˜¯åå…­è¿›åˆ¶çš„æ•°å­—ã€‚</p>
<p><a href="https://docs.python.org/2/howto/unicode.html#encodings" target="_blank" rel="external">Pythonå®˜æ–¹æ–‡æ¡£</a>ä¸­å¯¹Unicodeå­—ç¬¦ä¸²ã€å­—èŠ‚ä¸²ä¸ç¼–ç ä¹‹é—´çš„å…³ç³»æœ‰è¿™æ ·ä¸€æ®µæè¿°ï¼š</p>
<pre><code>a Unicode string is a sequence of code points, which are numbers from 0 to 0x10ffff.
This sequence needs to be represented as a set of bytes (meaning, values from 0â€“255) in memory.
The rules for translating a Unicode string into a sequence of bytes are called an encoding.

Unicodeå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªä»£ç ç‚¹ï¼ˆcode pointï¼‰åºåˆ—ï¼Œä»£ç ç‚¹å–å€¼èŒƒå›´ä¸º0åˆ°0x10FFFFï¼ˆå¯¹åº”çš„åè¿›åˆ¶ä¸º1114111ï¼‰ã€‚
è¿™ä¸ªä»£ç ç‚¹åºåˆ—åœ¨å­˜å‚¨ï¼ˆåŒ…æ‹¬å†…å­˜å’Œç‰©ç†ç£ç›˜ï¼‰ä¸­éœ€è¦è¢«è¡¨ç¤ºä¸ºä¸€ç»„å­—èŠ‚(0åˆ°255ä¹‹é—´çš„å€¼)ï¼Œ
è€Œå°†Unicodeå­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è§„åˆ™ç§°ä¸ºç¼–ç ã€‚
</code></pre><p>è¿™é‡Œè¯´çš„ç¼–ç ä¸æ˜¯æŒ‡å­—ç¬¦ç¼–ç ï¼Œè€Œæ˜¯æŒ‡<strong>ç¼–ç çš„è¿‡ç¨‹ä»¥åŠè¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨åˆ°çš„Unicodeå­—ç¬¦çš„ä»£ç ç‚¹ä¸å­—èŠ‚çš„æ˜ å°„è§„åˆ™</strong>ã€‚è¿™ä¸ªæ˜ å°„ä¸å¿…æ˜¯ç®€å•çš„ä¸€å¯¹ä¸€æ˜ å°„ï¼Œå› æ­¤ç¼–ç è¿‡ç¨‹ä¹Ÿä¸å¿…å¤„ç†æ¯ä¸ªå¯èƒ½çš„Unicodeå­—ç¬¦ï¼Œä¾‹å¦‚ï¼š</p>
<p>å°†<code>Unicodeå­—ç¬¦ä¸²</code>è½¬æ¢ä¸º<code>ASCIIç¼–ç </code>çš„è§„åˆ™å¾ˆç®€å•â€“å¯¹äºæ¯ä¸ª<code>ä»£ç ç‚¹</code>ï¼š</p>
<ul>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&lt;128ï¼Œåˆ™æ¯ä¸ª<code>å­—èŠ‚</code>ä¸ä»£ç ç‚¹çš„å€¼ç›¸åŒ</li>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&gt;=128ï¼Œåˆ™<code>Unicodeå­—ç¬¦</code>æ— æ³•åœ¨æ­¤ç¼–ç ä¸­è¿›è¡Œè¡¨ç¤ºï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼ŒPythonä¼šå¼•å‘ä¸€ä¸ª<code>UnicodeEncodeError</code>å¼‚å¸¸ï¼‰</li>
</ul>
<p>å°†<code>Unicodeå­—ç¬¦ä¸²</code>è½¬æ¢ä¸º<code>UTF-8ç¼–ç </code>ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&lt;128ï¼Œåˆ™ç”±ç›¸åº”çš„<code>å­—èŠ‚å€¼</code>è¡¨ç¤ºï¼ˆä¸Unicodeè½¬ASCIIå­—èŠ‚ä¸€æ ·ï¼‰</li>
<li>å¦‚æœä»£ç ç‚¹æ•°å€¼&gt;=128ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª2ä¸ªå­—èŠ‚ï¼Œ3ä¸ªå­—èŠ‚æˆ–4ä¸ªå­—èŠ‚çš„åºåˆ—ï¼Œè¯¥åºåˆ—ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½åœ¨128åˆ°255ä¹‹é—´ã€‚</li>
</ul>
<p>ç®€å•æ€»ç»“ï¼š</p>
<ul>
<li>ç¼–ç (<code>encode</code>)ï¼šå°†<code>Unicodeå­—ç¬¦ä¸²</code>ï¼ˆä¸­çš„ä»£ç ç‚¹)è½¬æ¢ç‰¹å®š<code>å­—ç¬¦ç¼–ç </code>å¯¹åº”çš„<code>å­—èŠ‚ä¸²</code>çš„è¿‡ç¨‹å’Œè§„åˆ™</li>
<li>è§£ç (decode)ï¼šå°†<strong>ç‰¹å®šå­—ç¬¦ç¼–ç çš„å­—èŠ‚ä¸²</strong>è½¬æ¢ä¸ºå¯¹åº”çš„<strong>Unicodeå­—ç¬¦ä¸²</strong>(ä¸­çš„ä»£ç ç‚¹)çš„è¿‡ç¨‹å’Œè§„åˆ™</li>
</ul>
<p>å¯è§ï¼Œæ— è®ºæ˜¯ç¼–ç è¿˜æ˜¯è§£ç ï¼Œéƒ½éœ€è¦ä¸€ä¸ªé‡è¦å› ç´ ï¼Œå°±æ˜¯ç‰¹å®šçš„å­—ç¬¦ç¼–ç ã€‚å› ä¸ºä¸€ä¸ªå­—ç¬¦ç”¨ä¸åŒçš„å­—ç¬¦ç¼–ç è¿›è¡Œç¼–ç åçš„å­—èŠ‚å€¼ä»¥åŠå­—èŠ‚ä¸ªæ•°å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸åŒçš„ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p>è€Œä¸”å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œç¼–ç å’Œè§£ç éƒ½æ˜¯åŸºäº<strong>Unicodeå­—ç¬¦ä¸²</strong>ï¼Œ<em>æ²¡æœ‰ç¬¬äºŒç§å­—ç¬¦ä¸²æºå’Œ</em>ï¼Œå…¶ä»–éƒ½æ˜¯ç¼–ç æ–¹å¼ï¼Œä¸€å®šè¦æ·±åˆ»åœ°è®¤è¯†åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<h2 id="Pythonç¼–ç "><a href="#Pythonç¼–ç " class="headerlink" title="Pythonç¼–ç "></a>Pythonç¼–ç </h2><h3 id="Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"></a>Pythonæºä»£ç æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç£ç›˜ä¸Šçš„æ–‡ä»¶éƒ½æ˜¯ä»¥<code>äºŒè¿›åˆ¶æ ¼å¼</code>å­˜æ”¾çš„ï¼Œå…¶ä¸­<code>æ–‡æœ¬æ–‡ä»¶</code>éƒ½æ˜¯ä»¥<code>æŸç§ç‰¹å®šç¼–ç </code>çš„<code>å­—èŠ‚</code>å½¢å¼å­˜æ”¾çš„ã€‚å¯¹äºç¨‹åºæºä»£ç æ–‡ä»¶çš„å­—ç¬¦ç¼–ç æ˜¯ç”±ç¼–è¾‘å™¨æŒ‡å®šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨vimæ¥ç¼–å†™Pythonç¨‹åºæ—¶ä¼šæŒ‡å®šæ–‡ä»¶ç¼–ç ä¸ºUTF-8ï¼Œé‚£ä¹ˆPythonä»£ç è¢«ä¿å­˜åˆ°ç£ç›˜æ—¶å°±ä¼šè¢«è½¬æ¢ä¸ºUTF-8ç¼–ç å¯¹åº”çš„å­—èŠ‚ï¼ˆencodeè¿‡ç¨‹ï¼‰åå†™å…¥ç£ç›˜ã€‚å½“æ‰§è¡ŒPythonä»£ç æ–‡ä»¶ä¸­çš„ä»£ç æ—¶ï¼ŒPythonè§£é‡Šå™¨åœ¨è¯»å–Pythonä»£ç æ–‡ä»¶ä¸­çš„å­—èŠ‚ä¸²ä¹‹åï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸ºUNICODEå­—ç¬¦ä¸²ï¼ˆdecodeè¿‡ç¨‹ï¼‰ä¹‹åæ‰æ‰§è¡Œåç»­æ“ä½œã€‚</p>
<p>ä¸Šé¢å·²ç»è§£é‡Šè¿‡ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼ˆdecodeï¼Œè§£ç ï¼‰éœ€è¦æˆ‘ä»¬æŒ‡å®šæ–‡ä»¶ä¸­ä¿å­˜çš„å­—èŠ‚ä½¿ç”¨çš„å­—ç¬¦ç¼–ç æ˜¯ä»€ä¹ˆï¼Œæ‰èƒ½çŸ¥é“è¿™äº›å­—èŠ‚åœ¨UNICODEè¿™å¼ ä¸‡å›½ç å’Œç»Ÿä¸€ç ä¸­æ‰¾åˆ°å…¶å¯¹åº”çš„ä»£ç ç‚¹æ˜¯ä»€ä¹ˆã€‚è¿™é‡ŒæŒ‡å®šå­—ç¬¦ç¼–ç çš„æ–¹å¼å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œä¸€å›¾èƒœåƒè¨€ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div></pre></td></tr></table></figure>
<p><img src="/img/python_source_file_execute.png" alt="pythonæºæ–‡ä»¶æ–‡ä»¶çš„æ‰§è¡Œè¿‡ç¨‹"></p>
<h3 id="é»˜è®¤ç¼–ç "><a href="#é»˜è®¤ç¼–ç " class="headerlink" title="é»˜è®¤ç¼–ç "></a>é»˜è®¤ç¼–ç </h3><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ä»£ç æ–‡ä»¶å¼€å§‹çš„éƒ¨åˆ†æŒ‡å®šå­—ç¬¦ç¼–ç ï¼ŒPythonè§£é‡Šå™¨ä¼šä½¿ç”¨å“ªç§å­—ç¬¦ç¼–ç æŠŠä»ä»£ç æ–‡ä»¶ä¸­è¯»å–åˆ°çš„å­—èŠ‚è½¬æ¢ä¸º<strong>UNICODEä»£ç ç‚¹</strong>å‘¢ï¼Ÿå°±åƒæˆ‘ä»¬é…ç½®æŸäº›è½¯ä»¶æ—¶ï¼Œæœ‰å¾ˆå¤šé»˜è®¤é€‰é¡¹ä¸€æ ·ï¼ŒPythonè§£é‡Šå™¨å†…éƒ¨è®¾ç½®äº†é»˜è®¤çš„<code>å­—ç¬¦ç¼–ç </code>ã€‚å› æ­¤å¤§å®¶æ‰€è¯´çš„Pythonä¸­æ–‡å­—ç¬¦é—®é¢˜å°±å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå½“æ— æ³•é€šè¿‡<strong>é»˜è®¤çš„å­—ç¬¦ç¼–ç </strong>å¯¹å­—èŠ‚è¿›è¡Œè½¬æ¢æ—¶ï¼Œå°±ä¼šå‡ºç°è§£ç é”™è¯¯(UnicodeEncodeError)ã€‚</p>
<p>Python2å’ŒPython3çš„è§£é‡Šå™¨ä½¿ç”¨çš„é»˜è®¤ç¼–ç æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>sys.getdefaultencoding()</code>æ¥è·å–é»˜è®¤ç¼–ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># python2</span></div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> sys</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: sys.getdefaultencoding()</div><div class="line">Out[<span class="number">3</span>]: <span class="string">'ascii'</span></div><div class="line"></div><div class="line"><span class="comment"># python3</span></div><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> sys</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: sys.getdefaultencoding()</div><div class="line">Out[<span class="number">3</span>]: <span class="string">'utf-8'</span></div></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œå¯¹äºPython2æ¥è®²ï¼ŒPythonè§£é‡Šå™¨åœ¨è¯»å–åˆ°ä¸­æ–‡å­—ç¬¦çš„å­—èŠ‚ç å°è¯•è§£ç æ“ä½œæ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹å½“å‰ä»£ç æ–‡ä»¶å¤´éƒ¨æ˜¯å¦æœ‰æŒ‡æ˜å½“å‰ä»£ç æ–‡ä»¶ä¸­ä¿å­˜çš„å­—èŠ‚ç å¯¹åº”çš„å­—ç¬¦ç¼–ç æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤å­—ç¬¦ç¼–ç â€ASCIIâ€è¿›è¡Œè§£ç å¯¼è‡´è§£ç å¤±è´¥ï¼Œå¯¼è‡´å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Non-ASCII character <span class="string">'\xc4'</span> <span class="keyword">in</span> file xxx.py on line <span class="number">11</span>, but no encoding declared; see http://python.org/dev/peps/pep<span class="number">-0263</span>/ <span class="keyword">for</span> details</div></pre></td></tr></table></figure>
<p>å¯¹äºPython3æ¥è®²ï¼Œæ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯Python3çš„è§£é‡Šå™¨ä»¥â€UTF-8â€ä½œä¸ºé»˜è®¤ç¼–ç ï¼Œä½†æ˜¯è¿™å¹¶ä¸è¡¨ç¤ºå¯ä»¥å®Œå…¨å…¼å®¹ä¸­æ–‡é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨Windowsä¸Šè¿›è¡Œå¼€å‘æ—¶ï¼ŒPythonå·¥ç¨‹åŠä»£ç æ–‡ä»¶éƒ½ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„GBKç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´Pythonä»£ç æ–‡ä»¶æ˜¯è¢«è½¬æ¢æˆGBKæ ¼å¼çš„å­—èŠ‚ç ä¿å­˜åˆ°ç£ç›˜ä¸­çš„ã€‚Python3çš„è§£é‡Šå™¨æ‰§è¡Œè¯¥ä»£ç æ–‡ä»¶æ—¶ï¼Œè¯•å›¾ç”¨UTF-8è¿›è¡Œè§£ç æ“ä½œæ—¶ï¼ŒåŒæ ·ä¼šè§£ç å¤±è´¥ï¼Œå¯¼è‡´å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SyntaxError: Non-UTF<span class="number">-8</span> code starting <span class="keyword">with</span> <span class="string">'\xc4'</span> <span class="keyword">in</span> file xxx.py on line <span class="number">11</span>, but no encoding declared; see http://python.org/dev/peps/pep<span class="number">-0263</span>/ <span class="keyword">for</span> details</div></pre></td></tr></table></figure>
<h2 id="å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²"><a href="#å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²" class="headerlink" title="å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²"></a>å†è°ˆpython2å’Œpython3ä¸­çš„å­—ç¬¦ä¸²</h2><p>å…¶å®Python3ä¸­å¯¹å­—ç¬¦ä¸²æ”¯æŒçš„æ”¹è¿›ï¼Œä¸ä»…ä»…æ˜¯æ›´æ”¹äº†é»˜è®¤ç¼–ç ï¼Œè€Œæ˜¯é‡æ–°è¿›è¡Œäº†å­—ç¬¦ä¸²çš„å®ç°ï¼Œè€Œä¸”å®ƒå·²ç»å®ç°äº†<strong>å¯¹UNICODEçš„å†…ç½®æ”¯æŒ</strong>ï¼Œä»è¿™æ–¹é¢æ¥è®²Pythonå·²ç»å’ŒJAVAç­‰è¯­è¨€ä¸€æ ·ä¼˜ç§€ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹Python2ä¸Python3ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p>
<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>Python2ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒç”±ä»¥ä¸‹ä¸‰ä¸ªç±»æä¾›</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">basestring</span><span class="params">(object)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">str</span><span class="params">(basestring)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">unicode</span><span class="params">(basestring)</span></span></div></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>help(str)</code>å’Œ<code>help(bytes)</code>ä¼šå‘ç°ç»“æœéƒ½æ˜¯<code>strç±»</code>çš„å®šä¹‰ï¼Œè¿™ä¹Ÿè¯´æ˜Python2ä¸­strå°±æ˜¯<strong>å­—èŠ‚ä¸²</strong>ï¼Œè€Œåæ¥çš„<strong>unicodeå¯¹è±¡å¯¹åº”æ‰æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²</strong>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: <span class="keyword">print</span> type(a), len(a)</div><div class="line">&lt;type <span class="string">'str'</span>&gt; <span class="number">6</span></div><div class="line"></div><div class="line">In [<span class="number">4</span>]: <span class="keyword">print</span> type(b), len(b)</div><div class="line">&lt;type <span class="string">'unicode'</span>&gt; <span class="number">2</span></div></pre></td></tr></table></figure>
<h3 id="python3"><a href="#python3" class="headerlink" title="python3"></a>python3</h3><p>Python3ä¸­å¯¹å­—ç¬¦ä¸²çš„æ”¯æŒè¿›è¡Œäº†å®ç°ç±»å±‚æ¬¡çš„ä¸Šç®€åŒ–ï¼Œå»æ‰äº†unicodeç±»ï¼Œæ·»åŠ äº†ä¸€ä¸ªbytesç±»ã€‚ä»è¡¨é¢ä¸Šæ¥çœ‹ï¼Œå¯ä»¥è®¤ä¸ºPython3ä¸­çš„strå’ŒunicodeåˆäºŒä¸ºä¸€äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">bytes</span><span class="params">(object)</span></span></div><div class="line"><span class="class"><span class="title">class</span> <span class="title">str</span><span class="params">(object)</span></span></div></pre></td></tr></table></figure>
<p>å®é™…ä¸Šï¼ŒPython3ä¸­å·²ç»æ„è¯†åˆ°ä¹‹å‰çš„é”™è¯¯ï¼Œå¼€å§‹æ˜ç¡®çš„åŒºåˆ†å­—ç¬¦ä¸²ä¸å­—èŠ‚ã€‚å› æ­¤Python3ä¸­çš„strå·²ç»æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²ï¼Œè€Œå­—èŠ‚æ˜¯ç”¨å•ç‹¬çš„bytesç±»æ¥è¡¨ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒPython3é»˜è®¤å®šä¹‰çš„å°±æ˜¯å­—ç¬¦ä¸²ï¼Œå®ç°äº†å¯¹UNICODEçš„å†…ç½®æ”¯æŒï¼Œå‡è½»äº†ç¨‹åºå‘˜å¯¹å­—ç¬¦ä¸²å¤„ç†çš„è´Ÿæ‹…ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = <span class="string">u"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: c = a.encode(<span class="string">"gbk"</span>)</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: print(type(a), len(a))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2</span></div><div class="line"><span class="class"></span></div><div class="line"><span class="class"><span class="title">In</span> [5]:</span> print(type(b), len(b))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt; 2</span></div><div class="line"><span class="class"></span></div><div class="line"><span class="class"><span class="title">In</span> [6]:</span> print(type(c), len(c))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">bytes</span>'&gt; 4</span></div></pre></td></tr></table></figure>
<h2 id="å­—ç¬¦ç¼–ç è½¬æ¢"><a href="#å­—ç¬¦ç¼–ç è½¬æ¢" class="headerlink" title="å­—ç¬¦ç¼–ç è½¬æ¢"></a>å­—ç¬¦ç¼–ç è½¬æ¢</h2><p>ä¸Šé¢æåˆ°ï¼ŒUNICODEå­—ç¬¦ä¸²å¯ä»¥ä¸ä»»æ„å­—ç¬¦ç¼–ç çš„å­—èŠ‚è¿›è¡Œç›¸äº’è½¬æ¢ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/img/unicode_string.png" alt="unicode å­—ç¬¦ä¸²"></p>
<p>é‚£ä¹ˆå¤§å®¶å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸åŒçš„å­—ç¬¦ç¼–ç çš„å­—èŠ‚å¯ä»¥é€šè¿‡Unicodeç›¸äº’è½¬æ¢å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p>
<p><strong>Python2ä¸­çš„å­—ç¬¦ä¸²è¿›è¡Œå­—ç¬¦ç¼–ç è½¬æ¢è¿‡ç¨‹æ˜¯</strong>ï¼š</p>
<p>å­—èŠ‚ä¸²â€“&gt;decode(â€˜åŸæ¥çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;Unicodeå­—ç¬¦ä¸²â€“&gt;encode(â€˜æ–°çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;å­—èŠ‚ä¸²</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span>  <span class="comment"># utf-8ç¼–ç çš„å­—èŠ‚ä¸²</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = a.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>)  <span class="comment"># å…ˆè½¬æ¢æˆunicodeå­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œgbkç¼–ç </span></div><div class="line"></div><div class="line">In [<span class="number">3</span>]: <span class="keyword">print</span> b.decode(<span class="string">'gbk'</span>)  <span class="comment"># è§£ç æˆunicodeå­—ç¬¦ä¸²</span></div><div class="line">ä¸­å›½</div></pre></td></tr></table></figure>
<p><strong>Python3ä¸­å®šä¹‰çš„å­—ç¬¦ä¸²é»˜è®¤å°±æ˜¯unicodeï¼Œå› æ­¤ä¸éœ€è¦å…ˆè§£ç ï¼Œå¯ä»¥ç›´æ¥ç¼–ç æˆæ–°çš„å­—ç¬¦ç¼–ç ï¼š</strong></p>
<p>å­—ç¬¦ä¸²â€“&gt;encode(â€˜æ–°çš„å­—ç¬¦ç¼–ç â€™)â€“&gt;å­—èŠ‚ä¸²</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: a = <span class="string">"ä¸­å›½"</span></div><div class="line"></div><div class="line">In [<span class="number">2</span>]: b = a.encode(<span class="string">"gbk"</span>)</div><div class="line"></div><div class="line">In [<span class="number">3</span>]: print(b.decode(<span class="string">"gbk"</span>))</div><div class="line">ä¸­å›½</div></pre></td></tr></table></figure>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>pythonå­—ç¬¦ä¸²ç¼–ç å·®ä¸å¤šå°±æ˜¯è¿™äº›å†…å®¹äº†ï¼Œææ¸…æ¥šåŸç†å…¶å®è®°å¿†ä¹Ÿä¸éš¾ã€‚ç¥å¤§å®¶ä¸ä¼šå†æ‰åˆ°pythonå­—ç¬¦ç¼–ç çš„å‘ä¸­ï¼Œç¥æˆ‘å¸èƒ½å°½å¿«è¿ç§»åˆ°python3ï¼</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/img/lufei.jpeg"
               alt="You Wangqiu" />
          <p class="site-author-name" itemprop="name">You Wangqiu</p>
           
              <p class="site-description motion-element" itemprop="description">ä¸–ä¹‹å¥‡ä¼Ÿã€ç‘°æ€ªï¼Œéå¸¸ä¹‹è§‚ï¼Œå¸¸åœ¨äºé™©è¿œï¼Œè€Œäººä¹‹æ‰€ç½•è‡³ç„‰ï¼Œæ•…éæœ‰å¿—è€…ä¸èƒ½è‡³ä¹Ÿ</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">163</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/michaelyou" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhi-yu-65-2" target="_blank" title="çŸ¥ä¹">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      çŸ¥ä¹
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="michaelseu2011@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">You Wangqiu</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
